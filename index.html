<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<title>Wiki for lab</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sa {
  color: #000000;
  font-weight: bold;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Wiki for lab</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_application_architecture">1. Application Architecture</a></li>
<li><a href="#_java_core">2. Java Core</a></li>
<li><a href="#_spring_framework">3. Spring Framework</a>
<ul class="sectlevel2">
<li><a href="#_spring_core">3.1. Spring Core</a></li>
</ul>
</li>
<li><a href="#_jakarta_servlet">4. Jakarta Servlet</a></li>
<li><a href="#_java_tools">5. Java Tools</a>
<ul class="sectlevel2">
<li><a href="#_junit">5.1. JUnit</a></li>
<li><a href="#_mockito">5.2. Mockito</a></li>
<li><a href="#_liquibase">5.3. Liquibase</a></li>
<li><a href="#_logging">5.4. Logging</a></li>
</ul>
</li>
<li><a href="#_sql">6. SQL</a>
<ul class="sectlevel2">
<li><a href="#_основные_понятия_sql">6.1. Основные понятия SQL</a></li>
<li><a href="#_манипуляция_данными">6.2. Манипуляция данными</a></li>
<li><a href="#_многотабличные_базы_данных">6.3. Многотабличные базы данных</a></li>
<li><a href="#_агрегатные_функции_и_группировка">6.4. Агрегатные функции и группировка</a></li>
<li><a href="#_проектирование_баз_данных">6.5. Проектирование баз данных</a></li>
<li><a href="#_продвинутый_sql">6.6. Продвинутый SQL</a></li>
<li><a href="#_объекты_бд">6.7. Объекты БД</a></li>
<li><a href="#_analytical_functions">6.8. Analytical functions</a></li>
</ul>
</li>
<li><a href="#_common">7. Common</a>
<ul class="sectlevel2">
<li><a href="#_github_keys">7.1. GitHub keys</a></li>
<li><a href="#_тестирование">7.2. Тестирование</a></li>
<li><a href="#_web_services">7.3. Web services</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Wiki for lab.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_application_architecture">1. Application Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Moved to <a href="https://github.com/rakovets/wiki" class="bare">https://github.com/rakovets/wiki</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_java_core">2. Java Core</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Moved to <a href="https://github.com/rakovets/wiki" class="bare">https://github.com/rakovets/wiki</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_framework">3. Spring Framework</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_spring_core">3.1. Spring Core</h3>
<div class="paragraph">
<p><strong>Spring Framework</strong> – это framework, который облегчает и ускоряет разработку приложений на Java.</p>
</div>
<div class="paragraph">
<p>Ключевым элементом <strong>Spring Framework</strong> является <strong>Spring Container</strong>, который выполняет основные функции:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>IoC</strong> – <strong>Inversion of Control</strong> (Создание и управление объектами);</p>
</li>
<li>
<p><strong>DI</strong> – <strong>Dependency Injection</strong> (внедрение зависимостей).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Container</strong> создаёт объекты, связывает их вместе, настраивает и управляет ими от создания до момента уничтожения. Эти объекты называются <strong>Spring Bean</strong>. Beans после создания помещаются в <strong>Spring Container</strong>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../assets/img/java/spring/core/spring-container.png" alt="spring container"></span></p>
</div>
<div class="paragraph">
<p>В <strong>Spring</strong> имеется 2 различных вида контейнеров:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>BeanFactory</strong>;</p>
</li>
<li>
<p><strong>ApplicationContext</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>BeanFactory Container</strong> самый простой контейнер, обеспечивающий базовую поддержку <strong>DI</strong> и который основан на интерфейсе <code>org.springframework.beans.factory.BeanFactory</code>. Такие интерфейсы, как <code>BeanFactoryAware</code> и <code>DisposableBean</code> всё ещё присутствуют в <strong>Spring</strong> для обеспечения обратной совместимости. Наиболее часто используемая реализация интерфейса <code>BeanFactory</code> – <code>XmlBeanFactory</code>. <code>XmlBeanFactory</code> получает метаданные из конфигурационного <strong>XML</strong> файла и использует его для создания настроенного приложения или системы.</p>
</div>
<div class="paragraph">
<p><strong>BeanFactory Container</strong> обычно используется тогда, когда ресурсы ограничены (мобильные устройства). Поэтому, если ресурсы не сильно ограничены, то лучше использовать <strong>ApplicationContext</strong>.</p>
</div>
<div class="paragraph">
<p>Для того чтобы <strong>Spring Container</strong> мог создать и поместить в себя Beans необходимы:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Java</strong> классы (<strong>POJO</strong>), из которых создаются Beans</p>
</li>
<li>
<p>метаданные, которые подсказывают что и как создавать</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../assets/img/java/spring/core/spring-ioc-container.png" alt="spring ioc container"></span></p>
</div>
<div class="paragraph">
<p>Эти метаданные можно сконфигурировать несколькими способами:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Xml</strong> конфигурация;</p>
</li>
<li>
<p><strong>Groovy</strong> конфигурация;</p>
</li>
<li>
<p>Конфигурация через аннотации;</p>
</li>
<li>
<p>Конфигурация через <strong>Java</strong>-код.</p>
</li>
<li>
<p>и т.д.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_bean_и_его_атрибуты">3.1.1. Bean и его атрибуты</h4>
<div class="paragraph">
<p><strong>Bean</strong> – это объект, экземпляр которого создается, собирается и иным образом управляется контейнером <strong>IoC Spring</strong> (создание, вызов методов инициализации и конфигурирование объектов путем связывания между собой).</p>
</div>
<div class="paragraph">
<p>Объекты, которые составляют основу приложения и управляются контейнером <strong>IoC Spring</strong>, называются <strong>Components</strong> (<strong>компонентами</strong> или управляемые Java-объект).</p>
</div>
<div class="paragraph">
<p>Определение <strong>Beans</strong> содержит метаданные конфигурации, которые необходимы управляющему контейнеру для получения следующей информации:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Как создать бин;</p>
</li>
<li>
<p>Информацию о жизненном цикле бина;</p>
</li>
<li>
<p>Зависимости бина.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>С помощью этих метаданных (атрибуты бина) мы можем настраивать бины.</p>
</div>
<div class="paragraph">
<p><strong>Bean</strong> имеет следующие атрибуты:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>class</strong> - этот атрибут является обязательным и указывает конкретный класс Java-приложения, который будет использоваться для создания бина.</p>
</li>
<li>
<p><strong>id</strong>/<strong>name</strong>- уникальный идентификатор бина. В случае конфигурации с помощью <strong>xml</strong>-файла, вы можете использовать свойство <code>id</code> и/или <code>name</code> для идентификации бина.</p>
</li>
<li>
<p><strong>scope</strong> - это свойство определяет область видимости создаваемых объектов.</p>
</li>
<li>
<p><strong>constructor-arg</strong> - определяет конструктор, использующийся для внедрения зависимости. Имеет атрибут <code>ref</code>, который указывает на <code>id</code> бина с которым нужно связываться.</p>
</li>
<li>
<p><strong>properties</strong> - определяет свойства внедрения зависимости.</p>
</li>
<li>
<p><strong>initialization method</strong> - здесь определяется метод инициализации бина</p>
</li>
<li>
<p><strong>destruction method</strong> - метод уничтожения бина, который будет использоваться при уничтожении контейнера, содержащего бин.</p>
</li>
<li>
<p><strong>autowiring mode</strong> - определяет режим автоматического связывания при внедрении зависимости.</p>
</li>
<li>
<p><strong>lazy-initialization mode</strong> - режим ленивой инициализации даёт контейнеру <strong>IoC</strong> команду создавать экземпляр бина при первом запросе, а не при запуске приложения.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_bean_scopes">3.1.2. Bean Scopes</h4>
<div class="paragraph">
<p>Очень важной особенностью является задание области применения бинов. По умолчанию всегда используется <strong>singleton</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Scope</strong> (область видимости) определяет:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>жизненный цикл бина;</p>
</li>
<li>
<p>возможное количество создаваемых бинов.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Разновидности <strong>bean scope</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Singleton</strong> – тип бина, при котором, создается одна сущность на <strong>Spring-контейнер</strong> (значение по умолчанию)</p>
</li>
<li>
<p><strong>Prototype</strong> – тип бина, при котором, каждый раз создается новая сущность бина.</p>
</li>
<li>
<p><strong>Request</strong> – тип бина, при котором сущность бина создается одна на request. Такой тип бина справедлив для контекста веб-приложения.</p>
</li>
<li>
<p><strong>Session</strong> – тип бина, при котором сущность бина создается только одна на объект http-session. Такой тип бина справедлив для контекста веб-приложения.</p>
</li>
<li>
<p><strong>Global-session</strong> – тип бина, при котором сущность бина одна создается на приложение. Такой тип бина справедлив для контекста портлета.</p>
</li>
<li>
<p><strong>Application</strong> – тип бина, задаваемый в единственном экземпляре на контекст сервлета. Действителен для контекста веб-приложения.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_конфигурация">3.1.3. Конфигурация</h4>
<div class="paragraph">
<p>Как указывалось выше, существует 4 вида конфигурации метаданных для создания бинов:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Xml конфигурация</strong> — <code>ClassPathXmlApplicationContext("context.xml")</code>;</p>
</li>
<li>
<p><strong>Groovy конфигурация</strong> — <code>GenericGroovyApplicationContext("context.groovy")</code>;</p>
</li>
<li>
<p>Конфигурация через аннотации с указанием пакета для сканирования — <code>AnnotationConfigApplicationContext("package.name")</code>;</p>
</li>
<li>
<p><strong>JavaConfig</strong> — конфигурация через аннотации с указанием класса (или массива классов) помеченного аннотацией <code>@Configuration</code> — <code>AnnotationConfigApplicationContext(JavaConfig.class)</code>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_xml_конфигурация">Xml конфигурация</h5>
<div class="paragraph">
<p>Чтобы использовать настройку через xml-файл, необходимо создать <code>ClassPathXmlApplicationContext</code> и в параметры передать <strong>CLASSPATH</strong> xml-файла.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"applicationContext.xml"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ниже приведен пример простого конфигурационного файла <strong>xml</strong> <code>applicationContext.xml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/context
    http://www.springframework.org/schema/context/spring-context.xsd"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id =</span> <span class="s">"villain"</span> <span class="na">class =</span> <span class="s">"film.Villain"</span> <span class="na">lazy-init=</span> <span class="s">"true"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name =</span> <span class="s">"name"</span> <span class="na">value =</span> <span class="s">"Vasily"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_groovy_конфигурация">Groovy конфигурация</h5>
<div class="paragraph">
<p>При конфигурации контекста с помощью <strong>groovy</strong>-файла, необходимо сформировать <code>GenericGroovyApplicationContext</code>, который принимает на вход строку с конфигурацией контекста. Эта конфигурация работает по сути так же, как и <strong>xml</strong>, только с <strong>groovy</strong>-файлами. К тому же, <code>GroovyApplicationContext</code> нормально работает и с <strong>xml</strong>-файлом.</p>
</div>
<div class="paragraph">
<p>Пример простого конфигурационного <strong>Groovy</strong>-файла:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="groovy"><span class="n">beans</span> <span class="o">{</span>
    <span class="n">goodOperator</span><span class="o">(</span><span class="n">film</span><span class="o">.</span><span class="na">Operator</span><span class="o">)</span> <span class="o">{</span><span class="n">bean</span> <span class="o">-</span> <span class="o">&gt;</span>
            <span class="n">bean</span><span class="o">.</span><span class="na">lazyInit</span> <span class="o">=</span> <span class="s1">'true'</span> <span class="o">&gt;</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">'Good Oleg'</span>
         <span class="o">}</span>
    <span class="n">badOperator</span><span class="o">(</span><span class="n">film</span><span class="o">.</span><span class="na">BadOperator</span><span class="o">){</span><span class="n">bean</span> <span class="o">-</span> <span class="o">&gt;</span>
            <span class="n">bean</span><span class="o">.</span><span class="na">lazyInit</span> <span class="o">=</span> <span class="s1">'true'</span> <span class="o">&gt;</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">'Bad Oleg'</span> <span class="o">/</span> <span class="o">&gt;</span>
        <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_конфигурация_через_аннотации">Конфигурация через аннотации</h5>
<div class="paragraph">
<p>При конфигурации через аннотации используются следующие аннотации:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Component</code></p>
</li>
<li>
<p><code>@Repository</code></p>
</li>
<li>
<p><code>@Service</code></p>
</li>
<li>
<p><code>@Controller</code></p>
</li>
<li>
<p><code>@RestController</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CoolDaoImpl</span> <span class="kd">implements</span> <span class="nc">CoolDao</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doCRUD</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">//some logic here</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Service</span>
<span class="nd">@Scope</span><span class="o">(</span><span class="nc">BeanDefinition</span><span class="o">.</span><span class="na">SCOPE_PROTOTYPE</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CoolServiceImpl</span> <span class="kd">implements</span> <span class="nc">CoolService</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">CoolDao</span> <span class="n">dao</span><span class="o">;</span>

    <span class="nd">@PostConstruct</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">//init logic here</span>
    <span class="o">}</span>

    <span class="nd">@PreDestroy</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">closeResources</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">//close resources here</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doWork</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">dao</span><span class="o">.</span><span class="na">doCRUD</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_конфигурация_через_java_код">Конфигурация через Java-код</h5>
<div class="paragraph">
<p>Центральными артефактами при конфигурации через <strong>Java</strong> в <strong>Spring</strong> являются <code>@Configuration</code> и <code>@Bean</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JavaConfig</span> <span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">ClassName</span> <span class="nf">getClassName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ClassName</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span><span class="o">(</span><span class="n">initMethod</span> <span class="o">=</span> <span class="s">"init"</span><span class="o">,</span> <span class="n">destroyMethod</span> <span class="o">=</span> <span class="s">"closeResources"</span><span class="o">)</span>
    <span class="nd">@Scope</span><span class="o">(</span><span class="nc">BeanDefinition</span><span class="o">.</span><span class="na">SCOPE_PROTOTYPE</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ClassName2</span> <span class="nf">getClassName2</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">ClassName2</span> <span class="n">className</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ClassName2</span><span class="o">();</span>
        <span class="n">className</span><span class="o">.</span><span class="na">getClassName</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">service</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_applicationcontext">3.1.4. ApplicationContext</h4>
<div class="paragraph">
<p><code>ApplicationContext</code> — это главный интерфейс в <strong>Spring</strong>-приложении, который предоставляет информацию о конфигурации приложения.</p>
</div>
<div class="paragraph">
<p><code>ApplicationContext</code> представляет собой <strong>Spring Container</strong>, место, где хранятся все созданные бины. Поэтому для получения бина из <strong>Spring Container</strong> нам нужно создать <code>ApplicationContext</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">"applicationContext.xml"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Чаще всего используются следующие реализации <code>ApplicationContext</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FileSystemXmlApplicationContext</code> - загружает данные о бине из xml-файла. При использовании этой реализации в конструкторе необходимо указать полный адрес конфигурационного файла.</p>
</li>
<li>
<p><code>ClassPathXmlApplicationContext</code> - этот контейнер также получает данные о бине из xml-файла. Но в отличие от <code>FileSystemApplicationContext</code>, в этом случае необходимо указать относительный адрес конфигурационного файла (<strong>CLASSPATH</strong>).</p>
</li>
<li>
<p><code>WebXmlApplicationContext</code> - эта реализация <code>ApplicationContext</code> получает необходимую информацию из веб-приложения.</p>
</li>
<li>
<p><code>AnnotationConfigApplicationContext</code> - конфигурация через аннотации с указанием пакета для сканирования</p>
</li>
<li>
<p><code>GenericGroovyApplicationContext</code> - конфигурация через <strong>groovy</strong>-файл</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>На рисунке ниже приведены этапы формирования <code>ApplicationContext</code>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../assets/img/java/spring/core/stages-of-context-initialization.png" alt="stages of context initialization"></span></p>
</div>
<div class="sect4">
<h5 id="_парсинг_конфигурации_и_создание_beandefinition">Парсинг конфигурации и создание <code>BeanDefinition</code></h5>
<div class="paragraph">
<p>На первом этапе происходит чтение конфигураций и создание <code>BeanDefinition</code>.</p>
</div>
<div class="paragraph">
<p><code>BeanDefinition</code> — это специальный интерфейс, через который можно получить доступ к метаданным будущего бина. В зависимости от того, какая у вас конфигурация, будет использоваться тот или иной механизм парсинга конфигурации.</p>
</div>
<div class="sect5">
<h6 id="_xml_config">XML config</h6>
<div class="paragraph">
<p>Для <strong>xml</strong> конфигурации используется класс — <code>XmlBeanDefinitionReader</code>, который реализует интерфейс <code>BeanDefinitionReader</code>. <code>XmlBeanDefinitionReader</code> получает <code>InputStream</code> и загружает <code>Document</code> через <code>DefaultDocumentLoader</code>. Далее обрабатывается каждый элемент документа и если он является бином, то создается <code>BeanDefinition</code> на основе заполненных данных (<code>id</code>, <code>name</code>, <code>class</code>, <code>alias</code>, <code>init-method</code>, <code>destroy-method</code> и др.)</p>
</div>
<div class="paragraph">
<p>Каждый <code>BeanDefinition</code> помещается в <strong>map</strong>. <strong>Map</strong> хранится в классе <code>DefaultListableBeanFactory</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_groovy_config">Groovy config</h6>
<div class="paragraph">
<p>Конфигурация через <strong>groovy</strong> очень похожа на конфигурацию через <strong>xml</strong>, за исключением того, что в файл не <strong>xml</strong>, а <strong>groovy</strong>. Чтением и парсинг <strong>groovy</strong> конфигурации занимается класс <code>GroovyBeanDefinitionReader</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_annotations_based_config">Annotations-based config</h6>
<div class="paragraph">
<p>Для конфигурации через аннотации с указанием пакета для сканирования или <strong>JavaConfig</strong> используется класс <code>AnnotationConfigApplicationContext</code>. Этот класс имеет следующие поля, с помощью которых происходит создание <code>BeanDefinition</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AnnotatedBeanDefinitionReader</code>;</p>
</li>
<li>
<p><code>ClassPathBeanDefinitionScanner</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>ClassPathBeanDefinitionScanner</code> сканирует указанный пакет на наличие классов помеченных аннотацией <code>@Component</code> (или любой другой аннотацией которая включает в себя <code>@Component</code>). Найденные классы парсятся и для них создаются <code>BeanDefinition</code>.</p>
</div>
<div class="paragraph">
<p>Чтобы сканирование было запущено, в конфигурации должен быть указан пакет для сканирования. Вся магия работы с аннотациями, как в случае с <strong>xml</strong> и <strong>groovy</strong>, заключается именно в классе <code>ClassReader.class</code> из пакета <code>springframework.asm</code>. Специфика этого ридера заключается в том, что он умеет работать с байт-кодом. То есть, ридер достает <code>InputStream</code> из байт-кода, сканирует его и ищет там аннотации.</p>
</div>
<div class="paragraph">
<p><code>AnnotatedBeanDefinitionReader</code> работает в несколько этапов.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Первый этап</strong>: регистрация всех <code>@Configuration</code> для дальнейшего парсинга.<br>
Если в конфигурации используются <code>@Conditional</code>, то будут зарегистрированы только те конфигурации, для которых Condition вернет <code>true</code>. Аннотация <code>@Conditional</code> появилась в четвертой версии <strong>Spring Framework</strong>. Она используется в случае, когда на момент поднятия контекста нужно решить, создавать бин/конфигурацию или нет. Причем решение принимает специальный класс, который обязан реализовать интерфейс <code>Condition</code>.</p>
</li>
<li>
<p><strong>Второй этап</strong>: регистрация специального <code>BeanFactoryPostProcessor</code><br>
Если точнее, регистрация <code>BeanDefinitionRegistryPostProcessor</code>, который при помощи класса <code>ConfigurationClassParser</code> парсит <strong>JavaConfig</strong> и создает <code>BeanDefinition</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Каждый <code>BeanDefinition</code> помещается в <strong>map</strong>, который хранится в классе <code>DefaultListableBeanFactory</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">private</span> <span class="kd">final</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">BeanDefinition</span><span class="o">&gt;</span> <span class="n">beanDefinitionMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ConcurrentHashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">BeanDefinition</span><span class="o">&gt;();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_настройка_созданных_beandefinition_beanfactorypostprocessor">Настройка созданных <code>BeanDefinition</code> (<code>BeanFactoryPostProcessor</code>)</h5>
<div class="paragraph">
<p>После первого этапа у нас имеется <strong>map</strong>, в котором хранятся <code>BeanDefinition</code>. На этом этапе у нас есть возможность повлиять на то, какими будут наши бины еще до их фактического создания, иначе говоря мы имеем доступ к метаданным класса. Для этого существует специальный интерфейс <code>BeanFactoryPostProcessor</code>, реализовав который, мы получаем доступ к созданным <code>BeanDefinition</code> и можем их изменять.</p>
</div>
<div class="paragraph">
<p>В этом интерфейсе всего один метод:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory)</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Метод <code>postProcessBeanFactory()</code> принимает параметром <code>ConfigurableListableBeanFactory</code>. Данная фабрика содержит много полезных методов, в том числе <code>getBeanDefinitionNames()</code>, через который мы можем получить все <code>BeanDefinitionNames</code>, а уже потом по конкретному имени получить <strong>BeanDefinition</strong> для дальнейшей обработки метаданных</p>
</div>
</div>
<div class="sect4">
<h5 id="_создание_собственных_factorybean">Создание собственных <code>FactoryBean</code></h5>
<div class="paragraph">
<p>На этом этапе, если не устраивает <strong>BeanFactory</strong> из-под капота, можно создать собственные <code>FactoryBean</code>.</p>
</div>
<div class="paragraph">
<p><code>FactoryBean</code> — это <strong>generic</strong> интерфейс, которому можно делегировать процесс создания бинов необходимого типа. В те времена, когда конфигурация была исключительно в <strong>xml</strong>, разработчикам был необходим механизм с помощью которого они бы могли управлять процессом создания бинов. Именно для этого и был сделан этот интерфейс.</p>
</div>
<div class="paragraph">
<p>Чтобы создать свою фабрику бинов (собственный <code>FactoryBean</code>), необходимо реализовать интерфейс <code>FactoryBean</code> и переопределить три его метода.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClassNameFactory</span> <span class="kd">implements</span> <span class="nc">FactoryBean</span><span class="o">&lt;</span><span class="nc">ClassName</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">ClassName</span> <span class="nf">getObject</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ClassName</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">getObjectType</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">ClassName</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isSingleton</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_создание_экземпляров_бинов">Создание экземпляров бинов</h5>
<div class="paragraph">
<p>На этом этапе происходит создание бинов.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Созданием экземпляров бинов занимается <strong>BeanFactory</strong> при этом, если нужно, делегирует это кастомным <strong>FactoryBean</strong>.</p>
</li>
<li>
<p>Экземпляры бинов создаются на основе ранее созданных <strong>BeanDefinition</strong>.</p>
</li>
<li>
<p>При этом важно знать, что на этапе поднятия контекста создаются только бины с областью видимости <strong>Singleton</strong>.</p>
</li>
<li>
<p>Остальные бины создаются тогда, когда необходимы.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../assets/img/java/spring/core/create-bean-by-bean-factory.png" alt="create bean by bean factory"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="_настройка_созданных_бинов_beanpostprocessor">Настройка созданных бинов (<code>BeanPostProcessor</code>)</h5>
<div class="paragraph">
<p>На данном этапе можно производить дополнительную настройку созданных бинов. Настройка производиться через интерфейс <code>BeanPostProcessor</code>.</p>
</div>
<div class="paragraph">
<p><code>BeanPostProcessor</code> - позволяет настраивать бины до того, как они попадут в <strong>Spring</strong> контейнер. Данный интерфейс имеет два метода.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>postProcessBeforeInitialization(Object bean, String beanName)</code>;</p>
</li>
<li>
<p><code>postProcessAfterInitialization(Object bean, String beanName)</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>BeanFactory</code> вызывает оба метода для каждого бина, и прогоняет бин через все <code>BeanPostProcessor</code>. У обоих методов параметры абсолютно одинаковые. Разница только в порядке их вызова. Первый вызывается до <strong>init</strong>-метода, второй, после.</p>
</div>
<div class="paragraph">
<p>Порядок в котором будут вызваны <strong>BeanPostProcessor</strong> не известен, но мы точно знаем что выполнены они будут последовательно.</p>
</div>
<div class="paragraph">
<p>Важно понимать, что на данном этапе экземпляр бина уже создан и идет его донастройка. Процесс донастройки показан на рисунке ниже.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../assets/img/java/spring/core/bean-post-processor.png" alt="bean post processor"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClassBeanPostProcessor</span> <span class="kd">implements</span> <span class="nc">BeanPostProcessor</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">postProcessBeforeInitialization</span><span class="o">(</span><span class="nc">Object</span> <span class="n">bean</span><span class="o">,</span> <span class="nc">String</span> <span class="n">beanName</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">BeansException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">postProcessAfterInitialization</span><span class="o">(</span><span class="nc">Object</span> <span class="n">bean</span><span class="o">,</span> <span class="nc">String</span> <span class="n">beanName</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">BeansException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_схема_создания_бинов">3.1.5. Схема создания бинов</h4>
<div class="paragraph">
<p>Несмотря на кажущуюся сложность, жизненный цикл бинов крайне прост и лёгок для понимания. После создания экземпляра бина, могут понадобиться некоторые действия для того, чтобы сделать его работоспособным. Также при удалении бина из контейнера, необходима очистка.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../assets/img/java/spring/core/lifecycle-bean.png" alt="lifecycle bean"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Spring</strong> создает <strong>bean</strong>.</p>
</li>
<li>
<p><strong>Spring</strong> задает значения и ссылки в поля <strong>bean</strong>.</p>
</li>
<li>
<p>Если <strong>bean</strong> реализует <code>BeanNameAware</code>, <strong>Spring</strong> передает <strong>ID</strong> бина в метод <code>setBeanName()</code>.</p>
</li>
<li>
<p>Если <strong>bean</strong> реализует <code>BeanFactoryAware</code>, <strong>Spring</strong> вызывает <code>setBeanFactory()</code>, передавая туда <strong>bean</strong> <strong>factory</strong>.</p>
</li>
<li>
<p>Если <strong>bean</strong> реализует интерфейс <code>ApplicationContextAware</code>, <strong>Spring</strong> вызовет <code>setApplicationContext()</code>, передавая по ссылке контекст приложения.</p>
</li>
<li>
<p>Если <strong>bean</strong> реализует интерфейс <code>BeanPostProcessor</code>, <strong>Spring</strong> вызывает метод бина <code>postProcessBeforeInitialization()</code>.</p>
</li>
<li>
<p>На этом происходит вызов методов init().
Если <strong>bean</strong> реализуют интерфейс <code>InitializingBean</code>, <strong>Spring</strong> вызывает метод <code>afterPropertiesSet()</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CachingMovieLister</span> <span class="o">{</span>
    <span class="nd">@PostConstruct</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">populateMovieCache</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Если <strong>bean</strong> реализует <code>BeanPostProcessor</code>, <strong>Spring</strong> вызовет метод <strong>бина</strong> <code>postProcessAfterInitialization()</code>.</p>
</li>
<li>
<p>В этой точке, <strong>bean</strong> готов для использования приложением и останется в контексте приложения, пока контекст не будет уничтожен.</p>
</li>
<li>
<p>На этом происходит вызов методов destroy().
Если <strong>bean</strong> реализует интерфейс <code>DisposableBean</code>, <strong>Spring</strong> вызовет <code>destroy()</code> метод.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CachingMovieLister</span> <span class="o">{</span>
    <span class="nd">@PreDestroy</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clearMovieCache</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Компонент перестает существовать.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ioc_di_autowired">3.1.6. IoC, DI, <code>@Autowired</code></h4>
<div class="paragraph">
<p>Как было описано выше, ядром <strong>Spring</strong> является контейнер <strong>Inversion of Control</strong>, функция которого создать и управлять объектами (бинами), а благодаря основной реализации <strong>Dependency Injection</strong> и связывать различные объекты между собой.</p>
</div>
<div class="paragraph">
<p>Связывать объекты между собой можно несколькими способами:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>С помощью конструктора</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MovieRecommender</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">CustomerPreferenceDao</span> <span class="n">customerPreferenceDao</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="nf">MovieRecommender</span><span class="o">(</span><span class="nc">CustomerPreferenceDao</span> <span class="n">customerPreferenceDao</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">customerPreferenceDao</span> <span class="o">=</span> <span class="n">customerPreferenceDao</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>С помощью метода (сеттер)</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleMovieLister</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">MovieFinder</span> <span class="n">movieFinder</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMovieFinder</span><span class="o">(</span><span class="nc">MovieFinder</span> <span class="n">movieFinder</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">movieFinder</span> <span class="o">=</span> <span class="n">movieFinder</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Через поле</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MovieRecommender</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">MovieCatalog</span> <span class="n">movieCatalog</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>По умолчанию внедрение зависимостей через методы или поля рассматриваются как обязательные зависимости. Однако, Вы можете изменить это поведение, устанавливая для <strong>required</strong> атрибута <code>@Autowired</code> значение <strong>false</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleMovieLister</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">MovieFinder</span> <span class="n">movieFinder</span><span class="o">;</span>

    <span class="nd">@Autowired</span><span class="o">(</span><span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMovieFinder</span><span class="o">(</span><span class="nc">MovieFinder</span> <span class="n">movieFinder</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">movieFinder</span> <span class="o">=</span> <span class="n">movieFinder</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>В ситуации, когда имеются два бина для внедрения можно воспользоваться следующими аннотациями:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Primary</code> - указывает, что текущий бин будет внедряться по умолчанию, если их несколько</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MovieConfiguration</span> <span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="nd">@Primary</span>
    <span class="kd">public</span> <span class="nc">MovieCatalog</span> <span class="nf">firstMovieCatalog</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">MovieCatalog</span> <span class="nf">secondMovieCatalog</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Qualifier</code> - указывает какой бин необходимо использовать для внедрения</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Component</span>
<span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"Action"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ActionMovieCatalog</span> <span class="kd">implements</span> <span class="nc">MovieCatalog</span> <span class="o">{</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MovieRecommender</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"Action"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">MovieCatalog</span> <span class="n">movieCatalog</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_component_service_и_другие_аннотации">3.1.7. <code>@Component</code>, <code>@Service</code> и другие аннотации</h4>
<div class="paragraph">
<p>В <strong>Spring</strong> используются следующие аннотации:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Component</code><br>
Аннотация для любого компонента фреймворка.</p>
</li>
<li>
<p><code>@Repository</code><br>
(Доменный слой) Аннотация показывает, что класс функционирует как репозиторий и требует наличия прозрачной трансляции исключений. Преимуществом трансляции исключений является то, что слой сервиса будет иметь дело с общей иерархией исключений от <strong>Spring</strong> (<code>DataAccessException</code>) вне зависимости от используемых технологий доступа к данным в слое данных.</p>
</li>
<li>
<p><code>@Service</code><br>
(Сервис-слой приложения) Аннотация, объявляющая, что этот класс представляет собой сервис – компонент сервис-слоя. Сервис является подтипом класса <code>@Component</code>. Использование данной аннотации позволит искать бины-сервисы автоматически.</p>
</li>
<li>
<p><code>@Controller</code><br>
(Слой представления) Аннотация для маркировки <strong>java</strong> класса, как класса контроллера. Данный класс представляет собой компонент, похожий на обычный сервлет (<strong>HttpServlet</strong>) (работающий с объектами <strong>HttpServletRequest</strong> и <strong>HttpServletResponse</strong>), но с расширенными возможностями от <strong>Spring</strong> <strong>Framework</strong>.</p>
</li>
<li>
<p><code>@RestController</code><br>
Аннотация аккумулирует поведение двух аннотаций <code>@Controller</code> и <code>@ResponseBody</code> (показывает что данный метод может возвращать собственный объект в виде <strong>xml</strong>, <strong>json</strong> и другие).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../assets/img/java/spring/core/annotation.jpg" alt="annotation"></span></p>
</div>
<div class="paragraph">
<p>Данные аннотации используются при конфигурации приложения через аннотации.</p>
</div>
<div class="paragraph">
<p>Основной считается <code>@Component</code>, общий стереотип для любого компонента, управляемого <strong>Spring</strong>. <code>@Repository</code>, <code>@Service</code> И <code>@Controller</code> являются специализациями <code>@Component</code> для более конкретных случаев применения (в настойчивости, обслуживании и презентации слоев, соответственно).</p>
</div>
<div class="paragraph">
<p>Бины, получившиеся при помощи <code>@Repository</code>, дополнительно имеют обработку для <strong>JDBC</strong> <strong>Exception</strong>.</p>
</div>
<div class="paragraph">
<p><code>@RestController = @Controller + @ResponseBody</code>. Этот бин для конвертации входящих/исходящих данных использует <strong>Jackson message converter</strong>. Как правило, целевые данные представлены в <strong>json</strong> или <strong>xml</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_links">3.1.8. Links</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/">Spring Framework Documentation</a></p>
</li>
<li>
<p><a href="https://proselyte.net/tutorials/spring-tutorial-full-version">Руководство по Spring</a></p>
</li>
<li>
<p><a href="https://www.tutorialspoint.com/spring/">Spring Tutorial</a></p>
</li>
<li>
<p><a href="https://javarush.ru/groups/posts/spring-framework-java-1">Spring для ленивых. Основы, базовые концепции и примеры с кодом. Часть 1</a></p>
</li>
<li>
<p><a href="https://javarush.ru/groups/posts/477-spring-dlja-lenivihkh-osnovih-bazovihe-koncepcii-i-primerih-s-kodom-chastjh-2">Spring для ленивых. Основы, базовые концепции и примеры с кодом. Часть 2</a></p>
</li>
<li>
<p><a href="https://habr.com/ru/post/222579/">Spring изнутри. Этапы инициализации контекста</a></p>
</li>
<li>
<p><a href="https://habr.com/ru/post/350682/">Spring: вопросы к собеседованию</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=BmBr5diz8WA&amp;ab_channel=JUG.ru">YouTube: Евгений Борисов — Spring-потрошитель, часть 1</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=cou_qomYLNU&amp;t=3443s&amp;ab_channel=JUG.ru">YouTube: Евгений Борисов — Spring-потрошитель, часть 2</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/playlist?list=PLxqzxxW1gWwIuSgG8od6N4LZg5V4kKp72">YouTube: Spring Framework для начинающих [Jetbulb</a>]</p>
</li>
<li>
<p><a href="https://www.youtube.com/playlist?list=PLAma_mKffTOR5o0WNHnY0mTjKxnCgSXrZ">YouTube: Spring Framework [alishev</a>]</p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=yRr_vzqha-g&amp;ab_channel=AndreiLegan">YouTube: Spring изнутри. Этапы инициализации контекста</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=l20USjGgnTo&amp;t=3881s&amp;ab_channel=Jetbulb">YouTube: Java Spring Контекст</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jakarta_servlet">4. Jakarta Servlet</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Moved to <a href="https://github.com/rakovets/wiki" class="bare">https://github.com/rakovets/wiki</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_java_tools">5. Java Tools</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_junit">5.1. JUnit</h3>
<div class="sect3">
<h4 id="_введение">5.1.1. Введение</h4>
<div class="paragraph">
<p><strong>Тестирование</strong> – это процесс проверки функционала программы с целью подтверждения того, что она работает в соответствии с определёнными требованиями. Unit-тестирование – это тестирование, которые пишутся, непосредственно, на уровне разработчика (тестирование определённой сущности – метод или класс). Это крайне важный этап разработки ПО, который помогает создавать качественный продукт.</p>
</div>
<div class="paragraph">
<p><strong>Юнит-тестирование</strong> делится на две большие группы:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ручное тестирование</p>
</li>
<li>
<p>Автоматизированное тестирование</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Ручное тестирование</th>
<th class="tableblock halign-left valign-top">Автоматизированное тестирование</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ручное выполнение тестов без помощи каких-либо средств.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Использование специальных средств для автоматизированного тестирования</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Не программируется</p>
<p class="tableblock">Нет возможности для написания сложных тестов для тестирования сложных моделей поведения.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Программируется</p>
<p class="tableblock">Тестировщики могут написать сложные тесты для тестирования сложных моделей программирования</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Низкая надёжность</p>
<p class="tableblock">Ручное тестирование имеет низкую надёжность, так как крайне подвержено влиянию человеческого фактора.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Высокая надёжность</p>
<p class="tableblock">Автоматизированное тестирование точное и надёжное.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Большие затраты времени</p>
<p class="tableblock">Связано с тем, что человек имеет крайне ограниченные возможность в скорости работы.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Быстро</p>
<p class="tableblock">Автоматизированные тесты выполняются на порядок быстрее, чем это может сделать человек.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_junit_2">JUnit</h5>
<div class="paragraph">
<p><strong>JUnit</strong> – это фреймворк, разработанный для тестирования программ, написанных с использованием технологии <strong>Java</strong>. Он лежит в основе <strong>TDD</strong> (<strong>Test-Driven Development</strong>) и входит в семейство фрейморков для тестирования xUnit.</p>
</div>
<div class="paragraph">
<p>Главная идея данного фреймворка – “сначала тесты, потом код”. Это означает, что сначала мы определяем, что должно получиться в результате работы того или иного куска кода и пишем тесты, которые проверяют идентичность результата с требуемым, после чего пишем сам кусок кода, который и будем тестировать. Данный подход увеличивает эффективность работы разработчика и позволяет писать более стабильный код. В результате этого мы получаем меньшее количество времени, которое затрачивается на отладку программы.</p>
</div>
</div>
<div class="sect4">
<h5 id="_свойства_junit">Свойства JUnit</h5>
<div class="ulist">
<ul>
<li>
<p>Фреймворк с открытым исходным кодом, который используется для написания и выполнения тестов.</p>
</li>
<li>
<p>Позволяет писать код более быстро и качественно.</p>
</li>
<li>
<p>Крайне прост в использовании.</p>
</li>
<li>
<p>Поддерживает аннотации для идентификации методов.</p>
</li>
<li>
<p>Поддерживает утверждения для тестирования получаемых результатов.</p>
</li>
<li>
<p>Тесты могут быть организованы  в связки тестов (<strong>test suites</strong>).</p>
</li>
<li>
<p>Имеет визуальную индикацию состояния тестов (красные – не пройдены, зелёные – пройдены).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_тестовый_случай">Тестовый случай</h5>
<div class="paragraph">
<p><strong>Тестовый случай</strong> (Test Case) в <strong>юнит тестировании</strong> – это часть кода, которая проверяет, что другая часть кода  (в частности – метод) работает в соответствии с определёнными требованиями.</p>
</div>
<div class="paragraph">
<p>Формально описанный тестовый случай характеризуется известными входными данными и ожидаемым выводом программы, который известен до начала выполнения теста.</p>
</div>
<div class="paragraph">
<p>Необходимо создавать, как минимум, два тестовых случая для каждого требования – положительный и отрицательный. Если требование имеет под требования, каждое из них должно тестироваться отдельно.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_junit_5">5.1.2. JUnit 5</h4>
<div class="paragraph">
<p><strong>JUnit 5</strong> требует <strong>Java 8</strong> (или выше) во время выполнения. Однако вы все равно можете протестировать код, скомпилированный с предыдущими версиями <strong>JDK</strong>.</p>
</div>
<div class="paragraph">
<p>В отличие от предыдущих версий <strong>JUnit</strong>, <strong>JUnit 5</strong> состоит из нескольких разных модулей из трех разных подпроектов.</p>
</div>
<div class="paragraph">
<p><strong>JUnit 5</strong> = <strong>Platform JUnit</strong> + <strong>JUnit Jupiter</strong> + <strong>JUnit Vintage</strong></p>
</div>
<div class="paragraph">
<p><strong>JUnit платформа</strong> служит основой для запуска тестирования рамок на <strong>JVM</strong>. Он также определяет <strong>TestEngineAPI</strong> для разработки инфраструктуры тестирования, работающей на платформе. Кроме того, платформа предоставляет средство запуска консоли для запуска платформы из командной строки и средство запуска на основе <strong>JUnit 4</strong> для запуска любого <strong>TestEngine</strong> на платформе в среде на основе <strong>JUnit 4</strong>. Первоклассная поддержка <strong>платформы JUnit</strong> также существует в популярных <strong>IDE</strong> (см. <strong>IntelliJ IDEA</strong>, <strong>Eclipse</strong>, <strong>NetBeans</strong> и <strong>код Visual Studio</strong>) и инструментах сборки (см. <strong>Gradle</strong>, <strong>Maven</strong> и <strong>Ant</strong>).</p>
</div>
<div class="paragraph">
<p><strong>JUnit Jupiter</strong> является сочетанием новой модели программирования и модели расширения для написания тестов и расширений в <strong>JUnit 5</strong>. Jupiter подпроекте обеспечивает <strong>TestEngine</strong> для выполнения тестов на основе <strong>Jupiter</strong> на платформе.</p>
</div>
<div class="paragraph">
<p><strong>JUnit Vintage</strong> обеспечивает <strong>TestEngine</strong> запуск тестов на основе <strong>JUnit 3</strong> и <strong>JUnit 4</strong> на платформе.</p>
</div>
<div class="paragraph">
<p>Получать помощь, а также задайте вопросы, связанные с <strong>JUnit 5</strong> можно на <a href="https://translate.google.com/website?sl=en&amp;tl=ru&amp;ajax=1&amp;elem=1&amp;se=1&amp;u=https://stackoverflow.com/questions/tagged/junit5"><strong>Stack Overflow</strong></a> или пообщайтесь с нами в <a href="https://translate.google.com/website?sl=en&amp;tl=ru&amp;ajax=1&amp;elem=1&amp;se=1&amp;u=https://gitter.im/junit-team/junit5"><strong>Gitter</strong></a>.</p>
</div>
<div class="paragraph">
<p>В <a href="https://translate.google.com/website?sl=en&amp;tl=ru&amp;ajax=1&amp;elem=1&amp;se=1&amp;u=https://github.com/junit-team/junit5-samples"><strong>junit5-samples</strong></a> репозитории размещена коллекция примеров проектов, основанных на <strong>JUnit Jupiter</strong>, <strong>JUnit Vintage</strong> и других средах тестирования. Вы найдете подходящие сценарии сборки.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Для <strong>Gradle</strong> и <strong>Java</strong> ознакомьтесь с <a href="https://translate.google.com/website?sl=en&amp;tl=ru&amp;ajax=1&amp;elem=1&amp;se=1&amp;u=https://github.com/junit-team/junit5-samples/tree/r5.7.2/junit5-jupiter-starter-gradle"><strong>junit5-jupiter-starter-gradle</strong></a> проектом.</p>
</li>
<li>
<p>Для <strong>Gradle</strong> и <strong>Kotlin</strong> ознакомьтесь с <a href="https://translate.google.com/website?sl=en&amp;tl=ru&amp;ajax=1&amp;elem=1&amp;se=1&amp;u=https://github.com/junit-team/junit5-samples/tree/r5.7.2/junit5-jupiter-starter-gradle-kotlin"><strong>junit5-jupiter-starter-gradle-kotlin</strong></a> проектом.</p>
</li>
<li>
<p>Для <strong>Gradle</strong> и <strong>Groovy</strong> ознакомьтесь с <a href="https://translate.google.com/website?sl=en&amp;tl=ru&amp;ajax=1&amp;elem=1&amp;se=1&amp;u=https://github.com/junit-team/junit5-samples/tree/r5.7.2/junit5-jupiter-starter-gradle-groovy"><strong>junit5-jupiter-starter-gradle-groovy</strong></a> проектом.</p>
</li>
<li>
<p>Для <strong>Maven</strong> проверьте <a href="https://translate.google.com/website?sl=en&amp;tl=ru&amp;ajax=1&amp;elem=1&amp;se=1&amp;u=https://github.com/junit-team/junit5-samples/tree/r5.7.2/junit5-jupiter-starter-maven"><strong>junit5-jupiter-starter-maven</strong></a> проект.</p>
</li>
<li>
<p>Что касается <strong>Ant</strong>, ознакомьтесь с <a href="https://translate.google.com/website?sl=en&amp;tl=ru&amp;ajax=1&amp;elem=1&amp;se=1&amp;u=https://github.com/junit-team/junit5-samples/tree/r5.7.2/junit5-jupiter-starter-ant"><strong>junit5-jupiter-starter-ant</strong></a> проектом.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_аннотации">Аннотации</h5>
<div class="paragraph">
<p><strong>JUnit Jupiter</strong> поддерживает следующие аннотации для настройки тестов и расширения фреймворка.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Аннотация</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Свойство</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Test</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Означает, что метод является методом тестирования. В отличие от аннотации <strong>JUnit 4</strong>, эта аннотация не объявляет никаких атрибутов, так как тестовые расширения в JUnit Jupiter работают на основе собственных специальных аннотаций. Такие методы наследуются, если они не переопределены.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ParameterizedTest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Означает, что метод является параметризированным тестом. Такие методы наследуются, если они не переопределены.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RepeatedTest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Означает, что метод является тестовым шаблоном для повторного теста. Такие методы наследуются, если они не переопределены.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@TestFactory</code> (<strong>JUnit5</strong>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Означает, что метод является испытательным заводом для динамических тестов. Такие методы наследуются, если они не переопределены.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@TestTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Означает, что метод является шаблоном для тестовых случаев, предназначенных для вызова несколько раз в зависимости от количества контекстов вызова, возвращенных зарегистрированными поставщиками. Такие методы наследуются, если они не переопределены.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@TestMethodOrder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Используется для настройки порядка выполнения тестового метода для аннотированного тестового класса; похож на <strong>JUnit 4&#8217;s</strong>. Такие аннотации наследуются.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@TestInstance</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Используется для настройки жизненного цикла экземпляра теста для аннотированного тестового класса. Такие аннотации наследуются.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@DisplayName</code> (<strong>JUnit5</strong>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Объявляет пользовательское имя дисплея для тестового класса или метода тестирования. Такие аннотации не наследуются.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@DisplayNameGeneration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Объявляет пользовательский генератор имен отображения для тестового класса. Такие аннотации наследуются.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@BeforeEach</code> (<strong>JUnit5</strong>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Означает, что аннотированный метод должен быть выполнен перед каждым, или методом в текущем классе; по аналогии с <strong>JUnit 4&#8217;s</strong>. Такие методы наследуются, если они не переопределены.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@AfterEach</code> (<strong>JUnit5</strong>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Означает, что аннотированный метод должен быть выполнен после каждого, или метода в текущем классе; по аналогии с <strong>JUnit 4&#8217;s</strong>. Такие методы наследуются, если они не переопределены.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@BeforeAll</code> (<strong>JUnit5</strong>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Означает, что аннотированный метод должен быть выполнен прежде всего, и методы в текущем классе; по аналогии с <strong>JUnit 4&#8217;s</strong>. Такие методы наследуются (если они не скрыты или переопределены)и должны быть (если не используется жизненный цикл "в каждом классе" экземпляра теста).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@AfterAll</code> (<strong>JUnit5</strong>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Означает, что аннотированный метод должен быть выполнен в конце концов, и методы в текущем классе; по аналогии с <strong>JUnit 4&#8217;s</strong>. Такие методы наследуются (если они не скрыты или переопределены)и должны быть (если не используется жизненный цикл "в каждом классе" экземпляра теста).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Nested</code> (<strong>JUnit5</strong>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Означает, что аннотированный класс является нестатичным вложенным тестовым классом. и методы не могут быть использованы непосредственно в тестовом классе, если не используется жизненный цикл экземпляра теста "на класс". Такие аннотации не наследуются.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Tag</code> (<strong>JUnit5</strong>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Используется для объявления тегов для фильтрации тестов, либо на уровне класса или метода; аналогично тестовым группам в <strong>TestNG</strong> или <strong>Categories</strong> в <strong>JUnit 4.</strong> Такие аннотации наследуются на уровне класса, но не на уровне метода.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Disabled</code> (<strong>JUnit5</strong>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Используется для отключения тестового класса или метода тестирования; по аналогии с <strong>JUnit 4&#8217;s</strong>. Такие аннотации не наследуются.@Ignore</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Используется для неудачи теста, испытательного завода, шаблона тестирования или метода жизненного цикла, если его выполнение превышает данный срок. Такие аннотации наследуются.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ExtendWith</code> (<strong>JUnit5</strong>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Используется для регистрации расширений декларативно. Такие аннотации наследуются.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RegisterExtension</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Используется для регистрации расширений программно через поля. Такие поля наследуются, если они не затенены.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@TempDir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Используется для поставки временного каталога с помощью инъекций поля или инъекций параметра в метод жизненного цикла или метод тестирования; расположен в пакете <code>org.junit.jupiter.api.io</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Все основные аннотации находятся в <a href="https://junit-org.translate.goog/junit5/docs/current/api/org.junit.jupiter.api/org/junit/jupiter/api/package-summary.html?_x_tr_sl=en&amp;_x_tr_tl=ru&amp;_x_tr_hl=ru&amp;_x_tr_pto=ajax,elem,se"><strong>org.junit.jupiter.api</strong></a> пакете в <strong>junit-jupiter-api</strong> модуле.</p>
</div>
</div>
<div class="sect4">
<h5 id="_утверждения">Утверждения</h5>
<div class="paragraph">
<p><strong>JUnit 5</strong> поставляется со многими стандартными утверждениями, которые можно найти в классе <a href="https://junit.org/junit5/docs/current/api/org.junit.jupiter.api/org/junit/jupiter/api/Assertions.html"><strong>org.junit.jupiter.api.Assertions</strong>.</a></p>
</div>
<div class="paragraph">
<p>Основные утверждения:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>assertEquals()</code>,</p>
</li>
<li>
<p><code>assertArrayEquals()</code>,</p>
</li>
<li>
<p><code>assertSame()</code>,</p>
</li>
<li>
<p><code>assertNotSame()</code>,</p>
</li>
<li>
<p><code>assertTrue()</code>,</p>
</li>
<li>
<p><code>assertFalse()</code>,</p>
</li>
<li>
<p><code>assertNull()</code>,</p>
</li>
<li>
<p><code>assertNotNull()</code>,</p>
</li>
<li>
<p><code>assertLinesMatch()</code>,</p>
</li>
<li>
<p><code>assertIterablesMatch()</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mockito">5.2. Mockito</h3>
<div class="sect3">
<h4 id="_mockito_что_это_такое_и_зачем_нужно">5.2.1. Mockito: что это такое и зачем нужно</h4>
<div class="paragraph">
<p>Говоря коротко, <strong>Mockito</strong> – фреймворк для работы с заглушками.</p>
</div>
<div class="paragraph">
<p>Как известно, при <strong>тестировании кода</strong> (прежде всего <strong>юнит-тестировании</strong>, но не только) тестируемому элементу часто требуется предоставить экземпляры классов, которыми он должен пользоваться при работе.
При этом часто они не должны быть <strong>полнофункциональными</strong> – наоборот, от них требуется вести себя <strong>жёстко заданным образом</strong>, так, чтобы их поведение было <strong>простым и полностью предсказуемым</strong>.
Они и называются <strong>заглушками</strong> (<strong>stub</strong>).
Чтобы их получить, можно создавать альтернативные тестовые реализации интерфейсов, наследовать нужные классы с переопределением функционала и так далее, но всё это достаточно неудобно, избыточно и чревато ошибками.
Более удобное во всех смыслах решение – <strong>специализированные фреймворки</strong> для создания заглушек.
Одним из таковых (и, пожалуй, самым известным для <strong>Java</strong>) и является <strong>Mockito</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Mockito</strong> позволяет создать одной строчкой кода так называемый <strong>mock</strong> (что-то вроде основы для нужной заглушки) любого класса.
Для такого <strong>mock</strong> сразу после создания характерно некое поведение по умолчанию (<strong>все методы возвращают заранее известные значения</strong> — обычно это <strong>null</strong> либо <strong>0</strong>).
Можно переопределить это поведение желаемым образом, проконтролировать с нужной степенью детальности обращения к ним так далее.
В результате <strong>mock</strong> и становится заглушкой с требуемыми свойствами.</p>
</div>
<div class="paragraph">
<p>Также <strong>mock</strong> можно создать и для тех классов, новый экземпляр которых вообще-то так просто не создашь, в частности, классов с исключительно приватными конструкторами типа <strong>синглтонов</strong> и <strong>утилитных классов</strong>, а при минимальной настройке фреймворка — и перечислений (<strong>enums</strong>).</p>
</div>
<div class="paragraph">
<p>Наибольшее распространение получили следующие возможности <strong>Mockito</strong> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>создание заглушек для классов и интерфейсов;</p>
</li>
<li>
<p>проверка вызова метода и значений передаваемых методу параметров;</p>
</li>
<li>
<p>использование концепции «частичной заглушки», при которой заглушка создается на класс с определением поведения, требуемое для некоторых методов класса;</p>
</li>
<li>
<p>подключение к реальному классу «шпиона» spy для контроля вызова методов.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_mock_и_spy">5.2.2. Mock и Spy</h4>
<div class="paragraph">
<p>Центральный класс <strong>Mockito</strong>, через который предполагается обращаться к большей части функционала, — это, собственно, класс под названием <strong>Mockito</strong> (есть также класс <strong>BDDMockito</strong>, предоставляющий примерно те же возможности в форме, более подходящей для <a href="https://ru.wikipedia.org/wiki/BDD_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)"><strong>BDD</strong></a>.
Доступ к функционалу реализован через его <strong>статические методы</strong>.</p>
</div>
<div class="paragraph">
<p>Помните, что методы <strong>mock</strong> объекта возвращают значения по умолчанию: <strong>false</strong> для <strong>boolean</strong>, <strong>0</strong> для <strong>int</strong>, <strong>пустые коллекции</strong>, <strong>null</strong> для остальных объектов.
Для <strong>spy</strong> — значение, возвращаемое методом реального объекта.</p>
</div>
<div class="paragraph">
<p>Для того, чтобы отличить mock-объект от обычного в составе <strong>Mockito</strong> для этого есть инструмент — <strong>метод Mockito.mockingDetails</strong>.
Передав ему произвольный объект, получим объект класса <strong>MockingDetails</strong>.
Он содержит информацию о том, что этот объект представляет собой с точки зрения <strong>Mockito</strong>: является ли он <strong>mock</strong>, <strong>spy</strong> (см. ниже), как использовался, как был создан и прочее.</p>
</div>
<div class="paragraph">
<p>Поведение по умолчанию (и не только его) можно изменить при помощи функционала класса <strong>MockSettings</strong>, но это нечасто бывает нужно.</p>
</div>
<div class="paragraph">
<p>Чтобы создать <strong>Mockito</strong> объект можно использовать либо аннотацию <strong>@Mock</strong>, либо <strong>метод</strong> <strong>mock</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Mock</span>
<span class="nc">ICalculator</span> <span class="n">mcalc</span><span class="o">;</span>

<span class="nc">ICalculator</span> <span class="n">mcalc</span> <span class="o">=</span> <span class="nc">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="nc">ICalculator</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Однако, что если необходимо использовать в качестве заглушки объект реального класса с имеющимся функционалом, переопределив работу только части его методов?
На этот случай в <strong>Mockito</strong> есть так называемые <strong>spy</strong>, "шпионы".
В отличие от <strong>mock&#8217;ов</strong>, их можно создавать на основе как класса, так и готового объекта.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DataService</span> <span class="n">dataServiceSpy</span> <span class="o">=</span> <span class="nc">Mockito</span><span class="o">.</span><span class="na">spy</span><span class="o">(</span><span class="nc">DataService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="c1">// or</span>
<span class="nc">DataService</span> <span class="n">dataService</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DataService</span><span class="o">();</span>
<span class="n">dataServiceSpy</span> <span class="o">=</span> <span class="nc">Mockito</span><span class="o">.</span><span class="na">spy</span><span class="o">(</span><span class="n">dataService</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>При создании <strong>spy</strong> на основе класса, если его тип — интерфейс, будет создан обычный <strong>mock-объект</strong>, а если тип — класс, то <strong>Mockito</strong> попытается создать экземпляр при помощи конструктора по умолчанию (без параметров).
И только если такого конструктора нет, произойдёт ошибка и тест не сработает.</p>
</div>
</div>
<div class="sect3">
<h4 id="_управление_поведением">5.2.3. Управление поведением</h4>
<div class="paragraph">
<p>В целом управление поведением <strong>mock-объекта</strong> сводится к одной очевидной концепции: когда на mock так-то воздействовали (то есть вызван такой-то метод с такими-то аргументами), он должен отреагировать так-то и так-то.
У этой концепции существуют две реализации в рамках класса <strong>Mockito</strong> — основная, рекомендуемая разработчиками к использованию везде, где это возможно, и альтернативная, применяемая там, где основная не годится.</p>
</div>
<div class="paragraph">
<p>Основная реализация базируется на методе <strong>Mockito.when</strong>.
Этот метод принимает в качестве "параметра" вызов переопределяемого метода <strong>mock-объекта</strong> (таким образом фиксируется определяемое воздействие) и возвращает объект типа <strong>OngoingStubbing</strong>, позволяющий вызвать один из методов семейства <strong>Mockito.then</strong>&#8230;&#8203; (так задаётся реакция на это воздействие).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">//when(mock).thenReturn(value)</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">DataService</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">saveData</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">dataToSave</span><span class="o">);</span>
    <span class="nc">String</span> <span class="nf">getDataById</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">);</span>
    <span class="nc">String</span> <span class="nf">getDataById</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">,</span> <span class="nc">Supplier</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">calculateIfAbsent</span><span class="o">);</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">getData</span><span class="o">();</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">getDataListByIds</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">idList</span><span class="o">);</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">getDataByRequest</span><span class="o">(</span><span class="nc">DataSearchRequest</span> <span class="n">request</span><span class="o">);</span>
<span class="o">}</span>
<span class="o">-----------------------------------------</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
<span class="n">data</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"dataItem"</span><span class="o">);</span>
<span class="nc">Mockito</span><span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">dataService</span><span class="o">.</span><span class="na">getAllData</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="n">data</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>После этой операции, вызвав у объекта dataService метод getAllData(), получим объект, data.</p>
</div>
<div class="paragraph">
<p>Альтернативная реализация связывания условия и результата вызова — методы семейства <strong>Mockito.do</strong>&#8230;&#8203;. Эти методы позволяют задать поведение начиная с результата вызова и возвращают объект класса <strong>Stubber</strong>, уже при помощи которого можно задать условие.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">//doReturn(value).when(mock).method(params)</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">DataService</span> <span class="o">{</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">getData</span><span class="o">();</span>
<span class="o">}</span>
<span class="o">-----------------------------------------</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
<span class="n">data</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"dataItem"</span><span class="o">);</span>
<span class="nc">Mockito</span><span class="o">.</span><span class="na">doReturn</span><span class="o">(</span><span class="n">data</span><span class="o">).</span><span class="na">when</span><span class="o">(</span><span class="n">dataService</span><span class="o">).</span><span class="na">getData</span><span class="o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Обратите внимание: в первой реализации при задании поведения метода (в данном случае <strong>getAllData()</strong>) сначала выполняется вызов ещё не переопределённой его версии, и только потом, в недрах <strong>Mockito</strong>, происходит переопределение.
Во второй же такого вызова не происходит — методу <strong>Stubber.when</strong> передаётся непосредственно <strong>mock</strong>, а уже у возвращённого этим методом объекта того же типа, но другой природы совершается вызов переопределяемого метода.
Эта разница всё и определяет.
Связывание через <strong>Mockito.do&#8230;&#8203;</strong> никак не контролирует на стадии компиляции то, какой переопределяемый метод я вызову и совместим ли он по типу с заданным возвращаемым значением.</p>
</div>
<div class="sect4">
<h5 id="_задание_условий_вызова">Задание условий вызова</h5>
<div class="paragraph">
<p>Пример выше касается метода без параметров, и связанное с ним условие вызова возможно одно — сам факт вызова.
Как только появляются параметры, ситуация становится сложнее.
Как минимум, для вызова метода, поведение которого я задаю, мне нужно что-то ему передать.
Но важнее другое: может оказаться, что задаваемую реакцию я хочу получать не всегда, а только при вызове с параметрами, отвечающими определённым требованиям.
Если нужно задать реакцию на любой вызов этого метода независимо от аргументов, можно воспользоваться методом <strong>Mockito.any</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">DataService</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="nf">getDataItemById</span><span class="o">(</span><span class="nc">String</span> <span class="n">id</span><span class="o">);</span>
<span class="o">-----------------------------------------</span>
<span class="nc">Mockito</span><span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">dataService</span><span class="o">.</span><span class="na">getDataItemById</span><span class="o">(</span><span class="n">any</span><span class="o">()))</span>
       <span class="o">.</span><span class="na">thenReturn</span><span class="o">(</span><span class="s">"dataItem"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Если же требуется, чтобы <strong>mock</strong> реагировал только на определённое значение аргумента, можно использовать непосредственно это значение или методы <strong>Mockito.eq</strong> (когда речь об эквивалентности) либо <strong>Mockito.same</strong> (когда требуется сравнение ссылок)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Mockito</span><span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">dataService</span><span class="o">.</span><span class="na">getDataItemById</span><span class="o">(</span><span class="s">"idValue"</span><span class="o">))</span>
       <span class="o">.</span><span class="na">thenReturn</span><span class="o">(</span><span class="s">"dataItem"</span><span class="o">);</span>
<span class="c1">// or</span>
<span class="nc">Mockito</span><span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">dataService</span><span class="o">.</span><span class="na">getDataItemById</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="s">"idValue"</span><span class="o">)))</span>
       <span class="o">.</span><span class="na">thenReturn</span><span class="o">(</span><span class="s">"dataItem"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>При работе с методами с более чем одним аргументом заданные требования комбинируются в соответствии с логическим И, то есть для получения заданного результата КАЖДЫЙ из аргументов должен отвечать поставленному требованию.</p>
</div>
<div class="paragraph">
<p>Кроме того, при задании поведения такого метода нельзя комбинировать использующие матчеры статические методы Mockito и прямую передачу значений.
Используйте <strong>Mockito.eq</strong> или Mockito.same</p>
</div>
</div>
<div class="sect4">
<h5 id="_задание_результатов_вызова">Задание результатов вызова</h5>
<div class="paragraph">
<p>После того, как метод <strong>mock-объекта</strong> вызван, объект должен отреагировать на вызов.
Основные возможные последствия — возвращение результата и выбрасывание исключения, и именно на эти варианты в первую очередь рассчитан инструментарий <strong>Mockito</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Mockito</span><span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">dataService</span><span class="o">.</span><span class="na">getAllData</span><span class="o">()).</span><span class="na">thenReturn</span><span class="o">(</span><span class="n">data</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Также</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Mockito</span><span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">dataService</span><span class="o">.</span><span class="na">getDataById</span><span class="o">(</span><span class="s">"invalidId"</span><span class="o">))</span>
       <span class="o">.</span><span class="na">thenThrow</span><span class="o">(</span><span class="k">new</span> <span class="nc">IllegalArgumentException</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Есть и другой способ: можно создать объект исключения и бросить непосредственно его, а можно предоставить <strong>Mockito</strong> только класс исключения, чтобы оно было создано автоматически.
В обоих случаях синтаксис позволяет использовать и <strong>checked</strong> исключения, однако <strong>Mockito</strong> не позволит запустить такой тест, если тип исключения не соответствует методу, который я хочу заставить бросить это исключение.</p>
</div>
<div class="paragraph">
<p>Выше варианты реакции подходят, если в ответ на вызов с заданными условиями нужно всегда возвращать определённое, всегда одно и то же значение результата или выбрасывать всегда одинаковое исключение.
Предположим, метод принимает коллекцию значений, а возвращает другую коллекцию значений, связанных с первыми одно к одному (например, это получение коллекции объектов данных по набору их ID), и в рамках теста необходимо использовать этот <strong>mock-объект</strong> неоднократно с разными наборами входных данных, получая каждый раз соответствующий результат.
В Mockito есть метод <strong>Mockito.thenAnswer</strong>, он же <strong>Mockito.then</strong>.
Он принимает реализацию функционального интерфейса <strong>Answer</strong>, единственный метод которого получает объект <strong>класса InvocationOnMock</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Mockito</span><span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">dataService</span><span class="o">.</span><span class="na">getDataByIds</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">()))</span>
       <span class="o">.</span><span class="na">thenAnswer</span><span class="o">(</span><span class="n">invocation</span> <span class="o">-&gt;</span> <span class="n">invocation</span>
                <span class="o">.&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;</span><span class="n">getArgument</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">id</span> <span class="o">-&gt;</span> <span class="o">{</span>
                    <span class="k">switch</span> <span class="o">(</span><span class="n">id</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">case</span> <span class="s">"a"</span><span class="o">:</span>
                            <span class="k">return</span> <span class="s">"dataItemA"</span><span class="o">;</span>
                        <span class="k">case</span> <span class="s">"b"</span><span class="o">:</span>
                            <span class="k">return</span> <span class="s">"dataItemB"</span><span class="o">;</span>
                        <span class="k">default</span><span class="o">:</span>
                            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">})</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">()));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Обратите внимание: типобезопасности <strong>InvocationOnMock</strong> не обеспечивает — аргументы возвращаются либо в виде массива <strong>Object[]</strong>, либо <strong>generic</strong>-методом.</p>
</div>
<div class="paragraph">
<p>Отдельно стоит упомянуть ещё один вариант реакции — <strong>thenCallRealMethod</strong>.
Предназначение понятно из названия.
Он действует как для <strong>mock</strong>-, так и для <strong>spy</strong>-объектов.
В случае <strong>mock</strong> все поля объекта, к которым может обратиться код метода, будут опять-таки иметь значение <strong>null</strong>.
Для <strong>spy</strong> же использование <strong>thenCallRealMethod</strong> означает возвращение к поведению <strong>spy</strong> по умолчанию.</p>
</div>
<div class="paragraph">
<p>Методы <strong>thenReturn</strong> и <strong>thenThrow</strong> имеют перегруженные версии, принимающие <strong>varargs</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Mockito</span><span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">dataService</span><span class="o">.</span><span class="na">getDataById</span><span class="o">(</span><span class="s">"a"</span><span class="o">))</span>
       <span class="o">.</span><span class="na">thenReturn</span><span class="o">(</span><span class="s">"valueA1"</span><span class="o">,</span> <span class="s">"valueA2"</span><span class="o">)</span>
       <span class="o">.</span><span class="na">thenThrow</span><span class="o">(</span><span class="nc">IllegalArgumentException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Здесь первый вызов метода с заданным параметром вернёт "valueA1, второй — "valueA2, а третий (и все последующие) будет вызывать выбрасывание <strong>IllegalArgumentException</strong>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_слежение_за_вызовами_методов">5.2.4. Слежение за вызовами методов</h4>
<div class="paragraph">
<p>Метод <strong>verify</strong> позволяет проверить, была ли выполнена проверка с определенными параметрами.
Если проверка не выполнялась или выполнялась с другими параметрами, то <strong>verify</strong> вызовет исключение.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Mockito</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">dataService</span><span class="o">).</span><span class="na">getDataById</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Тест с такой конструкцией пройдёт успешно, если она находится после единственного за время выполнения теста вызова метода <strong>getDataById</strong>, и упадёт, если метод не был вызван или был вызван дважды и более.</p>
</div>
<div class="paragraph">
<p>Для проверки количества вызовов определенных методов Mockito предоставляет следующие методы:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>atLeast(int min) - не меньше min вызовов;</p>
</li>
<li>
<p>atLeastOnce() - хотя бы один вызов;</p>
</li>
<li>
<p>atMost(int max) - не более max вызовов;</p>
</li>
<li>
<p>times(int cnt) - cnt вызовов;</p>
</li>
<li>
<p>never() - вызовов не было;</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Mockito</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">dataService</span><span class="o">,</span> <span class="nc">Mockito</span><span class="o">.</span><span class="na">times</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">getDataById</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">());</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mock_объекты_как_значения_полей_и_аннотации_mockito">5.2.5. Mock-объекты как значения полей и аннотации Mockito</h4>
<div class="paragraph">
<p>Если в классе теста есть поля, которым я хочу присвоить <strong>mock-объекты</strong> в качестве значений, это не обязательно делать вручную — достаточно снабдить его аннотацией <strong>@Mock</strong>.</p>
</div>
<div class="paragraph">
<p>Для <strong>spy</strong> предусмотрена аннотация <strong>@Spy</strong> — она в целом аналогична <strong>@Mock</strong>… но для spy может использоваться объект, на основе которого он будет создан (несмотря на название, этот метод предназначен не только для <strong>mock&#8217;ов</strong>, а задействует также и все нижеперечисленные аннотации).
Такой объект можно сразу указать в качестве значения аннотируемого поля, но можно и не указывать — тогда <strong>spy</strong> будет создан на основе класса.</p>
</div>
<div class="paragraph">
<p>Есть аннотация <strong>@Captor</strong> для создания экземпляров <strong>ArgumentCaptor</strong>.</p>
</div>
<div class="paragraph">
<p>Ещё существует <strong>@InjectMocks</strong>.
Помеченное таким образом поле инициализируется настоящим объектом указанного класса.
Его поля по возможности проинициализированы значениями <strong>mock-полей</strong>, помеченных соответствующей аннотацией.
Для этого используется конструктор с наибольшим числом параметров, сеттеры и так далее.
Если какого-то объектного параметра конструктора не хватает, вместо него будет использован <strong>null</strong>, а вот параметр-примитив просто не позволит тесту сработать.
В целом это похоже на маленькую и простую (и всё равно не такую уж примитивную) реализацию <strong>dependency injection</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_откат_поведения_к_дефолтному_и_сессии_mockito">5.2.6. Откат поведения к дефолтному и сессии Mockito</h4>
<div class="paragraph">
<p>Чтобы привести все <strong>mock-объекты</strong> в состояние по умолчанию можно использовать методы <strong>Mockito.reset</strong> и <strong>Mockito.clearInvocations</strong>.
Оба принимают <strong>varargs</strong>, и передавать им нужно соответствующие <strong>mock&#8217;и</strong>.</p>
</div>
<div class="paragraph">
<p>Ещё одно решение — использовать так называемые <strong>сессии Mockito</strong>.
Именно его рекомендуют авторы.
В начале сессии все <strong>mock-объекты</strong> инициализируются, а после работы обязательно должно быть выполнено её окончание (хотя mock&#8217;и продолжают оставаться функциональными и после него).
Если я хочу создавать отдельную сессию для каждого тестового метода, то удобно создать поле типа MockitoSession, присвоить ему значение до вызова тестового метода и завершить сессию после.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nd">@Mock</span>
<span class="nc">DataService</span> <span class="n">dataService</span><span class="o">;</span>

<span class="nc">MockitoSession</span> <span class="n">session</span><span class="o">;</span>

<span class="nd">@BeforeMethod</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">beforeMethod</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">session</span> <span class="o">=</span> <span class="nc">Mockito</span><span class="o">.</span><span class="na">mockitoSession</span><span class="o">()</span>
            <span class="o">.</span><span class="na">initMocks</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
            <span class="o">.</span><span class="na">startMocking</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testMethod</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// some code using the dataService field</span>
<span class="o">}</span>

<span class="nd">@AfterMethod</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterMethod</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">session</span><span class="o">.</span><span class="na">finishMocking</span><span class="o">();</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_links_2">5.2.7. Links</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://ru.wikipedia.org/wiki/BDD_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)">Mockito и как его готовить</a></p>
</li>
<li>
<p><a href="https://habr.com/ru/post/444982/">BDD (программирование)</a></p>
</li>
<li>
<p><a href="https://www.javadoc.io/doc/org.mockito/mockito-core/2.7.10/org/mockito/Mockito.html">Официальная документация Mockito</a></p>
</li>
<li>
<p><a href="https://habr.com/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%B0%D0%B2%D1%82%D0%BE%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%5D">Автотестирование</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_liquibase">5.3. Liquibase</h3>
<div class="paragraph">
<p><strong>Liquibase</strong> представляет систему управления версиями базы данных, в основном это касается структуры и в меньшей степени содержимого базы.
При этом описание базы с одной стороны достаточно абстрактно и позволяет использовать на нижнем уровне различные СУБД, и с другой стороны всегда можно перейти на SQL-диалект конкретной СУБД, что достаточно гибко.</p>
</div>
<div class="paragraph">
<p><strong>Liquibase</strong> является устоявшимся проектом с открытым исходным кодом и активно используется за пределами своей родной Java среды и не требует глубоких знаний Java для работы. В качестве описания структуры базы и изменений базы исторически использовался <strong>XML</strong> формат, однако сейчас параллельно поддерживается <strong>YAML</strong> и <strong>JSON</strong>. Более подробно: <a href="https://docs.liquibase.com/home.html">Liquibase Docs</a></p>
</div>
<div class="paragraph">
<p>Использовать <strong>Liquibase</strong> можно различными способами:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>как консольное приложение</strong></p>
</li>
<li>
<p><strong>как java-library</strong> подключенная к проекту</p>
</li>
<li>
<p><strong>как встроенную задачу в CI/CD инструмент</strong></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_настройка_окружения">5.3.1. Настройка окружения</h4>
<div class="sect4">
<h5 id="_установка_и_настройка_субд">Установка и настройка СУБД</h5>
<div class="paragraph">
<p>Так как <strong>Liquibase</strong> систему управления версиями базы данных, то необходимо устанавливать и настраивать СУБД. Вместо этого можно использовать <strong>Docker Compose</strong> и следующий файл для запуска <strong>PostgreSQL</strong> как <strong>Docker Container</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.7'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">maven-liquibase-postgres</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">maven-liquibase-postgres-container</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">POSTGRES_DB</span><span class="pi">:</span> <span class="s">${POSTGRES_DATABASE:-maven-liquibase}</span>
      <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">${POSTGRES_USER:-postgres}</span>
      <span class="na">POSTGRES_PASSWORD</span><span class="pi">:</span> <span class="s">${POSTGRES_PASSWORD:-postgres}</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">5432:5432'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Для запуска можно использовать команду:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell script">docker-compose up -d</code></pre>
</div>
</div>
<div class="paragraph">
<p>Далее, при работе с Liquibase, будет использоваться данная СУБД.</p>
</div>
</div>
<div class="sect4">
<h5 id="_проект_с_liquibase">Проект с Liquibase</h5>
<div class="paragraph">
<p>При разработке на Java наиболее удобным будет использование <strong>Apache Maven</strong> или <strong>Gradle</strong>.</p>
</div>
<div class="paragraph">
<p>В дальнейшем речь пойдет именно о <strong>Apache Maven</strong>.</p>
</div>
<div class="listingblock">
<div class="title">Структура проекта</div>
<div class="content">
<pre>.
├── pom.xml
└── src
    └── main
        └── resources
            ├── data
            ├── liquibase.properties
            └── master.xml</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pom.xml</code> - содержит все необходимые зависимости, настройки для Liquibase</p>
</li>
<li>
<p><code>liquibase.properties</code> - файл с настройками соединения к базе (логин/пароль и возможно другие параметры)</p>
</li>
<li>
<p>xml-файл с изменениями базы (либо другие варианты: YAML, JSON, XML + SQL, YAML + SQL, JSON + SQL)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title"><code>pom.xml</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;groupId&gt;</span>by.rakovets.example<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>liquibase-maven<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>pom<span class="nt">&lt;/packaging&gt;</span>

    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
        <span class="nt">&lt;project.reporting.outputEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.reporting.outputEncoding&gt;</span>
        <span class="nt">&lt;log4j2.version&gt;</span>2.14.1<span class="nt">&lt;/log4j2.version&gt;</span>
        <span class="nt">&lt;liquibase.version&gt;</span>4.5.0<span class="nt">&lt;/liquibase.version&gt;</span>
        <span class="nt">&lt;postgresql.version&gt;</span>42.3.0<span class="nt">&lt;/postgresql.version&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!--Logging--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.logging.log4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>log4j-api<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${log4j2.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.logging.log4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>log4j-core<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${log4j2.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.logging.log4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>log4j-slf4j-impl<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${log4j2.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!--JDBC drivers--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.postgresql<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>postgresql<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${postgresql.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.liquibase<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>liquibase-core<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${liquibase.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.liquibase<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>liquibase-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>${liquibase.version}<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;propertyFile&gt;</span>src/main/resources/liquibase.properties<span class="nt">&lt;/propertyFile&gt;</span>
                    <span class="nt">&lt;changeLogFile&gt;</span>src/main/resources/master.xml<span class="nt">&lt;/changeLogFile&gt;</span>
                    <span class="nt">&lt;dataDir&gt;</span>src/main/resources/data<span class="nt">&lt;/dataDir&gt;</span>
                    <span class="c">&lt;!-- log  --&gt;</span>
                    <span class="nt">&lt;verbose&gt;</span>true<span class="nt">&lt;/verbose&gt;</span>
                    <span class="nt">&lt;logging&gt;</span>debug<span class="nt">&lt;/logging&gt;</span>
                    <span class="nt">&lt;promptOnNonLocalDatabase&gt;</span>false<span class="nt">&lt;/promptOnNonLocalDatabase&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Файл с настройками соединения к базе</p>
</div>
<div class="listingblock">
<div class="title"><code>liquibase.properties</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><span class="py">username</span><span class="p">=</span><span class="s">postgres</span>
<span class="py">password</span><span class="p">=</span><span class="s">postgres</span>
<span class="py">url</span><span class="p">=</span><span class="s">jdbc:postgresql://localhost:5432/maven-liquibase?prepareThreshold=0&amp;stringtype=unspecified</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Основным понятием liquibase являются так называемые <strong>changesets</strong> (<strong>изменения базы</strong>). Они могут включать в себя как изменения структуры, так и изменение данных. Для контроля примененных <strong>changesets</strong> <strong>Liquibase</strong> использует таблицы <code>databasechangelog</code> и <code>databasechangeloglock</code>.</p>
</div>
<div class="listingblock">
<div class="title">Main changeLogFile <code>master.xml</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="cp">&lt;?xml version="1.1" encoding="UTF-8" standalone="no"?&gt;</span>
<span class="nt">&lt;databaseChangeLog</span> <span class="na">xmlns=</span><span class="s">"http://www.liquibase.org/xml/ns/dbchangelog"</span>
                   <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
                   <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.6.xsd"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;changeSet</span> <span class="na">context=</span><span class="s">"legacy"</span> <span class="na">author=</span><span class="s">"author (generated)"</span> <span class="na">id=</span><span class="s">"1"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;createTable</span> <span class="na">tableName=</span><span class="s">"test"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;column</span> <span class="na">autoIncrement=</span><span class="s">"true"</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">type=</span><span class="s">"SERIAL"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;constraints</span> <span class="na">nullable=</span><span class="s">"false"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/column&gt;</span>
            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"user_name"</span> <span class="na">type=</span><span class="s">"VARCHAR(255)"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"preferences"</span> <span class="na">type=</span><span class="s">"TEXT"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/createTable&gt;</span>

        <span class="nt">&lt;rollback&gt;</span>
            <span class="nt">&lt;dropTable</span> <span class="na">tableName=</span><span class="s">"test"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/rollback&gt;</span>
    <span class="nt">&lt;/changeSet&gt;</span>
<span class="nt">&lt;/databaseChangeLog&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_обновление_бд">5.3.2. Обновление БД</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell script">mvn liquibase:update</code></pre>
</div>
</div>
<div class="paragraph">
<p>Здесь выполняется <code>liquibase:update</code> для базы указанной в <code>liquibase.properties</code> из <code>liquibase.url</code>, которая указана в стандартном JDBC формате.</p>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre>[INFO] Scanning for projects...
[INFO]
[INFO] ----------------&lt; by.rakovets.example:liquibase-maven &gt;-----------------
[INFO] Building liquibase-maven 1.0.0
[INFO] --------------------------------[ pom ]---------------------------------
[INFO]
[INFO] --- liquibase-maven-plugin:4.5.0:update (default-cli) @ liquibase-maven ---
[INFO] ------------------------------------------------------------------------
[INFO] Loading artifacts into URLClassLoader
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/apache/logging/log4j/log4j-api/2.14.1/log4j-api-2.14.1.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/apache/logging/log4j/log4j-core/2.14.1/log4j-core-2.14.1.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/apache/logging/log4j/log4j-slf4j-impl/2.14.1/log4j-slf4j-impl-2.14.1.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/slf4j/slf4j-api/1.7.25/slf4j-api-1.7.25.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/postgresql/postgresql/42.3.0/postgresql-42.3.0.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/checkerframework/checker-qual/3.5.0/checker-qual-3.5.0.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/liquibase/liquibase-core/4.5.0/liquibase-core-4.5.0.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/javax/xml/bind/jaxb-api/2.3.0/jaxb-api-2.3.0.jar
[INFO]   artifact: file:/home/rakovets/dev/exp/liquibase/target/classes/
[INFO]   artifact: file:/home/rakovets/dev/exp/liquibase/target/test-classes/
[INFO] ------------------------------------------------------------------------
[INFO] Loading artifacts into URLClassLoader
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/apache/logging/log4j/log4j-api/2.14.1/log4j-api-2.14.1.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/apache/logging/log4j/log4j-core/2.14.1/log4j-core-2.14.1.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/apache/logging/log4j/log4j-slf4j-impl/2.14.1/log4j-slf4j-impl-2.14.1.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/slf4j/slf4j-api/1.7.25/slf4j-api-1.7.25.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/postgresql/postgresql/42.3.0/postgresql-42.3.0.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/checkerframework/checker-qual/3.5.0/checker-qual-3.5.0.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/liquibase/liquibase-core/4.5.0/liquibase-core-4.5.0.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/javax/xml/bind/jaxb-api/2.3.0/jaxb-api-2.3.0.jar
[INFO]   artifact: file:/home/rakovets/dev/exp/liquibase/target/classes/
[INFO]   artifact: file:/home/rakovets/dev/exp/liquibase/target/test-classes/
[INFO] ------------------------------------------------------------------------
[project, pluginDescriptor]
[INFO] Parsing Liquibase Properties File
[INFO]   File: src/main/resources/liquibase.properties
[INFO] ------------------------------------------------------------------------
[INFO]
[INFO]
[INFO] Liquibase Community 4.5.0 by Datical
[INFO] ####################################################
##   _     _             _ _                      ##
##  | |   (_)           (_) |                     ##
##  | |    _  __ _ _   _ _| |__   __ _ ___  ___   ##
##  | |   | |/ _` | | | | | '_ \ / _` / __|/ _ \  ##
##  | |___| | (_| | |_| | | |_) | (_| \__ \  __/  ##
##  \_____/_|\__, |\__,_|_|_.__/ \__,_|___/\___|  ##
##              | |                               ##
##              |_|                               ##
##                                                ##
##  Get documentation at docs.liquibase.com       ##
##  Get certified courses at learn.liquibase.com  ##
##  Free schema change activity reports at        ##
##      https://hub.liquibase.com                 ##
##                                                ##
####################################################
Starting Liquibase at 06:31:52 (version 4.5.0 #52 built at 2021-09-27 16:19+0000)
[INFO] Settings
----------------------------
[INFO]     driver: null
[INFO]     url: jdbc:postgresql://localhost:5432/maven-liquibase?prepareThreshold=0&amp;stringtype=unspecified
[INFO]     username: *****
[INFO]     password: *****
[INFO]     use empty password: false
[INFO]     properties file: src/main/resources/liquibase.properties
[INFO]     properties file will override? false
[INFO]     prompt on non-local database? false
[INFO]     clear checksums? false
[INFO]     changeLogDirectory: null
[INFO]     changeLogFile: src/main/resources/master.xml
[INFO]     context(s): null
[INFO]     label(s): null
[INFO]     number of changes to apply: 0
[INFO]     drop first? false
[INFO] ------------------------------------------------------------------------
[INFO] Set default schema name to public
[INFO] Parsing Liquibase Properties File src/main/resources/liquibase.properties for changeLog parameters
[INFO] Executing on Database: jdbc:postgresql://localhost:5432/maven-liquibase?prepareThreshold=0&amp;stringtype=unspecified
[INFO] Successfully acquired change log lock
[INFO] Creating database history table with name: databasechangelog
[INFO] Reading from databasechangelog
[INFO] Table test created
[INFO] ChangeSet src/main/resources/master.xml::1::author (generated) ran successfully in 9ms
[INFO] Successfully released change log lock
[INFO] ------------------------------------------------------------------------
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  1.069 s
[INFO] Finished at: 2021-10-23T06:31:52+03:00
[INFO] ------------------------------------------------------------------------</pre>
</div>
</div>
<div class="paragraph">
<p>После успешного выполнения в БД появляются:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>две служебные таблицы <code>databasechangelog</code> и <code>databasechangeloglock</code> (если их не было раньше)</p>
</li>
<li>
<p>запись в таблице <code>databasechangelog</code> с информацией о примененном <strong>changeset</strong></p>
</li>
<li>
<p>изменения указанные в <strong>changeset</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_генерация_sql_без_обновления_базы">5.3.3. Генерация SQL без обновления базы</h4>
<div class="paragraph">
<p>Иногда перед запуском изменений требуется посмотреть содержимое создаваемых запросов. Для этого предназначены команды <code>liquibase:updateSQL</code> и <code>liquibase:rollbackSQL</code></p>
</div>
<div class="sect4">
<h5 id="_liquibaseupdatesql"><code>liquibase:updateSQL</code></h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell script">mvn liquibase:updateSQL</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre>[INFO] Scanning for projects...
[INFO]
[INFO] ----------------&lt; by.rakovets.example:liquibase-maven &gt;-----------------
[INFO] Building liquibase-maven 1.0.0
[INFO] --------------------------------[ pom ]---------------------------------
[INFO]
[INFO] --- liquibase-maven-plugin:4.5.0:updateSQL (default-cli) @ liquibase-maven ---
[INFO] ------------------------------------------------------------------------
[INFO] Loading artifacts into URLClassLoader
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/apache/logging/log4j/log4j-api/2.14.1/log4j-api-2.14.1.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/apache/logging/log4j/log4j-core/2.14.1/log4j-core-2.14.1.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/apache/logging/log4j/log4j-slf4j-impl/2.14.1/log4j-slf4j-impl-2.14.1.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/slf4j/slf4j-api/1.7.25/slf4j-api-1.7.25.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/postgresql/postgresql/42.3.0/postgresql-42.3.0.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/checkerframework/checker-qual/3.5.0/checker-qual-3.5.0.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/liquibase/liquibase-core/4.5.0/liquibase-core-4.5.0.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/javax/xml/bind/jaxb-api/2.3.0/jaxb-api-2.3.0.jar
[INFO]   artifact: file:/home/rakovets/dev/exp/liquibase/target/classes/
[INFO]   artifact: file:/home/rakovets/dev/exp/liquibase/target/test-classes/
[INFO] ------------------------------------------------------------------------
[INFO] Loading artifacts into URLClassLoader
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/apache/logging/log4j/log4j-api/2.14.1/log4j-api-2.14.1.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/apache/logging/log4j/log4j-core/2.14.1/log4j-core-2.14.1.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/apache/logging/log4j/log4j-slf4j-impl/2.14.1/log4j-slf4j-impl-2.14.1.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/slf4j/slf4j-api/1.7.25/slf4j-api-1.7.25.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/postgresql/postgresql/42.3.0/postgresql-42.3.0.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/checkerframework/checker-qual/3.5.0/checker-qual-3.5.0.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/liquibase/liquibase-core/4.5.0/liquibase-core-4.5.0.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/javax/xml/bind/jaxb-api/2.3.0/jaxb-api-2.3.0.jar
[INFO]   artifact: file:/home/rakovets/dev/exp/liquibase/target/classes/
[INFO]   artifact: file:/home/rakovets/dev/exp/liquibase/target/test-classes/
[INFO] ------------------------------------------------------------------------
[project, pluginDescriptor]
[INFO] Parsing Liquibase Properties File
[INFO]   File: src/main/resources/liquibase.properties
[INFO] ------------------------------------------------------------------------
[INFO]
[INFO]
[INFO] Liquibase Community 4.5.0 by Datical
[INFO] ####################################################
##   _     _             _ _                      ##
##  | |   (_)           (_) |                     ##
##  | |    _  __ _ _   _ _| |__   __ _ ___  ___   ##
##  | |   | |/ _` | | | | | '_ \ / _` / __|/ _ \  ##
##  | |___| | (_| | |_| | | |_) | (_| \__ \  __/  ##
##  \_____/_|\__, |\__,_|_|_.__/ \__,_|___/\___|  ##
##              | |                               ##
##              |_|                               ##
##                                                ##
##  Get documentation at docs.liquibase.com       ##
##  Get certified courses at learn.liquibase.com  ##
##  Free schema change activity reports at        ##
##      https://hub.liquibase.com                 ##
##                                                ##
####################################################
Starting Liquibase at 06:33:38 (version 4.5.0 #52 built at 2021-09-27 16:19+0000)
[INFO] Settings
----------------------------
[INFO]     driver: null
[INFO]     url: jdbc:postgresql://localhost:5432/maven-liquibase?prepareThreshold=0&amp;stringtype=unspecified
[INFO]     username: *****
[INFO]     password: *****
[INFO]     use empty password: false
[INFO]     properties file: src/main/resources/liquibase.properties
[INFO]     properties file will override? false
[INFO]     prompt on non-local database? false
[INFO]     clear checksums? false
[INFO]     changeLogDirectory: null
[INFO]     changeLogFile: src/main/resources/master.xml
[INFO]     context(s): null
[INFO]     label(s): null
[INFO]     number of changes to apply: 0
[INFO]     migrationSQLOutputFile: /home/rakovets/dev/exp/liquibase/target/liquibase/migrate.sql
[INFO] ------------------------------------------------------------------------
[INFO] Set default schema nliquibase:rollbackSQLame to public
[INFO] Char encoding not set! The created file will be system dependent!
[INFO] Output SQL Migration File: /home/rakovets/dev/exp/liquibase/target/liquibase/migrate.sql
[INFO] Parsing Liquibase Properties File src/main/resources/liquibase.properties for changeLog parameters
[INFO] Executing on Database: jdbc:postgresql://localhost:5432/maven-liquibase?prepareThreshold=0&amp;stringtype=unspecified
[INFO] Successfully acquired change log lock
[INFO] Reading from databasechangelog
[INFO] Successfully released change log lock
[INFO] ------------------------------------------------------------------------
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  1.022 s
[INFO] Finished at: 2021-10-23T06:33:39+03:00
[INFO] ------------------------------------------------------------------------</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Файл <code>target/liquibase/migrate.sql</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- *********************************************************************</span>
<span class="c1">-- Update Database Script</span>
<span class="c1">-- *********************************************************************</span>
<span class="c1">-- Change Log: src/main/resources/master.xml</span>
<span class="c1">-- Ran at: 10/23/21, 6:33 AM</span>
<span class="c1">-- Against: postgres@jdbc:postgresql://localhost:5432/maven-liquibase?prepareThreshold=0&amp;stringtype=unspecified</span>
<span class="c1">-- Liquibase version: 4.5.0</span>
<span class="c1">-- *********************************************************************</span>

<span class="c1">-- Create Database Lock Table</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">databasechangeloglock</span> <span class="p">(</span><span class="n">ID</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="n">LOCKED</span> <span class="nb">BOOLEAN</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="n">LOCKGRANTED</span> <span class="nb">TIMESTAMP</span> <span class="k">WITHOUT</span> <span class="nb">TIME</span> <span class="k">ZONE</span><span class="p">,</span> <span class="n">LOCKEDBY</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="k">CONSTRAINT</span> <span class="n">databasechangeloglock_pkey</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID</span><span class="p">));</span>

<span class="c1">-- Initialize Database Lock Table</span>
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">databasechangeloglock</span><span class="p">;</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">databasechangeloglock</span> <span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">LOCKED</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">FALSE</span><span class="p">);</span>

<span class="c1">-- Lock Database</span>
<span class="k">UPDATE</span> <span class="n">databasechangeloglock</span> <span class="k">SET</span> <span class="n">LOCKED</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">,</span> <span class="n">LOCKEDBY</span> <span class="o">=</span> <span class="s1">'ubuntu (172.20.0.1)'</span><span class="p">,</span> <span class="n">LOCKGRANTED</span> <span class="o">=</span> <span class="s1">'2021-10-23 07:29:28.866'</span> <span class="k">WHERE</span> <span class="n">ID</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">AND</span> <span class="n">LOCKED</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span>

<span class="c1">-- Create Database Change Log Table</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">databasechangelog</span> <span class="p">(</span><span class="n">ID</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="n">AUTHOR</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="n">FILENAME</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="n">DATEEXECUTED</span> <span class="nb">TIMESTAMP</span> <span class="k">WITHOUT</span> <span class="nb">TIME</span> <span class="k">ZONE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="n">ORDEREXECUTED</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="n">EXECTYPE</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="n">MD5SUM</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">35</span><span class="p">),</span> <span class="n">DESCRIPTION</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">COMMENTS</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">TAG</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">LIQUIBASE</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">CONTEXTS</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">LABELS</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">DEPLOYMENT_ID</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>

<span class="c1">-- Changeset src/main/resources/master.xml::1::author (generated)</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">test</span> <span class="p">(</span><span class="n">id</span> <span class="nb">INTEGER</span> <span class="k">GENERATED</span> <span class="k">BY</span> <span class="k">DEFAULT</span> <span class="k">AS</span> <span class="k">IDENTITY</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="n">user_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">preferences</span> <span class="nb">TEXT</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">databasechangelog</span> <span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">AUTHOR</span><span class="p">,</span> <span class="n">FILENAME</span><span class="p">,</span> <span class="n">DATEEXECUTED</span><span class="p">,</span> <span class="n">ORDEREXECUTED</span><span class="p">,</span> <span class="n">MD5SUM</span><span class="p">,</span> <span class="n">DESCRIPTION</span><span class="p">,</span> <span class="n">COMMENTS</span><span class="p">,</span> <span class="n">EXECTYPE</span><span class="p">,</span> <span class="n">CONTEXTS</span><span class="p">,</span> <span class="n">LABELS</span><span class="p">,</span> <span class="n">LIQUIBASE</span><span class="p">,</span> <span class="n">DEPLOYMENT_ID</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'1'</span><span class="p">,</span> <span class="s1">'author (generated)'</span><span class="p">,</span> <span class="s1">'src/main/resources/master.xml'</span><span class="p">,</span> <span class="n">NOW</span><span class="p">(),</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'8:d30ee8898b8b3a53a55c2ae2deba7edd'</span><span class="p">,</span> <span class="s1">'createTable tableName=test'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'EXECUTED'</span><span class="p">,</span> <span class="s1">'legacy'</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="s1">'4.5.0'</span><span class="p">,</span> <span class="s1">'4963369142'</span><span class="p">);</span>

<span class="c1">-- Release Database Lock</span>
<span class="k">UPDATE</span> <span class="n">databasechangeloglock</span> <span class="k">SET</span> <span class="n">LOCKED</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">,</span> <span class="n">LOCKEDBY</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">,</span> <span class="n">LOCKGRANTED</span> <span class="o">=</span> <span class="k">NULL</span> <span class="k">WHERE</span> <span class="n">ID</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_liquibaserollbacksql"><code>liquibase:rollbackSQL</code></h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell script">mvn liquibase:rollbackSQL -Dliquibase.rollbackCount=1</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>-Dliquibase.rollbackCount=1</code> - откатить 1 последнее изменение или использовать <strong>tags</strong> и тогда выполнять с командой <code>-Dliquibase.rollbackTag=${tag-name}</code>.</p>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre>[INFO] Scanning for projects...
[INFO]
[INFO] ----------------&lt; by.rakovets.example:liquibase-maven &gt;-----------------
[INFO] Building liquibase-maven 1.0.0
[INFO] --------------------------------[ pom ]---------------------------------
[INFO]
[INFO] --- liquibase-maven-plugin:4.5.0:rollbackSQL (default-cli) @ liquibase-maven ---
[INFO] ------------------------------------------------------------------------
[INFO] Loading artifacts into URLClassLoader
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/apache/logging/log4j/log4j-api/2.14.1/log4j-api-2.14.1.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/apache/logging/log4j/log4j-core/2.14.1/log4j-core-2.14.1.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/apache/logging/log4j/log4j-slf4j-impl/2.14.1/log4j-slf4j-impl-2.14.1.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/slf4j/slf4j-api/1.7.25/slf4j-api-1.7.25.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/postgresql/postgresql/42.3.0/postgresql-42.3.0.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/checkerframework/checker-qual/3.5.0/checker-qual-3.5.0.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/liquibase/liquibase-core/4.5.0/liquibase-core-4.5.0.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/javax/xml/bind/jaxb-api/2.3.0/jaxb-api-2.3.0.jar
[INFO]   artifact: file:/home/rakovets/dev/exp/liquibase/target/classes/
[INFO]   artifact: file:/home/rakovets/dev/exp/liquibase/target/test-classes/
[INFO] ------------------------------------------------------------------------
[INFO] Loading artifacts into URLClassLoader
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/apache/logging/log4j/log4j-api/2.14.1/log4j-api-2.14.1.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/apache/logging/log4j/log4j-core/2.14.1/log4j-core-2.14.1.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/apache/logging/log4j/log4j-slf4j-impl/2.14.1/log4j-slf4j-impl-2.14.1.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/slf4j/slf4j-api/1.7.25/slf4j-api-1.7.25.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/postgresql/postgresql/42.3.0/postgresql-42.3.0.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/checkerframework/checker-qual/3.5.0/checker-qual-3.5.0.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/org/liquibase/liquibase-core/4.5.0/liquibase-core-4.5.0.jar
[INFO]   artifact: file:/home/rakovets/.m2/repository/javax/xml/bind/jaxb-api/2.3.0/jaxb-api-2.3.0.jar
[INFO]   artifact: file:/home/rakovets/dev/exp/liquibase/target/classes/
[INFO]   artifact: file:/home/rakovets/dev/exp/liquibase/target/test-classes/
[INFO] ------------------------------------------------------------------------
[project, pluginDescriptor]
[INFO] Parsing Liquibase Properties File
[INFO]   File: src/main/resources/liquibase.properties
[INFO] ------------------------------------------------------------------------
[INFO]
[INFO]
[INFO] Liquibase Community 4.5.0 by Datical
[INFO] ####################################################
##   _     _             _ _                      ##
##  | |   (_)           (_) |                     ##
##  | |    _  __ _ _   _ _| |__   __ _ ___  ___   ##
##  | |   | |/ _` | | | | | '_ \ / _` / __|/ _ \  ##
##  | |___| | (_| | |_| | | |_) | (_| \__ \  __/  ##
##  \_____/_|\__, |\__,_|_|_.__/ \__,_|___/\___|  ##
##              | |                               ##
##              |_|                               ##
##                                                ##
##  Get documentation at docs.liquibase.com       ##
##  Get certified courses at learn.liquibase.com  ##
##  Free schema change activity reports at        ##
##      https://hub.liquibase.com                 ##
##                                                ##
####################################################
Starting Liquibase at 06:43:58 (version 4.5.0 #52 built at 2021-09-27 16:19+0000)
[INFO] Settings
----------------------------
[INFO]     driver: null
[INFO]     url: jdbc:postgresql://localhost:5432/maven-liquibase?prepareThreshold=0&amp;stringtype=unspecified
[INFO]     username: *****
[INFO]     password: *****
[INFO]     use empty password: false
[INFO]     properties file: src/main/resources/liquibase.properties
[INFO]     properties file will override? false
[INFO]     prompt on non-local database? false
[INFO]     clear checksums? false
[INFO]     changeLogDirectory: null
[INFO]     changeLogFile: src/main/resources/master.xml
[INFO]     context(s): null
[INFO]     label(s): null
[INFO]     rollback Count: 1
[INFO]     rollback Date: null
[INFO]     rollback Tag: null
[INFO]     migrationSQLOutputFile: /home/rakovets/dev/exp/liquibase/target/liquibase/migrate.sql
[INFO] ------------------------------------------------------------------------
[INFO] Set default schema name to public
[INFO] Char encoding not set! The created file will be system dependent!
[INFO] Output SQL Migration File: /home/rakovets/dev/exp/liquibase/target/liquibase/migrate.sql
[INFO] Parsing Liquibase Properties File src/main/resources/liquibase.properties for changeLog parameters
[INFO] Executing on Database: jdbc:postgresql://localhost:5432/maven-liquibase?prepareThreshold=0&amp;stringtype=unspecified
[INFO] Successfully acquired change log lock
[INFO] Reading from databasechangelog
[INFO] Successfully released change log lock
[INFO] ------------------------------------------------------------------------
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  1.046 s
[INFO] Finished at: 2021-10-23T06:43:59+03:00
[INFO] ------------------------------------------------------------------------</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Файл <code>.Файл `target/liquibase/migrate.sql`</code></div>
<div class="content">
<pre>-- *********************************************************************
-- Rollback 1 Change(s) Script
-- *********************************************************************
-- Change Log: src/main/resources/master.xml
-- Ran at: 10/23/21, 6:43 AM
-- Against: postgres@jdbc:postgresql://localhost:5432/maven-liquibase?prepareThreshold=0&amp;stringtype=unspecified
-- Liquibase version: 4.5.0
-- *********************************************************************

-- Lock Database
UPDATE databasechangeloglock SET LOCKED = TRUE, LOCKEDBY = 'ubuntu (172.20.0.1)', LOCKGRANTED = '2021-10-23 06:43:59.083' WHERE ID = 1 AND LOCKED = FALSE;

-- Rolling Back ChangeSet: src/main/resources/master.xml::1::author (generated)
DROP TABLE test;

DELETE FROM databasechangelog WHERE ID = '1' AND AUTHOR = 'author (generated)' AND FILENAME = 'src/main/resources/master.xml';

-- Release Database Lock
UPDATE databasechangeloglock SET LOCKED = FALSE, LOCKEDBY = NULL, LOCKGRANTED = NULL WHERE ID = 1;</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_подробнее_о_changeset">5.3.4. Подробнее о changeSet</h4>
<div class="paragraph">
<p>Изменения могут быть в разных форматах, в том числе обычный sql или он же в отдельном файле.</p>
</div>
<div class="paragraph">
<p>Каждое изменение может включать секцию <code>rollback</code> позволяющую откатывать изменения командой <code>liquibase:rollback</code>.
Кроме того для маркировки изменений, например для более удобного отката туда, можно использовать <code>tagDatabase</code>.</p>
</div>
<div class="sect4">
<h5 id="_обычный_формат">Обычный формат</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;changeSet</span> <span class="na">context=</span><span class="s">"legacy"</span> <span class="na">author=</span><span class="s">"author (generated)"</span> <span class="na">id=</span><span class="s">"1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;createTable</span> <span class="na">tableName=</span><span class="s">"test"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;column</span> <span class="na">autoIncrement=</span><span class="s">"true"</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">type=</span><span class="s">"SERIAL"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;constraints</span> <span class="na">primaryKey=</span><span class="s">"true"</span> <span class="na">primaryKeyName=</span><span class="s">"test_pkey"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/column&gt;</span>
        <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"c1"</span> <span class="na">type=</span><span class="s">"VARCHAR(255)"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"c2"</span> <span class="na">type=</span><span class="s">"INTEGER"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"c3"</span> <span class="na">type=</span><span class="s">"SMALLINT"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"c4"</span> <span class="na">type=</span><span class="s">"VARCHAR(255)"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"c5"</span> <span class="na">type=</span><span class="s">"TEXT"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"c6"</span> <span class="na">type=</span><span class="s">"VARCHAR(255)"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/createTable&gt;</span>
<span class="nt">&lt;/changeSet&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_встроенный_sql">Встроенный SQL</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;changeSet</span> <span class="na">context=</span><span class="s">"legacy"</span> <span class="na">author=</span><span class="s">"author"</span> <span class="na">id=</span><span class="s">"1-domain-some-domain"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;sql&gt;</span>CREATE DOMAIN public.some_domain AS bigint; ALTER DOMAIN public.some_domain OWNER TO test;<span class="nt">&lt;/sql&gt;</span>
    <span class="nt">&lt;rollback&gt;</span>DROP DOMAIN public.some_domain;<span class="nt">&lt;/rollback&gt;</span>
<span class="nt">&lt;/changeSet&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_файл_sql">Файл SQL</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;changeSet</span> <span class="na">context=</span><span class="s">"legacy"</span> <span class="na">author=</span><span class="s">"author"</span> <span class="na">id=</span><span class="s">"1-user"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;sqlFile</span> <span class="na">dbms=</span><span class="s">"postgresql"</span> <span class="na">path=</span><span class="s">"sql/some.sql"</span> <span class="na">relativeToChangelogFile=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;rollback&gt;</span>delete from "some";<span class="nt">&lt;/rollback&gt;</span>
<span class="nt">&lt;/changeSet&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_теги">Теги</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;changeSet</span> <span class="na">context=</span><span class="s">"legacy"</span> <span class="na">author=</span><span class="s">"author"</span> <span class="na">id=</span><span class="s">"1-initial-changeset"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;tagDatabase</span> <span class="na">tag=</span><span class="s">"initial"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/changeSet&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_контексты_запуска">5.3.5. Контексты запуска</h4>
<div class="paragraph">
<p>Для более удобного управления различными конфигурациями, например <code>development/production</code> можно использовать контексты.
Контекст указывается в changeSet аттрибуте context и затем запускается <strong>Apache Maven</strong> параметром <code>-Dcontexts</code>.</p>
</div>
<div class="sect4">
<h5 id="_изменение_с_контекстом">Изменение с контекстом</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;changeSet</span> <span class="na">context=</span><span class="s">"legacy"</span> <span class="na">author=</span><span class="s">"author"</span> <span class="na">id=</span><span class="s">"1-initial-changeset"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;tagDatabase</span> <span class="na">tag=</span><span class="s">"initial"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/changeSet&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_запуск_изменений_по_контексту">Запуск изменений по контексту</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell script">#!/usr/bin/env bash mvn liquibase:update\
        -Denv=dev\
        -Dliquibase.url="jdbc:postgresql://dev/test?prepareThreshold=0&amp;stringtype=unspecified"\
        -Dliquibase.contexts=non-legacy</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_откат_изменений">5.3.6. Откат изменений</h4>
<div class="paragraph">
<p>Операция обратная обновлению, в большинстве случаев поддерживается автоматически.
Для прочих возможно задание через секцию rollback.
Запускается командой liquibase:rollback.</p>
</div>
<div class="sect4">
<h5 id="_изменение_с_откатом">Изменение с откатом</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;changeSet</span> <span class="na">context=</span><span class="s">"legacy"</span> <span class="na">author=</span><span class="s">"author"</span> <span class="na">id=</span><span class="s">"1-domain-some-domain"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;sql&gt;</span>CREATE DOMAIN public.some_domain AS bigint; ALTER DOMAIN public.some_domain OWNER TO test;<span class="nt">&lt;/sql&gt;</span>
    <span class="nt">&lt;rollback&gt;</span>DROP DOMAIN public.some_domain;<span class="nt">&lt;/rollback&gt;</span>
<span class="nt">&lt;/changeSet&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_запуск_отката">Запуск отката</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell script">#!/usr/bin/env bash mvn liquibase:update\
        -Denv=dev\
        -Dliquibase.url="jdbc:postgresql://dev/test?prepareThreshold=0&amp;stringtype=unspecified"\
        -Dliquibase.contexts=non-legacy</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_сравнение">5.3.7. Сравнение</h4>
<div class="paragraph">
<p>В разработке удобно использовать для сравнения двух существующих баз на предмет внесённых изменений.
В настройки (или параметры запуска) потребуется добавить ссылку на reference DB и данные для доступа к ней.</p>
</div>
<div class="listingblock">
<div class="title"><code>liquibase.properties</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><span class="py">referenceUsername</span><span class="p">=</span><span class="s">test referenceUrl=jdbc:postgresql://dev/test_reference</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_сравнение_схем">Сравнение схем</h5>
<div class="paragraph">
<p>Сравнение схем <code>url</code> и <code>referenceUrl</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell script">#!/usr/bin/env bash mvn liquibase:diff\
        -Denv=dev\
        -Dliquibase.referenceUrl="jdbc:postgresql://dev/test?prepareThreshold=0"\
        -Dliquibase.url="jdbc:postgresql://dev/test_reference?prepareThreshold=0"\
        -Dliquibase.diffChangeLogFile=dev/diff.xml</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_сохранение_схемы">5.3.8. Сохранение схемы</h4>
<div class="paragraph">
<p>Также бывает полезно сохранить текущую схему базы, с данными или без. Необходимо иметь в виду, что <strong>Liquibase</strong> сохраняет схему не полностью соответствующую оригиналу, например используемые домены или наследование нужно будет добавлять отдельно (см Ограничения).</p>
</div>
<div class="sect4">
<h5 id="_сохранение_схемы_без_учёта_данных">Сохранение схемы без учёта данных</h5>
<div class="paragraph">
<p>Сохранение схемы существующей базы.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell script">#!/usr/bin/env bash mvn liquibase:generateChangeLog\
        -Denv=dev\
        -Dliquibase.url="jdbc:postgresql://dev/test_reference?prepareThreshold=0"\
        -Dliquibase.outputChangeLogFile=dev/changelog.xml</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_сохранение_схемы_с_данными">Сохранение схемы с данными</h5>
<div class="paragraph">
<p>Сохранение схемы существующей базы с данными.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell script">#!/usr/bin/env bash mvn liquibase:generateChangeLog\
        -Denv=dev\
        -Dliquibase.url="jdbc:postgresql://dev/test_reference?prepareThreshold=0"\
        -Dliquibase.outputChangeLogFile=dev/changelog.xml</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_обработка_типов_данных_специфичных_для_конкретной_базы">5.3.9. Обработка типов данных специфичных для конкретной базы</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;changeSet&gt;</span>
    <span class="nt">&lt;createTable</span> <span class="na">tableName=</span><span class="s">"t_name"</span><span class="nt">&gt;</span>
        ...
        <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"doubleArray"</span> <span class="na">type=</span><span class="s">"DOUBLE_ARRAY"</span><span class="nt">/&gt;</span>
        ...
    <span class="nt">&lt;/createTable&gt;</span>
    <span class="nt">&lt;modifySql</span> <span class="na">dbms=</span><span class="s">"postgresql"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;replace</span> <span class="na">replace=</span><span class="s">"DOUBLE_ARRAY"</span> <span class="na">with=</span><span class="s">"double precision[][]"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/modifySql&gt;</span>
<span class="nt">&lt;/changeSet&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_альтернативные_решения">5.3.10. Альтернативные решения</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Flyway</strong><br>
Наряду с Liquibase пользуется популярностью в Java сообществе — <a href="http://flywaydb.org/documentation" class="bare">http://flywaydb.org/documentation</a></p>
</li>
<li>
<p><strong>Sqitch</strong><br>
Аналог на Perl — <a href="http://sqitch.org" class="bare">http://sqitch.org</a></p>
</li>
<li>
<p><strong>FluentMigrator</strong><br>
Аналог для .Net — <a href="https://github.com/schambers/fluentmigrator" class="bare">https://github.com/schambers/fluentmigrator</a></p>
</li>
<li>
<p><strong>DBGeni</strong><br>
Аналог для Ruby — <a href="http://dbgeni.appsintheopen.com/manual.html" class="bare">http://dbgeni.appsintheopen.com/manual.html</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_links_3">5.3.11. Links</h4>
<div class="ulist">
<ul>
<li>
<p>Существуют определенные проблемы с выгрузкой, сравнением и применением бинарных данных, в частности проблема с генерацией изменений.</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://liquibase.jira.com/browse/CORE-2650" class="bare">https://liquibase.jira.com/browse/CORE-2650</a></p>
</li>
<li>
<p><a href="https://liquibase.jira.com/browse/CORE-2906" class="bare">https://liquibase.jira.com/browse/CORE-2906</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Наследование и общие столбцы</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://forum.liquibase.org/topic/postgresql-subtable-via-inherits" class="bare">http://forum.liquibase.org/topic/postgresql-subtable-via-inherits</a></p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/25840467/liquibase-common-columns" class="bare">https://stackoverflow.com/questions/25840467/liquibase-common-columns</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Исходный код</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/liquibase/liquibase" class="bare">https://github.com/liquibase/liquibase</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Как добавить liquibase в существующий проект</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.liquibase.org/documentation/existing_project.html" class="bare">https://www.liquibase.org/documentation/existing_project.html</a></p>
</li>
<li>
<p><a href="https://www.liquibase.org/documentation/contexts.html" class="bare">https://www.liquibase.org/documentation/contexts.html</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Как работают изменения базы</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.liquibase.org/documentation/changeset.html" class="bare">https://www.liquibase.org/documentation/changeset.html</a></p>
</li>
<li>
<p><a href="https://www.liquibase.org/documentation/databasechangelog_table.html" class="bare">https://www.liquibase.org/documentation/databasechangelog_table.html</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Больше о формате изменений</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.liquibase.org/documentation/json_format.html" class="bare">http://www.liquibase.org/documentation/json_format.html</a></p>
</li>
<li>
<p><a href="https://www.liquibase.org/documentation/changes/sql.html" class="bare">https://www.liquibase.org/documentation/changes/sql.html</a></p>
</li>
<li>
<p><a href="https://www.liquibase.org/documentation/changes/sql_file.html" class="bare">https://www.liquibase.org/documentation/changes/sql_file.html</a></p>
</li>
<li>
<p><a href="https://www.liquibase.org/documentation/column.html" class="bare">https://www.liquibase.org/documentation/column.html</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Больше про update</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.liquibase.org/documentation/maven/generated/update-mojo.html" class="bare">https://www.liquibase.org/documentation/maven/generated/update-mojo.html</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Больше о генерации изменений</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.liquibase.org/documentation/maven/generated/generateChangeLog-mojo.html" class="bare">https://www.liquibase.org/documentation/maven/generated/generateChangeLog-mojo.html</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Больше о custom SQL</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.liquibase.org/documentation/modify_sql.html" class="bare">http://www.liquibase.org/documentation/modify_sql.html</a></p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/28240068/create-column-of-type-double-precision-with-liquibase" class="bare">https://stackoverflow.com/questions/28240068/create-column-of-type-double-precision-with-liquibase</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Прочее</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://news.ycombinator.com/item?id=10145933" class="bare">https://news.ycombinator.com/item?id=10145933</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Другие статьи о Liquibase</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://habr.com/ru/post/179425/" class="bare">https://habr.com/ru/post/179425/</a></p>
</li>
<li>
<p><a href="https://habr.com/ru/post/178665/" class="bare">https://habr.com/ru/post/178665/</a></p>
</li>
<li>
<p><a href="https://habr.com/ru/post/333762/" class="bare">https://habr.com/ru/post/333762/</a></p>
</li>
<li>
<p><a href="https://habr.com/ru/post/251617/" class="bare">https://habr.com/ru/post/251617/</a></p>
</li>
<li>
<p><a href="https://habr.com/ru/post/251617/" class="bare">https://habr.com/ru/post/251617/</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_logging">5.4. Logging</h3>
<div class="paragraph">
<p><strong>Logging</strong> (<strong>логирование</strong>, <strong>журналирование</strong>) — это процесс записи куда-то (в файл, в сетевой сокет) данных о работе программы. Место, куда эти данные записываются, является <strong>log-файл</strong>, а само содержимое называют <strong>logs</strong> (<strong>логи</strong>). <strong>Log</strong> (<strong>лог</strong>) - это одна запись, которая делается в <strong>log-file</strong>. Так же само действие по отправке записи при logging называется <strong>log</strong> (<strong>логировать</strong>)</p>
</div>
<div class="paragraph">
<p>Если в работе сервера, компьютера или программного обеспечения возникла неизвестная ошибка, в первую очередь смотрят логи. <strong>Log-файл</strong> — <strong>текстовый файл</strong> с информацией о действиях программного обеспечения или пользователей, который хранится на компьютере или передается на хранение в систему логирования. Это хронология событий и их источников, ошибок и причин, по которым они произошли. Читать и анализировать логи можно как с помощью обычного текстового редактора, так и с помощью специального ПО.</p>
</div>
<div class="paragraph">
<p><strong>Logging</strong> позволяет ответить на вопросы, что происходило, когда и при каких обстоятельствах. Без логов сложно понять, из-за чего появляется ошибка, если она возникает периодически и только при определенных условиях. Чтобы облегчить задачу администраторам и программистам, в лог записывается информация не только об ошибках, но и о причинах их возникновения. Благодаря логам найденные ошибки можно быстро исправить.</p>
</div>
<div class="paragraph">
<p>Весь процесс логирования состоит из трех частей.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Сбор информации.</p>
</li>
<li>
<p>Фильтрование собранной информации.</p>
</li>
<li>
<p>Запись отобранной информации.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_типы_логов">5.4.1. Типы логов</h4>
<div class="paragraph">
<p>Для удобной работы с логами их делят на типы. Это помогает быстрее находить нужные и выбирать правильные инструменты для работы с ними. Например, выделяют:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>системные логи</strong>, то есть те, которые связаны с системными событиями;</p>
</li>
<li>
<p><strong>серверные логи</strong>, регистрирующие обращения к серверу и возникшие при этом ошибки;</p>
</li>
<li>
<p><strong>логи баз данных</strong>, фиксирующие запросы к базам данных;</p>
</li>
<li>
<p><strong>почтовые логи</strong>, относящиеся к входящим/исходящим письмам и отслеживающие ошибки, из-за которых письма не были доставлены;</p>
</li>
<li>
<p><strong>логи авторизации</strong>;</p>
</li>
<li>
<p><strong>логи аутентификации</strong>;</p>
</li>
<li>
<p><strong>логи приложений</strong>, установленных на этих операционных системах.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Также логи можно типизировать <strong>по степени важности</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Fatal/critical error</strong> — то, что нужно срочно исправить.</p>
</li>
<li>
<p><strong>Not critical error</strong> — ошибки, которые не влияют на пользователя.</p>
</li>
<li>
<p><strong>Warning</strong> — предупреждения, то, на что нужно обратить внимание.</p>
</li>
<li>
<p><strong>Initial information</strong> — информация о вызовах <strong>API</strong> сервиса, запросах в БД, вызовах других сервисов.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Еще одним важным вопросом на который надо ответить - это что необходимо отправлять в log.</p>
</div>
<div class="paragraph">
<p>Работа приложения - это происходящие в нем события, которые в свою очередь могут быть классифицированы на:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>события, связанные с бизнес-логикой;</p>
</li>
<li>
<p>события, связанные с безопасностью приложения;</p>
</li>
<li>
<p>системные события, связанные с уже конкретикой реализации - вызовов ОС, использования библиотек, фреймворков и т.д.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Логировать обязательно необходимо:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Начало/конец работы приложения</strong>. Нужно знать, что приложение действительно запустилось, как мы и ожидали, и завершилось так же ожидаемо.</p>
</li>
<li>
<p><strong>Вопросы безопасности</strong>. Здесь хорошо бы логировать попытки подбора пароля, логирование входа важных юзеров и т.д.</p>
</li>
<li>
<p>Некоторые <strong>состояния приложения</strong>. Например, переход из одного состояния в другое в бизнес процессе.</p>
</li>
<li>
<p>Некоторая <strong>информация для debug</strong>, с соответственным уровнем логирования.</p>
</li>
<li>
<p><strong>Некоторые SQL скрипты</strong>. Есть реальные случаи, когда это нужно. Опять-таки, умелым образом регулируя уровни, можно добиться отличных результатов.</p>
</li>
<li>
<p><strong>Выполняемые потоки (Thread)</strong> могут быть отправлены в log в случаях с проверкой корректной работы.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Популярные ошибки в logging:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Избыток логирования</strong><br>
Не стоит логировать каждый шаг, который чисто теоретически может быть важным.
<strong>Есть правило</strong>: логи могут нагружать работоспособность не более, чем на <strong>10%</strong>. Иначе будут проблемы с производительностью.</p>
</li>
<li>
<p><strong>Логирование всех данных в один файл</strong><br>
Это приведет к тому, что в определенный момент чтение/запись в него будет очень сложной, не говоря о том, что есть ограничения по размеру файлов в определенных системах.</p>
</li>
<li>
<p><strong>Использование неверных уровней логирования</strong><br>
У каждого уровня логирования есть четкие границы, и их стоит соблюдать. Если граница расплывчатая, можно договориться какой из уровней использовать.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_библиотеки_логирования_в_java">5.4.2. Библиотеки логирования в Java</h4>
<div class="paragraph">
<p>В <strong>Java</strong> существуют следующие <strong>библиотеки логирования</strong>, иногда называемые <strong>loggers</strong> (<strong>логерами</strong>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Log4j</strong> - это первый набор инструментов для логирования Java, который появился еще в 1999-м году. Внутри себя имеет различные способы вывода логов, несколько форматов логирования и многое другое. Раньше данная библиотека активно применялась, но уже долгое время этот проект не развивается.</p>
</li>
<li>
<p><strong>JUL</strong> — <code>java.util.logging</code>. Является частью <strong>JDK</strong>. Имеет множество уровней логирования, например, только для отладки у этого инструмента есть в арсенале 3 отладочных уровня вместо одного стандартного.</p>
</li>
<li>
<p><strong>JCL</strong> — <strong>Apache Commons Logging</strong>. Из-за того, что долгое время не было промышленного стандарта в logging и был период, когда многие создавали свой свои собственные библиотеки логирования, решили выпустить <strong>JCL</strong> — общую обертку, которая  использовалась бы над другими.</p>
</li>
<li>
<p><strong>Logback</strong> - был создан как альтернатива умирающему <strong>Log4j</strong>, разработанная создателями <strong>Log4j</strong>, поэтому он вобрал в себя все лучшее из этого инструмента, при этом усовершенствовал некоторые показатели.</p>
</li>
<li>
<p><strong>Log4j 2.x</strong> - это улучшенная версия <strong>log4j 1.x</strong> и <strong>logback</strong>.</p>
</li>
<li>
<p><strong>SLF4J</strong> — <strong>Simple Logging Facade for Java</strong>. Этот инструмент является оберткой над многими популярными библиотеками логирования, например: <strong>Logback</strong>, <strong>Log4j</strong>, <strong>JUL</strong> и др., поэтому его рекомендуется использовать в паре с полноценной библиотекой для логирования.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_уровень_логирования">5.4.3. Уровень логирования</h4>
<div class="paragraph">
<p>Если в <strong>лог-файл</strong> записывать все действия программы, то там будет большое количество различных сведений. В некоторых ситуациях лог-файлы могут генерироваться очень быстро и в огромных размерах. В этом случае найти нужную информацию в логах будет очень нелегко. Поэтому, чтобы контролировать объемы записываемой информации, придумали различные уровни логирования.</p>
</div>
<div class="paragraph">
<p><strong>Уровень логирования</strong> - это разделение событий по приоритетам, по степени важности. Например, <strong>error</strong> - пишем ошибки, <strong>debug</strong> - пишем более подробно в лог и т.д.</p>
</div>
<div class="paragraph">
<p>Практически все библиотеки логирования (кроме <strong>JUL</strong>) имеют следующие уровни логирования:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>OFF</strong>: никакие логи не записываются, все будут проигнорированы;</p>
</li>
<li>
<p><strong>FATAL</strong>: ошибка, после которой приложение уже не сможет работать и будет остановлено, например, <strong>JVM out of memory error</strong>;</p>
</li>
<li>
<p><strong>ERROR</strong>: уровень ошибок, когда есть проблемы, которые нужно решить. Ошибка не останавливает работу приложения в целом. Остальные запросы могут работать корректно;</p>
</li>
<li>
<p><strong>WARN</strong>: обозначаются логи, которые содержат предостережение. Произошло неожиданное действие, несмотря на это система устояла и выполнила запрос;</p>
</li>
<li>
<p><strong>INFO</strong>: лог, который записывает важные действия в приложении. Это не ошибки, это не предостережение, это ожидаемые действия системы;</p>
</li>
<li>
<p><strong>DEBUG</strong>: логи, необходимые для отладки приложения. Для уверенности в том, что система делает именно то, что от нее ожидают, или описания действия системы: <code>method1 начал работу</code>;</p>
</li>
<li>
<p><strong>TRACE</strong>: менее приоритетные логи для отладки, с наименьшим уровнем логирования;</p>
</li>
<li>
<p><strong>ALL</strong>: уровень, при котором будут записаны все логи из системы.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Если в приложении в каком-то месте включен уровень логирования <strong>INFO</strong>, будут логироваться все уровни, начиная с <strong>INFO</strong> и до <strong>FATAL</strong>. Если будет уровень логирования <strong>FATAL</strong>, будут записаны <strong>только логи с этим уровнем</strong>.</p>
</div>
<div class="paragraph">
<p><strong>JUL</strong> имеет следующие уровни логирования:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>FINEST</strong>,</p>
</li>
<li>
<p><strong>FINER</strong>,</p>
</li>
<li>
<p><strong>FINE</strong>,</p>
</li>
<li>
<p><strong>CONFIG</strong>,</p>
</li>
<li>
<p><strong>INFO</strong>,</p>
</li>
<li>
<p><strong>WARNING</strong>,</p>
</li>
<li>
<p><strong>SEVERE</strong>,</p>
</li>
<li>
<p><strong>ALL</strong>,</p>
</li>
<li>
<p><strong>OFF</strong>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_основные_термины">5.4.4. Основные термины</h4>
<div class="paragraph">
<p>В основе большинства библиотек логирования в <strong>Java</strong> лежат три понятия:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Logger</strong></p>
</li>
<li>
<p><strong>Appender</strong></p>
</li>
<li>
<p><strong>Layout</strong></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_logger">Logger</h5>
<div class="paragraph">
<p><strong>Logger</strong> — это некий объект, который отвечает за запись информации в лог-файлы, опираясь на заданные уровни логирования. <strong>Logger</strong> создается с помощью фабрики и на этапе создания ему присваивается имя. Имя может быть любым, но по стандарту имя должно быть сопряжено с именем класса, в котором вы собираетесь что-то логировать.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">gerLogger</span><span class="o">(</span><span class="nc">SomeClass</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Основная задача Logger</strong> — не пропустить событие, которое нужно записать в лог-файл.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Application started"</span><span class="o">);</span>
<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Or not"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Это событие по сути состоит из двух полей:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>message = "Application started"</code>;</p>
</li>
<li>
<p><code>level = Level.Info</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_appender">Appender</h5>
<div class="paragraph">
<p><strong>Appender</strong> — это конечная точка, куда «приходит» информация для логирования. В качестве <strong>appender</strong> могут выступать: <strong>файл</strong>, <strong>база данных</strong>, <strong>консоль</strong>, <strong>сокет</strong> и др. У <strong>appender</strong> нет каких-либо ограничений, куда записывать сообщения. Можно написать свой <strong>appender</strong>, который пишет сообщения куда-угодно. Если <strong>Logger</strong> — это начальная точка в logging, то <strong>Appender</strong> — это конечная точка.</p>
</div>
<div class="paragraph">
<p><strong>Loggers</strong>  и <strong>appenders</strong> связаны в отношении <code>many-to-many</code>. При этом один <strong>logger</strong> может содержать несколько <strong>appenders</strong> и наоборот. Чтобы изменить поведение <strong>logger по умолчанию</strong>, нам нужно сконфигурировать свой <strong>файловый appender</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_layout">Layout</h5>
<div class="paragraph">
<p><strong>Layout</strong> — это формат, в котором выводятся сообщения. Форматирование сообщений напрямую зависит от используемой библиотеки при logging.</p>
</div>
</div>
<div class="sect4">
<h5 id="_узлы_логирования">Узлы логирования</h5>
<div class="paragraph">
<p>При создании logger используется класс, но по итогу записывается полное имя класса с пакетами. Это делается, чтобы потом можно было разделить логирование на узлы, и для каждого узла настроить уровень логирования и appender. Например, имя класса: <code>com.github.romankh3.logginglecture.MainDemo</code> — в нем создался logger. И вот таким образом его можно разделить на узлы логирования.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../assets/img/java/tools/logging/logging-nodes.png" alt="logging nodes"></span></p>
</div>
<div class="paragraph">
<p>Каждый <strong>logger</strong> имеет имя, описывающее иерархию, к которой он принадлежит. Разделитель – точка. Принцип полностью аналогичен формированию имени пакета в <strong>Java</strong>. Например: <code>ru.aarexer.example.SomeClass</code>. Главный узел — нулевой <strong>RootLogger</strong>. Это узел, который принимает все логи всего приложения. Каждому <strong>logger</strong> можно выставить свой уровень. Установленный <strong>logger</strong> уровень вывода распространяется на все его дочерние <strong>loggers</strong>, для которых явно не выставлен уровень. Поэтому у всех <strong>loggers</strong> будет уровень логирования, даже если явно мы не прописали для <code>ru.aarexer.example.SomeClass</code> его, то он будет наследоваться от <strong>RootLogger</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Appenders</strong> настраивают свою работу именно на узлы логирования. Но такое наследование <strong>appenders</strong> можно отключить через конфигурацию, для этого стоит посмотреть в сторону выставления флага <code>additivity="false"</code> на <strong>loggers</strong>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_конфигурация_и_использование">5.4.5. Конфигурация и использование</h4>
<div class="sect4">
<h5 id="_конфигурация_2">Конфигурация</h5>
<div class="paragraph">
<p>При конфигурировании можно выбрать куда будет производиться запись, путь где будет лежать файл лога, количество файлов, их размеры. Более подробные описания конфигураций для различных реализаций будут приведены при описании этих реализаций.</p>
</div>
<div class="paragraph">
<p>В зависимости от используемой библиотеки, <strong>loggers</strong> могут конфигурироваться различными способами.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Log4j</strong> поддерживает конфигурирование двумя способами – как <strong>properties</strong> и <strong>xml</strong> файл.</p>
</li>
<li>
<p><strong>JUL</strong> настраивается только через <strong>properties</strong> файл.</p>
</li>
<li>
<p><strong>Logback</strong> может быть сконфигурирован через <strong>xml</strong> и <strong>groovy</strong> файл.</p>
</li>
<li>
<p><strong>Log4j 2</strong> может быть сконфигурирован через <strong>xml</strong>, <strong>json</strong> и <strong>yaml</strong> файл.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Конфигурация через xml-файл:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="cp">&lt;!DOCTYPE log4j:configuration SYSTEM "log4j.dtd"&gt;</span>
<span class="nt">&lt;log4j:configuration</span> <span class="na">debug=</span><span class="s">"false"</span> <span class="na">xmlns:log4j=</span><span class="s">"http://jakarta.apache.org/log4j/"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"ConsoleAppender"</span> <span class="na">class=</span><span class="s">"org.apache.log4j.ConsoleAppender"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"Encoding"</span> <span class="na">value=</span><span class="s">"Cp866"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;layout</span> <span class="na">class=</span><span class="s">"org.apache.log4j.PatternLayout"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">"ConversionPattern"</span> <span class="na">value=</span><span class="s">"%d{ISO8601} [%-5p][%-16.16t][%32.32c] - %m%n"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/layout&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>
    <span class="nt">&lt;root&gt;</span>
        <span class="nt">&lt;priority</span> <span class="na">value=</span><span class="s">"DEBUG"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"ConsoleAppender"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/root&gt;</span>
<span class="nt">&lt;/log4j:configuration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Конфигурация через properties-файл:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><span class="py">log4j.debug</span> <span class="p">=</span> <span class="s">false</span>
<span class="py">log4j.rootLogger</span> <span class="p">=</span> <span class="s">DEBUG, ConsoleAppender</span>
<span class="c"># CONSOLE appender customisation
</span><span class="py">log4j.appender.ConsoleAppender</span> <span class="p">=</span> <span class="s">org.apache.log4j.ConsoleAppender</span>
<span class="py">log4j.appender.ConsoleAppender.encoding</span> <span class="p">=</span> <span class="s">Cp866</span>
<span class="py">log4j.appender.ConsoleAppender.layout</span> <span class="p">=</span> <span class="s">org.apache.log4j.PatternLayout</span>
<span class="py">log4j.appender.ConsoleAppender.layout.ConversionPattern</span> <span class="p">=</span> <span class="s">%d{ISO8601} [%-5p][%-16.16t][%32.32c] - %m%n</span>
<span class="c"># File appender customisation
</span><span class="py">log4j.appender.FILE</span><span class="p">=</span><span class="s">org.apache.log4j.RollingFileAppender</span>
<span class="py">log4j.appender.FILE.File</span><span class="p">=</span><span class="s">./target/logging/logging.log</span>
<span class="py">log4j.appender.FILE.MaxFileSize</span><span class="p">=</span><span class="s">1MB log4j.appender.FILE.threshold=DEBUG log4j.appender.FILE.MaxBackupIndex=2 log4j.appender.FILE.layout=org.apache.log4j.PatternLayout log4j.appender.FILE.layout.ConversionPattern=[ %-5p] - %c:%L - %m%n</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Принято считать эти два способа равнозначными. При инициализации они ищутся в <strong>classpath</strong>, сначала <strong>xml-файл</strong>, потом <strong>properties-файл</strong>. Так что при наличии обоих рабочим будет именно <strong>xml</strong>.</p>
</div>
<div class="paragraph">
<p>Ниже приведен пример конфигурации <code>log4j.properties</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><span class="py">log4j.appender.CONSOLE</span><span class="p">=</span><span class="s">org.apache.log4j.ConsoleAppender</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Эта строка говорит, что мы регистрируем <strong>appender</strong> <code>CONSOLE</code>, который использует реализацию <code>org.apache.log4j.ConsoleAppender</code>. Этот <strong>appender</strong> записывает данные в консоль.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><span class="py">log4j.appender.FILE</span><span class="p">=</span><span class="s">org.apache.log4j.RollingFileAppender</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Этот <strong>appender</strong> записывает в файл.</p>
</div>
<div class="paragraph">
<p>Когда у нас уже есть зарегистрированные <strong>appenders</strong>, мы можем определить, какой будет уровень логирования в узлах и какие <strong>appenders</strong> будут при этом использоваться.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><span class="py">log4j.rootLogger</span><span class="p">=</span><span class="s">DEBUG, CONSOLE, FILE</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>log4j.rootLogger</code> означает, что будем настраивать главный узел, в котором находятся все логи;</p>
</li>
<li>
<p>после знака равно первое слово говорит о том, с каким уровнем и выше будут записываться логи (в нашем случае это <code>DEBUG</code>);</p>
</li>
<li>
<p>далее после запятой указываются все <strong>appenders</strong>, которые будут использоваться.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Чтобы настроить определенный узел логирования, нужно использовать такую запись:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><span class="py">log4j.logger.com.github.romankh3.logginglecture</span><span class="p">=</span><span class="s">TRACE, OWN, CONSOLE</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>где <code>log4j.logger.</code> используется для настройки определенного узла, в нашем случае это <code>com.github.romankh3.logginglecture.</code>.</p>
</div>
<div class="paragraph">
<p>Настройка <code>CONSOLE</code> <strong>appender</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><span class="c"># CONSOLE appender customisation
</span><span class="py">log4j.appender.CONSOLE</span><span class="p">=</span><span class="s">org.apache.log4j.ConsoleAppender</span>
<span class="py">log4j.appender.CONSOLE.threshold</span><span class="p">=</span><span class="s">DEBUG</span>
<span class="py">log4j.appender.CONSOLE.layout</span><span class="p">=</span><span class="s">org.apache.log4j.PatternLayout</span>
<span class="py">log4j.appender.CONSOLE.layout.ConversionPattern</span><span class="p">=</span><span class="s">[%-5p] : %c:%L : %m%n</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Здесь видно, что можно задать уровень, с которого будет обрабатывать именно <strong>appender</strong>. Реальная ситуация: сообщение с уровнем <strong>info</strong> принял узел логирования и передал <strong>appender</strong>, который к нему приписан, а вот уже <strong>appender</strong>, с уровнем <strong>warn</strong> и выше, лог этот принял, но ничего с ним не сделал.</p>
</div>
<div class="paragraph">
<p>Далее нужно определиться с тем, какой шаблон будет в сообщении (<strong>PatternLayout</strong>).</p>
</div>
<div class="paragraph">
<p>Пример настройки <code>FILE</code> <strong>appender</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><span class="c"># File appender customisation
</span><span class="py">log4j.appender.FILE</span><span class="p">=</span><span class="s">org.apache.log4j.RollingFileAppender</span>
<span class="py">log4j.appender.FILE.File</span><span class="p">=</span><span class="s">./target/logging/logging.log</span>
<span class="py">log4j.appender.FILE.MaxFileSize</span><span class="p">=</span><span class="s">1MB</span>
<span class="py">log4j.appender.FILE.threshold</span><span class="p">=</span><span class="s">DEBUG</span>
<span class="py">log4j.appender.FILE.MaxBackupIndex</span><span class="p">=</span><span class="s">2</span>
<span class="py">log4j.appender.FILE.layout</span><span class="p">=</span><span class="s">org.apache.log4j.PatternLayout</span>
<span class="py">log4j.appender.FILE.layout.ConversionPattern</span><span class="p">=</span><span class="s">[ %-5p] - %c:%L - %m%n</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Здесь можно настроить, в какой именно файл будут записываться логи. Запись идет в файл <code>logging.log</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><span class="py">log4j.appender.FILE.File</span><span class="p">=</span><span class="s">./target/logging/logging.log</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы не было проблем с размером файла, можно настроить максимальный: в данном случае — 1МБ.</p>
</div>
<div class="paragraph">
<p><code>MaxBackupIndex</code> — говорит о том, сколько будет таких файлов. Если создается больше этого числа, то первый файл будет удален.</p>
</div>
</div>
<div class="sect4">
<h5 id="_использование">Использование</h5>
<div class="paragraph">
<p>Чтобы использовать <code>Logger</code>, необходимо его создать:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">org</span><span class="o">.</span><span class="na">slf4j</span><span class="o">.</span><span class="na">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">slf4j</span><span class="o">.</span><span class="na">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">ClassName</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы сделать запись в лог, можно использовать множество методов, которые показывают, с каким уровнем будут записи.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">"Method 1 started with argument={}"</span><span class="o">,</span> <span class="n">argument</span><span class="o">);</span>
<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Database updated with script = {}"</span><span class="o">,</span> <span class="n">script</span><span class="o">);</span>
<span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Application has started on port = {}"</span><span class="o">,</span> <span class="n">port</span><span class="o">);</span>
<span class="n">logger</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"Log4j didn't find log4j.properties.Please, provide them"</span><span class="o">);</span>
<span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"Connection refused to host = {}"</span><span class="o">,</span> <span class="n">host</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Также можно использовать метод <code>log()</code> и передать в него параметры.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">logger</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="nc">Level</span><span class="o">.</span><span class="na">INFO</span><span class="o">,</span> <span class="n">argument</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_реализация_slf4jlog4j_2logback">5.4.6. Реализация (SLF4J/Log4J 2/Logback)</h4>
<div class="paragraph">
<p>На данный момент в <strong>Java</strong> наиболее популярные следующие библиотеки логирования:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>log4j 2</strong></p>
</li>
<li>
<p><strong>Logback</strong></p>
</li>
<li>
<p><strong>SLF4J</strong> (как фасад)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_system_err_println"><code>System.err.println()</code></h5>
<div class="paragraph">
<p>Первоначально был, разумеется, <code>System.err.println()</code> - выводит запись в консоль. Его и сейчас используют для быстрого получения лога при debugging.</p>
</div>
</div>
<div class="sect4">
<h5 id="_log4j_2">Log4j 2</h5>
<div class="paragraph">
<p>Для использования <strong>log4j2</strong> вам необходимо подключить библиотеки <code>log4j-api-2.x</code> и <code>log4j-core-2.x</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.logging.log4j<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>log4j-api<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${log4j.version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.logging.log4j<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>log4j-core<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${log4j.version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Logger создается вызовом статического метода класса <code>org.apache.logging.log4j.Logger</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="nc">LogManager</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">LoggingLog4j</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Logger умеет принимать помимо привычных нам <code>String</code>, <code>Object</code> и <code>Throwable</code> еще два новых типа — <code>MapMessage</code> и <code>Marker</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// Карта сообщений (напечатается как msg1="Сообщение 1” msg2="Сообщение 2”)</span>
<span class="nc">MapMessage</span> <span class="n">mapMessage</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MapMessage</span><span class="o">();</span>
<span class="n">mapMessage</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"msg1"</span><span class="o">,</span> <span class="s">"Сообщение 1"</span><span class="o">);</span>
<span class="n">mapMessage</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"msg2"</span><span class="o">,</span> <span class="s">"Сообщение 2"</span><span class="o">);</span>
<span class="c1">// Маркер, объект по которому можно фильтровать сообщения</span>
<span class="nc">Marker</span> <span class="n">marker</span> <span class="o">=</span> <span class="nc">MarkerManager</span><span class="o">.</span><span class="na">getMarker</span><span class="o">(</span><span class="s">"fileonly"</span><span class="o">);</span>
<span class="c1">// Строковое сообщение</span>
<span class="nc">String</span> <span class="n">stringMessage</span> <span class="o">=</span> <span class="s">"Сообщение"</span><span class="o">;</span>
<span class="c1">// Строковое сообщение с параметрами</span>
<span class="nc">String</span> <span class="n">stringMessageFormat</span> <span class="o">=</span> <span class="s">"Сообщение {}, от {}"</span><span class="o">;</span>
<span class="c1">// Исключение</span>
<span class="nc">Throwable</span> <span class="n">throwable</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Throwable</span><span class="o">();</span>
<span class="c1">// Объект</span>
<span class="nc">Object</span> <span class="n">object</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>В классическом для loggers стиле методы делятся на два типа:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>совпадающие с названием уровня логирования</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">((</span><span class="n">marker</span><span class="o">,</span> <span class="n">mapMessage</span><span class="o">,</span> <span class="n">throwable</span><span class="o">);</span>
<span class="n">log</span><span class="o">.</span><span class="na">throwing</span><span class="o">(</span><span class="n">throwable</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>методы <code>log</code>, принимающие уровень логирования в качестве параметра.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">log</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="nc">Level</span><span class="o">.</span><span class="na">INFO</span><span class="o">,</span> <span class="n">marker</span><span class="o">,</span> <span class="n">stringMessage</span><span class="o">,</span> <span class="n">throwable</span><span class="o">);</span>
<span class="n">log</span><span class="o">.</span><span class="na">throwing</span><span class="o">(</span><span class="nc">Level</span><span class="o">.</span><span class="na">INFO</span><span class="o">,</span> <span class="n">throwable</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Если не определить конфигурацию, то при запуске <strong>log4j2</strong> выдаст гневное сообщение, о том, что конфигурация не задана и будет печатать ваши сообщения на консоль уровнем не ниже <strong>ERROR</strong>. Конфигурация <strong>log4j2</strong> задается несколькими вариантами: <strong>xml</strong>, <strong>json</strong>, <strong>yaml</strong>. Файл с конфигурацией автоматически ищется <strong>classpath</strong>, должен иметь название <strong>log4j2</strong> и располагаться в пакете по умолчанию.</p>
</div>
<div class="paragraph">
<p>Конфигурация <strong>log4j2</strong> состоит из описания loggers, appenders и фильтров.</p>
</div>
<div class="paragraph">
<p>Фильтры позволяют оценивать события журнала, чтобы определить, следует ли их публиковать и каким образом. Фильтр будет вызван одним из своих методов фильтра и вернет <strong>Result</strong>, который представляет собой <strong>Enum</strong> имеющий одно из 3 значений:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ACCEPT</code></p>
</li>
<li>
<p><code>DENY</code></p>
</li>
<li>
<p><code>NEUTRAL</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Фильтры могут быть сконфигурированы в одном из четырех мест:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Контекстные фильтры</strong><br>
Настраиваются непосредственно в конфигурации. События, отклоняемые этими фильтрами, не будут передаваться регистраторам для дальнейшей обработки. После того как событие было принято контекстным фильтром, оно не будет оцениваться никакими другими контекстными фильтрами, а уровень регистратора не будет использоваться для фильтрации события. Однако событие будет оцениваться фильтрами <strong>Logger</strong> и <strong>Appender</strong>.</p>
</li>
<li>
<p><strong>Фильтры регистратора</strong><br>
Настраиваются на указанном регистраторе. Они оцениваются после контекстных фильтров и уровня журнала для регистратора. События, отклоненные этими фильтрами, будут отброшены, и событие не будет передано родительскому регистратору независимо от параметра аддитивности.</p>
</li>
<li>
<p><strong>Фильтры Appender</strong><br>
Используются для определения того, должен ли конкретный Appender обрабатывать форматирование и публикацию события.</p>
</li>
<li>
<p><strong>Ссылочные фильтры appender</strong><br>
Используются для определения того, должен ли регистратор направлять событие в приложение.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Есть различные фильтра, в том числе и по маркерам:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>BurstFilter</strong> - предоставляет механизм для управления скоростью обработки <strong>LogEvents</strong> путем автоматического отбрасывания событий после достижения максимального предела.</p>
</li>
<li>
<p><strong>CompositeFilter</strong> - предоставляет способ указать несколько фильтров. Он добавляется в конфигурацию в качестве элемента фильтров и содержит другие фильтры для оценки. Элемент <strong>filters</strong> не принимает никаких параметров.</p>
</li>
<li>
<p><strong>DynamicThresholdFilter</strong> - позволяет выполнять фильтрацию по уровню журнала на основе определенных атрибутов.</p>
</li>
<li>
<p><strong>MapFilter</strong> - позволяет фильтровать по элементам данных, которые находятся в MapMessage.</p>
</li>
<li>
<p><strong>MarkerFilter</strong> - сравнивает настроенное значение маркера с параметром маркера, включенным в <strong>LogEvent</strong>. Совпадение происходит, когда имя маркера совпадает с маркером события журнала или одним из его родителей.</p>
</li>
<li>
<p><strong>RegexFilter</strong> - позволяет сравнивать отформатированное или неформатированное сообщение с регулярным выражением.</p>
</li>
<li>
<p><strong>StructuredDataFilter</strong> - это <code>MapFilter</code>, который также позволяет фильтровать по идентификатору события, типу и сообщению.</p>
</li>
<li>
<p><strong>ThreadContextMapFilter</strong> - позволяет выполнять фильтрацию по элементам данных, которые находятся в сопоставлении <strong>ThreadContext</strong>.</p>
</li>
<li>
<p><strong>ThresholdFilter</strong> - возвращает результат <strong>onMatch</strong>, если уровень в <strong>LogEvent</strong> совпадает или более специфичным, чем настроенный уровень, а значение <strong>onMismatch</strong> в противном случае.</p>
</li>
<li>
<p><strong>TimeFilter</strong> - можно использовать для ограничения фильтра только определенной частью дня.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Имеется широкий круг классов appenders, в том числе асинхронные appenders и appenders оборачивающие группу других appenders.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>AsyncAppender</strong> - принимает ссылки на другие приложения и заставляет <strong>LogEvents</strong> записываться на них в отдельном потоке.</p>
</li>
<li>
<p><strong>OutputStreamAppender</strong> - предоставляет основу для многих других приложений, таких как приложения <strong>File</strong> и <strong>Socket</strong>, которые записывают событие в выходной поток.</p>
</li>
<li>
<p><strong>ConsoleAppender</strong> - записывает свои выходные данные либо в <code>System.out</code>, либо в <code>System.err</code>, причем <code>System.out</code> является целевым объектом по умолчанию.</p>
</li>
<li>
<p><strong>FileAppender</strong> - это объект <code>OutputStreamAppender</code>, который записывает данные в файл, указанный в параметре fileName.</p>
</li>
<li>
<p><strong>JDBCAppender</strong> - записывает события журнала в таблицу реляционной базы данных с помощью стандартного <code>JDBC</code>.</p>
</li>
<li>
<p><strong>RollingFileAppender</strong> - это объект <code>OutputStreamAppender</code>, который записывает данные в файл, указанный в параметре <strong>fileName</strong>, и переворачивает файл в соответствии с параметрами <strong>TriggeringPolicy</strong> и <strong>RolloverPolicy</strong>.</p>
</li>
<li>
<p><strong>SocketAppender</strong> - это <code>OutputStreamAppender</code>, который записывает свои выходные данные в удаленное место назначения, указанное узлом и портом.</p>
</li>
<li>
<p>И другие.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Стоит также заметить, что <strong>log4j</strong> может создавать множество различающихся appenders одного и того же класса, например несколько файловых appenders, которые пишут в разные файлы. Рассмотрим пример конфигурации, в которой объявлены два logger:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>корневой - которых пишет в файл <code>log.log</code></p>
</li>
<li>
<p>для нашего класса - пишет в <code>log2.log</code> с использованием фильтрации по маркер.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Пример настройки конфигурации <code>log4j.xml</code> файла</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;Configuration&gt;</span>
    <span class="c">&lt;!-- Секция appenders --&gt;</span>
    <span class="nt">&lt;Appenders&gt;</span>
        <span class="c">&lt;!-- Файловый appender --&gt;</span>
        <span class="nt">&lt;File</span> <span class="na">name=</span><span class="s">"file"</span> <span class="na">fileName=</span><span class="s">"log.log"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;PatternLayout&gt;</span>
                <span class="nt">&lt;Pattern&gt;</span>%d %p %c{1.} [%t] %m %ex%n<span class="nt">&lt;/Pattern&gt;</span>
            <span class="nt">&lt;/PatternLayout&gt;</span>
        <span class="nt">&lt;/File&gt;</span>
        <span class="c">&lt;!-- Файловый appender --&gt;</span>
        <span class="nt">&lt;File</span> <span class="na">name=</span><span class="s">"file2"</span> <span class="na">fileName=</span><span class="s">"log2.log"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- Фильтр по маркеру --&gt;</span>
            <span class="nt">&lt;MarkerFilter</span> <span class="na">marker=</span><span class="s">"fileonly"</span> <span class="na">onMatch=</span><span class="s">"DENY"</span> <span class="na">onMismatch=</span><span class="s">"ACCEPT"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;PatternLayout&gt;</span>
                <span class="nt">&lt;Pattern&gt;</span>%d %p %c{1.} [%t] %m %ex%n<span class="nt">&lt;/Pattern&gt;</span>
            <span class="nt">&lt;/PatternLayout&gt;</span>
        <span class="nt">&lt;/File&gt;</span>
    <span class="nt">&lt;/Appenders&gt;</span>
    <span class="c">&lt;!-- Секция loggers --&gt;</span>
    <span class="nt">&lt;Loggers&gt;</span>
        <span class="c">&lt;!-- Корневой logger --&gt;</span>
        <span class="nt">&lt;Root</span> <span class="na">level=</span><span class="s">"trace"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"file"</span> <span class="na">level=</span><span class="s">"DEBUG"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Root&gt;</span>
        <span class="c">&lt;!-- Logger нашего класса --&gt;</span>
        <span class="nt">&lt;Logger</span> <span class="na">name=</span><span class="s">"logging.log4j.LoggingLog4j"</span> <span class="na">level=</span><span class="s">"info"</span> <span class="na">additivity=</span><span class="s">"false"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">"file2"</span> <span class="na">level=</span><span class="s">"INFO"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Logger&gt;</span>
    <span class="nt">&lt;/Loggers&gt;</span>
<span class="nt">&lt;/Configuration&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_logback">Logback</h5>
<div class="paragraph">
<p>Данный фреймворк используется только в связке с оберткой <strong>SLF4J</strong>.</p>
</div>
<div class="paragraph">
<p>Добавляется следующей зависимостью:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>logback-classic<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.2.6<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">org</span><span class="o">.</span><span class="na">slf4j</span><span class="o">.</span><span class="na">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">slf4j</span><span class="o">.</span><span class="na">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">LoggingLogback</span><span class="o">.</span><span class="na">class</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>API позволяет выводить строковые сообщения, шаблоны строковых сообщений, исключения, а также использовать маркеры.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// Строковое сообщение</span>
<span class="nc">String</span> <span class="n">stringMessage</span> <span class="o">=</span> <span class="s">"Сообщение"</span><span class="o">;</span>
<span class="c1">// Шаблон сообщения</span>
<span class="nc">String</span> <span class="n">stringMessageFormat</span> <span class="o">=</span> <span class="s">"Сообщение {} {}"</span><span class="o">;</span>
<span class="c1">// Ошибка</span>
<span class="nc">Throwable</span> <span class="n">throwable</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Throwable</span><span class="o">();</span>
<span class="c1">// Маркер</span>
<span class="nc">Marker</span> <span class="n">marker</span> <span class="o">=</span> <span class="nc">MarkerFactory</span><span class="o">.</span><span class="na">getMarker</span><span class="o">(</span><span class="s">"marker"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Конфигурация ищется в <strong>classpath</strong> в следующем порядке:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Пытается найти <code>logback.groovy</code></p>
</li>
<li>
<p>Иначе пытается найти <code>logback-test.xml</code></p>
</li>
<li>
<p>Иначе пытается найти <code>logback.xml</code></p>
</li>
<li>
<p>Иначе использует базовую конфигурацию — выводим сообщения на консоль</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Основными элементами конфигурации являются loggers, appenders, layout, и фильтры.</p>
</div>
<div class="paragraph">
<p><strong>Logback-classic</strong> предлагает два типа фильтров:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>обычные фильтры</p>
</li>
<li>
<p>турбофильтры</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Имеются следующие фильтры:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Regular filters</strong></p>
</li>
<li>
<p><strong>LevelFilter</strong> - фильтрует события на основе точного соответствия уровней.</p>
</li>
<li>
<p><strong>ThresholdFilter</strong> - фильтрует события ниже указанного порогового значения.</p>
</li>
<li>
<p><strong>EvaluatorFilter</strong> - это универсальный фильтр, инкапсулирующий. Как следует из названия, <strong>EventEvaluator</strong> оценивает, соответствует ли заданный критерий для данного события.</p>
</li>
<li>
<p><strong>Matchers</strong></p>
</li>
<li>
<p><strong>CountingFilter</strong></p>
</li>
<li>
<p><strong>TurboFilters</strong> - предназначены для высокопроизводительной фильтрации регистрирования событий еще до их создания.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Имеются следующие appenders:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>OutputStreamAppender</strong></p>
</li>
<li>
<p><strong>ConsoleAppender</strong></p>
</li>
<li>
<p><strong>FileAppender</strong></p>
</li>
<li>
<p><strong>RollingFileAppender</strong></p>
</li>
<li>
<p><strong>SocketAppender</strong> и <strong>SSLSocketAppender</strong></p>
</li>
<li>
<p><strong>ServerSocketAppender</strong> и <strong>SSLServerSocketAppender</strong></p>
</li>
<li>
<p><strong>SMTPAppender</strong></p>
</li>
<li>
<p><strong>SyslogAppender</strong></p>
</li>
<li>
<p><strong>SiftingAppender</strong></p>
</li>
<li>
<p><strong>AsyncAppender</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Encoders</strong> (кодировщики) отвечают за преобразование входящего события в массив байтов и запись результирующего массива байтов в соответствующий массив. Таким образом, кодировщики имеют полный контроль над тем, что и когда записываются в <strong>appender</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Layouts</strong>  — это компоненты, отвечающие за преобразование входящего события в строку. Метод в интерфейсе <strong>Layout</strong> принимает объект, представляющий событие (любого типа), и возвращает объект <code>String</code>.</p>
</div>
<div class="listingblock">
<div class="title">Простой пример файла <code>logback.xml</code>:</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
    <span class="c">&lt;!--Аппендеры --&gt;</span>
    <span class="c">&lt;!--Файловый appender --&gt;</span>
    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"file"</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.FileAppender"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;file&gt;</span>log.log<span class="nt">&lt;/file&gt;</span>
        <span class="nt">&lt;layout</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.PatternLayout"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;Pattern&gt;</span>%date %level [%thread] %logger{10} [%file:%line] %msg%n<span class="nt">&lt;/Pattern&gt;</span>
        <span class="nt">&lt;/layout&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>
    <span class="c">&lt;!--Консольный appender --&gt;</span>
    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"sout"</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.ConsoleAppender"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;layout</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.PatternLayout"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;Pattern&gt;</span>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n<span class="nt">&lt;/Pattern&gt;</span>
        <span class="nt">&lt;/layout&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>
    <span class="c">&lt;!-- Фильтры --&gt;</span>
    <span class="c">&lt;!-- Фильтр по маркеру --&gt;</span>
    <span class="nt">&lt;turboFilter</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.turbo.MarkerFilter"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Marker&gt;</span>marker<span class="nt">&lt;/Marker&gt;</span>
        <span class="nt">&lt;OnMatch&gt;</span>DENY<span class="nt">&lt;/OnMatch&gt;</span>
    <span class="nt">&lt;/turboFilter&gt;</span>
    <span class="c">&lt;!-- Loggers --&gt;</span>
    <span class="c">&lt;!-- Корневой logger --&gt;</span>
    <span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">"info"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"file"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/root&gt;</span>
    <span class="c">&lt;!-- Logger нашего класса --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">"logging.logback.LoggingLogback"</span> <span class="na">level=</span><span class="s">"info"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"sout"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>
<span class="nt">&lt;/configuration&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_slf4j">SLF4J</h5>
<div class="paragraph">
<p><strong>SLF4J</strong> является оберткой над <strong>logback</strong>, а также над <strong>JUL</strong>, <strong>log4j</strong>, или <strong>JCL</strong>, а также над любым logger, который реализует ее интерфейс. Для работы с <strong>SLF4J</strong> нужны библиотека <code>slf4j-api-1.x.x</code> и реализация одного из loggers либо заглушка. Как правило, реализации всех loggers (кроме <strong>logback</strong>) поставляются вместе с SLF4J и имеют названия на подобии <code>slf4j-jcl-1.x</code>, <code>slf4j-log4j12-1.x</code>, <code>slf4j-nop-1.x</code> и т.п. Если в <strong>classpath</strong> не будет найдена реализация logger (или заглушка <strong>nop</strong>) <strong>SLF4J</strong> гневно ругнется и работать откажется. Конфигурация соответственно будет искаться в зависимости от положенной в <strong>classpath</strong> реализации.</p>
</div>
<div class="paragraph">
<p>Вся обертка делится на две части:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>API</strong><br>
Используется приложениями</p>
</li>
<li>
<p><strong>Реализация logger</strong>
Представлена отдельными jar-файлами для каждого вида логирования. Такие реализации для <strong>slf4j</strong> называются <strong>binding</strong>. Например, <code>slf4j-log4j12</code> или <code>logback-classic</code>. Достаточно только положить в <strong>CLASSPATH</strong> нужный <strong>binding</strong> и весь код проекта и все используемые библиотеки (при условии, что они обращаются к <strong>SLF4J</strong>) будут выполнять logging в нужном направлении.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>API SLF4J</strong> было рассмотрено в реализации <strong>logback</strong>.</p>
</div>
<div class="paragraph">
<p>Чтобы использовать <strong>SLF4J</strong> вместе с <strong>log4j 2</strong> необходимо подключить зависимость:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.logging.log4j<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>log4j-api<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.7<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.logging.log4j<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>log4j-core<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.7<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.logging.log4j<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>log4j-slf4j-impl<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.7<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_links_4">5.4.7. Links</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://javarush.ru/groups/posts/2388-logirovanie-chto-kak-gde-i-chem">Логирование: что, как, где и чем?</a></p>
</li>
<li>
<p><a href="https://javarush.ru/groups/posts/2293-zachem-nuzhno-logirovanie">Зачем нужно логирование</a></p>
</li>
<li>
<p><a href="https://javarush.ru/quests/lectures/questcollections.level04.lecture09">Logger</a></p>
</li>
<li>
<p><a href="https://habr.com/ru/post/113145/">Java Logging: история кошмара</a></p>
</li>
<li>
<p><a href="https://habr.com/ru/post/247647/">Java logging. Hello World</a></p>
</li>
<li>
<p><a href="https://github.com/qcha/JBook/blob/master/other/logging.md">Логирование в Java</a></p>
</li>
<li>
<p><a href="https://codernet.ru/articles/drugoe/logirovanie_java_terminologiya_urovni_logirovaniya_log-fajlyi/">Логирование Java: терминология, уровни логирования, log-файлы</a></p>
</li>
<li>
<p><a href="https://coderlessons.com/tutorials/java-tekhnologii/vyuchi-slf4j/slf4j-kratkoe-rukovodstvo">SLF4J — Краткое руководство</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=j-i3NQiKbcc&amp;t=2052s&amp;ab_channel=JUG.ru">Владимир Красильщик — Что надо знать о логировании прагматичному Java-программисту</a></p>
</li>
<li>
<p><a href="http://logging.apache.org/log4j/2.x/">Apache Log4j 2</a></p>
</li>
<li>
<p><a href="http://logback.qos.ch/">Logback</a></p>
</li>
<li>
<p><a href="http://www.slf4j.org//">Simple Logging Facade for Java (SLF4J)</a></p>
</li>
<li>
<p><a href="http://skipy.ru/useful/logging.html#log4j_fa">Ведение лога приложения</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sql">6. SQL</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_основные_понятия_sql">6.1. Основные понятия SQL</h3>
<div class="paragraph">
<p><strong>SQL</strong> - это язык структурированных запросов, с помощью которого можно обрабатывать и извлекать данные из реляционных баз данных.</p>
</div>
<div class="paragraph">
<p><strong>SQL</strong> (<strong>Structured Query Language</strong> — <strong>язык структурированных запросов</strong>) - это непроцедурный язык программирования, используемый для работы с информацией реляционной базы данных, которая управляется соответствующей <strong>системой управления базами данных</strong> (<strong>СУБД</strong>).</p>
</div>
<div class="paragraph">
<p>Первоначально SQL был основным средством доступа пользователя к информации базы данных и позволял выполнять следующие операции с таблицами <strong>БД</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>создание новой таблицы;</p>
</li>
<li>
<p>добавление записей в таблицу;</p>
</li>
<li>
<p>изменение содержимого записей;</p>
</li>
<li>
<p>удаление записей из таблицы;</p>
</li>
<li>
<p>чтение записей из одной или нескольких таблиц;</p>
</li>
<li>
<p>изменение структур таблиц.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>По мере развития <strong>СУБД</strong> <strong>SQL</strong> усложнился и обогатился новыми конструкциями типа индексы, представления, триггеры, хранимые процедуры — и стал приобретать черты, свойственные языкам программирования.
Изначально <strong>SQL</strong> создавался как простой стандартизированный язык извлечения и управления данными, содержащимися в реляционной <strong>СУБД</strong>.
Но со временем он усложнился настолько, что превратился в инструмент разработчика, а не конечного пользователя.</p>
</div>
<div class="paragraph">
<p>Таким образом использование <strong>SQL</strong> сводится, по сути, к формированию всевозможных выборок строк и совершению операций над всеми записями, входящими в набор.</p>
</div>
<div class="paragraph">
<p><strong>SQL</strong> состоит из четырех отдельных частей (иногда разделяют на 5 частей):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>DDL</strong> (<strong>Data Definition Language</strong>) - язык определения данных; используется для определения структур хранящихся в <strong>БД</strong> данных.
Операторы <strong>DDL</strong> позволяют создавать, изменять и удалять объекты в <strong>БД</strong>.
Допустимые типы объектов зависят от используемой <strong>СУБД</strong> и обычно включают базы данных, пользователей, таблицы, представления, хранимые процедуры и ряд более вспомогательных объектов типа роли и индексы. <strong>Операторы DDL</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><code>CREATE SCHEMA</code> - создать схему БД</p>
</li>
<li>
<p><code>DROP SHEMA</code> - удалить схему БД;</p>
</li>
<li>
<p><code>CREATE TABLE</code> - создать таблицу;</p>
</li>
<li>
<p><code>ALTER TABLE</code> - изменить структуру таблицы;</p>
</li>
<li>
<p><code>DROP TABLE</code> - удалить таблицу;</p>
</li>
<li>
<p><code>CREATE DATABASE</code> - создать базу данных;</p>
</li>
<li>
<p><code>DROP DATABASE</code> - удалить базу данных;</p>
</li>
<li>
<p><code>CREATE SEQUENCE</code> - создать последовательность;</p>
</li>
<li>
<p><code>DROP SEQUENCE</code> - удалить последовательность;</p>
</li>
<li>
<p><code>CREATE VIEW</code> - создать представление;</p>
</li>
<li>
<p><code>DROP VIEW</code> - удалить представление;</p>
</li>
<li>
<p><code>CREATE INDEX</code> - создать индекс;</p>
</li>
<li>
<p><code>DROP INDEX</code> - удалить индекс;</p>
</li>
<li>
<p><code>CREATE CONSTRAINT</code> - создать ограничение (<strong>Primary Key</strong>, <strong>Foreign Key</strong>);</p>
</li>
<li>
<p><code>DROP CONSTRAINT</code> - удалить ограничение (<strong>Primary Key</strong>, <strong>Foreign Key</strong>).</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>DML</strong> (<strong>Data Manipulation Language</strong>) - язык манипуляции данными; используется для извлечения, вставки, изменения и удаления данных в таблицах. <strong>Операторы DML</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><code>SELECT</code> - чтение инфомации (из одной или нескольких таблиц);</p>
</li>
<li>
<p><code>INSERT</code> - добавить строки в таблицу;</p>
</li>
<li>
<p><code>UPDATE</code> - изменить строки в таблице;</p>
</li>
<li>
<p><code>DELETE</code> - удалить строки в таблице;</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>DCL</strong> (<strong>Data Control Language</strong>) - язык определения доступа к данным; используется для контроля доступа к информации БД. Операторы DCL определяют привилегии пользователя и позволяют выдавать и отбирать права на использование DDL и DML определенных операторов к определенным объектам БД. <strong>Операторы DCL</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><code>GRANT</code> - предоставление доступа пользователю или приложению на манипулирование объектами;</p>
</li>
<li>
<p><code>DENY</code> — явный запрет доступа для пользователя;</p>
</li>
<li>
<p><code>REVOKE</code> - отмена запрета или разрешения пользователя.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>TCL</strong> (<strong>Transaction Control Language</strong>) - язык управления транзакциями; используется для контроля обработки транзакций в БД. Операторы TCL включают, как правило, оператор commit для сохранения изменений, сделанных в ходе транзакции, и rollback для их отмены.
Оператор savepoint можно использовать для разбиения транзакции на несколько частей, и, в зависимости от определенных условий, часть из них "откатить". <strong>Операторы TCL</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><code>BEGIN TRANSACTION</code> — начать транзакцию;</p>
</li>
<li>
<p><code>COMMIT</code> - зафиксировать внесенные изменения;</p>
</li>
<li>
<p><code>ROLLBACK</code> - откатить внесенные изменения.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Необходимо отметить, что SQL реализует декларативную парадигму программирования: с помощью данного языка пользователь описывает запрос, а СУБД принимает решение, как этот запрос выполнить, т.е. планирует элементарные операции, необходимые для выполнения данного запроса.</p>
</div>
<div class="sect3">
<h4 id="_create_database_and_schema">6.1.1. Create Database and Schema</h4>
<div class="paragraph">
<p><strong>Схема</strong>/<strong>Schema</strong> с точки зрения <strong>базы данных</strong> представляет собой контейнер объектов типа таблиц, триггеров, хранимых процедур и т.п. Но стоит рассмотреть некоторые особенности для следующих <strong>СУБД</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>PostgreSQL</strong>: <strong>Schema</strong> создается внутри объекта <strong>Database</strong>. <em>Сервер может управлять несколькими базами данных, каждая из которых может включать несколько схем</em>. То есть, <em>схема не связана с учетной записью пользователя</em>.</p>
</li>
<li>
<p><strong>MariaDB</strong>: понятие <strong>Schema</strong> имеет тождественный смысл с <strong>Database</strong>. <em>*База данных* (<strong>Database</strong>) является контейнером объектов, к которым пользователь получает доступ</em>.</p>
</li>
<li>
<p><strong>SQL Server</strong>: в Microsoft SQL Server начиная с версии 2005 <em>жесткая связь между пользователями и схемами была отменена</em>. <em>Пользователи могут получить доступ на выполнение определенных операций с объектами схемы: чтение, запись, обновление или выполнение</em>.</p>
</li>
<li>
<p><strong>Oracle® Database</strong>: <em>*Schema* привязывается к пользователю</em>, т.е. наименование схемы, как правило, является учетной записью пользователя. <em>*Схема* создается при создании пользователем первого объекта, и все последующие объекты созданные этим пользователем становятся частью этой схемы</em>. Кроме этого <em>Oracle позволяет создавать <strong>схему</strong> как контейнер одновременно с объектами <strong>базы данных</strong></em>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_оператор_create_database">Оператор <code>CREATE DATABASE</code></h5>
<div class="paragraph">
<p>Оператор <code>CREATE DATABASE</code> используется для создания новой базы данных SQL.</p>
</div>
<div class="paragraph">
<p><strong>Синтаксис:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">databasename</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Пример</strong>, следующий оператор SQL создает базу данных с именем <code>invoice</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">invoice</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_оператор_drop_database">Оператор <code>DROP DATABASE</code></h5>
<div class="paragraph">
<p>Оператор <code>DROP DATABASE</code> используется для удаления существующей базы данных SQL.</p>
</div>
<div class="paragraph">
<p><strong>Синтаксис:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">DATABASE</span> <span class="n">databasename</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Пример</strong>, следующий оператор SQL уничтожает существующую базу данных <code>info</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">DATABASE</span> <span class="n">info</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_типы_данных">6.1.2. Типы данных</h4>
<div class="paragraph">
<p><strong>Тип данных</strong> — это атрибут, который определяет тип любого объекта. <strong>SQL</strong> предлагает шесть категорий типов данных для использования.</p>
</div>
<div class="sect4">
<h5 id="_точные_типы_числовых_данных">Точные типы числовых данных</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Тип данных</th>
<th class="tableblock halign-left valign-top">Возможные значения</th>
<th class="tableblock halign-left valign-top">Примечание</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> или <code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Фактически является аналогом булевого типа в языках программирования. Занимает 1 байт.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TINYINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">От <code>0</code> до <code>255</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Занимает 1 байт. Хорошо подходит для хранения небольших чисел.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMALLINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">От <code>–32 768</code> до <code>32 767</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Занимает 2 байта</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">От <code>–2 147 483 648</code> до <code>2 147 483 647</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Занимает 4 байта. Наиболее используемый тип для хранения чисел.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BIGINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">От <code>-9 223 372 036 854 775 808</code> до <code>9 223 372 036 854 775 807</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Занимают в памяти 8 байт.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DECIMAL</code></p></td>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">Хранит числа с фиксированной точностью. Занимает от 5 до 17 байт в зависимости от количества чисел после запятой. Данный тип может принимать два параметра <code>precision</code> и <code>scale</code>: <code>DECIMAL(precision, scale)</code>. Параметр <code>precision</code> представляет максимальное количество цифр, которые может хранить число. Это значение должно находиться в диапазоне от <code>1</code> до <code>38</code>. По умолчанию оно равно <code>18</code>. Параметр <code>scale</code> представляет максимальное количество цифр, которые может содержать число после запятой. Это значение должно находиться в диапазоне от <code>0</code> до значения параметра <code>precision</code>. По умолчанию оно равно <code>0</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MONEY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Дробные значения от <code>-922 337 203 685 477.5808</code> до <code>922 337 203 685 477.5807</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Представляет денежные величины и занимает 8 байт.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SMALLMONEY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Хранит дробные значения от <code>-214 748.3648</code> до <code>214 748.3647</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Предназначено для хранения денежных величин. Занимает 4 байта. Эквивалентен типу <code>DECIMAL(10,4)</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FLOAT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Хранит числа от <code>–1.79E+308</code> до <code>1.79E+308</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Занимает от 4 до 8 байт в зависимости от дробной части.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">От <code>–340E+38</code> to <code>3.40E+38</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Занимает 4 байта. Эквивалентен типу <code>FLOAT(24)</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Если необходимо получать из базы данных числовое значение в строго указанном формате, то для этого следует выбрать один из точных числовых типов данных.</p>
</div>
</div>
<div class="sect4">
<h5 id="_примерные_типы_числовых_данных">Примерные типы числовых данных</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Тип данных</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возможные значения</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>float</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">От <code>-1.79E + 308</code>, до <code>1.79E + 308</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>real</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">От <code>-3.40E + 38</code>, до <code>3.40E + 38</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Некоторые числа нельзя точно представить в десятичном виде с ограниченным числом знаков, например, одну треть или число пи. Для записи таких чисел используются действительный (<code>real</code>) или плавающий (<code>float</code>) типы данных. Данные действительного типа хранятся с точностью от 1 до 7 знаков. Плавающий формат, который иногда называют еще форматом двойной точности, может хранить числа, содержащие от 8 до 15 значащих цифр. Действительный и плавающий типы данных применяются в научных приложениях для хранения чисел, не требующих точного двоичного выражения. Одна-две последние цифры могут не вполне точно сохраняться при преобразованиях в двоичный формат.</p>
</div>
</div>
<div class="sect4">
<h5 id="_типы_данных_даты_и_времени">Типы данных даты и времени</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Тип данных</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Примечание</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datetime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">От <code>1 января 1753</code>, до <code>31 декабря, 9999</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>smalldatetime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">От <code>1 января 1900</code>, до <code>6 июня 2079</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Сохраняет дату, как <code>30 июня 1991 года</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Сохраняет время суток, как <code>12:30</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Для дат применяются два типа данных, <code>datetime</code> и <code>smalldatetime</code>. Тип данных <code>smalldatetime</code> охватывает период времени от 1 января 1900 года до 6 июня 2079 года и включает время с точностью до минуты. Такого диапазона достаточно для подавляющего большинства проектов. Тип данных <code>datetime</code> годен для использования до 31 декабря 9999 года (это следует учитывать при решении проблемы 10К года).</p>
</div>
</div>
<div class="sect4">
<h5 id="_типы_данных_символьных_строк">Типы данных символьных строк</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Тип данных</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возможные значения</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>char</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Максимальная длина 8000 символов. (Фиксированная длина без Unicode символов)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>varchar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Максимум 8000 символов. (Переменная длина данных не-Unicode).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>text</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Переменная длина данных, не Unicode с максимальной длиной 2147483647 символов.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>К этому типу относятся такие символьные данные, как имена или адреса. Можно выбрать символьный тип данных либо фиксированной длины, <code>char</code>, либо переменной длины, <code>varchar</code>. Фиксированный размер оказывается предпочтительным в тех случаях, когда данные имеют одинаковую или сходную длину, например, при вводе идентификатора автора (часто в этом качестве используют индивидуальный номер системы социальной безопасности). В большинстве ситуаций применение переменной длины данных не приводит к сколько-нибудь заметному увеличению времени обработки. В то же время фамилия автора может быть очень длинной, так что использование типа <code>varchar</code> оказывается вполне оправданным. Применительно к подавляющему большинству фамилий фиксированная длина поля означает потерю значительного объема памяти, поэтому лучше использовать тип данных varchar. При выборе того или иного типа данных всегда следует искать компромисс с учетом двух аспектов: с одной стороны, потери полезного объема памяти при использовании данных фиксированной длины, а с другой стороны, увеличения времени обработки в случае применения данных переменной длины.</p>
</div>
</div>
<div class="sect4">
<h5 id="_типы_строк_данных_символов_unicode">Типы строк данных символов Unicode</h5>
<div class="paragraph">
<p><strong>Юникод</strong> (англ. <strong>Unicode</strong>) — стандарт кодирования символов, включающий в себя знаки почти всех письменных языков мира.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Тип данных</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возможные значения</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nchar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Максимальная длина 4000 символов. (Фиксированная длина Unicode)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nvarchar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Максимальная длина 4000 символов. (Переменная длина Unicode)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nvarchar(max)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Максимальная длина 231 символов (SQL Server 2005). (Переменная длина Unicode)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ntext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Максимальная длина 1,073,741,823 символа. (Переменная длина Unicode)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>SQL Server 7.0 поддерживает набор символов Unicode.
В связи с этим, чтобы воспользоваться всеми преимуществами, предоставляемыми расширенными возможностями Unicode, необходимо было ввести дополнительный тип данных. Если необходимо использовать символьные данные Unicode, то следует указать тип данных <code>Nchar</code> или, если это информация переменной длины, то <code>Nvarchar</code>. При вводе данных Unicode их следует заключать в одиночные кавычки, причем непосредственно перед ними необходимо поставить заглавную латинскую букву N. Ограничение максимальной длины информации при работе с типом данных Unicode составляет 4000 знаков. Это объясняется тем, что для хранения каждого символа Unicode требуется два байта памяти. Поэтому на стандартную страницу памяти размером 8К можно поместить в два раза меньше символов Unicode, чем при использовании обычных символов.</p>
</div>
</div>
<div class="sect4">
<h5 id="_двоичные_типы_данных">Двоичные типы данных</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Тип данных</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возможные значения</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>binary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Максимальная длина 8000 байт (фиксированная длина двоичных данных)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>varbinary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Максимальная длина 8000 байт.(Переменная длина двоичных данных)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>varbinary(max)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Максимальная длина 231 байт (SQL Server 2005).(Переменная длина двоичных данных)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>image</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Максимальная длина 2147483647 байт.(Переменная длина двоичных данных)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Если в базе данных необходимо хранить двоичную информацию, имеется выбор между двумя форматами представления: с фиксированной или переменной длиной. Данным фиксированной длины соответствует тип данных <code>binary</code>, а двоичным данным переменной длины соответствует тип данных <code>varbinary</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_таблицы">6.1.3. Таблицы</h4>
<div class="sect4">
<h5 id="_создание_таблицы_create_table">Создание таблицы <code>CREATE TABLE</code></h5>
<div class="paragraph">
<p>Для того чтобы создать таблицу в <strong>SQL</strong>, используется выражение <code>CREATE TABLE</code>. Оно принимает в качестве параметров все колонки, которые необходимо внести, а также их типы данных. Пример создания таблицы с названием <code>Months</code>, в которой будет три колонки:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>id</code> - порядковый номер месяца (целочисленный тип или <code>int</code>).</p>
</li>
<li>
<p><code>name</code> - название месяца.</p>
</li>
<li>
<p><code>days</code> - число дней в конкретном месяце.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Код создания будет выглядеть следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">months</span> <span class="p">(</span><span class="n">id</span> <span class="nb">int</span><span class="p">,</span> <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">days</span> <span class="nb">int</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_запрос_drop_table">Запрос <code>DROP TABLE</code></h5>
<div class="paragraph">
<p>Оператор <code>DROP TABLE</code> используется для удаления существующей таблицы в базе данных.</p>
</div>
<div class="paragraph">
<p><strong>Синтаксис:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">TABLE</span> <span class="k">table_name</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_удаление_таблиц_при_помощи_truncate">Удаление таблиц при помощи <code>TRUNCATE</code></h5>
<div class="paragraph">
<p>Если необходимо все данные из таблицы, но при этом оставить саму таблицу, следует использовать команду <code>TRUNCATE</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">TRUNCATE</span> <span class="k">TABLE</span> <span class="k">table_name</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ограничения">6.1.4. Ограничения</h4>
<div class="paragraph">
<p><strong>Ограничения</strong> могут быть указаны при создании таблицы с помощью оператора <code>CREATE TABLE</code> или после создания таблицы с помощью инструкции <code>ALTER TABLE</code>.</p>
</div>
<div class="paragraph">
<p><strong>Синтаксис:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">table_name</span> <span class="p">(</span>
    <span class="n">column1</span> <span class="n">datatype</span> <span class="k">constraint</span><span class="p">,</span>
    <span class="n">column2</span> <span class="n">datatype</span> <span class="k">constraint</span><span class="p">,</span>
    <span class="n">column3</span> <span class="n">datatype</span> <span class="k">constraint</span><span class="p">,</span>
    <span class="p">....</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>SQL-ограничения</strong> используются для указания правил данных таблицы, для ограничения типа данных, которые могут входить в таблицу. Это обеспечивает точность и надежность данных в таблице. Если между ограничением и действием данных существует какое-либо нарушение, действие прерывается.</p>
</div>
<div class="paragraph">
<p>Ограничения могут быть уровнями столбцов или таблиц. Ограничения уровня столбца применяются к столбцу, а ограничения уровня таблиц относятся ко всей таблице.</p>
</div>
<div class="paragraph">
<p>В SQL обычно используются следующие ограничения:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NOT NULL</code> - гарантирует, что столбец не может иметь значение NULL</p>
</li>
<li>
<p><code>UNIQUE</code> - обеспечивает, чтобы все значения в столбце были разными</p>
</li>
<li>
<p><code>PRIMARY KEY</code> - комбинация NOT NULL и UNIQUE. Уникально идентифицирует каждую строку в таблице</p>
</li>
<li>
<p><code>FOREIGN KEY</code> - однозначно идентифицирует строку / запись в другой таблице</p>
</li>
<li>
<p><code>CHECK</code> - обеспечивает, чтобы все значения в столбце удовлетворяли конкретному условию</p>
</li>
<li>
<p><code>DEFAULT</code> - устанавливает значение по умолчанию для столбца, если не указано значение</p>
</li>
<li>
<p><code>INDEX</code> - используется для быстрого создания и извлечения данных из базы данных</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_ограничение_not_null">Ограничение <code>NOT NULL</code></h5>
<div class="paragraph">
<p>По умолчанию столбец может содержать значения <code>NULL</code>. Ограничение <code>NOT NULL</code> приводит к тому, что столбец НЕ принимает значения <code>NULL</code>. Это приводит к тому, что поле всегда содержит значение, а это означает, что нельзя вставить новую запись или обновить запись без добавления значения в это поле.</p>
</div>
<div class="paragraph">
<p>Следующий SQL-запрос гарантирует, что столбцы <code>user_id</code>, <code>name</code> и <code>fullname</code> НЕ будут принимать значения <code>NULL</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="p">(</span>
    <span class="n">user_id</span> <span class="nb">int</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">fullname</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">balanse</span> <span class="nb">int</span>
<span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ограничение_unique">Ограничение <code>UNIQUE</code></h5>
<div class="paragraph">
<p>Ограничение <code>UNIQUE</code> гарантирует, что все значения в столбце отличаются. Ограничения <code>UNIQUE</code> и <code>PRIMARY KEY</code> гарантируют уникальность столбца или набора столбцов. Ограничение <code>PRIMARY KEY</code> автоматически имеет ограничение <code>UNIQUE</code>.</p>
</div>
<div class="paragraph">
<p>Однако для каждой таблицы может быть множество ограничений <code>UNIQUE</code>, но только одно ограничение <code>PRIMARY KEY</code> для каждой таблицы.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="p">(</span>
    <span class="n">user_id</span> <span class="nb">int</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">fullname</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">gender</span> <span class="nb">int</span><span class="p">,</span>
    <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_создание_ограничения_unique_когда_таблица_уже_создана">Создание ограничения <code>UNIQUE</code> когда таблица уже создана</h6>
<div class="paragraph">
<p>Чтобы создать ограничение <code>UNIQUE</code> в столбце <code>user_id</code>, когда таблица уже создана, используйте следующее:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="k">ADD</span> <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">user_id</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы назвать ограничение <code>UNIQUE</code> и определить ограничение <code>UNIQUE</code> для нескольких столбцов, используйте следующий синтаксис:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">UC_Users</span> <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_удаление_ограничения_unique">Удаление ограничения <code>UNIQUE</code></h6>
<div class="paragraph">
<p>Чтобы удалить ограничение <code>UNIQUE</code>, используйте следующий SQL-запрос:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="k">DROP</span> <span class="k">INDEX</span> <span class="n">UC_Users</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ограничение_primary_key">Ограничение <code>PRIMARY KEY</code></h5>
<div class="paragraph">
<p>Ограничение <code>PRIMARY KEY</code> однозначно идентифицирует каждую запись в таблице базы данных. Первичные ключи должны содержать <code>UNIQUE</code> значения и не могут содержать значения <code>NULL</code>.
В таблице может быть только один первичный ключ, который может состоять из одного или нескольких полей.</p>
</div>
<div class="sect5">
<h6 id="_создание_primary_key_при_создании_таблицы">Создание <code>PRIMARY KEY</code> при создании таблицы</h6>
<div class="paragraph">
<p>Следующий SQL-запрос создает <code>PRIMARY KEY</code> в столбце <code>user_id</code>, когда создается таблица <code>users</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="p">(</span>
    <span class="n">user_id</span> <span class="nb">int</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">fullname</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">gender</span> <span class="nb">int</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы разрешить именовать ограничение <code>PRIMARY KEY</code> и определить ограничение <code>PRIMARY KEY</code> для нескольких столбцов, используйте следующий синтаксис SQL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="p">(</span>
    <span class="n">user_id</span> <span class="nb">int</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">fullname</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">gender</span> <span class="nb">int</span><span class="p">,</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_Users</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_создание_ограничения_primary_key_когда_таблица_уже_создана">Создание ограничения <code>PRIMARY KEY</code> когда таблица уже создана</h6>
<div class="paragraph">
<p>Чтобы создать ограничение <code>PRIMARY KEY</code> в столбце <code>user_id</code>, когда таблица уже создана, используйте следующее:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="k">ADD</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">user_id</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы разрешить именовать ограничение <code>PRIMARY `KEY</code> и определить ограничение <code>PRIMARY KEY</code> для нескольких столбцов, используйте следующий синтаксис:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">PK_Users</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_удаление_ограничения_primary_key">Удаление ограничения `PRIMARY KEY</h6>
<div class="paragraph">
<p>Чтобы удалить ограничение <code>PRIMARY KEY</code>, используйте следующее:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="k">DROP</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ограничение_foreign_key">Ограничение <code>FOREIGN KEY</code></h5>
<div class="paragraph">
<p><code>FOREIGN KEY</code> - это <strong>ключ</strong>, используемый для соединения двух таблиц вместе. Является полем (или набором полей) в одной таблице, которое ссылается на <code>PRIMARY KEY</code> в другой таблице.</p>
</div>
<div class="paragraph">
<p>Таблица, содержащая внешний ключ, называется дочерней таблицей, а таблица, содержащая ключ-кандидат, называется <strong>ссылочной</strong> или <strong>родительской таблицей</strong>.</p>
</div>
<div class="sect5">
<h6 id="_создание_foreign_key_при_создании_таблицы">Создание <code>FOREIGN KEY</code> при создании таблицы</h6>
<div class="paragraph">
<p>Следующий SQL-запрос создает <code>FOREIGN KEY</code> в столбце <code>user_id</code> при создании таблицы <code>invoice</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">invoice</span>
<span class="p">(</span>
    <span class="n">invoice_id</span> <span class="nb">int</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">number</span> <span class="nb">int</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">user_id</span> <span class="nb">int</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">invoice_id</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">users</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы разрешить именовать ограничение <code>FOREIGN KEY</code> и определять ограничение <code>FOREIGN KEY</code> для нескольких столбцов, используйте следующий синтаксис SQL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">invoice</span>
<span class="p">(</span>
    <span class="n">invoice_id</span> <span class="nb">int</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">number</span> <span class="nb">int</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">user_id</span> <span class="nb">int</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">invoice_id</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">FK_UserInvoice</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
    <span class="k">REFERENCES</span> <span class="n">Users</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_создание_ограничения_foreign_key_когда_таблица_уже_создана">Создание ограничения <code>FOREIGN KEY</code> когда таблица уже создана</h6>
<div class="paragraph">
<p>Чтобы создать ограничение <code>FOREIGN KEY</code> в столбце <code>user_id</code>, когда таблица <code>invoice</code> уже создана, используйте следующее:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">invoice</span>
<span class="k">ADD</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Users</span><span class="p">(</span><span class="n">user_id</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы разрешить именовать ограничение <code>FOREIGN KEY</code> и определять ограничение <code>FOREIGN KEY</code> для нескольких столбцов, используйте следующий синтаксис:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">invoice</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">FK_UsersInvoice</span>
<span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Users</span><span class="p">(</span><span class="n">user_id</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_удаление_ограничения_foreign_key">Удаление ограничения <code>FOREIGN KEY</code></h6>
<div class="paragraph">
<p>Чтобы удалить ограничение <code>FOREIGN KEY</code>, используйте следующий:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">invoice</span>
<span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">FK_UsersInvoice</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ограничение_check">Ограничение <code>CHECK</code></h5>
<div class="paragraph">
<p>Ограничение <code>CHECK</code> используется для ограничения диапазона значений, который может быть помещен в столбец.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Если определяется ограничение <code>CHECK</code> для одного столбца, оно допускает только определенные значения для этого столбца.</p>
</li>
<li>
<p>Если определяется ограничение <code>CHECK</code> для таблицы, оно может ограничить значения в определенных столбцах на основе значений в других столбцах в строке.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_создание_ограничения_check_при_создании_таблицы">Создание ограничения <code>CHECK</code> при создании таблицы</h6>
<div class="paragraph">
<p>Следующий SQL-запрос создает ограничение <code>CHECK</code> в столбце <code>age</code>, когда создается таблица <code>users</code>. Ограничение <code>CHECK</code> гарантирует, не может быть пользователя с возрастом старше 60 лет:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="p">(</span>
    <span class="n">user_id</span> <span class="nb">int</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">fullname</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">age</span> <span class="nb">int</span><span class="p">,</span>
    <span class="k">CHECK</span> <span class="p">(</span><span class="n">age</span><span class="o">&gt;=</span><span class="mi">60</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы разрешить именовать ограничение <code>CHECK</code> и определить ограничение <code>CHECK</code> для нескольких столбцов, используйте следующий синтаксис SQL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="p">(</span>
    <span class="n">user_id</span> <span class="nb">int</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">fullname</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">age</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">balance</span> <span class="nb">int</span><span class="p">,</span>
    <span class="k">CONSTRAINT</span> <span class="n">CHK_Users</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">age</span><span class="o">&gt;=</span><span class="mi">60</span> <span class="k">AND</span> <span class="n">balance</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_создание_ограничения_check_когда_таблица_уже_создана">Создание ограничения <code>CHECK</code> когда таблица уже создана</h6>
<div class="paragraph">
<p>Чтобы создать ограничение <code>CHECK</code> в столбце <code>age</code>, когда таблица уже создана, используйте следующее:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="k">ADD</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">age</span><span class="o">&gt;=</span><span class="mi">60</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы разрешить именовать ограничение <code>CHECK</code> и определить ограничение <code>CHECK</code> для нескольких столбцов, используйте следующий синтаксис:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">CHK_UsersAge</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">age</span><span class="o">&gt;=</span><span class="mi">60</span> <span class="k">AND</span> <span class="n">country</span><span class="o">=</span><span class="s1">'Spain'</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_drop_check"><code>DROP CHECK</code></h6>
<div class="paragraph">
<p>Чтобы удалить ограничение <code>CHECK</code>, используйте следующий SQL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="k">DROP</span> <span class="k">CHECK</span> <span class="n">CHK_UsersAge</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ограничение_default">Ограничение <code>DEFAULT</code></h5>
<div class="paragraph">
<p>Ограничение <code>DEFAULT</code> используется для предоставления значения по умолчанию для столбца. Значение по умолчанию будет добавлено ко всем новым записям, если другое значение не указано.</p>
</div>
<div class="sect5">
<h6 id="_установка_default_столбца_при_создании_таблицы">Установка <code>DEFAULT</code> столбца при создании таблицы</h6>
<div class="paragraph">
<p>Следующий SQL-запрос устанавливает значение <code>DEFAULT</code> для столбца <code>country</code>, когда создается таблица <code>users</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="p">(</span>
    <span class="n">user_id</span> <span class="nb">int</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">fullname</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
    <span class="n">gender</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">country</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">'Spain'</span>
<span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_установка_default_столбца_в_уже_созданной_таблице">Установка <code>DEFAULT</code> столбца в уже созданной таблице</h6>
<div class="paragraph">
<p>Чтобы создать ограничение <code>DEFAULT</code> в столбце <code>country</code>, когда таблица уже создана, используйте следующее:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="k">ALTER</span> <span class="n">country</span> <span class="k">SET</span> <span class="k">DEFAULT</span> <span class="s1">'Spain'</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_удаление_ограничения_default">Удаление ограничения <code>DEFAULT</code></h6>
<div class="paragraph">
<p>Чтобы удалить ограничение <code>DEFAULT</code>, используйте следующее:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="k">ALTER</span> <span class="n">country</span> <span class="k">DROP</span> <span class="k">DEFAULT</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_изменение_структуры_таблицы">6.1.5. Изменение структуры таблицы</h4>
<div class="paragraph">
<p>Оператор <code>ALTER TABLE</code> используется для добавления, удаления или изменения столбцов в существующей таблице, а также для добавления и удаления различных ограничений для существующей таблицы.</p>
</div>
<div class="sect4">
<h5 id="_alter_table_add_column"><code>ALTER TABLE - ADD Column</code></h5>
<div class="paragraph">
<p>Чтобы добавить столбец в таблицу, используйте следующий синтаксис:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">table_name</span>
<span class="k">ADD</span> <span class="k">column_name</span> <span class="n">datatype</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_alter_table_drop_column"><code>ALTER TABLE - DROP COLUMN</code></h5>
<div class="paragraph">
<p>Чтобы удалить столбец в таблице, используйте следующий синтаксис, обратите внимание, что некоторые системы баз данных не позволяют удалить столбец:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">table_name</span>
<span class="k">DROP</span> <span class="k">COLUMN</span> <span class="k">column_name</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_alter_table_altermodify_column"><code>ALTER TABLE - ALTER/MODIFY COLUMN</code></h5>
<div class="paragraph">
<p>Чтобы изменить тип данных столбца в таблице, используйте следующий синтаксис:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">table_name</span>
<span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="k">column_name</span> <span class="n">datatype</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">table_name</span>
<span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="k">column_name</span> <span class="n">datatype</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_изменить_тип_данных">Изменить тип данных</h5>
<div class="paragraph">
<p>Изменим тип данных столбца с именем <code>day_birth</code> в таблице <code>users</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">day_birth</span> <span class="nb">year</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_пример_drop_column">Пример <code>DROP COLUMN</code></h5>
<div class="paragraph">
<p>Для удаления столбца <code>day_birth</code> в таблице <code>users</code> используется следующее:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">users</span>
<span class="k">DROP</span> <span class="k">COLUMN</span> <span class="n">day_birth</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_однострочные_и_многострочные_комментарии">6.1.6. Однострочные и многострочные комментарии</h4>
<div class="paragraph">
<p>Комментарии используются для пояснения разделов операторов SQL или для предотвращения выполнения операторов во время отладки запросов.</p>
</div>
<div class="sect4">
<h5 id="_однострочные_комментарии">Однострочные комментарии</h5>
<div class="paragraph">
<p>Однострочные комментарии начинаются со знака <code>-</code>. Любой текст между <code>-</code> и концом строки будет проигнорирован (не будет выполнен).</p>
</div>
<div class="paragraph">
<p>В следующем примере в качестве объяснения используется однострочный комментарий:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- Select all:</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>В следующем примере используется однострочный комментарий для игнорирования конца строки:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span> <span class="c1">-- WHERE balance = 1000;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>В следующем примере используется однострочный комментарий для игнорирования оператора:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="c1">-- SELECT * FROM users</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_многострочные_комментарии">Многострочные комментарии</h5>
<div class="paragraph">
<p>Многострочные комментарии начинаются с <code>/</code> и заканчиваются на <code>/</code>. Любой текст между <code>/</code> и <code>/</code> будет проигнорирован. В следующем примере в качестве объяснения используется многострочный комментарий:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="cm">/* Этот запрос
выведет данные
всех пользователей */</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>В следующем примере используется многострочный комментарий для игнорирования многих операторов:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="cm">/*SELECT * FROM users;
SELECT * FROM product;
SELECT * FROM invoice;*/</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">category</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_манипуляция_данными">6.2. Манипуляция данными</h3>
<div class="sect3">
<h4 id="_добавление_записи_в_таблицу_insert_into">6.2.1. Добавление записи в таблицу (<code>INSERT INTO</code>)</h4>
<div class="paragraph">
<p><code>INSERT INTO</code> - этот запрос используется для добавления двумя разными способами новых строк данных в таблицу в базе данных.</p>
</div>
<div class="paragraph">
<p><strong>Способ первый:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">months</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'January'</span><span class="p">,</span> <span class="mi">31</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Этот способ не подразумевает указания названий колонок, а лишь принимает значения в том порядке, в котором они указаны в таблице. Однако, если в будущем необходимо добавить дополнительные колонки, все предыдущие запросы работать не будут.</p>
</div>
<div class="paragraph">
<p>Для решения данной проблемы следует использовать <strong>второй способ</strong>. Его суть заключается в том, что перед вводом данных указываются названия колонок.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">months</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'February'</span><span class="p">,</span> <span class="mi">29</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_выборка_записей_из_таблицы_select">6.2.2. Выборка записей из таблицы (<code>SELECT</code>)</h4>
<div class="sect4">
<h5 id="_простая_выборка_select">Простая выборка (<code>SELECT</code>)</h5>
<div class="paragraph">
<p><code>SELECT</code> - используется для выбора данных из базы данных. Возвращаемые данные сохраняются в таблице результатов, называемой результирующим набором.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">characters</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Результатом данного запроса будет таблица со всеми данными в таблице <code>characters</code>. Знак звёздочки (<code>*</code>) означает то, что необходимо показать все столбцы из таблицы без исключений. Так как в базе данных обычно больше одной таблицы, нам необходимо указывать название таблицы, данные из которой требуется посмотреть. Сделать это можно используя ключевое слово <code>FROM</code>.</p>
</div>
<div class="paragraph">
<p>Когда необходимы лишь некоторые столбцы из таблицы, то можно указать их имена через запятую вместо звёздочки.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="n">weapon</span>
<span class="k">FROM</span> <span class="n">characters</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_выборка_уникальных_select_distinct">Выборка уникальных (<code>SELECT DISTINCT</code>)</h5>
<div class="paragraph">
<p>Оператор <code>SELECT DISTINCT</code> используется для возврата только отдельных (разных) значений. Внутри таблицы столбец часто содержит много повторяющихся значений и вам нужно только перечислить отличающиеся значения.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="p">...</span>
<span class="k">FROM</span> <span class="k">table_name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Пример</strong>, следующий оператор SQL выбирает только значения <code>DISTINCT</code> из столбца <code>name</code> в таблице <code>users</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">name</span>
<span class="k">FROM</span> <span class="n">users</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Пример</strong>, следующий оператор SQL выбирает только значения <code>DISTINCT</code> по столбцам <code>name</code>, <code>age</code> в таблице <code>users</code>, т.е. уникальное сочетание <code>name</code> + <code>age</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span>
<span class="k">FROM</span> <span class="n">users</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>В следующем SQL-заявлении указано количество разных имен пользователей:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">name</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">users</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_выборка_с_условием_where">6.2.3. Выборка с условием (<code>WHERE</code>)</h4>
<div class="paragraph">
<p><code>WHERE</code> - это запрос позволяющий включить в вывод лишь некоторые конкретные строки. Данное ключевое слово позволяет фильтровать данные по определённому условию.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="p">...</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Пример предложения</strong>, следующий оператор SQL выбирает всех пользователей с именем <code>name</code> в таблице <code>users</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">'Tom'</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Следует отметить, что <strong>SQL</strong> требует одинарных кавычек вокруг текстовых значений (большинство систем баз данных также допускают двойные кавычки). Однако числовые поля не должны быть заключены в кавычки.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_операторы_в_разделе_where">Операторы в разделе <code>WHERE</code></h5>
<div class="paragraph">
<p>Следующие операторы могут использоваться в предложении <code>WHERE</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Заголовок</strong></th>
<th class="tableblock halign-left valign-top"><strong>Группа</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Равно</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>!=</code> или <code>&lt;&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Не равно</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Больше чем</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Меньше чем</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Больше или равно</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Меньше или равно</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BETWEEN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Между включенным диапазоном</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIKE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Поиск по шаблону</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Поиск данных по нескольким значениям, перечисленным через запятую</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_операторы_and_or_и_not">Операторы <code>AND</code>, <code>OR</code> и <code>NOT</code></h5>
<div class="paragraph">
<p>Предложение <code>WHERE</code> может быть объединено с операторами <code>AND</code>, <code>OR</code> и <code>NOT</code>. Операторы <code>AND</code> и <code>OR</code> используются для фильтрации записей на основе более чем одного условия:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Оператор <code>AND</code> отображает запись, если все условия, разделенные символом <code>AND</code>, имеют значение <code>true</code>.</p>
</li>
<li>
<p>Оператор <code>OR</code> отображает запись, если любое из условий, разделенных <code>OR</code>, является <code>true</code>.</p>
</li>
<li>
<p>Оператор <code>NOT</code> отображает запись, если условие (и) <strong>false</strong>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_оператор_and">Оператор <code>AND</code></h6>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="p">...</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="n">condition1</span> <span class="k">AND</span> <span class="n">condition2</span> <span class="k">AND</span> <span class="n">condition3</span> <span class="p">...;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор SQL выбирает все поля из <code>users</code>, где пол <code>gender</code> равен <code>F</code> (<em>Female</em>), а баланс <code>balance</code> больше или равен <code>1000</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">gender</span> <span class="o">=</span> <span class="s1">'F'</span>
  <span class="k">AND</span> <span class="n">balance</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_оператор_or">Оператор <code>OR</code></h6>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="p">...</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="n">condition1</span> <span class="k">OR</span> <span class="n">condition2</span> <span class="k">OR</span> <span class="n">condition3</span> <span class="p">...;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор SQL выбирает все поля из <code>users</code>, где баланс пользователя <code>balance</code> равен <code>1000</code> или возраст пользователя <code>age</code> равен <code>25</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">balance</span> <span class="o">=</span> <span class="mi">1000</span> <span class="k">OR</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_оператор_not">Оператор <code>NOT</code></h6>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="p">...</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="k">NOT</span> <span class="n">condition</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор SQL выбирает все поля из <code>users</code>, где возраст <code>age</code> не равен <code>30</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="k">NOT</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_комбинирование_and_or_и_not">Комбинирование <code>AND</code>, <code>OR</code> и <code>NOT</code></h6>
<div class="paragraph">
<p>Также можно комбинировать операторы <code>AND</code>, <code>OR</code> и <code>NOT</code>.</p>
</div>
<div class="paragraph">
<p>Следующий оператор выбирает все поля из <code>users</code>, где возраст <code>age</code> равно <code>30</code>. И баланс <code>balance</code> больше <code>1000</code> или имя <code>name</code> не равно <code>Tom</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">30</span>
  <span class="k">AND</span> <span class="p">(</span><span class="n">balance</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="k">OR</span> <span class="k">NOT</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">'Tom'</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_выборка_с_сортировкой_результата_order_by">Выборка с сортировкой результата (<code>ORDER BY</code>)</h5>
<div class="paragraph">
<p>Ключевое слово <code>ORDER BY</code> используется для сортировки результирующего набора в порядке возрастания или убывания. По умолчанию оно сортирует записи по возрастанию. Чтобы отсортировать записи в порядке убывания, используйте ключевое слово <code>DESC</code>. Для сортировки по возрастанию, используйте ключевое слово <code>ASC</code>.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="p">...</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="p">...</span> <span class="k">ASC</span><span class="o">|</span><span class="k">DESC</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор выбирает всех пользователей из таблицы <code>users</code>, отсортированные по столбцу <code>name</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>или</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">name</span> <span class="k">ASC</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Но <code>ASC</code> избыточен, так как он идет по умолчанию.</p>
</div>
<div class="paragraph">
<p>Следующий оператор выбирает всех пользователей из таблицы <code>users</code>, отсортированные по столбцу <code>name</code> в обратном порядке:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">name</span> <span class="k">DESC</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_значение_null">Значение <code>NULL</code></h5>
<div class="paragraph">
<p>Поле со значением <code>NULL</code> является <strong>полем без значения</strong>. Если поле в таблице является необязательным, можно вставить новую запись или обновить запись без добавления значения в это поле. Затем поле будет сохранено со значением <code>NULL</code>. Значение <code>NULL</code> отличается от нулевого значения или поля, содержащего пробелы.</p>
</div>
<div class="sect5">
<h6 id="_как_проверить_значения_null">Как проверить значения <code>NULL</code>?</h6>
<div class="paragraph">
<p>Невозможно проверить значения <code>NULL</code> с операторами сравнения, такими как <code>=</code>, <code>&lt;</code> или <code>!=</code>. Вместо этого нужно использовать операторы <code>IS NULL</code> и <code>IS NOT NULL</code>.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис <code>IS NULL</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">column_names</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="k">column_name</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор использует оператор <code>IS NULL</code> для перечисления всех пользователей, у которых нет телефона.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="n">phone</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">phone</span> <span class="k">IS</span> <span class="k">NULL</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Синтаксис <code>NOT NULL</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">column_names</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="k">column_name</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор использует оператор <code>IS NOT NULL</code> для перечисления всех пользователей, у которых есть телефон.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="n">phone</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">phone</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_выборка_с_указанием_количества_записей_в_результате_limit">Выборка с указанием количества записей в результате (<code>LIMIT</code>)</h5>
<div class="paragraph">
<p>Предложение <code>SELECT &#8230;&#8203; LIMIT</code> используется для указания количества возвращаемых записей. Оно полезно для больших таблиц с тысячами записей. Возвращение большого количества записей может повлиять на производительность.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="n">condition</span>
<span class="k">LIMIT</span> <span class="n">number</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_примеры_top_limit_и_rownum">Примеры <code>TOP</code>, <code>LIMIT</code> и <code>ROWNUM</code></h5>
<div class="paragraph">
<p>Следующий оператор показывает эквивалентный пример, используя предложение <code>LIMIT</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">LIMIT</span> <span class="mi">3</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор показывает эквивалентный пример, используя предложение <code>LIMIT</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">balance</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">LIMIT</span> <span class="mi">5</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<code>TOP</code>, <code>ROWNUM</code> - не входят в стандарт <strong>SQL</strong>, это dialect для <strong>СУБД</strong> Oracle. Поэтому они не будут работать например для <strong>PostgreSQL</strong>, <strong>MariaDB</strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Следующий оператор выбирает первые три записи из таблицы <code>users</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">TOP</span> <span class="mi">3</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор показывает эквивалентный пример с использованием <code>ROWNUM</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">ROWNUM</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор выбирает <strong>первые 25% записей</strong> из таблицы <code>users</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">TOP</span> <span class="mi">25</span> <span class="n">PERCENT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор выбирает первые 5 записи из таблицы <code>users</code>, где баланс <code>balance</code> равен <code>1000</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">TOP</span> <span class="mi">5</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">balance</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор показывает эквивалентный пример с использованием <code>ROWNUM</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">balance</span> <span class="o">=</span> <span class="mi">1000</span> <span class="k">AND</span> <span class="n">ROWNUM</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_выборка_по_заданному_шаблону_like">Выборка по заданному шаблону (<code>LIKE</code>)</h5>
<div class="paragraph">
<p>Оператор <code>LIKE</code> используется в предложении <code>WHERE</code> для поиска заданного шаблона в столбце.</p>
</div>
<div class="paragraph">
<p>В сочетании с оператором <code>LIKE</code> используются два подстановочных знака:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>%</code> - знак процента представляет нулевой, один или несколько символов</p>
</li>
<li>
<p><code>_</code> - подчеркнутый символ представляет собой один символ</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="p">...</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="n">columnN</span> <span class="k">LIKE</span> <span class="n">pattern</span><span class="p">;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Выражение</th>
<th class="tableblock halign-left valign-top">Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WHERE name LIKE 'text%'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Находит любые значения, начинающиеся с <code>text</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WHERE name LIKE '%text'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Находит любые значения, заканчивающиеся на <code>text</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WHERE name LIKE '%text%'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Находит любые значения, которые имеют <code>text</code> в любой позиции</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WHERE name LIKE '_text%'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Находит любые значения, которые имеют <code>text</code> во второй позиции</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WHERE name LIKE 'text_%_%'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Находит любые значения, начинающиеся с <code>text</code> и длиной не менее 3 символов</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WHERE name LIKE 'text%data'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Находит любые значения, начинающиеся с <code>text</code> и заканчивающиеся на <code>data</code></p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="_подстановочные_знаки">Подстановочные знаки</h6>
<div class="paragraph">
<p>Символ подстановки используется для замены любого другого символа в строке. Подстановочные символы используются с оператором <code>LIKE</code>. Оператор <code>LIKE</code> используется в предложении <code>WHERE</code> для поиска заданного шаблона в столбце.</p>
</div>
<div class="sect6">
<h7 id="_использование_подстановочного_знака">Использование подстановочного знака</h7>
<div class="paragraph">
<p>Следующий оператор SQL выбирает всех пользователей с <code>name</code>, начиная с любого символа, за которым следует <code>о</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">name</span> <span class="k">LIKE</span> <span class="s1">'_o'</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор выбирает всех пользователей с <code>name</code> начиная с <code>B</code>, за которыми, следует любой символ. А за ним следует <code>l</code>, за которым следует любой символ, а затем <code>y</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">name</span> <span class="k">LIKE</span> <span class="s1">'B_l_y'</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Подстановочные знаки <code>[charlist]</code> и <code>[!charlist]</code> - не входят в стандарт <strong>SQL</strong>, это dialect для <strong>СУБД</strong> Oracle. Поэтому они не будут работать например для <strong>PostgreSQL</strong>, <strong>MariaDB</strong>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect6">
<h7 id="_использование_подстановочного_знака_charlist">Использование подстановочного знака <code>[charlist]</code></h7>
<div class="paragraph">
<p>Следующий оператор SQL выбирает всех пользователей с name, начиная с <code>Т</code>, <code>Р</code> или <code>Е</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">name</span> <span class="k">LIKE</span> <span class="s1">'[ТРЕ]%'</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор SQL выбирает всех пользователей с <code>name</code>, начиная с <code>Т</code>, <code>Р</code> или <code>Е</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">name</span> <span class="k">LIKE</span> <span class="s1">'[Т-E]%'</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_использование_подстановочного_знака_charlist_2">Использование подстановочного знака <code>[!charlist]</code></h7>
<div class="paragraph">
<p>Два следующих оператора SQL выбирают всех пользователей с помощью <code>name NOT</code>, начинающегося с <code>Т</code>, <code>Р</code> или <code>E</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">name</span> <span class="k">LIKE</span> <span class="s1">'[!ТРЕ]%'</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Или:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">name</span> <span class="k">NOT</span> <span class="k">LIKE</span> <span class="s1">'[ТРЕ]%'</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_выборка_с_проверкой_на_вхождение_в_множество_in">Выборка с проверкой на вхождение в множество (<code>IN</code>)</h5>
<div class="paragraph">
<p>Оператор <code>IN</code> позволяет указать несколько значений в предложении <code>WHERE</code>. Он является сокращением для нескольких условий <code>OR</code>.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="k">column_name</span> <span class="k">IN</span> <span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">,</span> <span class="p">...);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Синтаксис  подзапросом</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="k">column_name</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">STATEMENT</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий SQL запрос выбирает всех пользователей, которые находятся в странах <code>Belarus</code>, <code>Spain</code> и <code>France</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">country</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">'Belarus'</span><span class="p">,</span> <span class="s1">'Spain'</span><span class="p">,</span> <span class="s1">'France'</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий SQL запрос выбирает всех пользователей, которые <strong>НЕ расположены</strong> в <code>Belarus</code>, <code>Spain</code> и <code>France</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">country</span> <span class="k">NOT</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">'Belarus'</span><span class="p">,</span> <span class="s1">'Spain'</span><span class="p">,</span> <span class="s1">'France'</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_выборка_с_проверкой_на_вхождение_в_диапазон_between_и_not_between">Выборка с проверкой на вхождение в диапазон (<code>BETWEEN</code> и <code>NOT BETWEEN</code>)</h5>
<div class="paragraph">
<p>Оператор <code>BETWEEN</code> выбирает значения в заданном диапазоне. Значения могут быть числами, текстом или датами.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="k">column_name</span> <span class="k">BETWEEN</span> <span class="n">value1</span> <span class="k">AND</span> <span class="n">value2</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий SQL запрос выбирает все продукты с ценой <code>BETWEEN</code> <code>5</code> и <code>200</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">products</span>
<span class="k">WHERE</span> <span class="n">price</span> <span class="k">BETWEEN</span> <span class="mi">5</span> <span class="k">AND</span> <span class="mi">200</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы отобразить товары вне диапазона предыдущего примера, используйте <code>NOT BETWEEN</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">products</span>
<span class="k">WHERE</span> <span class="n">price</span> <span class="k">NOT</span> <span class="k">BETWEEN</span> <span class="mi">5</span> <span class="k">AND</span> <span class="mi">200</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_пример_between_с_in">Пример <code>BETWEEN</code> с <code>IN</code></h6>
<div class="paragraph">
<p>Следующий оператор выбирает все товары с ценой <code>BETWEEN</code> <code>5</code> и <code>200</code> и не показывать товары с категориями <code>1</code>, <code>2</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">products</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="n">price</span> <span class="k">BETWEEN</span> <span class="mi">5</span> <span class="k">AND</span> <span class="mi">200</span><span class="p">)</span>
  <span class="k">AND</span> <span class="k">NOT</span> <span class="n">category_id</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_between_текстовых_значений"><code>BETWEEN</code> текстовых значений</h6>
<div class="paragraph">
<p>Следующий оператор выбирает все товары с name <code>BETWEEN</code> <code>Bike</code> и <code>PC</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">products</span>
<span class="k">WHERE</span> <span class="n">name</span> <span class="k">BETWEEN</span> <span class="s1">'Bike'</span> <span class="k">AND</span> <span class="s1">'PC'</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_not_between_текстовых_значений"><code>NOT BETWEEN</code> текстовых значений</h6>
<div class="paragraph">
<p>Следующий оператор выбирает все продукты с name <code>NOT BETWEEN</code> <code>Bike</code> и <code>PC</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">products</span>
<span class="k">WHERE</span> <span class="n">name</span> <span class="k">NOT</span> <span class="k">BETWEEN</span> <span class="s1">'Bike'</span> <span class="k">AND</span> <span class="s1">'PC'</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_пример_between_с_датами">Пример <code>BETWEEN</code> с датами</h6>
<div class="paragraph">
<p>Следующий оператор SQL выбирает все счета с помощью <code>date BETWEEN</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">products</span>
<span class="k">WHERE</span> <span class="n">manufacture_date</span> <span class="k">BETWEEN</span> <span class="s1">'2021-02-01'</span> <span class="k">AND</span> <span class="s1">'2021-04-01'</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_псевдонимы_aliases">6.2.4. Псевдонимы (<code>Aliases</code>)</h4>
<div class="paragraph">
<p><strong>SQL-псевдонимы</strong> используются для предоставления таблицы или столбца таблицы временного имени. Псевдонимы часто используются, чтобы сделать имена столбцов более читабельными. Псевдоним существует только для продолжительности запроса.</p>
</div>
<div class="paragraph">
<p>Псевдонимы могут быть полезны, когда:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>В запросе содержится более одной таблицы</p>
</li>
<li>
<p>Функции используются в запросе</p>
</li>
<li>
<p>Названия столбцов большие или не очень читаемые</p>
</li>
<li>
<p>Два или более столбца объединяются вместе</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Синтаксис псевдонимов для столбца</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span> <span class="k">AS</span> <span class="n">alias_name</span>
<span class="k">FROM</span> <span class="k">table_name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Синтаксис псевдонимов для таблицы</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">FROM</span> <span class="k">table_name</span> <span class="k">AS</span> <span class="n">alias_name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор создает два псевдонима: один для столбца <code>user_id</code> и один для столбца <code>name</code>:</p>
</div>
<div class="paragraph">
<p><strong>Пример:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">user_id</span> <span class="k">AS</span> <span class="n">id</span><span class="p">,</span> <span class="n">name</span> <span class="k">AS</span> <span class="k">user</span>
<span class="k">FROM</span> <span class="n">users</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор создает два псевдонима: один для столбца <code>name</code> и один для столбца <code>country</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">name</span> <span class="k">AS</span> <span class="k">user</span><span class="p">,</span> <span class="n">country</span> <span class="k">AS</span> <span class="nv">"User from Country"</span>
<span class="k">FROM</span> <span class="n">users</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор выбирает все покупки от пользователя с помощью <code>user_id</code> и <code>name</code>. В запросе используются таблицы <code>users</code> и <code>products</code>, которым даются псевдонимы таблиц <code>u</code> и <code>p</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">u</span><span class="p">.</span><span class="n">name</span> <span class="k">AS</span> <span class="n">buyer</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">name</span> <span class="k">as</span> <span class="n">purchase</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">price</span>
<span class="k">FROM</span> <span class="n">users</span> <span class="k">AS</span> <span class="n">u</span><span class="p">,</span>
     <span class="n">products</span> <span class="k">AS</span> <span class="n">p</span>
<span class="k">WHERE</span> <span class="n">u</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">'Lily'</span>
  <span class="k">AND</span> <span class="n">u</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">user_id</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_обновление_записей_update">6.2.5. Обновление записей (<code>UPDATE</code>)</h4>
<div class="paragraph">
<p>Зачастую необходимо изменить данные в таблице. В <strong>SQL</strong> это делается с помощью <code>UPDATE</code>.</p>
</div>
<div class="paragraph">
<p>Использование <code>UPDATE</code> включает в себя выбор таблицы, в которой находится поле подлежащее изменению. Запись нового значения осуществляется с помощью запроса <code>WHERE</code>, чтобы обозначить конкретное место в таблице.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">UPDATE</span> <span class="k">table_name</span>
<span class="k">SET</span> <span class="n">column1</span> <span class="o">=</span> <span class="n">value1</span><span class="p">,</span> <span class="n">column2</span> <span class="o">=</span> <span class="n">value2</span><span class="p">,</span> <span class="p">...</span>
<span class="k">WHERE</span> <span class="n">condition</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Предположим есть таблица с самыми высоко оценёнными сериалами всех времён. Однако в ней есть несоответствие: <strong>Игра Престолов</strong>  обозначена как комедия, изменим значение поля следующим запросом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">UPDATE</span> <span class="n">tv_series</span>
<span class="k">SET</span> <span class="n">genre</span> <span class="o">=</span> <span class="s1">'drama'</span>
<span class="k">WHERE</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">'Game of Thrones'</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_удаление_записей_из_таблицы_delete">6.2.6. Удаление записей из таблицы (<code>DELETE</code>)</h4>
<div class="paragraph">
<p>Удаление записи из таблицы очень простая операция, всё что нужно - это обозначить, что необходимо удалить.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DELETE</span>
<span class="k">FROM</span> <span class="n">tv_serials</span>
<span class="k">WHERE</span> <span class="n">tv_serial_id</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Необходимо убедиться что используется запрос <code>WHERE</code>, когда происходит удаление записи из таблицы. Иначе удалятся все записи.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_удалить_все_записи">Удалить все записи</h5>
<div class="paragraph">
<p>Можно удалить все строки таблицы без удаления таблицы. Это означает, что структура таблицы, атрибуты и индексы будут неповрежденными:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DELETE</span> <span class="k">FROM</span> <span class="k">table_name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>или:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DELETE</span>
<span class="k">FROM</span> <span class="n">tv_serials</span>
<span class="k">WHERE</span> <span class="n">tv_serial_id</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_многотабличные_базы_данных">6.3. Многотабличные базы данных</h3>
<div class="sect3">
<h4 id="_ключи">6.3.1. Ключи</h4>
<div class="paragraph">
<p><strong>Ключ</strong> — это колонка или колонки, не имеющие в строках дублирующих значений.</p>
</div>
<div class="paragraph">
<p><strong>Ключи бывают:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Первичные</strong></p>
</li>
<li>
<p><strong>Внешние</strong></p>
</li>
<li>
<p><strong>Составные</strong></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_первичный_ключ">Первичный ключ</h5>
<div class="paragraph">
<p>Столбец, который в базе данных должен быть уникальным помечают первичным ключом. <strong>Первичный ключ</strong> или <strong>primary key</strong> означает, что в таблице значение колонки <strong>primary key</strong> не может повторяться. Таким образом данный ключ позволяет однозначно идентифицировать запись в таблице не боясь при этом, что значение столбца повториться.</p>
</div>
<div class="paragraph">
<p>В качестве первичного ключа может использоваться:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Естественный Ключ</strong> (<strong>Natural key</strong>) – набор атрибутов описываемой записью сущности, уникально её идентифицирующий (например, номер паспорта для человека).</p>
</li>
<li>
<p><strong>Суррогатный Ключ</strong> (<strong>Surrogate Key</strong>) – автоматически сгенерированное поле, никак не связанное с информационным содержанием записи.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Допустим есть таблица студентов с полями: <code>ФИО</code>, <code>год рождения</code>. Поскольку может возникнуть ситуация когда <code>ФИО</code> и <code>год рождения</code> совпадут сразу у нескольких студентов, верным решением будет внести в таблицу первичный ключ:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Первичный ключ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ФИО</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Год рождения</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Иванов Иван</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2001</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Егоров Егор</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2002</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Николаенко Николай</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2001</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_внешний_ключ">Внешний ключ</h5>
<div class="paragraph">
<p><strong>Внешние ключи</strong> еще называют <strong>ссылочным</strong>, они необходимы для связывания таблиц между собой.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Товары</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Артикул</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID тип товара</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Цена</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">151687</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">104</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">151605</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">42</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">151690</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">77</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">151601</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">90</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Тип товара</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Тип товара</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Джемпер</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Футболка</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>В таблице <code>Тип товара</code> внешним ключом будет поле <code>ID тип товара</code> в таблице <code>Товары</code>. Благодаря такой зависимости образуется связь между двумя таблицами.</p>
</div>
</div>
<div class="sect4">
<h5 id="_составной_ключ">Составной ключ</h5>
<div class="paragraph">
<p>Бывают ситуации, когда при вставке в таблицу нужно проверять запись на уникальность сразу по нескольким полям.</p>
</div>
<div class="paragraph">
<p><strong>Составной ключ</strong> — это несколько первичных ключей в таблице. Таким образом, создав составной ключ, уникальность записи будет проверяться по полям, которые объединенные в этот ключ.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Город</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">№ школы</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Директор</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Адрес</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Телефон</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Гомель</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Иванов Иван</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Лесная, 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2-22-99</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Минск</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Егоров Егор</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Солнечная, 4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-44-44</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Минск</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Николаенко Николай</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Радужная, 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5-55-55</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Составной ключ может состоять и более чем из двух полей. В таблице поля <code>Город</code> и <code>№ школы</code> вместе образуют составной ключ. В такой таблице у разных записей не могут совпасть одновременно два поля <code>Город</code> и <code>№ школы</code>, а номера школ совпасть могут.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_подзапросы">6.3.2. Подзапросы</h4>
<div class="sect4">
<h5 id="_оператор_exists">Оператор <code>EXISTS</code></h5>
<div class="paragraph">
<p>Оператор <code>EXISTS</code> используется для проверки существования любой записи в подзапросе. Если подзапрос возвращает одну или несколько записей, то возвращается <code>true</code>.</p>
</div>
<div class="sect5">
<h6 id="_синтаксис_exists">Синтаксис <code>EXISTS</code></h6>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="k">EXISTS</span>
<span class="p">(</span><span class="k">SELECT</span> <span class="k">column_name</span> <span class="k">FROM</span> <span class="k">table_name</span> <span class="k">WHERE</span> <span class="n">condition</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_примеры_использования_exists">Примеры использования <code>EXISTS</code></h6>
<div class="paragraph">
<p>Следующий оператор возвращает <code>TRUE</code> и перечисляет доставки с ценой товара менее <code>1000</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">name</span>
<span class="k">FROM</span> <span class="n">delivery</span>
<span class="k">WHERE</span> <span class="k">EXISTS</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">name</span> <span class="k">FROM</span> <span class="n">product</span> <span class="k">WHERE</span> <span class="n">delivery_id</span> <span class="o">=</span> <span class="n">delivery</span><span class="p">.</span><span class="n">delivery_id</span> <span class="k">AND</span> <span class="n">price</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор SQL возвращает <code>TRUE</code> и перечисляет доставки с ценой товара <code>5000</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">name</span>
<span class="k">FROM</span> <span class="n">delivery</span>
<span class="k">WHERE</span> <span class="k">EXISTS</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">name</span> <span class="k">FROM</span> <span class="n">product</span> <span class="k">WHERE</span> <span class="n">delivery_id</span> <span class="o">=</span> <span class="n">delivery</span><span class="p">.</span><span class="n">delivery_id</span> <span class="k">AND</span> <span class="n">price</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_операторы_any_и_all">Операторы <code>ANY</code> и <code>ALL</code></h5>
<div class="paragraph">
<p>Операторы <code>ANY</code> и <code>ALL</code> используются с предложением <code>WHERE</code> или <code>HAVING</code>. Оператор <code>ANY</code> возвращает <code>true</code>, если какое-либо из значений подзапроса соответствует условию. Оператор <code>ALL</code> возвращает <code>true</code>, если все значения подзапроса удовлетворяют условию.</p>
</div>
<div class="sect5">
<h6 id="_синтаксис_any">Синтаксис <code>ANY</code></h6>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="k">column_name</span> <span class="k">operator</span> <span class="k">ANY</span>
<span class="p">(</span><span class="k">SELECT</span> <span class="k">column_name</span> <span class="k">FROM</span> <span class="k">table_name</span> <span class="k">WHERE</span> <span class="n">condition</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_пример_any">Пример <code>ANY</code></h6>
<div class="paragraph">
<p>Оператор <code>ANY</code> возвращает <code>TRUE</code>, если какое-либо из значений подзапроса соответствует условию. Следующий оператор возвращает <code>TRUE</code> и перечисляет имена товаров, если он находит ЛЮБЫЕ записи в таблице <code>info</code>, с количеством = <code>15</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">name</span>
<span class="k">FROM</span> <span class="n">product</span>
<span class="k">WHERE</span> <span class="n">product_id</span> <span class="o">=</span> <span class="k">ANY</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">product_id</span> <span class="k">FROM</span> <span class="n">info</span> <span class="k">WHERE</span> <span class="n">counts</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор возвращает <code>TRUE</code> и перечисляет имена товаров, если он находит ЛЮБЫЕ записи в таблице <code>info</code>, с количеством &gt; <code>15</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">name</span>
<span class="k">FROM</span> <span class="n">product</span>
<span class="k">WHERE</span> <span class="n">product_id</span> <span class="o">=</span> <span class="k">ANY</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">product_id</span> <span class="k">FROM</span> <span class="n">info</span> <span class="k">WHERE</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_синтаксис_all">Синтаксис <code>ALL</code></h6>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="k">column_name</span> <span class="k">operator</span> <span class="k">ALL</span>
<span class="p">(</span><span class="k">SELECT</span> <span class="k">column_name</span> <span class="k">FROM</span> <span class="k">table_name</span> <span class="k">WHERE</span> <span class="n">condition</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_пример_all">Пример <code>ALL</code></h6>
<div class="paragraph">
<p>Оператор <code>ALL</code> возвращает <code>TRUE</code>, если все значения подзапроса удовлетворяют условию.</p>
</div>
<div class="paragraph">
<p>Следующий оператор возвращает <code>TRUE</code> и перечисляет имена товаров, если ВСЕ записи в таблице <code>info</code> имеют количество = <code>7</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">name</span>
<span class="k">FROM</span> <span class="n">product</span>
<span class="k">WHERE</span> <span class="n">product_id</span> <span class="o">=</span> <span class="k">ALL</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">product_id</span> <span class="k">FROM</span> <span class="n">info</span> <span class="k">WHERE</span> <span class="n">couns</span> <span class="o">=</span><span class="mi">7</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_соединение">6.3.3. Соединение</h4>
<div class="paragraph">
<p>Оператор <code>UNION</code> используется для объединения результирующего набора из двух или более операторов <code>SELECT</code>. Каждый оператор <code>SELECT</code> в <code>UNION</code> должен иметь одинаковое количество столбцов. Столбцы также должны иметь похожие типы данных и в каждой инструкции <code>SELECT</code> быть в том же порядке.</p>
</div>
<div class="sect4">
<h5 id="_синтаксис_union">Синтаксис <code>UNION</code></h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">table1</span>
<span class="k">UNION</span>
<span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">table2</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_пример_union">Пример <code>UNION</code></h5>
<div class="paragraph">
<p>Следующий оператор выбирает все разные города (только отдельные значения) от <code>users</code> и <code>delivery</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">city</span> <span class="k">FROM</span> <span class="n">users</span>
<span class="k">UNION</span>
<span class="k">SELECT</span> <span class="n">city</span> <span class="k">FROM</span> <span class="n">delivery</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">city</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_синтаксис_union_all">Синтаксис <code>UNION ALL</code></h5>
<div class="paragraph">
<p>Оператор <code>UNION</code> по умолчанию выбирает только разные значения. Чтобы разрешить повторяющиеся значения, используйте <code>UNION ALL</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">table1</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">table2</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_пример_union_all">Пример <code>UNION ALL</code></h5>
<div class="paragraph">
<p>Следующий оператор выбирает все города (дублирующиеся значения также) из <code>users</code> и <code>delivery</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">city</span> <span class="k">FROM</span> <span class="n">users</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="n">city</span> <span class="k">FROM</span> <span class="n">delivery</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">city</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_оператор_union_с_where">Оператор <code>UNION</code> с <code>WHERE</code></h5>
<div class="paragraph">
<p>Следующий оператор выбирает все разные испанские города (только отдельные значения) от <code>users</code> и <code>delivery</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">city</span><span class="p">,</span> <span class="n">country</span> <span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">country</span><span class="o">=</span><span class="s1">'Spain'</span>
<span class="k">UNION</span>
<span class="k">SELECT</span> <span class="n">city</span><span class="p">,</span> <span class="n">country</span> <span class="k">FROM</span> <span class="n">delivery</span>
<span class="k">WHERE</span> <span class="n">country</span><span class="o">=</span><span class="s1">'Spain'</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">city</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_оператор_union_all_с_where">Оператор <code>UNION ALL</code> с <code>WHERE</code></h5>
<div class="paragraph">
<p>Следующий оператор выбирает все испанские города (повторяющиеся значения) также из <code>users</code> и <code>delivery</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">city</span><span class="p">,</span> <span class="n">country</span> <span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">country</span><span class="o">=</span><span class="s1">'Spain'</span>
<span class="k">UNION</span> <span class="k">ALL</span>
<span class="k">SELECT</span> <span class="n">city</span><span class="p">,</span> <span class="n">country</span> <span class="k">FROM</span> <span class="n">delivery</span>
<span class="k">WHERE</span> <span class="n">country</span> <span class="o">=</span> <span class="s1">'Spain'</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">city</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_объединения">6.3.4. Объединения</h4>
<div class="paragraph">
<p>Предложение <code>JOIN</code> используется для объединения строк из двух или более таблиц на основе соответствующего столбца между ними.</p>
</div>
<div class="paragraph">
<p>Существует несколько типов <code>JOIN</code> в <strong>SQL</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>(INNER) JOIN</code> - возвращает записи, имеющие соответствующие значения в обеих таблицах</p>
</li>
<li>
<p><code>LEFT (OUTER) JOIN</code> - возвращает все записи из левой таблицы и соответствующие записи из правой таблицы</p>
</li>
<li>
<p><code>RIGHT (OUTER) JOIN</code> - вернуть все записи из правой таблицы и сопоставленные записи из левой таблицы</p>
</li>
<li>
<p><code>FULL (OUTER) JOIN</code> - возвращает все записи, когда есть совпадение в левой или правой таблице</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_inner_join"><code>INNER JOIN</code></h5>
<div class="paragraph">
<p>Ключевое слово <code>INNER JOIN</code> выбирает записи, имеющие соответствующие значения в обеих таблицах</p>
</div>
<div class="paragraph">
<p><strong>Синтаксиc:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">table1</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">table2</span> <span class="k">ON</span> <span class="n">table1</span><span class="p">.</span><span class="k">column_name</span> <span class="o">=</span> <span class="n">table2</span><span class="p">.</span><span class="k">column_name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Пример:</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Таблица users</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">user_id</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">fullname</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ник</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Никольский</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Майк</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Майкович</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Таблица invoice</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">invoice_id</th>
<th class="tableblock halign-left valign-top">user_id</th>
<th class="tableblock halign-left valign-top">product_id</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Столбец <code>user_id</code> в таблице <code>invoice</code> ссылается на <code>user_id</code> в таблице <code>invoice</code> между которыми осуществляется взаимосвязь. Для выбора записей, имеющие соответствующие значения в обеих таблицах используется следующий запрос:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">invoice</span><span class="p">.</span><span class="n">invoice_id</span><span class="p">,</span> <span class="n">users</span><span class="p">.</span><span class="n">name</span>
<span class="k">FROM</span> <span class="n">Orders</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">users</span> <span class="k">ON</span> <span class="n">invoice</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">users</span><span class="p">.</span><span class="n">user_id</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_join_three_таблиц"><code>JOIN Three</code> таблиц</h6>
<div class="paragraph">
<p>Следующий оператор выбирает все счета с информацией о пользователях и отправителях:</p>
</div>
<div class="paragraph">
<p><strong>Пример:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">invoice</span><span class="p">.</span><span class="n">invoice</span><span class="p">,</span> <span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">addresser</span><span class="p">.</span><span class="n">name</span>
<span class="k">FROM</span> <span class="p">((</span><span class="n">invoice</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">users</span> <span class="k">ON</span> <span class="n">invoice</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">users</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">addresser</span> <span class="k">ON</span> <span class="n">invoice</span><span class="p">.</span><span class="n">addresser_id</span> <span class="o">=</span> <span class="n">addresser</span><span class="p">.</span><span class="n">addresser_id</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_left_join"><code>LEFT JOIN</code></h5>
<div class="paragraph">
<p>Ключевое слово <code>LEFT JOIN</code> возвращает все записи из левой таблицы и сопоставленные записи из правой таблицы. Результат равен <code>NULL</code> с правой стороны, если нет совпадения.</p>
</div>
<div class="paragraph">
<p><strong>Синтаксис:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">table1</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">table2</span> <span class="k">ON</span> <span class="n">table1</span><span class="p">.</span><span class="k">column_name</span> <span class="o">=</span> <span class="n">table2</span><span class="p">.</span><span class="k">column_name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Пример</strong>, следующий оператор выберет всех пользователей и любые заказы, которые они могут иметь:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">invoice</span><span class="p">.</span><span class="n">invoice_id</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">invoice</span> <span class="k">ON</span> <span class="n">users</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">invoice</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_right_join"><code>RIGHT JOIN</code></h5>
<div class="paragraph">
<p>Ключевое слово <code>RIGHT JOIN</code> возвращает все записи из правой таблицы и сопоставленные записи из левой таблицы. Результат равен <code>NULL</code> с левой стороны, когда нет совпадения.</p>
</div>
<div class="paragraph">
<p><strong>Синтаксис:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">table1</span>
<span class="k">RIGHT</span> <span class="k">JOIN</span> <span class="n">table2</span> <span class="k">ON</span> <span class="n">table1</span><span class="p">.</span><span class="k">column_name</span> <span class="o">=</span> <span class="n">table2</span><span class="p">.</span><span class="k">column_name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Пример</strong>, следующий оператор вернет всех пользователей и любые заказы, которые они могли бы разместить.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">invoice</span><span class="p">.</span><span class="n">invoice_id</span><span class="p">,</span> <span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">users</span><span class="p">.</span><span class="n">fullname</span>
<span class="k">FROM</span> <span class="n">invoice</span>
<span class="k">RIGHT</span> <span class="k">JOIN</span> <span class="n">users</span> <span class="k">ON</span> <span class="n">invoice</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">users</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">invoice</span><span class="p">.</span><span class="n">invoice_id</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_full_outer_join"><code>FULL OUTER JOIN</code></h5>
<div class="paragraph">
<p>Ключевое слово <code>FULL OUTER JOIN</code> возвращает все записи, когда есть совпадение в обеих таблицах таблицы или справа.</p>
</div>
<div class="paragraph">
<p><strong>Синтаксис:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">table1</span>
<span class="k">FULL</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">table2</span> <span class="k">ON</span> <span class="n">table1</span><span class="p">.</span><span class="k">column_name</span> <span class="o">=</span> <span class="n">table2</span><span class="p">.</span><span class="k">column_name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Пример</strong>, следующий оператор выбирает всех пользователей и все заказы:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">invoice</span><span class="p">.</span><span class="n">invoice_id</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">FULL</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">invoice</span> <span class="k">ON</span> <span class="n">users</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">invoice</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">users</span><span class="p">.</span><span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_регулярное_соединение_self_join">Регулярное соединение <code>Self JOIN</code></h5>
<div class="paragraph">
<p><code>Self JOIN</code> - это регулярное соединение, но таблица соединяется сама с собой.</p>
</div>
<div class="paragraph">
<p><strong>Синтаксис:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">table1</span> <span class="n">T1</span><span class="p">,</span> <span class="n">table1</span> <span class="n">T2</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Пример</strong>, следующий оператор соответствует пользователям из одного города:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">A</span><span class="p">.</span><span class="n">name</span> <span class="k">AS</span> <span class="n">name1</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">name</span> <span class="k">AS</span> <span class="n">name2</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="n">city</span>
<span class="k">FROM</span> <span class="n">users</span> <span class="n">A</span><span class="p">,</span> <span class="n">users</span> <span class="n">B</span>
<span class="k">WHERE</span> <span class="n">A</span><span class="p">.</span><span class="n">user_id</span> <span class="o">&lt;&gt;</span> <span class="n">B</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">AND</span> <span class="n">A</span><span class="p">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="n">city</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">A</span><span class="p">.</span><span class="n">city</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_агрегатные_функции_и_группировка">6.4. Агрегатные функции и группировка</h3>
<div class="sect3">
<h4 id="_агрегатные_функции">6.4.1. Агрегатные функции</h4>
<div class="sect4">
<h5 id="_функции_min_и_max">Функции <code>MIN()</code> и <code>MAX()</code></h5>
<div class="paragraph">
<p>Функция <code>MIN()</code> возвращает наименьшее значение выбранного столбца. Функция <code>MAX()</code> возвращает наибольшее значение выбранного столбца.</p>
</div>
<div class="paragraph">
<p><strong>Синтаксис <code>MIN()</code>:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">MIN</span><span class="p">(</span><span class="k">column_name</span><span class="p">)</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Пример <code>MIN()</code>:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">MIN</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">AS</span> <span class="n">min_price</span>
<span class="k">FROM</span> <span class="n">product</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Синтаксис <code>MAX()</code>:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="k">column_name</span><span class="p">)</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Пример <code>MAX()</code></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">AS</span> <span class="n">max_price</span>
<span class="k">FROM</span> <span class="n">product</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_функция_count">Функция <code>COUNT()</code></h5>
<div class="paragraph">
<p>Функция <code>COUNT()</code> возвращает количество строк, соответствующих заданным критериям.</p>
</div>
<div class="paragraph">
<p><strong>Синтаксис:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">column_name</span><span class="p">)</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Пример:</strong></p>
</div>
<div class="paragraph">
<p>Следующий оператор SQL находит количество товаров.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">product_id</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">product</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_функция_avg">Функция <code>AVG()</code></h5>
<div class="paragraph">
<p>Функция <code>AVG()</code> возвращает среднее значение числового столбца.</p>
</div>
<div class="paragraph">
<p><strong>Синтаксис:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">AVG</span><span class="p">(</span><span class="k">column_name</span><span class="p">)</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Например</strong> найдем среднюю стоимость товара:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">AVG</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">product</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_функция_sum">Функция <code>SUM()</code></h5>
<div class="paragraph">
<p>Функция <code>SUM()</code> возвращает общую сумму числового столбца.</p>
</div>
<div class="paragraph">
<p><strong>Синтаксис:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">SUM</span><span class="p">(</span><span class="k">column_name</span><span class="p">)</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Пример</strong>, найдем сумму полей доставка <code>delivery</code> в таблице <code>invoice</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">SUM</span><span class="p">(</span><span class="n">delivery</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">invoice</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_группировка">6.4.2. Группировка</h4>
<div class="paragraph">
<p>Оператор <code>GROUP BY</code> часто используется с агрегатными функциями (<code>COUNT</code>, <code>MAX</code>, <code>MIN</code>, <code>SUM</code>, <code>AVG</code>) для группировки результирующего набора одним или несколькими столбцами.</p>
</div>
<div class="sect4">
<h5 id="_синтаксис_group_by">Синтаксис <code>GROUP BY</code></h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="n">condition</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_пример_sql_group_by">Пример SQL <code>GROUP BY</code></h5>
<div class="paragraph">
<p>В следующем выражении указано количество пользователей в каждой стране:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">use_id</span><span class="p">),</span> <span class="n">country</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">country</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>В следующем SQL-заявлении указано количество пользователей в каждой стране, отсортированных по высоким и низким:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span> <span class="n">country</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">country</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="k">DESC</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_операторgroup_by_с_join">Оператор`GROUP BY` с <code>JOIN</code></h5>
<div class="paragraph">
<p>В следующем выражении указано количество заказов, отправленных каждой службой доставки:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">delivery</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">invoice</span><span class="p">.</span><span class="n">delivery_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">orders</span> <span class="k">FROM</span> <span class="n">invoice</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">delivery</span> <span class="k">ON</span> <span class="n">invoice</span><span class="p">.</span><span class="n">delivery_id</span> <span class="o">=</span> <span class="n">delivery</span><span class="p">.</span><span class="n">delivery_id</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_предложение_having">6.4.3. Предложение <code>HAVING</code></h4>
<div class="paragraph">
<p>Предложение <code>HAVING</code> используется в SQL, для работы с агрегатными функциями, так как <code>WHERE</code> не могло с ними использоваться.</p>
</div>
<div class="paragraph">
<p><strong>Синтаксис:</strong>`</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">FROM</span> <span class="k">table_name</span>
<span class="k">WHERE</span> <span class="n">condition</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">HAVING</span> <span class="n">condition</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">column_name</span><span class="p">(</span><span class="n">s</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Пример</strong>, в следующем SQL-заявлении указано количество пользователей в каждой стране. Включать только страны с более чем 7 клиентами:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span> <span class="n">country</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">country</span>
<span class="k">HAVING</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>В следующем SQL-заявлении указано количество пользователей в каждой стране, отсортированные по высоким и низким.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span> <span class="n">country</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">country</span>
<span class="k">HAVING</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">7</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="k">DESC</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_проектирование_баз_данных">6.5. Проектирование баз данных</h3>
<div class="sect3">
<h4 id="_нормализация_и_денормализация_баз_данных">6.5.1. Нормализация и денормализация баз данных</h4>
<div class="paragraph">
<p><strong>Нормализация базы данных</strong> - это процесс эффективной организации данных в базе данных. Есть две причины процесса нормализации:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Устранение избыточных данных, например, хранение тех же данных в более чем одной таблице.</p>
</li>
<li>
<p>Обеспечение зависимостей данных.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Денормализация</strong> — намеренное приведение структуры базы данных в состояние, не соответствующее критериям нормализации, обычно проводимое с целью ускорения операций чтения из базы за счет добавления избыточных данных.</p>
</div>
<div class="paragraph">
<p><strong>Нормализация</strong> состоит из ряда принципов, которые помогают в создании хорошей структуры базы данных. Эти принципы делятся на нормальные формы, их цель в организации структуры базы данных таким образом, чтобы правильно организовать структуру базы данных.</p>
</div>
<div class="sect4">
<h5 id="_первая_нормальная_форма">Первая нормальная форма</h5>
<div class="paragraph">
<p>Правила первой нормальной формы:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>В таблице не должно быть дублирующих строк.</p>
</li>
<li>
<p>В каждой ячейке таблицы хранится атомарное значение (одно не составное значение).</p>
</li>
<li>
<p>В столбце хранятся данные одного типа.</p>
</li>
<li>
<p>Нет упорядочивания строк сверху вниз (другими словами, порядок строк не несет в себе никакой информации).</p>
</li>
<li>
<p>Нет упорядочивания столбцов слева направо (другими словами, порядок столбцов не несет в себе никакой информации).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Пример, допустим есть ненормализованная таблица:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID покупателя</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ФИО</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Заказ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Телефон</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Егоров Егор</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ноутбук Asus G53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Мобильный телефон 44 888 77 77, Домашний Телефон 8-77-77</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Егоров Егор</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Телефон Nokia 5310</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Мобильный телефон 44 888 77 77, Домашний Телефон 8-77-77</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Егоров Егор</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Наушники LG 700</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Мобильный телефон 44 888 77 77, Домашний Телефон 8-77-77</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Такая таблица нарушает требования первой нормальной формы. Ее следует разбить на две части, а затем соединить их с помощью ключа.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Информация о клиенте</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID покупателя</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ФИО</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Мобильный телефон</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Домашний телефон</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Егоров Егор</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">44 888 77 77</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-77-77</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Информация о заказах</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID заказа</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID клиента</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Заказ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ноутбук Asus G53</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Телефон Nokia 5310</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Наушники LG 700</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Такие таблицы соответствуют требованиям первой нормальной формы.</p>
</div>
<div class="sect5">
<h6 id="_вторая_нормальная_форма">Вторая нормальная форма</h6>
<div class="paragraph">
<p><strong>Правило второй нормальной формы</strong> звучит следующим образом: отношение соответствует второй нормальной форме, если оно соответствует первой нормальной форме и каждый не ключевой атрибут неприводимо зависит от первичного ключа.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ФИО</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Должность</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Подразделение</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Егоров Егор</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Программист</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Отдел разработки ПО</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Иванов Иван</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Бухгалтер</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Бухгалтерия</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Борисов Борис</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Продавец</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Отдел реализации</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Допустим в организации каждому сотруднику присваивается уникальный табельный номер, который никогда не будет изменен. Таким образом, чтобы привести эту таблицу ко второй нормальной форме, необходимо добавить в нее еще один атрибут, т.е. столбец с табельным номером, который будет выступать первичным ключом.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Табельный номер</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ФИО</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Должность</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Подразделение</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">660</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Егоров Егор</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Программист</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Отдел разработки ПО</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">212</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Иванов Иван</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Бухгалтер</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Бухгалтерия</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Борисов Борис</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Продавец</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Отдел реализации</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_третья_нормальная_форма">Третья нормальная форма</h6>
<div class="paragraph">
<p><strong>Правило третьей нормальной формы</strong> звучит следующим образом: отношение находится в третьей нормальной форме, когда находится во второй нормальной форме и каждый не ключевой атрибут не транзитивно зависит от первичного ключа.</p>
</div>
<div class="paragraph">
<p>Иначе говоря, третья нормальная форма требует выносить все не ключевые поля, содержимое которых может относиться к нескольким записям таблицы в отдельные таблицы.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CourseID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Course</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TeacherID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Teacher</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Математика</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Егоров Егор</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Иванов Иван</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Алгоритмы</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Иванов Иван</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Такую ненормализованную таблицу требуется разбить на две разные таблицы:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TeacherID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Teacher</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Егоров Егор</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Иванов Иван</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Таким образом в первой таблице TeacherID является ключом, явный указывающий на преподавателя.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CourseID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Course</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TeacherID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Математика</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Алгоритмы</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_нормальная_форма_бойса_кодда">Нормальная форма Бойса-Кодда</h6>
<div class="paragraph">
<p><strong>Требование нормальной формы Бойса-Кодда</strong> звучит следующим образом: таблица должна находиться в третьей нормальной форме и ключевые атрибуты составного ключа не должны зависеть от неключевых атрибутов. Отсюда следует, что требования нормальной формы Бойса-Кодда предъявляются только к таблицам, у которых первичный ключ составной.</p>
</div>
<div class="paragraph">
<p><strong>Пример</strong></p>
</div>
<div class="paragraph">
<p>Представим, что у нас есть организация, которая реализует множество различных проектов. При этом в каждом проекте работа ведётся по нескольким функциональным направлениям, в каждом из которых есть свой куратор. Сотрудник может быть куратором только того направления, на котором он специализируется, т.е. если сотрудник программист, он не может курировать в проекте направление, связанное с бухгалтерией.</p>
</div>
<div class="paragraph">
<p>Допустим, что нам нужно хранить информацию о кураторах всех проектов по каждому направлению в таблице, где <strong>первичный ключ составной</strong> «Проект + Направление:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Проект</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Направление</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Куратор</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Разработка</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Егоров Егор</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Бухгалтерия</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Иванов Иван</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Разработка</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Егоров Егор</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Реализация</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Андреев Андрей</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>В данном случае таблица не находится в нормальной форме Бойса-Кодда, дело в том, что зная куратора, можно четко определить, какое направление он курирует, иными словами, часть составного ключа, т.е. «Направление», зависит от неключевого атрибута, т.е. «Куратора». Чтобы привести данную таблицу к нормальной форме Бойса-Кодда, необходимо сделать декомпозицию данного отношения, т.е. разбить эту таблицу на несколько таблиц.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Таблица кураторов</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Идентификатор куратора</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ФИО</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Направление</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Егоров Егор</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Разработка</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Иванов Иван</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Бухгалтерия</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Андреев Андрей</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Реализация</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Таблица связи кураторов и проектов</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Проект</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Идентификатор куратора</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_продвинутый_sql">6.6. Продвинутый SQL</h3>
<div class="sect3">
<h4 id="_заявление_select_into">6.6.1. Заявление <code>SELECT INTO</code></h4>
<div class="paragraph">
<p>Оператор <code>SELECT INTO</code> копирует данные из одной таблицы в новую таблицу.</p>
</div>
<div class="sect4">
<h5 id="_синтаксис_select_into">Синтаксис <code>SELECT INTO</code></h5>
<div class="paragraph">
<p>Скопировать все столбцы в новую таблицу:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">INTO</span> <span class="n">newtable</span> <span class="p">[</span><span class="k">IN</span> <span class="n">externaldb</span><span class="p">]</span>
<span class="k">FROM</span> <span class="n">oldtable</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Скопировать только несколько столбцов в новую таблицу:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="n">column3</span><span class="p">,</span> <span class="p">...</span>
<span class="k">INTO</span> <span class="n">newtable</span> <span class="p">[</span><span class="k">IN</span> <span class="n">externaldb</span><span class="p">]</span>
<span class="k">FROM</span> <span class="n">oldtable</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Новая таблица будет создана с именами и типами столбцов, как определено в старой таблице. Можно создавать новые имена столбцов, используя предложение <code>AS</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_примеры_sql_select_into">Примеры SQL <code>SELECT INTO</code></h5>
<div class="paragraph">
<p>Следующий оператор SQL создает резервную копию <code>users</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">INTO</span> <span class="n">usersBackup001</span>
<span class="k">FROM</span> <span class="n">users</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор использует предложение <code>IN</code> для копирования таблицы в новую таблицу в другой базе данных:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">INTO</span> <span class="n">usersBackup001</span> <span class="k">IN</span> <span class="s1">'backup.mdb'</span>
<span class="k">FROM</span> <span class="n">users</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следующий оператор копирует только несколько столбцов в новую таблицу:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="n">fullname</span> <span class="k">INTO</span> <span class="n">usersBackup001</span>
<span class="k">FROM</span> <span class="n">users</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_оператор_insert_into_select">6.6.2. Оператор <code>INSERT INTO SELECT</code></h4>
<div class="paragraph">
<p>Оператор <code>INSERT INTO SELECT</code> копирует данные из одной таблицы и вставляет ее в другую таблицу. <code>INSERT INTO SELECT</code> требует, чтобы типы данных в исходной и целевой таблицах соответствовали.</p>
</div>
<div class="paragraph">
<p>Синтаксис <code>INSERT IN SELECT</code>
Скопировать все столбцы из одной таблицы в другую:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">table2</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">table1</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Скопировать только несколько столбцов из одной таблицы в другую таблицу:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">table2</span> <span class="p">(</span><span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="n">column3</span><span class="p">,</span> <span class="p">...)</span>
<span class="k">SELECT</span> <span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="n">column3</span><span class="p">,</span> <span class="p">...</span>
<span class="k">FROM</span> <span class="n">table1</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_пример_sql_insert_into_select">Пример SQL <code>INSERT INTO SELECT</code></h5>
<div class="paragraph">
<p>Следующий оператор копирует <code>clients</code> в <code>users</code> (столбцы, которые не заполнены данными, будет содержать <code>NULL</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">users</span> <span class="p">(</span><span class="n">nme</span><span class="p">,</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">balance</span><span class="p">)</span>
<span class="k">SELECT</span> <span class="n">nme</span><span class="p">,</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">balance</span> <span class="k">FROM</span> <span class="n">clients</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_index">6.6.3. <code>CREATE INDEX</code></h4>
<div class="paragraph">
<p>Оператор <code>CREATE INDEX</code> используется для создания индексов в таблицах. Индексы используются для быстрого извлечения данных из базы данных. Пользователи не могут видеть индексы, они просто используются для ускорения поиска/запросов.</p>
</div>
<div class="sect4">
<h5 id="_синтаксис_create_index">Синтаксис <code>CREATE INDEX</code></h5>
<div class="paragraph">
<p><code>CREATE INDEX</code> создает индекс в таблице. Допускаются повторяющиеся значения:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">index_name</span>
<span class="k">ON</span> <span class="k">table_name</span> <span class="p">(</span><span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="p">...);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_синтаксис_create_unique_index">Синтаксис <code>CREATE UNIQUE INDEX</code></h5>
<div class="paragraph">
<p>Создает уникальный индекс в таблице. Дублирующие значения не допускаются:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">UNIQUE</span> <span class="k">INDEX</span> <span class="n">index_name</span>
<span class="k">ON</span> <span class="k">table_name</span> <span class="p">(</span><span class="n">column1</span><span class="p">,</span> <span class="n">column2</span><span class="p">,</span> <span class="p">...);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_пример_create_index">Пример <code>CREATE INDEX</code></h5>
<div class="paragraph">
<p>В приведенной ниже инструкции SQL создается индекс с именем <code>ind_name</code> в столбце <code>name</code> в таблице <code>users</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">ind_name</span>
<span class="k">ON</span> <span class="n">users</span> <span class="p">(</span><span class="n">name</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Если необходимо создать индекс в комбинации столбцов, можно указать имена столбцов в круглых скобках, разделенные запятыми:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">ind_name</span>
<span class="k">ON</span> <span class="n">users</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">fullname</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_оператор_drop_index">6.6.4. Оператор <code>DROP INDEX</code></h4>
<div class="paragraph">
<p>Оператор <code>DROP INDEX</code> используется для удаления индекса в таблице.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="k">table_name</span>
<span class="k">DROP</span> <span class="k">INDEX</span> <span class="n">index_name</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_поле_auto_increment">6.6.5. Поле <code>AUTO INCREMENT</code></h4>
<div class="paragraph">
<p><code>Auto-increment</code> позволяет создавать уникальный номер автоматически, когда новая запись вставляется в таблицу. Часто это поле основного ключа, которое необходимо создать автоматически каждый раз, когда будет вставлена новая запись.</p>
</div>
<div class="sect4">
<h5 id="_синтаксис_для_mysql">Синтаксис для <code>MySQL</code></h5>
<div class="paragraph">
<p>Следующий оператор SQL определяет столбец <code>user_id</code> как поле первичного ключа с автоматическим приращением в таблице «users»:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">users</span> <span class="p">(</span>
<span class="n">user_id</span> <span class="nb">int</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">fullname</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="n">balance</span> <span class="nb">int</span><span class="p">,</span>
<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>MySQL использует ключевое слово <code>AUTO_INCREMENT</code> для выполнения функции автоматического увеличения.</p>
</div>
<div class="paragraph">
<p>По умолчанию начальное значение для <code>AUTO_INCREMENT</code> равно <code>1</code>, и оно будет увеличиваться на 1 для каждой новой записи.</p>
</div>
<div class="paragraph">
<p>Чтобы последовательность <code>AUTO_INCREMENT</code> начиналась с другого значения, используйте следующий оператор:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">users</span> <span class="n">AUTO_INCREMENT</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы вставить новую запись в таблицу <code>user</code>, нам не нужно указывать значение для столбца <code>user_id</code>, так как уникальное значение будет добавляться автоматически:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">users</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">fullname</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Том'</span><span class="p">,</span><span class="s1">'Эдисон'</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_работа_с_датами">6.6.6. Работа с датами</h4>
<div class="paragraph">
<p>Пока ваши данные содержат только часть даты, ваши запросы будут работать должным образом. Однако, если задействована временная часть, она становится более сложной.</p>
</div>
<div class="sect4">
<h5 id="_типы_данных_sql_date">Типы данных <code>SQL Date</code></h5>
<div class="paragraph">
<p>MySQL имеет следующие типы данных для хранения даты или значения даты/времени в базе данных:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DATE</code> - формат: <code>YYYY-MM-DD</code></p>
</li>
<li>
<p><code>DATETIME</code> - формат: <code>YYYY-MM-DD HH:MI:SS</code></p>
</li>
<li>
<p><code>TIMESTAMP</code> - формат: <code>YYYY-MM-DD HH:MI:SS</code></p>
</li>
<li>
<p><code>YEAR</code> - формат: <code>YYYY</code> or <code>YY</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_операторы">6.6.7. Операторы</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Арифметические операторы SQL</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Оператор</th>
<th class="tableblock halign-left valign-top">Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Добавление</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Вычитание</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Умножение</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Деление</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Модуль</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Побитовые операции SQL</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Оператор</th>
<th class="tableblock halign-left valign-top">Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Побитовое М</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Побитовое ИЛИ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>^</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Операторы сравнения SQL</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Оператор</th>
<th class="tableblock halign-left valign-top">Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Равно</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Больше</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Меньше</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Больше или равно</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Меньше или равно</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Не равно</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Составные операторы SQL</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Оператор</th>
<th class="tableblock halign-left valign-top">Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Добавить равно</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Вычесть равно</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Умножить равно</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Разделить равно</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Модуль равно</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Побитовое И равно</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>^-=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Побитовое исключающее равно</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|*=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Побитовое ИЛИ равно</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Логические операторы SQL</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Оператор</th>
<th class="tableblock halign-left valign-top">Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Если все значения подзапроса являются <code>TRUE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AND</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Если все условия, разделенные И, являются <code>TRUE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ANY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Если какое-либо из значений подзапроса соответствует <code>TRUE</code> условию</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BETWEEN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Если операнд находится в диапазоне сравнения</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXISTS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Если подзапрос возвращает одну или несколько записей</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Если операнд равен одному из списка выражений</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LIKE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Если операнд соответствует шаблону</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Отображает запись, если условие (И) НЕ <code>TRUE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Если любое из условий, разделенных <code>OR</code>, является <code>TRUE</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SOME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Если какое-либо из значений подзапроса соответствует условию</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_функции">6.6.8. Функции</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Функции</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Функция</th>
<th class="tableblock halign-left valign-top">Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ASCII</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает числовой код, который представляет конкретный символ</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHAR_LENGTH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает длину указанной строки (в символах)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CHARACTER_LENGTH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает длину указанной строки (в символах)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONCAT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Объединяет два или более выражения вместе</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONCAT_WS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Объединяет два или более выражения вместе и добавляет разделитель между ними</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FIELD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает позицию значения в списке значений</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FIND_IN_SET</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает позицию строки в списке строк</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FORMAT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Форматирует число как формат «<mark>, <mark></mark>. </mark>», округляя его до определенного количества знаков после запятой</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INSERT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Вставляет подстроку в строку в указанной позиции для определенного количества символов</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INSTR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает позицию первого вхождения строки в другую строку</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LCASE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Преобразует строку в нижний регистр</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LEFT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Извлекает подстроку из строки (начиная слева)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LENGTH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает длину указанной строки (в байтах)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOCATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает позицию первого вхождения подстроки в строку</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOWER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Преобразует строку в нижний регистр</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LPAD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает строку, которая добавлена в левую сторону с указанной строкой до определенной длины</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LTRIM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Удаляет ведущие пробелы из строки</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Извлекает подстроку из строки (начиная с любой позиции)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>POSITION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает позицию первого вхождения подстроки в строку</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REPEAT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Повторяет строку определенное количество раз</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REPLACE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Заменяет все вхождения указанной строки</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REVERSE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Отменяет строку и возвращает результат</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RIGHT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Извлекает подстроку из строки (начиная справа)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RPAD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает строку с правой строкой с определенной строкой до определенной длины</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTRIM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Удаляет конечные пробелы из строки</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SPACE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает строку с заданным количеством пробелов</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STRCMP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Проверяет, одинаковы ли две строки</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SUBSTR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Извлекает подстроку из строки (начиная с любой позиции)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SUBSTRING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Извлекает подстроку из строки (начиная с любой позиции)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SUBSTRING_INDEX</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает подстроку  string и перед integer вхождений delimiter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRIM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Удаляет начальные и конечные пробелы из строки</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UCASE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Преобразует строку в верхний регистр</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UPPER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Преобразует строку в верхний регистр</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Числовые функции</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Функция</th>
<th class="tableblock halign-left valign-top">Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ABS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает абсолютное значение числа</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ACOS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает косинус дуги числа</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ASIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает синус дуги числа</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ATAN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает тангенс дуги числа или дуги касательной n и m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ATAN2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает тангенс дуги n и m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AVG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает среднее значение выражения</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CEIL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает наименьшее целочисленное значение, которое больше или равно числу</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CEILING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает наименьшее целочисленное значение, которое больше или равно числу</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает косинус числа</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает котангенс числа</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COUNT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает количество записей в выбранном запросе</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEGREES</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Преобразует значение радиана в градусы</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DIV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Используется для целочисленного деления</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает e, поднятый до степени числа</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FLOOR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает наибольшее целочисленное значение, которое меньше или равно числу</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GREATEST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает наибольшее значение в списке выражений</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LEAST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает наименьшее значение в списке выражений</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает натуральный логарифм числа</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает натуральный логарифм числа или логарифм числа к заданной базе</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOG10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает логарифм базы-10 числа</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOG2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает логарифм базы-2 числа</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MAX</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает максимальное значение выражения</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает минимальное значение выражения</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MOD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает остаток n, деленный на m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает значение PI, отображаемое с шестью знаками после запятой</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>POW</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает m, поднятую до n-й степени</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>POWER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает m, поднятую до n-й степени</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RADIANS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Преобразует значение в градусах в радианы</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RAND</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает случайное число или случайное число в пределах диапазона</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ROUND</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает число, округленное до определенного количества знаков после запятой</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SIGN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает значение, обозначающее знак числа</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает синус числа</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SQRT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает квадратный корень из числа</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SUM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает суммарное значение выражения</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TAN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает тангенс числа</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TRUNCATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает число, усеченное до определенного количества знаков после запятой</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Функции даты</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Функция</th>
<th class="tableblock halign-left valign-top">Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATEDIFF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает дату после добавления определенного интервала времени / даты</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATE_ADD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает время / дату-время после добавления определенного временного интервала</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATE_FORMAT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает текущую дату</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATE_SUB</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает текущую дату</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DAY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает текущее время</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DAYNAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает текущую дату и время</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DAYOFMONTH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает текущее время</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DAYOFWEEK</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Извлекает значение даты из выражения даты или даты и времени</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DAYOFYEAR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает разницу в днях между двумя значениями даты</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EXTRACT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает дату после добавления определенного интервала времени / даты</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FROM_DAYS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Форматирует дату, указанную маской формата</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HOUR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает дату после вычитания определенного интервала времени / даты</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LAST_DAY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает дневную часть значения даты</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOCALTIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает имя дня недели для даты</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LOCALTIMESTAMP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает дневную часть значения даты</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MAKEDATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает индекс недели для значения даты</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MAKETIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает день года для значения даты</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MICROSECOND</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Извлекает части с даты</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MINUTE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает значение даты из числового представления дня</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MONTH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает часовую часть значения даты</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MONTHNAME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает последний день месяца на заданную дату</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOW</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает текущую дату и время</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PERIOD_ADD</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает текущую дату и время</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PERIOD_DIFF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает дату определенного годового и дневного значения</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>QUARTER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает время для определенного часа, минуты, второй комбинации</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SECOND</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает микросекундную часть значения даты</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SEC_TO_TIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает минутную часть значения даты</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>STR_TO_DATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает месячную часть значения даты</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SUBDATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает полное название месяца для даты</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SUBTIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает текущую дату и время</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSDATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Принимает период и добавляет к нему определенное количество месяцев</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает разницу в месяцах между двумя периодами</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIME_FORMAT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает четвертную часть значения даты</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIME_TO_SEC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает вторую часть значения даты</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIMEDIFF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Преобразует числовые секунды в значение времени</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TIMESTAMP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Принимает строку и возвращает дату, заданную маской формата</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TO_DAYS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает дату, после которой вычитается определенный интервал времени / даты</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WEEK</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает значение time / datetime после вычитания определенного временного интервала</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WEEKDAY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает текущую дату и время</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WEEKOFYEAR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Извлекает значение времени из выражения time / datetime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>YEAR</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Форматирует время, указанное маской формата</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>YEARWEEK</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Преобразует значение времени в числовые секунды</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Расширенные функции</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Функция</th>
<th class="tableblock halign-left valign-top">Описание</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BIN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Преобразует десятичное число в двоичное число</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BINARY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Преобразует значение в двоичную строку</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CASE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Позволяет вам оценить условия и вернуть значение при выполнении первого условия</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CAST</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Преобразует значение из одного типа данных в другой тип данных</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COALESCE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает первое ненулевое выражение в списке</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONNECTION_ID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает уникальный идентификатор соединения для текущего соединения</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Преобразует число из одной базы чисел в другую</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONVERT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Преобразует значение из одного типа данных в другой или один набор символов в другой</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CURRENT_USER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает имя пользователя и имя хоста для учетной записи MySQL, используемой сервером, для проверки подлинности текущего клиента</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DATABASE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает имя базы данных по умолчанию</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает одно значение, если условие TRUE или другое значение, если условие FALSE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IFNULL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Позволяет вернуть альтернативное значение, если выражение равно NULL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ISNULL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Проверяет, является ли выражение NULL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LAST_INSERT_ID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает первое значение AUTO_INCREMENT, заданное последним оператором INSERT или UPDATE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NULLIF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Сравнивает два выражения</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SESSION_USER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает имя пользователя и имя хоста для текущего пользователя MySQL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SYSTEM_USER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает имя пользователя и имя хоста для текущего пользователя MySQL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>USER</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает имя пользователя и имя хоста для текущего пользователя MySQL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VERSION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Возвращает версию базы данных MySQL</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_блокировки">6.6.9. Блокировки</h4>
<div class="paragraph">
<p><strong>Блокировки</strong> - это механизм поддержки требований об изолированности транзакций.</p>
</div>
<div class="paragraph">
<p>Одновременный конкурентный доступ может вызывать разные отрицательные эффекты, например <strong>чтение несуществующих данных</strong> или <strong>потерю модифицированных данных</strong>.</p>
</div>
<div class="paragraph">
<p>Рассмотрим следующий практический пример: Пользователь №1 из отдела кадров получает извещение, что сотрудник "Егор Егоров" поменял место жительства. Он вносит соответствующее изменение в базу данных для данного сотрудника, но при просмотре другой информации об этом сотруднике он понимает, что изменил адрес не того человека. Он нажимает кнопку отмены, уверенный в том, что данные после отмены операции изменения адреса уже не содержат никакой ошибки. В то же самое время пользователь №2 в отделе проектирования обращается к данным второго сотрудника с именем Егор Егоров, чтобы отправить ему домой последнюю техническую документацию, поскольку этот служащий редко бывает в офисе. Однако пользователь №2 обратился к базе данных после того, как адрес этого второго сотрудника с именем Егор Егоров был ошибочно изменен, но до того, как он был исправлен. В результате письмо отправляется не тому адресату. Чтобы предотвратить подобные проблемы, каждая система управления базами данных должна обладать механизмом для управления одновременным доступом к данным всеми пользователями. Для обеспечения согласованности данных в случае одновременного обращения к данным несколькими пользователями, применяют блокировки. Каждая прикладная программа блокирует требуемые ей данные, что гарантирует, что никакая другая программа не сможет модифицировать эти данные. Когда другая прикладная программа пытается получить доступ к заблокированным данным для их модификации, то система или завершает эту попытку ошибкой, или заставляет программу ожидать снятия блокировки.</p>
</div>
<div class="paragraph">
<p>Режимы блокировки определяют разные типы блокировок. Выбор определенного режима блокировки зависит от типа ресурса, который требуется заблокировать. Для блокировок ресурсов уровня строки и страницы применяются следующие три типа блокировок:</p>
</div>
<div class="sect4">
<h5 id="_разделяемая_блокировка_shared_lock">Разделяемая блокировка (shared lock)</h5>
<div class="paragraph">
<p>Резервирует ресурс только для чтения. Другие процессы не могут изменять заблокированный таким образом ресурс, но несколько процессов могут одновременно считывать информацию или накладывать разделяемую блокировку на один и тот же ресурс. Иными словами, чтение ресурса с разделяемой блокировкой могут одновременно выполнять несколько процессов.</p>
</div>
</div>
<div class="sect4">
<h5 id="_монопольная_блокировка_exclusive_lock">Монопольная блокировка (exclusive lock)</h5>
<div class="paragraph">
<p>Резервирует страницу или строку для монопольного использования одной транзакции. Блокировка этого типа применяется такими инструкциями как <em>INSERT</em>, <em>UPDATE</em> и <em>DELETE</em>, которые модифицируют ресурс. Монопольную блокировку нельзя установить, если на ресурс уже установлена разделяемая или монопольная блокировка другим процессом, т.е. на ресурс может быть установлена только одна монопольная блокировка.</p>
</div>
</div>
<div class="sect4">
<h5 id="_блокировка_обновления_update_lock">Блокировка обновления (update lock)</h5>
<div class="paragraph">
<p>Является промежуточной между разделяемой блокировкой и монопольной. Блокировка обновления устанавливается при намерении транзакции изменить данные, но при этом само изменение не происходит. В этом случае другим транзакциям разрешается устанавливать разделяемые блокировки, но не позволяется устанавливать монопольные блокировки, до тех пор пока транзакция не завершится.</p>
</div>
</div>
<div class="sect4">
<h5 id="_блокировки_намерения">Блокировки намерения</h5>
<div class="paragraph">
<p>Чтобы наложить монопольную блокировку на страницу данных, сервер должен убедиться, что ни на одну из записей, входящих в эту страницу, никакая блокировка не наложена. То есть необходимо перебрать все записи, входящие в страницу, и проверить их на наличие блокировок. То же самое, только в гораздо большем объеме, необходимо делать и для таблицы. Это было бы достаточно дорогостоящей операцией, но тут на помощь приходят блокировки намерения. Прежде чем ставить блокировку на конкретную запись, ставится соответствующая блокировка намерения на таблицу и страницу. Таким образом, отпадает необходимость проверять все записи, достаточно проверить, есть ли блокировка намерения на соответствующем уровне иерархии.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sql_транзакции">6.6.10. SQL-транзакции</h4>
<div class="paragraph">
<p><strong>Транзакция</strong> представляет собой единицу работы, которая выполняется с базой данных.</p>
</div>
<div class="paragraph">
<p>Транзакцию можно рассматривать как внесение одного или нескольких изменений в базу данных. Например, если необходимо создать запись или выполнить обновление, удаление записи из таблицы, то выполняется транзакция в этой таблице.</p>
</div>
<div class="sect4">
<h5 id="_свойства_транзакций">Свойства транзакций</h5>
<div class="paragraph">
<p>Транзакции имеют следующие четыре стандартных свойств, как правило, называют аббревиатурой <strong>ACID</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Atomicity</strong> – гарантирует, что все операции в рамках единицы работы завершены успешно, иначе транзакция прерывается в точке выхода из строя, и все предыдущие операции откатываются в прежнее состояние.</p>
</li>
<li>
<p><strong>Consistency</strong> – гарантирует, что база данных правильно изменяет состояния на более успешное совершенные транзакции.</p>
</li>
<li>
<p><strong>Isolation</strong> – позволяет транзакции работать независимо и прозрачно друг с другом.</p>
</li>
<li>
<p><strong>Durability</strong> – гарантирует, что результат или эффект зафиксированной транзакции сохраняется в случае сбоя системы.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_управление_транзакцией">Управление транзакцией</h5>
<div class="paragraph">
<p>Следующие команды используются для управления операциями.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>COMMIT</code> – для сохранения изменений.</p>
</li>
<li>
<p><code>ROLLBACK</code> – откат изменений.</p>
</li>
<li>
<p><code>SAVEPOINT</code> – создает точки внутри групп операций, которые следует откатить.</p>
</li>
<li>
<p><code>SET TRANSACTION</code> – устанавливает характеристики транзакции.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_уровни_изоляции">Уровни изоляции</h5>
<div class="paragraph">
<p>Чаще всего транзакции не должна зависеть от других транзакций, но применение жестких ограничений (блокировок) приводит к эффекту выстраивания в очередь транзакций на выполнение, что замедляет производительность системы.
Но бывают случаи, когда жесткие ограничения не нужны, поэтому существуют <strong>уровни изоляции</strong>, которые определяют степень параллелизма транзакций.
Существуют четыре вида изоляции:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Read uncommitted</strong>;</p>
</li>
<li>
<p><strong>Read committed</strong>;</p>
</li>
<li>
<p><strong>Repeatable read</strong>;</p>
</li>
<li>
<p><strong>Serializable</strong>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_read_uncommitted_dirty_read">Read uncommitted (Dirty read)</h6>
<div class="paragraph">
<p>Позволяет читать данные незафиксированных транзакций.
<strong>Пример</strong>: первая транзакция ввела данные, но не зафиксировала изменения, вторая прочитала, но первая отменила свои изменения данных.
В таком случае, получилась ситуация, в которой вторая транзакция прочитала несуществующие данные. Такой эффект называют <strong>грязным чтением</strong>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_read_committed">Read Committed</h6>
<div class="paragraph">
<p>При таком уровне изоляции транзакции не дадут прочитать данные, которые не зафиксировала другая транзакция после изменения.</p>
</div>
<div class="paragraph">
<p>Если первая транзакция один раз прочитала данные, а вторая транзакция сразу же их изменила и зафиксировала, то повторное чтение данных первой транзакции вернет измененные значения.
В таком случае может возникнуть ситуация, при которой первая транзакция, к концу своего выполнения, обладает недостоверной информацией, которая может повлиять на вносимые данные.</p>
</div>
</div>
<div class="sect5">
<h6 id="_repeatable_read">Repeatable Read</h6>
<div class="paragraph">
<p>Изменение данных, которые ранее прочитала первая транзакция, другими транзакциями до завершения первой невозможно.
Однако имеет место ситуация, когда другие транзакции будут не изменять, а добавлять новые данные, удовлетворяющие условию выборки первой транзакции по определенному условию.
В таком случае повторная выборка первой транзакции вернет новые значения.</p>
</div>
</div>
<div class="sect5">
<h6 id="_serializable">Serializable</h6>
<div class="paragraph">
<p><strong>Serializable</strong> - уровень изоляции который бьет по производительности системы, но позволяет избежать проблем с чтением данных.
При таком уровне транзакции работают последовательно.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_объекты_бд">6.7. Объекты БД</h3>
<div class="paragraph">
<p><strong>Объектами баз данных</strong> называют их структурные составляющие, такие, как:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>схемы</strong> (<strong>schema</strong>)</p>
</li>
<li>
<p><strong>таблицы</strong> (<strong>table</strong>)</p>
</li>
<li>
<p><strong>представления</strong> (<strong>view</strong>)</p>
</li>
<li>
<p><strong>функции</strong> (<strong>function</strong>)</p>
</li>
<li>
<p><strong>процедуры</strong> (<strong>procedure</strong>)</p>
</li>
<li>
<p><strong>триггеры</strong> (<strong>trigger</strong>)</p>
</li>
<li>
<p><strong>последовательности</strong> (<strong>sequence</strong>)</p>
</li>
<li>
<p><strong>ограничения</strong> (<strong>constraints</strong>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Они выполняют различные функции по хранению и обработке информации.</p>
</div>
<div class="sect3">
<h4 id="_схемы">6.7.1. Схемы</h4>
<div class="paragraph">
<p><strong>Схема</strong> (<strong>schema</strong>) — это логический контейнер таблиц и других объектов внутри базы данных, причем каждая база данных может иметь одну или несколько схем.</p>
</div>
<div class="paragraph">
<p>Схемы применяются, чтобы объединить объекты базы данных в логические группы для облегчения управления ими и избежания конфликта имен различных приложений внутри схемы.</p>
</div>
<div class="paragraph">
<div class="title">Схемы</div>
<p><span class="image"><img src="../assets/img/sql/bd-object/postgresql-schema.png" alt="postgresql schema"></span></p>
</div>
<div class="sect4">
<h5 id="_создание_схемы_сreate_schema">Создание схемы (<code>СREATE SCHEMA</code>)</h5>
<div class="paragraph">
<p>Для создания схемы необходимо использовать следующий запрос:</p>
</div>
<div class="listingblock">
<div class="title">Создание схемы</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="err">имя</span><span class="n">_</span><span class="err">схемы</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Таблица, при создании без указания схемы, автоматически помещается в схему <code>public</code>, для создания таблицы в определенной схеме, необходимо указать её имя:</p>
</div>
<div class="listingblock">
<div class="title">Создание таблицы в определенной схеме</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="err">имя</span><span class="n">_</span><span class="err">схемы</span><span class="p">.</span><span class="err">имя</span><span class="n">_</span><span class="err">таблицы</span> <span class="p">(</span> <span class="p">...</span> <span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Часто бывает нужно создать схему, владельцем которой будет другой пользователь (это один из способов ограничения пользователей пространствами имён). Сделать это можно следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="err">имя</span><span class="n">_</span><span class="err">схемы</span> <span class="k">AUTHORIZATION</span> <span class="err">имя</span><span class="n">_</span><span class="err">пользователя</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Возможно опустить имя схемы, в этом случае именем схемы станет имя пользователя. Схемы с именами, начинающимися с <code>pg_</code>, являются системными - пользователям не разрешено использовать такие имена.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="err">имя</span><span class="n">_</span><span class="err">схемы</span> <span class="k">AUTHORIZATION</span> <span class="err">имя</span><span class="n">_</span><span class="err">пользователя</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>где <code>IF NOT EXISTS</code> означает <strong>не делать ничего</strong>  (только выдать замечание), если схема с таким именем уже существует.</p>
</div>
<div class="paragraph">
<p><strong>Пример</strong>, создание схемы, в которой сразу создаются таблица и представление:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">hollywood</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">films</span> <span class="p">(</span><span class="n">title</span> <span class="nb">text</span><span class="p">,</span> <span class="n">release</span> <span class="nb">date</span><span class="p">,</span> <span class="n">awards</span> <span class="nb">text</span><span class="p">[]);</span>
<span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">winners</span> <span class="k">AS</span>
    <span class="k">SELECT</span> <span class="n">title</span><span class="p">,</span> <span class="n">release</span> <span class="k">FROM</span> <span class="n">films</span> <span class="k">WHERE</span> <span class="n">awards</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы создать объекты в схеме или обратиться к ним, необходимо указать полное имя, состоящее из имён схемы и объекта, разделённых точкой:</p>
</div>
<div class="listingblock">
<div class="title">Правило обращения к объекту внутри схемы</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="err">схема</span><span class="p">.</span><span class="err">объект</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Есть ещё более общий синтаксис</p>
</div>
<div class="listingblock">
<div class="title">Обращение к объекту через базу данных</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="err">база</span><span class="n">_</span><span class="err">данных</span><span class="p">.</span><span class="err">схема</span><span class="p">.</span><span class="err">объект</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_удаление_схемы_drop_schema">Удаление схемы (<code>DROP SCHEMA</code>)</h5>
<div class="paragraph">
<p>Удалить схему, которая не содержит внутри себя объектов, можно следующим способом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">SCHEMA</span> <span class="err">имя</span><span class="n">_</span><span class="err">схемы</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Удалить схему со всеми содержащимися в ней объектами:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">SCHEMA</span> <span class="err">имя</span><span class="n">_</span><span class="err">схемы</span> <span class="k">CASCADE</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>RESTRICT</code> позволяет отказать в удалении схемы, если она содержит какие-либо объекты. Это поведение по умолчанию.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">SCHEMA</span> <span class="err">имя</span><span class="n">_</span><span class="err">схемы</span> <span class="k">RESTRICT</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_изменение_схемы_alter_schema">Изменение схемы (<code>ALTER SCHEMA</code>)</h5>
<div class="paragraph">
<p><code>ALTER SCHEMA</code> — позволяет изменить определение схемы.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">SCHEMA</span> <span class="err">имя</span> <span class="k">RENAME</span> <span class="k">TO</span> <span class="err">новое</span><span class="n">_</span><span class="err">имя</span>

<span class="k">ALTER</span> <span class="k">SCHEMA</span> <span class="err">имя</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="err">{</span> <span class="err">новый</span><span class="n">_</span><span class="err">владелец</span> <span class="o">|</span> <span class="k">CURRENT_USER</span> <span class="o">|</span> <span class="k">SESSION_USER</span> <span class="err">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Параметры</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>имя</code> - имя существующей схемы.</p>
</li>
<li>
<p><code>новое_имя</code> - новое имя схемы. Новое имя не может начинаться с <code>pg_</code>, так как такие имена зарезервированы для системных схем.</p>
</li>
<li>
<p><code>новый_владелец</code> - новый владелец схемы.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_схемы_и_права">Схемы и права</h5>
<div class="paragraph">
<p>По умолчанию пользователь не может обращаться к объектам в чужих схемах. Чтобы изменить это, владелец схемы должен дать пользователю право <code>USAGE</code> для данной схемы. Чтобы пользователи могли использовать объекты схемы, может понадобиться назначить дополнительные права на уровне объектов.</p>
</div>
<div class="paragraph">
<p>Пользователю также можно разрешить создавать объекты в схеме, не принадлежащей ему. Для этого ему нужно дать право <code>CREATE</code> в требуемой схеме. Требуется помнить, что по умолчанию все имеют права <code>CREATE</code> и <code>USAGE</code> в схеме <code>public</code>. Благодаря этому все пользователи могут подключаться к заданной базе данных и создавать объекты в её схеме <code>public</code>.</p>
</div>
<div class="paragraph">
<p>Некоторые шаблоны использования позволяют запретить это:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">REVOKE</span> <span class="k">CREATE</span> <span class="k">ON</span> <span class="k">SCHEMA</span> <span class="k">public</span> <span class="k">FROM</span> <span class="k">PUBLIC</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_таблицы_2">6.7.2. Таблицы</h4>
<div class="paragraph">
<p><strong>Таблицы</strong> используются для хранения данных, в базе данных может находиться несколько таблиц.</p>
</div>
<div class="paragraph">
<div class="title">Таблицы</div>
<p><span class="image"><img src="../assets/img/sql/bd-object/postgresql-tables.png" alt="postgresql tables"></span></p>
</div>
<div class="sect4">
<h5 id="_создание_таблицы_create_table_2">Создание таблицы (<code>CREATE TABLE</code>)</h5>
<div class="paragraph">
<p>Для создания таблицы используется команда <code>CREATE TABLE</code>. В этой команде необходимо указать как минимум имя новой таблицы и имена, типы данных каждого столбца.</p>
</div>
<div class="paragraph">
<p><strong>Например</strong>:</p>
</div>
<div class="listingblock">
<div class="title">Создание таблицы</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">my_first_table</span> <span class="p">(</span>
    <span class="n">first_column</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">second_column</span> <span class="nb">INTEGER</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Число столбцов в таблице <strong>не может быть бесконечным</strong>. Это число ограничивается максимумом в пределах от <code>250</code> до <code>1600</code>, в зависимости от типов столбцов. Однако, создавать таблицы с таким большим числом столбцов обычно не требуется, а если такая потребность возникает, это скорее признак сомнительного дизайна.</p>
</div>
</div>
<div class="sect4">
<h5 id="_удаление_таблицы_drop_table">Удаление таблицы (<code>DROP TABLE</code>)</h5>
<div class="paragraph">
<p>Если таблица больше не нужна, можно удалить её, выполнив следующую команду <code>DROP TABLE</code>:</p>
</div>
<div class="listingblock">
<div class="title">Удаление таблицы</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">my_first_table</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_изменение_таблицы_alter_table">Изменение таблицы (<code>ALTER TABLE</code>)</h5>
<div class="paragraph">
<p><code>ALTER TABLE</code> меняет определение существующей таблицы.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="p">[</span> <span class="k">ONLY</span> <span class="p">]</span> <span class="err">имя</span> <span class="p">[</span> <span class="o">*</span> <span class="p">]</span>
<span class="err">действие</span> <span class="p">[,</span> <span class="p">...</span> <span class="p">]</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="p">[</span> <span class="k">ONLY</span> <span class="p">]</span> <span class="err">имя</span> <span class="p">[</span> <span class="o">*</span> <span class="p">]</span>
<span class="k">RENAME</span> <span class="p">[</span> <span class="k">COLUMN</span> <span class="p">]</span> <span class="err">имя</span><span class="n">_</span><span class="err">столбца</span> <span class="k">TO</span> <span class="err">новое</span><span class="n">_</span><span class="err">имя</span><span class="n">_</span><span class="err">столбца</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="p">[</span> <span class="k">ONLY</span> <span class="p">]</span> <span class="err">имя</span> <span class="p">[</span> <span class="o">*</span> <span class="p">]</span>
<span class="k">RENAME</span> <span class="k">CONSTRAINT</span> <span class="err">имя</span><span class="n">_</span><span class="err">ограничения</span> <span class="k">TO</span> <span class="err">имя</span><span class="n">_</span><span class="err">нового</span><span class="n">_</span><span class="err">ограничения</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span>
<span class="k">RENAME</span> <span class="k">TO</span> <span class="err">новое</span><span class="n">_</span><span class="err">имя</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span>
<span class="k">SET</span> <span class="k">SCHEMA</span> <span class="err">новая</span><span class="n">_</span><span class="err">схема</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Действия могут быть различными, приведем несколько примеров:</p>
</div>
<div class="listingblock">
<div class="title">Действия</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ADD</span> <span class="p">[</span> <span class="k">COLUMN</span> <span class="p">]</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span><span class="n">_</span><span class="err">столбца</span> <span class="err">тип</span><span class="n">_</span><span class="err">данных</span>
<span class="p">[</span> <span class="k">COLLATE</span> <span class="err">правило</span><span class="n">_</span><span class="err">сортировки</span> <span class="p">]</span> <span class="p">[</span> <span class="err">ограничение</span><span class="n">_</span><span class="err">столбца</span> <span class="p">[</span> <span class="p">...</span> <span class="p">]</span> <span class="p">]</span>

<span class="k">DROP</span> <span class="p">[</span> <span class="k">COLUMN</span> <span class="p">]</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span><span class="n">_</span><span class="err">столбца</span> <span class="p">[</span> <span class="k">RESTRICT</span> <span class="o">|</span> <span class="k">CASCADE</span> <span class="p">]</span>

<span class="k">ADD</span> <span class="err">ограничение</span><span class="n">_</span><span class="err">таблицы</span> <span class="p">[</span> <span class="k">NOT</span> <span class="k">VALID</span> <span class="p">]</span>

<span class="k">DROP</span> <span class="k">CONSTRAINT</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span><span class="n">_</span><span class="err">ограничения</span> <span class="p">[</span> <span class="k">RESTRICT</span> <span class="o">|</span> <span class="k">CASCADE</span> <span class="p">]</span>

<span class="n">DISABLE</span> <span class="k">TRIGGER</span> <span class="p">[</span> <span class="err">имя</span><span class="n">_</span><span class="err">триггера</span> <span class="o">|</span> <span class="k">ALL</span> <span class="o">|</span> <span class="k">USER</span> <span class="p">]</span>

<span class="n">ENABLE</span> <span class="k">TRIGGER</span> <span class="p">[</span> <span class="err">имя</span><span class="n">_</span><span class="err">триггера</span> <span class="o">|</span> <span class="k">ALL</span> <span class="o">|</span> <span class="k">USER</span> <span class="p">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_представления_view">6.7.3. Представления (View)</h4>
<div class="paragraph">
<p><strong>Представления</strong> (<strong>View</strong>) - это именованные <strong>правила выборки данных</strong>. Они предназначены для извлечения данных из одной или нескольких таблиц, на которые основываются.</p>
</div>
<div class="paragraph">
<p>Еще можно сказать, что <strong>представление это виртуальная таблица</strong>, которая используется для упрощения сложных запросов и обеспечения безопасности для набора записей.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/sql/bd-object/postgresql-views.png" alt="postgresql views"></span></p>
</div>
<div class="paragraph">
<p><strong>Преимущества представления</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Обеспечивают независимость пользовательских программ от изменения логической структуры базы данных.</p>
</li>
<li>
<p>Возможность различным пользователям по-разному видеть одни и те же данные.</p>
</li>
<li>
<p>Дополнительный механизм для управления санкционированным доступом.
Представления защищают данные, так как могут дать доступ к части таблицы, а не ко всей таблице.</p>
</li>
<li>
<p>Повторное использование написанного запроса.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_создание_представления_create_view">Создание представления (<code>CREATE VIEW</code>)</h5>
<div class="paragraph">
<p>Предположим, что появилась необходимость вывести список из названий городов, но нет потребности каждый раз вводить весь запрос.
Можно создать <strong>представление</strong> по данному запросу, фактически присвоить имя запросу, а затем обращаться к нему как к обычной таблице:</p>
</div>
<div class="listingblock">
<div class="title">Создание и использование представления:</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">myview</span> <span class="k">AS</span>
    <span class="k">SELECT</span> <span class="n">name</span> <span class="k">FROM</span> <span class="n">cities</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь получить список названий (<code>name</code>) всех городов можно через представление используя следующий запрос:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">myview</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Для изменения представления можно воспользоваться запросом:</p>
</div>
<div class="listingblock">
<div class="title">Изменение представления благодаря <code>OR REPLACE</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">VIEW</span> <span class="n">myview</span> <span class="k">AS</span>
    <span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="n">id</span> <span class="k">FROM</span> <span class="n">cities</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Команда <code>CREATE OR REPLACE VIEW</code> действует подобным образом, но если представление с этим именем уже существует, оно заменяется. Новый запрос должен выдавать те же столбцы, что выдавал запрос, ранее определённый для этого представления, (то есть, столбцы с такими же именами должны иметь те же типы данных и следовать в том же порядке), но может добавить несколько новых столбцов в конце списка. Вычисления, в результате которых формируются столбцы представления, могут быть совершенно другими.</p>
</div>
<div class="paragraph">
<p>Это означает, что <strong>возникнет ошибка</strong>, если переопределить представление следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">VIEW</span> <span class="n">myview</span> <span class="k">AS</span>
    <span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">name</span> <span class="k">FROM</span> <span class="n">cities</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre>ERROR: ОШИБКА:  изменить имя столбца "name" на "id" в представлении нельзя</pre>
</div>
</div>
<div class="paragraph">
<p>Или при попытке исключить столбец:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">VIEW</span> <span class="n">myview</span> <span class="k">AS</span>
    <span class="k">SELECT</span> <span class="n">id</span> <span class="k">FROM</span> <span class="n">cities</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre>ERROR: ОШИБКА:  удалять столбцы из представления нельзя</pre>
</div>
</div>
<div class="paragraph">
<p>Рассмотрим механизм создания представления поподробнее.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис создания представления</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="p">[</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="p">]</span> <span class="p">[</span> <span class="k">TEMP</span> <span class="o">|</span> <span class="k">TEMPORARY</span> <span class="p">]</span> <span class="p">[</span> <span class="k">RECURSIVE</span> <span class="p">]</span> <span class="k">VIEW</span> <span class="err">имя</span> <span class="p">[</span> <span class="p">(</span> <span class="err">имя</span><span class="n">_</span><span class="err">столбца</span>
<span class="p">[,</span> <span class="p">...]</span> <span class="p">)</span> <span class="p">]</span>
<span class="p">[</span> <span class="k">WITH</span> <span class="p">(</span> <span class="err">имя</span><span class="n">_</span><span class="err">параметра</span><span class="n">_</span><span class="err">представления</span> <span class="p">[</span><span class="o">=</span> <span class="err">значение</span><span class="n">_</span><span class="err">параметра</span><span class="n">_</span><span class="err">представления</span><span class="p">]</span>
<span class="p">[,</span> <span class="p">...</span> <span class="p">]</span> <span class="p">)</span> <span class="p">]</span>
<span class="k">AS</span> <span class="err">запрос</span>
<span class="p">[</span> <span class="k">WITH</span> <span class="p">[</span> <span class="k">CASCADED</span> <span class="o">|</span> <span class="k">LOCAL</span> <span class="p">]</span> <span class="k">CHECK</span> <span class="k">OPTION</span> <span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Параметры</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TEMPORARY</code> или <code>TEMP</code> - с такими параметрами представление создаётся как временное. Временные представления автоматически удаляются в конце сеанса. Существующее постоянное представление с тем же именем не будет видно в текущем сеансе, пока существует временное, однако к нему можно обратиться, дополнив имя указанием схемы. Если в определении представления задействованы временные таблицы, представление так же создаётся как временное (вне зависимости от присутствия явного указания <code>TEMPORARY</code>).</p>
</li>
<li>
<p><code>RECURSIVE</code> - создаёт рекурсивное представление.</p>
</li>
<li>
<p><code>запрос</code> - команда <code>SELECT</code> или <code>VALUES</code>, которая выдаёт столбцы и строки представления.</p>
</li>
<li>
<p><code>WITH [ CASCADED | LOCAL ] CHECK OPTION</code> - это указание управляет поведением автоматически изменяемых представлений. Если оно присутствует, при выполнении операций <code>INSERT</code> и <code>UPDATE</code> с этим представлением будет проверяться, удовлетворяют ли новые строки условию, определяющему представление (т.е. проверяется, будут ли новые строки видны через это представление). Если они не удовлетворяют условию, операция не будет выполнена. Если указание <code>CHECK OPTION</code> отсутствует, команды <code>INSERT</code> и <code>UPDATE</code> смогут создавать в этом представлении строки, которые не будут видны в нём.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Поддерживаются следующие варианты проверки:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>LOCAL</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Новые строки проверяются только по условиям, определённым непосредственно в самом представлении. Любые условия, определённые в нижележащих базовых представлениях, не проверяются (если только в них нет указания <code>CHECK OPTION</code>).</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CASCADED</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Новые строки проверяются по условиям данного представления и всех нижележащих базовых. Если указано <code>CHECK OPTION</code>, а <code>LOCAL</code> и <code>CASCADED</code> опущено, подразумевается указание <code>CASCADED</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_удаление_представления_drop_view">Удаление представления (<code>DROP VIEW</code>)</h5>
<div class="paragraph">
<p>Удалить представление можно следующим образом:</p>
</div>
<div class="listingblock">
<div class="title">Удаление представления</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">VIEW</span> <span class="err">имя</span><span class="n">_</span><span class="err">представления</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Удаление представления с объектами, зависящие от данного представления</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">VIEW</span> <span class="err">имя</span><span class="n">_</span><span class="err">представления</span> <span class="k">CASCADE</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Отказать в удалении представления, если от него зависят какие-либо объекты. Это поведение по умолчанию</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">VIEW</span> <span class="err">имя</span><span class="n">_</span><span class="err">представления</span> <span class="k">RESTRICT</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_изменение_определения_представления_alter_view">Изменение определения представления (<code>ALTER VIEW</code>)</h5>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">VIEW</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span> <span class="k">ALTER</span> <span class="p">[</span> <span class="k">COLUMN</span> <span class="p">]</span> <span class="err">имя</span><span class="n">_</span><span class="err">столбца</span> <span class="k">SET</span> <span class="k">DEFAULT</span> <span class="err">выражение</span>

<span class="k">ALTER</span> <span class="k">VIEW</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span> <span class="k">ALTER</span> <span class="p">[</span> <span class="k">COLUMN</span> <span class="p">]</span> <span class="err">имя</span><span class="n">_</span><span class="err">столбца</span> <span class="k">DROP</span> <span class="k">DEFAULT</span>

<span class="k">ALTER</span> <span class="k">VIEW</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="err">{</span> <span class="err">новый</span><span class="n">_</span><span class="err">владелец</span> <span class="o">|</span> <span class="k">CURRENT_USER</span> <span class="o">|</span> <span class="k">SESSION_USER</span> <span class="err">}</span>

<span class="k">ALTER</span> <span class="k">VIEW</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span> <span class="k">RENAME</span> <span class="k">TO</span> <span class="err">новое</span><span class="n">_</span><span class="err">имя</span>

<span class="k">ALTER</span> <span class="k">VIEW</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span> <span class="k">SET</span> <span class="k">SCHEMA</span> <span class="err">новая</span><span class="n">_</span><span class="err">схема</span>

<span class="k">ALTER</span> <span class="k">VIEW</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span> <span class="k">SET</span> <span class="p">(</span> <span class="err">имя</span><span class="n">_</span><span class="err">параметра</span><span class="n">_</span><span class="err">представления</span>
<span class="p">[</span><span class="o">=</span> <span class="err">значение</span><span class="n">_</span><span class="err">параметра</span><span class="n">_</span><span class="err">представления</span><span class="p">]</span> <span class="p">[,</span> <span class="p">...</span> <span class="p">]</span> <span class="p">)</span>

<span class="k">ALTER</span> <span class="k">VIEW</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span> <span class="k">RESET</span> <span class="p">(</span> <span class="err">имя</span><span class="n">_</span><span class="err">параметра</span><span class="n">_</span><span class="err">представления</span> <span class="p">[,</span> <span class="p">...</span> <span class="p">]</span> <span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Выполнить <code>ALTER VIEW</code> может только владелец представления. Чтобы сменить схему представления, необходимо также иметь право <code>CREATE</code> в новой схеме. Чтобы сменить владельца, требуется также быть непосредственным или опосредованным членом новой роли, а эта роль должна иметь право <code>CREATE</code> в схеме представления.</p>
</div>
<div class="paragraph">
<p><strong>Параметры</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>имя</code> - имя существующего представления (возможно, дополненное схемой).</p>
</li>
<li>
<p><code>IF EXISTS</code> - не считать ошибкой, если представление не существует. В этом случае будет выдано замечание.</p>
</li>
<li>
<p><code>SET/DROP DEFAULT</code> - эти формы устанавливают или удаляют значение по умолчанию в заданном столбце. Значение по умолчанию подставляется в команды <code>INSERT</code> и <code>UPDATE</code>, вносящие данные в представление, до применения каких-либо правил или триггеров в этом представлении. Таким образом, значения по умолчанию в представлении имеют приоритет перед значениями по умолчанию в нижележащих отношениях.</p>
</li>
<li>
<p><code>новый_владелец</code> - имя пользователя, назначаемого новым владельцем представления.</p>
</li>
<li>
<p><code>новое_имя</code> - новое имя представления.</p>
</li>
<li>
<p><code>новая_схема</code> - новая схема представления.</p>
</li>
<li>
<p><code>SET</code> и <code>RESET</code> - устанавливает или сбрасывает параметры представления.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_материализованное_представление">6.7.4. Материализованное представление</h4>
<div class="paragraph">
<p><strong>Материализованное представление</strong> (<strong>MATERIALIZED VIEW</strong>) — это объект базы данных, который содержит результаты запроса.</p>
</div>
<div class="paragraph">
<p>Материализованное представление похоже на представление базы данных, за исключением того, что оно физически хранится на диске и обновляется вручную. <strong>MATERIALIZED VIEW</strong> хранит результаты запроса в собственной табличной структуре, из которой можно запрашивать данные. <strong>Невозможно добавлять или удалять строки</strong>, но в остальное время он ведет себя как настоящая таблица.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Разница <strong>VIEW</strong> и <strong>MATERIALIZED VIEW</strong></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Что сравниваем</th>
<th class="tableblock halign-left valign-top">VIEW</th>
<th class="tableblock halign-left valign-top">MATERIALIZED VIEW</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Способ хранения</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VIEW никогда не сохраняется, он только отображается.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Материализованное представление хранится на диске.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Способ обновления</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Представление обновляется каждый раз, когда используется виртуальная таблица (представление).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Материализованное представление должно обновляться вручную или с использованием триггеров.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Скорость</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Медленная обработка.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Быстрая обработка.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Использованием памяти</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Просмотр не требует места в памяти.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Материализованный вид использует пространство памяти.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Создание материализованного представления</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="n">MATERIALIZED</span> <span class="k">VIEW</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span><span class="n">_</span><span class="err">таблицы</span>
    <span class="p">[</span> <span class="p">(</span><span class="err">имя</span><span class="n">_</span><span class="err">столбца</span> <span class="p">[,</span> <span class="p">...]</span> <span class="p">)</span> <span class="p">]</span>
    <span class="p">[</span> <span class="k">WITH</span> <span class="p">(</span> <span class="err">параметр</span><span class="n">_</span><span class="err">хранения</span> <span class="p">[</span><span class="o">=</span> <span class="err">значение</span><span class="p">]</span> <span class="p">[,</span> <span class="p">...</span> <span class="p">]</span> <span class="p">)</span> <span class="p">]</span>
    <span class="p">[</span> <span class="n">TABLESPACE</span> <span class="err">табл</span><span class="n">_</span><span class="err">пространство</span> <span class="p">]</span>
<span class="k">AS</span> <span class="err">запрос</span>
    <span class="p">[</span> <span class="k">WITH</span> <span class="p">[</span> <span class="k">NO</span> <span class="p">]</span> <span class="k">DATA</span> <span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Параметры</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IF NOT EXISTS</code> - не считать ошибкой, если материализованное представление с таким именем уже существует. В этом случае будет выдано замечание. Заметьте, что нет никакой гарантии, что существующее материализованное представление как-то соотносится с тем, которое могло бы быть создано.</p>
</li>
<li>
<p><code>имя_таблицы</code> - имя создаваемого материализованного представления (возможно, дополненное схемой).</p>
</li>
<li>
<p><code>имя_столбца</code> - имя столбца в создаваемом материализованном представлении. Если имена столбцов не заданы явно, они определяются по именам столбцов результата запроса.</p>
</li>
<li>
<p><code>WITH ( параметр_хранения [= значение] [, &#8230;&#8203; ] )</code> - это предложение задаёт дополнительные параметры хранения для создаваемого материализованного представления. Все параметры, которые поддерживает <code>CREATE TABLE</code>, поддерживает и <code>CREATE MATERIALIZED VIEW</code>.</p>
</li>
<li>
<p><code>TABLESPACE (табл_пространство)</code> — имя табличного пространства, в котором будет создано материализованное представление.</p>
</li>
<li>
<p><code>запрос</code> - команды <code>SELECT</code> или <code>VALUES</code>. Эти команды будут выполняться с ограничениями по безопасности. В частности, будут запрещены вызовы функций, которые сами создают временные таблицы.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_удаление_материализованного_представления_drop_materialized_view">Удаление материализованного представления (<code>DROP MATERIALIZED VIEW</code>)</h5>
<div class="listingblock">
<div class="title">Удаление материализованного представления</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="n">MATERIALIZED</span> <span class="k">VIEW</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span> <span class="p">[,</span> <span class="p">...]</span> <span class="p">[</span> <span class="k">CASCADE</span> <span class="o">|</span> <span class="k">RESTRICT</span> <span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>где:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CASCADE</code> - автоматически удалять объекты, зависящие от данного материализованного представления (например, другие материализованные или обычные представления), и, в свою очередь, все зависящие от них объекты.</p>
</li>
<li>
<p><code>RESTRICT</code> - отказать в удалении материализованного представления, если от него зависят какие-либо объекты. Это поведение по умолчанию.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_изменение_материализованного_представления_alter_materialized_view">Изменение материализованного представления (<code>ALTER MATERIALIZED VIEW</code>)</h5>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="n">MATERIALIZED</span> <span class="k">VIEW</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span>
<span class="err">действие</span> <span class="p">[,</span> <span class="p">...</span> <span class="p">]</span>

<span class="k">ALTER</span> <span class="n">MATERIALIZED</span> <span class="k">VIEW</span> <span class="err">имя</span>
<span class="n">DEPENDS</span> <span class="k">ON</span> <span class="n">EXTENSION</span> <span class="err">имя</span><span class="n">_</span><span class="err">расширения</span>

<span class="k">ALTER</span> <span class="n">MATERIALIZED</span> <span class="k">VIEW</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span>
<span class="k">RENAME</span> <span class="p">[</span> <span class="k">COLUMN</span> <span class="p">]</span> <span class="err">имя</span><span class="n">_</span><span class="err">столбца</span> <span class="k">TO</span> <span class="err">новое</span><span class="n">_</span><span class="err">имя</span><span class="n">_</span><span class="err">столбца</span>

<span class="k">ALTER</span> <span class="n">MATERIALIZED</span> <span class="k">VIEW</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span>
<span class="k">RENAME</span> <span class="k">TO</span> <span class="err">новое</span><span class="n">_</span><span class="err">имя</span>

<span class="k">ALTER</span> <span class="n">MATERIALIZED</span> <span class="k">VIEW</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span>
<span class="k">SET</span> <span class="k">SCHEMA</span> <span class="err">новая</span><span class="n">_</span><span class="err">схема</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Возможные действия</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="p">[</span> <span class="k">COLUMN</span> <span class="p">]</span> <span class="err">имя</span><span class="n">_</span><span class="err">столбца</span> <span class="k">SET</span> <span class="k">STATISTICS</span> <span class="nb">integer</span>

<span class="k">ALTER</span> <span class="p">[</span> <span class="k">COLUMN</span> <span class="p">]</span> <span class="err">имя</span><span class="n">_</span><span class="err">столбца</span> <span class="k">SET</span> <span class="p">(</span> <span class="err">атрибут</span> <span class="o">=</span> <span class="err">значение</span> <span class="p">[,</span> <span class="p">...</span> <span class="p">]</span> <span class="p">)</span>

<span class="k">ALTER</span> <span class="p">[</span> <span class="k">COLUMN</span> <span class="p">]</span> <span class="err">имя</span><span class="n">_</span><span class="err">столбца</span> <span class="k">RESET</span> <span class="p">(</span> <span class="err">атрибут</span> <span class="p">[,</span> <span class="p">...</span> <span class="p">]</span> <span class="p">)</span>

<span class="k">SET</span> <span class="p">(</span> <span class="err">параметр</span><span class="n">_</span><span class="err">хранения</span> <span class="p">[</span><span class="o">=</span> <span class="err">значение</span><span class="p">]</span> <span class="p">[,</span> <span class="p">...</span> <span class="p">]</span> <span class="p">)</span>

<span class="k">RESET</span> <span class="p">(</span> <span class="err">параметр</span><span class="n">_</span><span class="err">хранения</span> <span class="p">[,</span> <span class="p">...</span> <span class="p">]</span> <span class="p">)</span>

<span class="k">OWNER</span> <span class="k">TO</span> <span class="err">{</span> <span class="err">новый</span><span class="n">_</span><span class="err">владелец</span> <span class="o">|</span> <span class="k">CURRENT_USER</span> <span class="o">|</span> <span class="k">SESSION_USER</span> <span class="err">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ALTER MATERIALIZED VIEW</code> изменяет различные расширенные свойства существующего материализованного представления.</p>
</div>
<div class="paragraph">
<p>Выполнить <code>ALTER MATERIALIZED VIEW</code> может только владелец материализованного представления. Чтобы сменить схему материализованного представления, необходимо также иметь право <code>CREATE</code> в новой схеме. Чтобы сменить владельца, требуется также быть непосредственным или опосредованным членом новой роли, а эта роль должна иметь право <code>CREATE</code> в схеме материализованного представления.</p>
</div>
<div class="paragraph">
<p><strong>Параметры</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>имя</code> - имя существующего материализованного представления (возможно, дополненное схемой).</p>
</li>
<li>
<p><code>имя_столбца</code> - имя нового или существующего столбца.</p>
</li>
<li>
<p><code>имя_расширения</code> - имя расширения, от которого будет зависеть материализованное представление.</p>
</li>
<li>
<p><code>новое_имя_столбца</code> - новое имя существующего столбца.</p>
</li>
<li>
<p><code>новый_владелец</code> - имя пользователя, назначаемого новым владельцем материализованного представления.</p>
</li>
<li>
<p><code>новое_имя</code> - новое имя материализованного представления.</p>
</li>
<li>
<p><code>новая_схема</code> - новая схема материализованного представления.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_замена_содержимого_материализованного_представления_refresh_materialized_view">Замена содержимого материализованного представления (<code>REFRESH MATERIALIZED VIEW</code>)</h5>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="n">REFRESH</span> <span class="n">MATERIALIZED</span> <span class="k">VIEW</span> <span class="p">[</span> <span class="n">CONCURRENTLY</span> <span class="p">]</span> <span class="err">имя</span>
<span class="p">[</span> <span class="k">WITH</span> <span class="p">[</span> <span class="k">NO</span> <span class="p">]</span> <span class="k">DATA</span> <span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>REFRESH MATERIALIZED VIEW</code> полностью заменяет содержимое материализованного представления. Эту команду разрешено выполнять только владельцам материализованного представления. Старое его содержимое при этом аннулируется. Если добавлено указание <code>WITH DATA</code> (или нет никакого), нижележащий запрос выполняется и выдаёт новые данные, так что материализованное представление остаётся в сканируемом состоянии. Если указано <code>WITH NO DATA</code>, новые данные не выдаются, и оно оказывается в не сканируемом состоянии. Указать <code>CONCURRENTLY</code> вместе с <code>WITH NO DATA</code> нельзя.</p>
</div>
<div class="paragraph">
<p><strong>Параметры</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CONCURRENTLY</code> - обновить материализованное представление, не блокируя параллельные выборки из него. Без данного параметра обновление, затрагивающее много строк, обычно задействует меньше ресурсов и выполнится быстрее, но может препятствовать чтению этого материализованного представления другими сеансами. При этом данный режим может быть быстрее при небольшом количестве строк. Данный параметр допускается, только если в материализованном представлении есть хотя бы один индекс <code>UNIQUE</code>, построенный только по именам столбцов и включающий все строки (т.е. это не должен быть индекс по выражению или индекс, содержащий <code>WHERE</code>). Этот параметр нельзя использовать, когда материализованное представление ещё не наполнено. Даже с этим параметром в один момент времени допускается только одно обновление (<code>REFRESH</code>) материализованного представления.</p>
</li>
<li>
<p><code>имя</code> - имя (возможно, дополненное схемой) материализованного представления, подлежащего обновлению.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_функции_2">6.7.5. Функции</h4>
<div class="paragraph">
<p><strong>Функция</strong> — это многократно используемый блок кода SQL, который возвращает скалярное значение списка записей.</p>
</div>
<div class="paragraph">
<div class="title">Функции</div>
<p><span class="image"><img src="../assets/img/sql/bd-object/postgresql-functions.png" alt="postgresql functions"></span></p>
</div>
<div class="sect4">
<h5 id="_создание_функции_create_function">Создание функции (<code>CREATE FUNCTION</code>)</h5>
<div class="paragraph">
<p>Чтобы заменить текущее определение существующей функции, используется команда <code>CREATE OR REPLACE FUNCTION</code>. Но следует учесть, что она не позволяет изменить имя или аргументы функции (если попытаться сделать это, на самом деле будет создана новая, независимая функция). Кроме того, <code>CREATE OR REPLACE FUNCTION</code> не позволит изменить тип результата существующей функции. Чтобы сделать это, придётся удалить функцию и создать её заново. Если удалить и затем вновь создавать функцию, новая функция станет другой сущностью, отличной от старой - потребуется так же удалить существующие правила, представления, триггеры, ссылающиеся на старую функцию. Поэтому, чтобы изменить определение функции, сохраняя ссылающиеся на неё объекты, следует использовать <code>CREATE OR REPLACE FUNCTION</code>.</p>
</div>
<div class="paragraph">
<p>Владельцем функции становится создавший её пользователь. Чтобы создать функцию, необходимо иметь право <code>USAGE</code> для типов её аргументов и возвращаемого типа.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="p">[</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="p">]</span> <span class="k">FUNCTION</span>
    <span class="err">имя</span> <span class="p">(</span> <span class="p">[</span> <span class="p">[</span> <span class="err">режим</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="p">[</span> <span class="err">имя</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="err">тип</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">[</span> <span class="err">{</span> <span class="k">DEFAULT</span> <span class="o">|</span>
<span class="o">=</span> <span class="err">}</span> <span class="err">выражение</span><span class="n">_</span><span class="err">по</span><span class="n">_</span><span class="err">умолчанию</span> <span class="p">]</span> <span class="p">[,</span> <span class="p">...]</span> <span class="p">]</span> <span class="p">)</span>
    <span class="p">[</span> <span class="k">RETURNS</span> <span class="err">тип</span><span class="n">_</span><span class="err">результата</span>
    <span class="o">|</span> <span class="k">RETURNS</span> <span class="k">TABLE</span> <span class="p">(</span> <span class="err">имя</span><span class="n">_</span><span class="err">столбца</span> <span class="err">тип</span><span class="n">_</span><span class="err">столбца</span> <span class="p">[,</span> <span class="p">...]</span> <span class="p">)</span> <span class="p">]</span>
<span class="err">{</span> <span class="k">LANGUAGE</span> <span class="err">имя</span><span class="n">_</span><span class="err">языка</span>
    <span class="o">|</span> <span class="k">TRANSFORM</span> <span class="err">{</span> <span class="k">FOR</span> <span class="k">TYPE</span> <span class="err">имя</span><span class="n">_</span><span class="err">типа</span> <span class="err">}</span> <span class="p">[,</span> <span class="p">...</span> <span class="p">]</span>
    <span class="o">|</span> <span class="n">WINDOW</span>
    <span class="o">|</span> <span class="err">{</span> <span class="k">IMMUTABLE</span> <span class="o">|</span> <span class="k">STABLE</span> <span class="o">|</span> <span class="k">VOLATILE</span> <span class="err">}</span>
    <span class="o">|</span> <span class="p">[</span> <span class="k">NOT</span> <span class="p">]</span> <span class="n">LEAKPROOF</span>
    <span class="o">|</span> <span class="err">{</span> <span class="k">CALLED</span> <span class="k">ON</span> <span class="k">NULL</span> <span class="k">INPUT</span> <span class="o">|</span> <span class="k">RETURNS</span> <span class="k">NULL</span> <span class="k">ON</span> <span class="k">NULL</span> <span class="k">INPUT</span> <span class="o">|</span> <span class="k">STRICT</span> <span class="err">}</span>
    <span class="o">|</span> <span class="err">{</span> <span class="p">[</span> <span class="k">EXTERNAL</span> <span class="p">]</span> <span class="k">SECURITY</span> <span class="k">INVOKER</span> <span class="o">|</span> <span class="p">[</span> <span class="k">EXTERNAL</span> <span class="p">]</span> <span class="k">SECURITY</span> <span class="k">DEFINER</span> <span class="err">}</span>
    <span class="o">|</span> <span class="n">PARALLEL</span> <span class="err">{</span> <span class="n">UNSAFE</span> <span class="o">|</span> <span class="n">RESTRICTED</span> <span class="o">|</span> <span class="n">SAFE</span> <span class="err">}</span>
    <span class="o">|</span> <span class="n">COST</span> <span class="err">стоимость</span><span class="n">_</span><span class="err">выполнения</span>
    <span class="o">|</span> <span class="k">ROWS</span> <span class="err">строк</span><span class="n">_</span><span class="err">в</span><span class="n">_</span><span class="err">результате</span>
    <span class="o">|</span> <span class="n">SUPPORT</span> <span class="err">вспомогательная</span><span class="n">_</span><span class="err">функция</span>
    <span class="o">|</span> <span class="k">SET</span> <span class="err">параметр</span><span class="n">_</span><span class="err">конфигурации</span> <span class="err">{</span> <span class="k">TO</span> <span class="err">значение</span> <span class="o">|</span> <span class="o">=</span> <span class="err">значение</span> <span class="o">|</span> <span class="k">FROM</span> <span class="k">CURRENT</span> <span class="err">}</span>
    <span class="o">|</span> <span class="k">AS</span> <span class="s1">'определение'</span>
    <span class="o">|</span> <span class="k">AS</span> <span class="s1">'объектный_файл'</span><span class="p">,</span> <span class="s1">'объектный_символ'</span>
<span class="err">}</span> <span class="p">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Основные параметры</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>имя</code> - имя создаваемой функции (возможно, дополненное схемой).</p>
</li>
<li>
<p><code>режим_аргумента</code> - режим аргумента: <code>IN</code> (входной), <code>OUT</code> (выходной), <code>INOUT</code> (входной и выходной) или <code>VARIADIC</code> (переменный). По умолчанию подразумевается <code>IN</code>. За единственным аргументом <code>VARIADIC</code> могут следовать только аргументы <code>OUT</code>. Кроме того, аргументы <code>OUT</code> и <code>INOUT</code> нельзя использовать с предложением <code>RETURNS TABLE</code>.</p>
</li>
<li>
<p><code>имя_аргумента</code> - имя аргумента.</p>
</li>
<li>
<p><code>тип_аргумента</code> - тип данных аргумента функции (возможно, дополненный схемой), при наличии аргументов. Тип аргументов может быть базовым, составным или доменным, либо это может быть ссылка на столбец таблицы.</p>
</li>
<li>
<p><code>выражение_по_умолчанию</code> - выражение, используемое для вычисления значения по умолчанию, если параметр не задан явно. Результат выражения должен сводиться к типу соответствующего параметра.</p>
</li>
<li>
<p><code>тип_результата</code> - тип возвращаемых данных (возможно, дополненный схемой). Это может быть базовый, составной или доменный тип, либо ссылка на тип столбца таблицы.</p>
</li>
<li>
<p><code>имя_столбца</code> - имя выходного столбца в записи <code>RETURNS TABLE</code>.</p>
</li>
<li>
<p><code>тип_столбца</code> - тип данных выходного столбца в записи <code>RETURNS TABLE</code>.</p>
</li>
<li>
<p><code>имя_языка</code> - имя языка, на котором реализована функция.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Пример</strong>:</p>
</div>
<div class="listingblock">
<div class="title">Пример создания функции на языке <code>SQL</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="k">add</span><span class="p">(</span><span class="nb">integer</span><span class="p">,</span> <span class="nb">integer</span><span class="p">)</span> <span class="k">RETURNS</span> <span class="nb">integer</span>
    <span class="k">AS</span> <span class="s1">'select $1 + $2;'</span>
    <span class="k">LANGUAGE</span> <span class="k">SQL</span>
    <span class="k">IMMUTABLE</span>
    <span class="k">RETURNS</span> <span class="k">NULL</span> <span class="k">ON</span> <span class="k">NULL</span> <span class="k">INPUT</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Пример создания функции на языке <code>PL/pgSQL</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="k">add</span><span class="p">(</span><span class="nb">integer</span><span class="p">,</span> <span class="nb">integer</span><span class="p">)</span> <span class="k">RETURNS</span> <span class="nb">integer</span> <span class="k">AS</span> <span class="err">$$</span>
    <span class="k">BEGIN</span>
    <span class="k">RETURN</span> <span class="err">$</span><span class="mi">1</span> <span class="o">+</span> <span class="err">$</span><span class="mi">2</span><span class="p">;</span>
    <span class="k">END</span><span class="p">;</span> <span class="err">$$</span>
    <span class="k">LANGUAGE</span> <span class="n">plpgsql</span>
    <span class="k">IMMUTABLE</span>
    <span class="k">RETURNS</span> <span class="k">NULL</span> <span class="k">ON</span> <span class="k">NULL</span> <span class="k">INPUT</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Вызов функции <code>add</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="k">add</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">12</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ответом функции будет значение <code>112</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_удаление_функции_drop_function">Удаление функции (<code>DROP FUNCTION</code>)</h5>
<div class="paragraph">
<p><code>DROP FUNCTION</code> удаляет определение существующей функции. Пользователь, выполняющий эту команду, должен быть владельцем функции. Помимо имени функции требуется указать типы её аргументов, так как в базе данных могут существовать несколько функций с одним именем, но с разными списками аргументов.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">FUNCTION</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span> <span class="p">[</span> <span class="p">(</span> <span class="p">[</span> <span class="p">[</span> <span class="err">режим</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="p">[</span> <span class="err">имя</span><span class="n">_</span><span class="err">аргумента</span>
<span class="p">]</span> <span class="err">тип</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">[,</span> <span class="p">...]</span> <span class="p">]</span> <span class="p">)</span> <span class="p">]</span> <span class="p">[,</span> <span class="p">...]</span>
<span class="p">[</span> <span class="k">CASCADE</span> <span class="o">|</span> <span class="k">RESTRICT</span> <span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Параметры</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>имя</code> - имя существующей функции (возможно, дополненное схемой). Если список аргументов не указан, имя функции должно быть уникальным в её схеме.</p>
</li>
<li>
<p><code>режим_аргумента</code> - режим аргумента: <code>IN</code>, <code>OUT</code>, <code>INOUT</code> или <code>VARIADIC</code>. По умолчанию подразумевается <code>IN</code>. Заметьте, что <code>DROP FUNCTION</code> не учитывает аргументы <code>OUT</code>, так как для идентификации функции нужны только типы входных аргументов.
Поэтому достаточно перечислить только аргументы <code>IN</code>, <code>INOUT</code> и <code>VARIADIC</code>.</p>
</li>
<li>
<p><code>имя_аргумента</code> - имя аргумента.</p>
</li>
<li>
<p><code>тип_аргумента</code> - тип данных аргументов функции (возможно, дополненный именем схемы), если таковые имеются.</p>
</li>
<li>
<p><code>CASCADE</code> - автоматически удалять объекты, зависящие от данной функции (например, операторы или триггеры), и, в свою очередь, все зависящие от них объекты.</p>
</li>
<li>
<p><code>RESTRICT</code> - отказать в удалении функции, если от неё зависят какие-либо объекты. Это поведение по умолчанию.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_изменить_определение_функции_alter_function">Изменить определение функции (<code>ALTER FUNCTION</code>)</h5>
<div class="paragraph">
<p><code>ALTER FUNCTION</code> позволяет изменить определение функции</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">FUNCTION</span> <span class="err">имя</span> <span class="p">[</span> <span class="p">(</span> <span class="p">[</span> <span class="p">[</span> <span class="err">режим</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="p">[</span> <span class="err">имя</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="err">тип</span><span class="n">_</span><span class="err">аргумента</span>
<span class="p">[,</span> <span class="p">...]</span> <span class="p">]</span> <span class="p">)</span> <span class="p">]</span>
<span class="err">действие</span> <span class="p">[</span> <span class="p">...</span> <span class="p">]</span> <span class="p">[</span> <span class="k">RESTRICT</span> <span class="p">]</span>

<span class="k">ALTER</span> <span class="k">FUNCTION</span> <span class="err">имя</span> <span class="p">[</span> <span class="p">(</span> <span class="p">[</span> <span class="p">[</span> <span class="err">режим</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="p">[</span> <span class="err">имя</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="err">тип</span><span class="n">_</span><span class="err">аргумента</span>
<span class="p">[,</span> <span class="p">...]</span> <span class="p">]</span> <span class="p">)</span> <span class="p">]</span>
<span class="k">RENAME</span> <span class="k">TO</span> <span class="err">новое</span><span class="n">_</span><span class="err">имя</span>

<span class="k">ALTER</span> <span class="k">FUNCTION</span> <span class="err">имя</span> <span class="p">[</span> <span class="p">(</span> <span class="p">[</span> <span class="p">[</span> <span class="err">режим</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="p">[</span> <span class="err">имя</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="err">тип</span><span class="n">_</span><span class="err">аргумента</span>
<span class="p">[,</span> <span class="p">...]</span> <span class="p">]</span> <span class="p">)</span> <span class="p">]</span>
<span class="k">OWNER</span> <span class="k">TO</span> <span class="err">{</span> <span class="err">новый</span><span class="n">_</span><span class="err">владелец</span> <span class="o">|</span> <span class="k">CURRENT_USER</span> <span class="o">|</span> <span class="k">SESSION_USER</span> <span class="err">}</span>

<span class="k">ALTER</span> <span class="k">FUNCTION</span> <span class="err">имя</span> <span class="p">[</span> <span class="p">(</span> <span class="p">[</span> <span class="p">[</span> <span class="err">режим</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="p">[</span> <span class="err">имя</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="err">тип</span><span class="n">_</span><span class="err">аргумента</span>
<span class="p">[,</span> <span class="p">...]</span> <span class="p">]</span> <span class="p">)</span> <span class="p">]</span>
<span class="k">SET</span> <span class="k">SCHEMA</span> <span class="err">новая</span><span class="n">_</span><span class="err">схема</span>

<span class="k">ALTER</span> <span class="k">FUNCTION</span> <span class="err">имя</span> <span class="p">[</span> <span class="p">(</span> <span class="p">[</span> <span class="p">[</span> <span class="err">режим</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="p">[</span> <span class="err">имя</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="err">тип</span><span class="n">_</span><span class="err">аргумента</span>
<span class="p">[,</span> <span class="p">...]</span> <span class="p">]</span> <span class="p">)</span> <span class="p">]</span>
<span class="p">[</span> <span class="k">NO</span> <span class="p">]</span> <span class="n">DEPENDS</span> <span class="k">ON</span> <span class="n">EXTENSION</span> <span class="err">имя</span><span class="n">_</span><span class="err">расширения</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Примеры</strong>:</p>
</div>
<div class="listingblock">
<div class="title">Переименование функции</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">FUNCTION</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">integer</span><span class="p">)</span> <span class="k">RENAME</span> <span class="k">TO</span> <span class="n">square_root</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Смена владельца функции</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">FUNCTION</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">integer</span><span class="p">)</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">joe</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_хранимые_процедуры">6.7.6. Хранимые процедуры</h4>
<div class="paragraph">
<p>Когда с данными нужно делать одни и те же действия очень часто на помощь приходят процедуры.</p>
</div>
<div class="paragraph">
<p><strong>Процедуры</strong> (<strong>procedure</strong>) - это блок операторов написанных на процедурном расширении языка <code>SQL</code> в контексте конкретной <strong>СУБД</strong>. Процедуры хранятся в базе данных в специально приспособленных для этого системных таблицах. Процедуры и функции могут быть вызваны на использование внутри базы данных или из клиентского приложения, но не возвращают результат, а функции возвращают.</p>
</div>
<div class="paragraph">
<p>Процедура является объектом базы данных, подобный функции, но имеющий следующие отличия:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Процедуры определяются командой <code>CREATE PROCEDURE</code>.</p>
</li>
<li>
<p>Процедуры, в отличие от функций, не возвращают значение; поэтому в <code>CREATE PROCEDURE</code> отсутствует предложение <code>RETURNS</code>. Однако процедуры могут выдавать данные в вызывающий код через выходные параметры.</p>
</li>
<li>
<p>Процедуры вызываются отдельно командой <code>CALL</code>.</p>
</li>
<li>
<p>Процедура, в отличие от функции, может фиксировать или откатывать транзакции во время её выполнения, а затем автоматически начинать новую транзакцию, если вызывающая команда <code>CALL</code> находится не в явном блоке транзакции.</p>
</li>
<li>
<p>Некоторые атрибуты функций (например, <code>STRICT</code>) неприменимы к процедурам.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_создание_процедуры_create_procedure">Создание процедуры (<code>CREATE PROCEDURE</code>)</h5>
<div class="listingblock">
<div class="title">Синтаксис создания процедуры</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="p">[</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="p">]</span> <span class="k">PROCEDURE</span>
    <span class="err">имя</span> <span class="p">(</span> <span class="p">[</span> <span class="p">[</span> <span class="err">режим</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="p">[</span> <span class="err">имя</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="err">тип</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">[</span>   <span class="err">{</span> <span class="k">DEFAULT</span> <span class="o">|</span>
    <span class="o">=</span> <span class="err">}</span> <span class="err">выражение</span><span class="n">_</span><span class="err">по</span><span class="n">_</span><span class="err">умолчанию</span> <span class="p">]</span> <span class="p">[,</span> <span class="p">...]</span> <span class="p">]</span> <span class="p">)</span>
 <span class="err">{</span> <span class="k">LANGUAGE</span> <span class="err">имя</span><span class="n">_</span><span class="err">языка</span>
    <span class="o">|</span> <span class="k">TRANSFORM</span> <span class="err">{</span> <span class="k">FOR</span> <span class="k">TYPE</span> <span class="err">имя</span><span class="n">_</span><span class="err">типа</span> <span class="err">}</span> <span class="p">[,</span> <span class="p">...</span> <span class="p">]</span>
    <span class="o">|</span> <span class="p">[</span> <span class="k">EXTERNAL</span> <span class="p">]</span> <span class="k">SECURITY</span> <span class="k">INVOKER</span> <span class="o">|</span> <span class="p">[</span> <span class="k">EXTERNAL</span> <span class="p">]</span> <span class="k">SECURITY</span> <span class="k">DEFINER</span>
    <span class="o">|</span> <span class="k">SET</span> <span class="err">параметр</span><span class="n">_</span><span class="err">конфигурации</span> <span class="err">{</span> <span class="k">TO</span> <span class="err">значение</span> <span class="o">|</span> <span class="o">=</span> <span class="err">значение</span> <span class="o">|</span> <span class="k">FROM</span>   <span class="k">CURRENT</span> <span class="err">}</span>
    <span class="o">|</span> <span class="k">AS</span> <span class="s1">'определение'</span>
    <span class="o">|</span> <span class="k">AS</span> <span class="s1">'объектный_файл'</span><span class="p">,</span> <span class="s1">'объектный_символ'</span>
 <span class="err">}</span> <span class="p">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Команда <code>CREATE PROCEDURE</code> определяет новую процедуру, в то же время <code>CREATE OR REPLACE PROCEDURE</code> создаёт новую процедуру либо заменяет определение уже существующей.</p>
</div>
<div class="paragraph">
<p>Чтобы определить процедуру, необходимо иметь право <code>USAGE</code> для соответствующего языка. Если указано имя схемы, процедура создаётся в заданной схеме, в противном случае — в текущей. Имя новой процедуры должно отличаться от имён существующих процедур и функций с такими же типами аргументов в этой схеме. Однако процедуры и функции с аргументами разных типов могут иметь одно имя (это называется перегрузкой).</p>
</div>
<div class="paragraph">
<p>Команда <code>CREATE OR REPLACE PROCEDURE</code> предназначена для изменения текущего определения существующей процедуры. С её помощью нельзя изменить имя или типы аргументов (если попытаться сделать это, будет создана новая отдельная процедура). Когда команда <code>CREATE OR REPLACE PROCEDURE</code> заменяет существующую процедуру, владелец и права доступа к этой процедуре не меняются. Все другие свойства процедуры получают значения, задаваемые командой явно или по умолчанию. Чтобы заменить процедуру, необходимо быть её владельцем (или быть членом роли-владельца). Владельцем процедуры становится создавший её пользователь. Чтобы создать процедуру, необходимо иметь право <code>USAGE</code> для типов её аргументов.</p>
</div>
<div class="paragraph">
<p><strong>Параметры</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>имя</code> - имя создаваемой процедуры.</p>
</li>
<li>
<p><code>режим_аргумента</code> - режим аргумента: <code>IN</code>, <code>INOUT</code> или <code>VARIADIC</code>. По умолчанию подразумевается <code>IN</code>. (Режим <code>OUT</code> для процедур в настоящее время не поддерживается. Используйте вместо него <code>INOUT</code>).</p>
</li>
<li>
<p><code>имя_аргумента</code> - имя аргумента.</p>
</li>
<li>
<p><code>тип_аргумента</code> - тип данных аргумента процедуры (возможно, дополненный схемой), при наличии аргументов. Тип аргументов может быть базовым, составным или доменным, либо это может быть ссылка на столбец таблицы.</p>
</li>
<li>
<p><code>выражение_по_умолчанию</code> - выражение, используемое для вычисления значения по умолчанию, если параметр не задан явно. Результат выражения должен сводиться к типу соответствующего параметра. Для всех входных параметров, следующих за параметром с определённым значением по умолчанию, также должны быть определены значения по умолчанию.</p>
</li>
<li>
<p><code>имя_языка</code> - имя языка, на котором реализована функция.</p>
</li>
<li>
<p><code>TRANSFORM { FOR TYPE имя_типа } [, &#8230;&#8203; ] }</code> - устанавливает список трансформаций, которые должны применяться при вызове процедуры. Трансформации выполняют преобразования между типами <code>SQL</code> и типами данных, специфичными для языков. Преобразования встроенных типов обычно жёстко предопределены в реализациях процедурных языков, так что их здесь указывать не нужно. Если реализация процедурного языка не может обработать тип и трансформация для него отсутствует, будет выполнено преобразование типов по умолчанию, но это зависит от реализации.</p>
</li>
<li>
<p><code>[EXTERNAL] SECURITY INVOKER</code> / <code>[EXTERNAL] SECURITY DEFINER</code> - характеристика <code>SECURITY INVOKER</code> (безопасность вызывающего) показывает, что процедура будет выполняться с правами пользователя, вызвавшего её. Этот вариант подразумевается по умолчанию. Вариант <code>SECURITY DEFINER</code> (безопасность определившего) обозначает, что процедура выполняется с правами пользователя, владеющего ей. Ключевое слово <code>EXTERNAL</code> допускается для соответствия стандарту <code>SQL</code>, но является необязательным, так как, в отличие от <code>SQL</code>, эта характеристика распространяется на все процедуры, а не только внешние. В процедуре с характеристикой <code>SECURITY DEFINER</code> не могут выполняться операторы управления транзакциями (например, <code>COMMIT</code> и <code>ROLLBACK</code> в некоторых языках).</p>
</li>
<li>
<p><code>параметр_конфигурации</code> \ <code>значение</code> - предложение <code>SET</code> определяет, что при вызове процедуры указанный параметр конфигурации должен принять заданное значение, а затем восстановить своё предыдущее значение при завершении процедуры. Предложение <code>SET FROM CURRENT</code> сохраняет в качестве значения, которое будет применено при входе в процедуру, значение, действующее в момент выполнения <code>CREATE PROCEDURE</code>. Если в определение процедуры добавлено <code>SET</code>, то действие команды <code>SET LOCAL</code>, выполняемой внутри процедуры для того же параметра, ограничивается телом процедуры: предыдущее значение параметра так же будет восстановлено при завершении процедуры. Однако обычная команда <code>SET</code> (без <code>LOCAL</code>) переопределяет предложение <code>SET</code>, как и предыдущую команду <code>SET LOCAL</code>: действие такой команды будет сохранено и после завершения процедуры, если только не произойдёт откат транзакции. Если к определению процедуры добавлено <code>SET</code>, то в этой процедуре не могут выполняться операторы управления транзакциями (например, <code>COMMIT</code> и <code>ROLLBACK</code> в некоторых языках).</p>
</li>
<li>
<p><code>определение</code> - строковая константа, определяющая реализацию процедуры; её значение зависит от языка. Это может быть имя внутренней процедуры, путь к объектному файлу, команда <code>SQL</code> или код на процедурном языке. Часто бывает полезно заключать определение процедуры в доллары, а не в традиционные апострофы. Если не использовать доллары, все апострофы и обратные косые черты в определении процедуры придётся экранировать, дублируя их.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Пример</strong></p>
</div>
<div class="listingblock">
<div class="title">Пример создания процедуры</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">insert_data</span><span class="p">(</span><span class="n">a</span> <span class="nb">integer</span><span class="p">,</span> <span class="n">b</span> <span class="nb">varchar</span><span class="p">)</span>
    <span class="k">LANGUAGE</span> <span class="k">SQL</span>
    <span class="k">AS</span> <span class="err">$$</span>
    <span class="k">insert</span> <span class="k">into</span> <span class="k">table_name</span> <span class="k">VALUES</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
    <span class="err">$$</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Процедура <code>insert_data</code> после вызова, занесет в таблицу значения <code>a</code> и <code>b</code>.</p>
</div>
<div class="paragraph">
<p>Чтобы вызвать процедуру, воспользуйтесь командой <code>CALL</code>:</p>
</div>
<div class="listingblock">
<div class="title">Вызов процедуры</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CALL</span> <span class="n">insert_data</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'data'</span><span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_удаление_процедуры_drop_procedure">Удаление процедуры (<code>DROP PROCEDURE</code>)</h5>
<div class="paragraph">
<p>Чтобы удалить процедуры, необходимо воспользоваться командой <code>DROP PROCEDURE</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">PROCEDURE</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span> <span class="p">[</span> <span class="p">(</span> <span class="p">[</span> <span class="p">[</span> <span class="err">режим</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="p">[</span> <span class="err">имя</span><span class="n">_</span><span class="err">аргумента</span>
 <span class="p">]</span> <span class="err">тип</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">[,</span> <span class="p">...]</span> <span class="p">]</span> <span class="p">)</span> <span class="p">]</span> <span class="p">[,</span> <span class="p">...]</span>
 <span class="p">[</span> <span class="k">CASCADE</span> <span class="o">|</span> <span class="k">RESTRICT</span> <span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>DROP PROCEDURE</code> удаляет определение существующей процедуры. Пользователь, выполняющий эту команду, должен быть владельцем процедуры. Помимо имени процедуры требуется указать типы её аргументов, так как в базе данных могут существовать несколько процедур с одним именем, но с разными списками аргументов.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Параметры</strong>:</p>
</li>
<li>
<p><code>IF EXISTS</code> - не считать ошибкой, если процедура не существует. В этом случае будет выдано замечание.</p>
</li>
<li>
<p><code>имя</code> - имя существующей процедуры (возможно, дополненное схемой). Если список аргументов не указан, имя процедуры должно быть уникальным в её схеме.</p>
</li>
<li>
<p><code>режим_аргумента</code> - режим аргумента: <code>IN</code> или <code>VARIADIC</code>. По умолчанию подразумевается <code>IN</code>.</p>
</li>
<li>
<p><code>имя_аргумента</code> - имя аргумента.</p>
</li>
<li>
<p><code>тип_аргумента</code> - тип данных аргументов процедуры (возможно, дополненный именем схемы), если таковые имеются.</p>
</li>
<li>
<p><code>CASCADE</code> - автоматически удалять объекты, зависящие от данной процедуры, и, в свою очередь, все зависящие от них объекты.</p>
</li>
<li>
<p><code>RESTRICT</code> - отказать в удалении процедуры, если от неё зависят какие-либо объекты. Это поведение по умолчанию.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_изменение_процедуры_alter_procedure">Изменение процедуры (<code>ALTER PROCEDURE</code>)</h5>
<div class="paragraph">
<p><code>ALTER PROCEDURE</code> позволяет изменить определение процедуры. Выполнить <code>ALTER PROCEDURE</code> может только владелец процедуры. Чтобы сменить схему процедуры, необходимо также иметь право <code>CREATE</code> в новой схеме. Чтобы сменить владельца, требуется также быть непосредственным или опосредованным членом новой роли, а эта роль должна иметь право <code>CREATE</code> в схеме представления.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">PROCEDURE</span> <span class="err">имя</span> <span class="p">[</span> <span class="p">(</span> <span class="p">[</span> <span class="p">[</span> <span class="err">режим</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="p">[</span> <span class="err">имя</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="err">тип</span><span class="n">_</span><span class="err">аргумента</span>
<span class="p">[,</span> <span class="p">...]</span> <span class="p">]</span> <span class="p">)</span> <span class="p">]</span>
<span class="err">действие</span> <span class="p">[</span> <span class="p">...</span> <span class="p">]</span> <span class="p">[</span> <span class="k">RESTRICT</span> <span class="p">]</span>

<span class="k">ALTER</span> <span class="k">PROCEDURE</span> <span class="err">имя</span> <span class="p">[</span> <span class="p">(</span> <span class="p">[</span> <span class="p">[</span> <span class="err">режим</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="p">[</span> <span class="err">имя</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="err">тип</span><span class="n">_</span><span class="err">аргумента</span>
<span class="p">[,</span> <span class="p">...]</span> <span class="p">]</span> <span class="p">)</span> <span class="p">]</span>
<span class="k">RENAME</span> <span class="k">TO</span> <span class="err">новое</span><span class="n">_</span><span class="err">имя</span>

<span class="k">ALTER</span> <span class="k">PROCEDURE</span> <span class="err">имя</span> <span class="p">[</span> <span class="p">(</span> <span class="p">[</span> <span class="p">[</span> <span class="err">режим</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="p">[</span> <span class="err">имя</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="err">тип</span><span class="n">_</span><span class="err">аргумента</span>
<span class="p">[,</span> <span class="p">...]</span> <span class="p">]</span> <span class="p">)</span> <span class="p">]</span>
<span class="k">OWNER</span> <span class="k">TO</span> <span class="err">{</span> <span class="err">новый</span><span class="n">_</span><span class="err">владелец</span> <span class="o">|</span> <span class="k">CURRENT_USER</span> <span class="o">|</span> <span class="k">SESSION_USER</span> <span class="err">}</span>

<span class="k">ALTER</span> <span class="k">PROCEDURE</span> <span class="err">имя</span> <span class="p">[</span> <span class="p">(</span> <span class="p">[</span> <span class="p">[</span> <span class="err">режим</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="p">[</span> <span class="err">имя</span><span class="n">_</span><span class="err">аргумента</span> <span class="p">]</span> <span class="err">тип</span><span class="n">_</span><span class="err">аргумента</span>
<span class="p">[,</span> <span class="p">...]</span> <span class="p">]</span> <span class="p">)</span> <span class="p">]</span>
<span class="k">SET</span> <span class="k">SCHEMA</span> <span class="err">новая</span><span class="n">_</span><span class="err">схема</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Где действие может быть следующим:</p>
</div>
<div class="listingblock">
<div class="title">Возможные действия</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SET</span> <span class="err">параметр</span><span class="n">_</span><span class="err">конфигурации</span> <span class="err">{</span> <span class="k">TO</span> <span class="o">|</span> <span class="o">=</span> <span class="err">}</span> <span class="err">{</span> <span class="err">значение</span> <span class="o">|</span> <span class="k">DEFAULT</span> <span class="err">}</span>

<span class="k">SET</span> <span class="err">параметр</span><span class="n">_</span><span class="err">конфигурации</span> <span class="k">FROM</span> <span class="k">CURRENT</span>

<span class="k">RESET</span> <span class="err">параметр</span><span class="n">_</span><span class="err">конфигурации</span>

<span class="k">RESET</span> <span class="k">ALL</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Параметры</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>новое_имя</code> - новое имя процедуры.</p>
</li>
<li>
<p><code>новый_владелец</code> - новый владелец процедуры. Заметьте, что если процедура помечена как <code>SECURITY DEFINER</code>, в дальнейшем она будет выполняться от имени нового владельца.</p>
</li>
<li>
<p><code>новая_схема</code> - новая схема процедуры.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Переименование процедуры <code>procedure_name</code> с двумя аргументами типа <code>integer</code> в <code>new_procedure_name</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">PROCEDURE</span> <span class="n">procedure_name</span><span class="p">(</span><span class="nb">integer</span><span class="p">,</span> <span class="nb">integer</span><span class="p">)</span> <span class="k">RENAME</span> <span class="k">TO</span> <span class="n">new_procedure_name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Смена владельца процедуры <code>procedure_name</code> с двумя аргументами типа <code>integer</code> на <code>user_name</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">PROCEDURE</span> <span class="n">procedure_name</span><span class="p">(</span><span class="nb">integer</span><span class="p">,</span> <span class="nb">integer</span><span class="p">)</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="n">user_name</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_триггеры">6.7.7. Триггеры</h4>
<div class="paragraph">
<p><strong>Триггер</strong> (<strong>trigger)</strong> - процедура, отличается от обычной тем, что она вызывается автоматически, при некотором событии в базе данных. Триггеры применяются для гарантированного выполнения определенных действий при возникновении событий. Триггеры носят глобальный характер и не зависят от причин и способов появления событий, на который они срабатывают.</p>
</div>
<div class="paragraph">
<p>Триггерные функции могут быть написаны на большинстве доступных процедурных языков,  включая <strong>PL/pgSQL</strong>, <strong>PL/Tcl</strong>, <strong>PL/Perl</strong> и <strong>PL/Python</strong>. В настоящее время невозможно написать  триггерную функцию на чистом <strong>SQL</strong>.</p>
</div>
<div class="paragraph">
<div class="title">Триггеры</div>
<p><span class="image"><img src="../assets/img/sql/bd-object/postgresql-triggers.png" alt="postgresql triggers"></span></p>
</div>
<div class="paragraph">
<p>В <strong>PostgreSQL</strong> триггеры создаются на основе существующих функции, т.е. сначала командой <code>CREATE FUNCTION</code> определяется триггерная функция, затем на ее основе командой <code>CREATE TRIGGER</code> определяется собственно триггер.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис определения триггера</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TRIGGER</span> <span class="err">триггер</span>
    <span class="err">{</span> <span class="k">BEFORE</span> <span class="o">|</span> <span class="k">AFTER</span> <span class="err">}</span> <span class="err">{</span> <span class="err">событие</span> <span class="p">[</span> <span class="k">OR</span> <span class="err">событие</span> <span class="p">]</span> <span class="err">}</span> <span class="k">ON</span> <span class="err">таблица</span>
    <span class="k">FOR</span> <span class="k">EACH</span> <span class="err">{</span> <span class="k">ROW</span> <span class="o">|</span>  <span class="k">STATEMENT</span> <span class="err">}</span>
    <span class="k">WHEN</span><span class="p">(</span><span class="err">условие</span><span class="p">)</span>
    <span class="k">EXECUTE</span> <span class="k">PROCEDURE</span> <span class="err">функция</span> <span class="p">(</span> <span class="err">аргументы</span> <span class="p">);</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Параметры</strong>:</p>
</li>
<li>
<p><code>{ BEFORE | AFTER }</code> - ключевое слово <code>BEFORE</code> означает, что функция должна выполняться перед попыткой выполнения операции, включая все встроенные проверки ограничений данных, реализуемые при выполнении команд <code>INSERT</code> и <code>DELETE</code>. Ключевое слово <code>AFTER</code> означает, что функция вызывается после завершения операции, приводящей в действие триггер.</p>
</li>
<li>
<p><code>{ событие [ OR событие &#8230;&#8203; ] }</code> - события, поддерживаемые в <strong>PostgreSQL</strong>: <code>INSERT</code>, <code>UPDATE</code> или <code>DELETE</code>. При перечислении нескольких событий в качестве разделителя используется ключевое слово <code>OR</code>.</p>
</li>
<li>
<p><code>FOR EACH { ROW | STATEMENT }</code> - ключевое слово, следующее за конструкцией <code>FOR EACH</code> и определяющее количество вызовов функции при наступлении указанного события. Ключевое слово <code>ROW</code> означает, что функция вызывается для каждой модифицируемой записи. Если функция должна вызываться всего один раз для всей команды, используется ключевое слово <code>STATEMENT</code>.</p>
</li>
<li>
<p><code>WHEN</code> - необязательный параметр. В определении триггера можно указать логическое условие <code>WHEN</code>, которое определит, вызывать триггер или нет. В триггерах на уровне строк условия <code>WHEN</code> могут проверять старые и/или новые значения столбцов в строке. Триггеры на уровне оператора так же могут содержать условие <code>WHEN</code>, хотя для них это не столь полезно, так как в этом условии нельзя ссылаться на какие-либо значения в таблице.</p>
</li>
<li>
<p><code>EXECUTE PROCEDURE функция ( аргументы )</code>- имя вызываемой функции с аргументами. На практике аргументы при вызове триггерных функций не используются.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Синтаксис определения триггерной функции</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="err">функция</span> <span class="p">()</span> <span class="k">RETURNS</span> <span class="k">trigger</span> <span class="k">AS</span> <span class="s1">'
    BEGIN
    команды;
    return NEW | OLD;
    END;'</span>
<span class="k">LANGUAGE</span>  <span class="n">plpgsql</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Специальные переменные, доступные в триггерных функциях:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NEW</code> - Новые значения полей записи базы данных, созданной командой <code>INSERT</code> или обновленной командой <code>UPDATE</code>, при срабатывании триггера уровня записи <code>ROW</code>. В триггерах уровня оператора и для команды <code>DELETE</code> эта переменная имеет значение <code>null</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Переменная <code>NEW</code> доступна только при операциях <code>INSERT</code> и <code>UPDATE</code>. Поля записи <code>NEW</code> могут быть изменены триггером. В триггерах уровня оператора и для команды <code>INSERT</code> эта  переменная имеет значение <code>null</code>.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OLD</code> - Старые значения полей записи базы данных, содержавшиеся в записи перед выполнением команды <code>DELETE</code> или <code>UPDATE</code> при срабатывании триггера уровня записи <code>ROW</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Переменная <code>OLD</code> доступна только при операциях <code>DELETE</code> и <code>UPDATE</code>. Поля записи <code>OLD</code> можно использовать только для чтения, изменять нельзя.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>К отдельным полям записей <code>NEW</code> и <code>OLD</code> в триггерных процедурах обращаются следующим образом: <code>NEW.names</code>, <code>OLD.rg</code>.</p>
</div>
<div class="paragraph">
<p><strong>Указания по возврату из триггеров:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Триггерная функция должна возвращать <code>NULL</code> или запись, соответствующую структуре таблицы, на которую будет вешаться триггер!</p>
</li>
<li>
<p>Если <code>BEFORE</code>-триггер возвращает <code>NULL</code>, то сама операция и <code>AFTER</code>-триггер будут отменены.</p>
</li>
<li>
<p><code>BEFORE</code>-триггер может изменить строку (<code>INSERT</code> \ <code>UPDATE</code>) через <code>NEW</code> и тогда операция и <code>AFTER</code>-триггеры` будут работать с заменённой строкой.</p>
</li>
<li>
<p>Если <code>BEFORE</code>-триггер` не "хочет" изменять строку, то надо просто вернуть <code>OLD</code>.</p>
</li>
<li>
<p><code>NEW</code> = <code>null</code> при <code>DELETE</code>, так что если <code>BEFORE</code>-триггер хочет дать ход <code>DELETE</code>, надо вернуть <code>OLD</code>.</p>
</li>
<li>
<p>Возвращаемое значение из построчного <code>AFTER</code>-триггера (или из <code>BEFORE</code> и из <code>AFTER</code>-триггеров на утверждения) игнорируется &#8658; можно возвращать <code>NULL</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Пример</strong>:</p>
</div>
<div class="listingblock">
<div class="title">Создаем триггер</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TRIGGER</span> <span class="n">tr</span>
    <span class="k">AFTER</span>
    <span class="k">INSERT</span> <span class="k">ON</span> <span class="k">table_name</span>
    <span class="k">FOR</span> <span class="k">EACH</span> <span class="k">ROW</span>
    <span class="k">EXECUTE</span> <span class="k">PROCEDURE</span> <span class="n">func</span><span class="p">();</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Создаем функцию</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">FUNCTION</span> <span class="n">func</span><span class="p">()</span> <span class="k">RETURNS</span> <span class="k">trigger</span> <span class="k">AS</span> <span class="s1">'
    BEGIN
    delete from table_name where age = 1;
    return NEW;
    END;'</span>
<span class="k">LANGUAGE</span> <span class="n">plpgsql</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>После внесения данных в таблицу <code>table_name</code> вызывается функция <code>func()</code>, которая удалит из таблицы значения <code>age = 1</code>;</p>
</div>
<div class="paragraph">
<p>Если есть несколько триггеров на одно и то же событие для одной и той же таблицы, то они  будут вызываться в алфавитном порядке по имени триггера.</p>
</div>
<div class="sect4">
<h5 id="_удаление_триггера_drop_trigger">Удаление триггера (<code>DROP TRIGGER</code>)</h5>
<div class="paragraph">
<p><code>DROP TRIGGER</code> удаляет существующее определение триггера. Пользователь, выполняющий эту команду, должен быть владельцем таблицы, для которой определён данный триггер.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">TRIGGER</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span> <span class="k">ON</span> <span class="err">имя</span><span class="n">_</span><span class="err">таблицы</span> <span class="p">[</span> <span class="k">CASCADE</span> <span class="o">|</span> <span class="k">RESTRICT</span> <span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Параметры</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IF EXISTS</code> - не считать ошибкой, если триггер не существует. В этом случае будет выдано замечание.</p>
</li>
<li>
<p><code>имя</code> - имя триггера, подлежащего удалению.</p>
</li>
<li>
<p><code>имя_таблицы</code> - имя (возможно, дополненное схемой) таблицы, для которой определён триггер.</p>
</li>
<li>
<p><code>CASCADE</code> - автоматически удалять объекты, зависящие от данного триггера, и, в свою очередь, все зависящие от них объекты.</p>
</li>
<li>
<p><code>RESTRICT</code> - Отказать в удалении триггера, если от него зависят какие-либо объекты. Это поведение по умолчанию.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_изменение_определения_триггера_alter_trigger">Изменение определения триггера (<code>ALTER TRIGGER</code>)</h5>
<div class="paragraph">
<p>Изменять свойства триггера может только владелец таблицы, с которой работает триггер следующим запросом:</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TRIGGER</span> <span class="err">имя</span> <span class="k">ON</span> <span class="err">имя</span><span class="n">_</span><span class="err">таблицы</span> <span class="k">RENAME</span> <span class="k">TO</span> <span class="err">новое</span><span class="n">_</span><span class="err">имя</span>

<span class="k">ALTER</span> <span class="k">TRIGGER</span> <span class="err">имя</span> <span class="k">ON</span> <span class="err">имя</span><span class="n">_</span><span class="err">таблицы</span> <span class="p">[</span> <span class="k">NO</span> <span class="p">]</span> <span class="n">DEPENDS</span> <span class="k">ON</span> <span class="n">EXTENSION</span> <span class="err">имя</span><span class="n">_</span><span class="err">расширения</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Предложение <code>RENAME</code> переименовывает данный триггер, не затрагивая его определение. Предложение <code>DEPENDS ON EXTENSION</code> помечает триггер как зависимый от расширения, так что при удалении расширения будет автоматически удаляться и триггер.</p>
</div>
<div class="paragraph">
<p><strong>Параметры</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Имя</code> - имя существующего триггера, подлежащего изменению.</p>
</li>
<li>
<p><code>Имя_таблицы</code> - имя таблицы, с которой работает триггер.</p>
</li>
<li>
<p><code>Новое_имя</code> - новое имя триггера.</p>
</li>
<li>
<p><code>Имя_расширения</code> - имя расширения, от которого будет зависеть триггер (или не будет, если указано <code>NO</code>).
Триггер, помеченный как зависимый от расширения, автоматически удаляется при удалении расширения.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_последовательности_sequence">6.7.8. Последовательности (<code>Sequence</code>)</h4>
<div class="paragraph">
<p>Последовательности используются для управления столбцами имеющих автоинкремент, которые определены в таблице, как <code>SERIAL</code>.</p>
</div>
<div class="paragraph">
<div class="title">Последовательности (<code>Sequence</code>)</div>
<p><span class="image"><img src="../assets/img/sql/bd-object/postgresql-sequence.png" alt="postgresql sequence"></span></p>
</div>
<div class="sect4">
<h5 id="_создание_последовательности_create_sequence">Создание последовательности (<code>CREATE SEQUENCE</code>)</h5>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="p">[</span> <span class="k">TEMPORARY</span> <span class="o">|</span> <span class="k">TEMP</span> <span class="p">]</span> <span class="n">SEQUENCE</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span>
    <span class="p">[</span> <span class="k">AS</span> <span class="err">тип</span><span class="n">_</span><span class="err">данных</span> <span class="p">]</span>
    <span class="p">[</span> <span class="k">INCREMENT</span> <span class="p">[</span> <span class="k">BY</span> <span class="p">]</span> <span class="err">шаг</span> <span class="p">]</span>
    <span class="p">[</span> <span class="k">MINVALUE</span> <span class="err">мин</span><span class="n">_</span><span class="err">значение</span> <span class="o">|</span> <span class="k">NO</span> <span class="k">MINVALUE</span> <span class="p">]</span> <span class="p">[</span> <span class="k">MAXVALUE</span> <span class="err">макс</span><span class="n">_</span><span class="err">значение</span> <span class="o">|</span> <span class="k">NO</span> <span class="k">MAXVALUE</span> <span class="p">]</span>
    <span class="p">[</span> <span class="k">START</span> <span class="p">[</span> <span class="k">WITH</span> <span class="p">]</span> <span class="err">начало</span> <span class="p">]</span> <span class="p">[</span> <span class="k">CACHE</span> <span class="err">кеш</span> <span class="p">]</span> <span class="p">[</span> <span class="p">[</span> <span class="k">NO</span> <span class="p">]</span> <span class="k">CYCLE</span> <span class="p">]</span>
    <span class="p">[</span> <span class="n">OWNED</span> <span class="k">BY</span> <span class="err">{</span> <span class="err">имя</span><span class="n">_</span><span class="err">таблицы</span><span class="p">.</span><span class="err">имя</span><span class="n">_</span><span class="err">столбца</span> <span class="o">|</span> <span class="k">NONE</span> <span class="err">}</span> <span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Такой запрос создаёт генератор последовательности. Эта операция включает создание и инициализацию специальной таблицы имя, содержащей одну строку. Владельцем генератора будет пользователь, выполняющий эту команду. Если указано имя схемы, последовательность создаётся в заданной схеме, в противном случае — в текущей. Временные последовательности существуют в специальной схеме, так что при создании таких последовательностей имя схемы задать нельзя. Имя последовательности должно отличаться от имён других последовательностей, таблиц, индексов, представлений или сторонних таблиц, уже существующих в этой схеме.</p>
</div>
<div class="paragraph">
<p>Хотя непосредственно изменить значение последовательности нельзя, получить её параметры и текущее состояние можно таким запросом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TEMPORARY</code> или <code>TEMP</code> - если указано, объект последовательности создаётся только для данного сеанса и автоматически удаляется при завершении сеанса. Существующая постоянная последовательность с тем же именем не будут видна (в этом сеансе), пока существует временная, однако к ней можно обратиться, дополнив имя указанием схемы.</p>
</li>
<li>
<p><code>IF NOT EXISTS</code> - не считать ошибкой, если отношение с таким именем уже существует. В этом случае будет выдано замечание. Заметьте, что нет никакой гарантии, что существующее отношение как-то соотносится с последовательностью, которая могла бы быть создана — это может быть даже не последовательность.</p>
</li>
<li>
<p><code>тип_данных</code> - необязательное предложение <code>AS</code> тип_данных задаёт тип данных для последовательности. Допустимые типы: <em>smallint</em>, <em>integer</em> и <em>bigint</em>. По умолчанию устанавливается тип <em>bigint</em>. От типа данных зависят принимаемые по умолчанию минимальное и максимальное значения последовательности.</p>
</li>
<li>
<p><code>шаг</code> - необязательное предложение <code>INCREMENT BY</code> шаг определяет, какое число будет добавляться к текущему значению последовательности для получения нового значения. С положительным шагом последовательность будет возрастающей, а с отрицательным — убывающей. Значение по умолчанию: <code>1</code>.</p>
</li>
<li>
<p><code>мин_значение</code> - Необязательное предложение <code>MINVALUE</code> определяет наименьшее число, которое будет генерировать последовательность. Если это предложение опущено либо указано <code>NO MINVALUE</code>, используется значение по умолчанию: <code>1</code> для возвращающей последовательности или минимальное значение типа данных — для убывающей.</p>
</li>
<li>
<p><code>макс_значения</code> - Необязательное предложение <code>MAXVALUE</code> определяет наибольшее число, которое будет генерировать последовательность. Если это предложение опущено либо указано <code>NO MAXVALUE</code>, используется значение по умолчанию: максимальное значение типа данных для возрастающей последовательности или <code>-1</code> — для убывающей</p>
</li>
<li>
<p><code>начало</code> - необязательное предложение <code>START WITH</code> начало позволяет запустить последовательность с любого значения. По умолчанию началом считается мин_значение для возрастающих последовательностей и максимальное значение для убывающих.</p>
</li>
<li>
<p><code>кеш</code> - необязательное предложение <code>CACHE</code> кеш определяет, сколько чисел последовательности будет выделяться и сохраняться в памяти для ускорения доступа к ним. Минимальное значение равно 1 (за один раз генерируется только одно значение, т. е. кеширования нет), и оно же предполагается по умолчанию.</p>
</li>
<li>
<p><code>CYCLE / NO CYCLE</code> - параметр <code>CYCLE</code> позволяет зациклить последовательность при достижении макс_значения или мин_значения для возрастающей или убывающей последовательности, соответственно. Когда этот предел достигается, следующим числом этих последовательностей будет соответственно мин_значение или макс_значение. Если указывается <code>NO CYCLE</code>, при каждом вызове <code>nextval</code> после достижения предельного значения будет возникать о</p>
</li>
<li>
<p><code>OWNED BY имя_таблицы.имя_столбца / OWNED BY NONE</code> - предложение <code>OWNED BY</code> позволяет связать последовательность с определённым столбцом таблицы так, чтобы при удалении этого столбца (или всей таблицы) последовательность удалялась автоматически. Указанная таблица должна иметь того же владельца и находиться в той же схеме, что и последовательность. Подразумеваемое по умолчанию предложение <code>OWNED BY NONE</code> указывает, что такая связь не устанавливается.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Примеры</strong>:</p>
</div>
<div class="paragraph">
<p>Создание возрастающей последовательности с именем <code>serial</code>, с начальным значением <code>101</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="n">SEQUENCE</span> <span class="nb">serial</span> <span class="k">START</span> <span class="mi">101</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Использование этой последовательности в команде <code>INSERT</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="k">table_name</span> <span class="k">VALUES</span> <span class="p">(</span><span class="n">nextval</span><span class="p">(</span><span class="s1">'serial'</span><span class="p">),</span> <span class="s1">'nothing'</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Добавив через такой запрос в таблицу значения, последовательность увеличится на единицу и <code>nextval('serial') = 102</code>;</p>
</div>
<div class="paragraph">
<p>Чтобы узнать следующий номер этой последовательности, выполните запрос:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="nb">serial</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_удаление_последовательности_drop_sequence">Удаление последовательности (<code>DROP SEQUENCE</code>)</h5>
<div class="paragraph">
<p>Удалить последовательность может только её владелец или суперпользователь, для этого воспользуйтесь запросом:</p>
</div>
<div class="listingblock">
<div class="title">Для удаления последовательности</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="n">SEQUENCE</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span> <span class="p">[,</span> <span class="p">...]</span> <span class="p">[</span> <span class="k">CASCADE</span> <span class="o">|</span> <span class="k">RESTRICT</span> <span class="p">]</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IF EXISTS</code> - не считать ошибкой, если последовательность не существует. В этом случае будет выдано замечание.</p>
</li>
<li>
<p><code>имя</code> - имя последовательности (возможно, дополненное схемой).</p>
</li>
<li>
<p><code>CASCADE</code> - автоматически удалять объекты, зависящие от данной последовательности, и, в свою очередь, все зависящие от них объекты.</p>
</li>
<li>
<p><code>RESTRICT</code> - отказать в удалении последовательности, если от неё зависят какие-либо объекты. Это поведение по умолчанию</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_изменение_определение_генератора_последовательности_alter_sequence">Изменение определение генератора последовательности (<code>ALTER SEQUENCE</code>)</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="n">SEQUENCE</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span>
    <span class="p">[</span> <span class="k">AS</span> <span class="err">тип</span><span class="n">_</span><span class="err">данных</span> <span class="p">]</span>
    <span class="p">[</span> <span class="k">INCREMENT</span> <span class="p">[</span> <span class="k">BY</span> <span class="p">]</span> <span class="err">шаг</span> <span class="p">]</span>
    <span class="p">[</span> <span class="k">MINVALUE</span> <span class="err">мин</span><span class="n">_</span><span class="err">значение</span> <span class="o">|</span> <span class="k">NO</span> <span class="k">MINVALUE</span> <span class="p">]</span> <span class="p">[</span> <span class="k">MAXVALUE</span> <span class="err">макс</span><span class="n">_</span><span class="err">значение</span> <span class="o">|</span> <span class="k">NO</span> <span class="k">MAXVALUE</span> <span class="p">]</span>
    <span class="p">[</span> <span class="k">START</span> <span class="p">[</span> <span class="k">WITH</span> <span class="p">]</span> <span class="err">начало</span> <span class="p">]</span>
    <span class="p">[</span> <span class="k">RESTART</span> <span class="p">[</span> <span class="p">[</span> <span class="k">WITH</span> <span class="p">]</span> <span class="err">перезапуск</span> <span class="p">]</span> <span class="p">]</span>
    <span class="p">[</span> <span class="k">CACHE</span> <span class="err">кеш</span> <span class="p">]</span> <span class="p">[</span> <span class="p">[</span> <span class="k">NO</span> <span class="p">]</span> <span class="k">CYCLE</span> <span class="p">]</span>
    <span class="p">[</span> <span class="n">OWNED</span> <span class="k">BY</span> <span class="err">{</span> <span class="err">имя</span><span class="n">_</span><span class="err">таблицы</span><span class="p">.</span><span class="err">имя</span><span class="n">_</span><span class="err">столбца</span> <span class="o">|</span> <span class="k">NONE</span> <span class="err">}</span> <span class="p">]</span>

    <span class="k">ALTER</span> <span class="n">SEQUENCE</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span> <span class="k">OWNER</span> <span class="k">TO</span> <span class="err">{</span> <span class="err">новый</span><span class="n">_</span><span class="err">владелец</span> <span class="o">|</span> <span class="k">CURRENT_USER</span> <span class="o">|</span>
    <span class="k">SESSION_USER</span> <span class="err">}</span>

    <span class="k">ALTER</span> <span class="n">SEQUENCE</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span> <span class="k">RENAME</span> <span class="k">TO</span> <span class="err">новое</span><span class="n">_</span><span class="err">имя</span>

    <span class="k">ALTER</span> <span class="n">SEQUENCE</span> <span class="p">[</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="p">]</span> <span class="err">имя</span> <span class="k">SET</span> <span class="k">SCHEMA</span> <span class="err">новая</span><span class="n">_</span><span class="err">схема</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ALTER SEQUENCE</code> меняет параметры существующего генератора последовательности. Параметры, не определяемые явно в команде <code>ALTER SEQUENCE</code>, сохраняют свои предыдущие значения. Выполнить <code>ALTER SEQUENCE</code> может только владелец соответствующей последовательности. Чтобы сменить схему последовательности, необходимо также иметь право <code>CREATE</code> в новой схеме. Чтобы сменить владельца, необходимо быть непосредственным или опосредованным членом новой роли-владельца, а эта роль должна иметь право <code>CREATE</code> в схеме последовательности.</p>
</div>
<div class="paragraph">
<p>Дополнительные параметры, отсутствующие в запросе создания <code>sequence</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>новый_владелец</code> - имя пользователя, назначаемого новым владельцем последовательности.</p>
</li>
<li>
<p><code>новое_имя</code> - новое имя последовательности.</p>
</li>
<li>
<p><code>новая_схема</code> - новая схема последовательности.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ограничения_constraints">6.7.9. Ограничения (<code>Constraints</code>)</h4>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/sql/bd-object/postgresql-constraints.png" alt="postgresql constraints"></span></p>
</div>
<div class="paragraph">
<p>С помощью ключевого слова <code>CONSTRAINT</code> можно задать имя для ограничений. В качестве ограничений могут использоваться <code>PRIMARY KEY</code>, <code>UNIQUE</code>, <code>CHECK</code>.</p>
</div>
<div class="sect4">
<h5 id="_ограничения_проверки">Ограничения-проверки</h5>
<div class="paragraph">
<p><strong>Ограничение-проверка</strong> — наиболее общий тип ограничений. В его определении можно указать, что значение данного столбца должно удовлетворять логическому выражению (проверке истинности). Например, цену товара можно ограничить положительными значениями так:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="p">(</span>
    <span class="n">product_no</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">NUMERIC</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">price</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ограничение определяется после типа данных, как и значение по умолчанию. Значения по умолчанию и ограничения могут указываться в любом порядке. Ограничение-проверка состоит из ключевого слова <code>CHECK</code>, за которым идёт выражение в скобках. Это выражение должно включать столбец, для которого задаётся ограничение, иначе оно не имеет большого смысла.</p>
</div>
<div class="paragraph">
<p>Можно также присвоить ограничению отдельное имя. Это улучшит сообщения об ошибках и позволит ссылаться на это ограничение, когда понадобится изменить его. Имена ограничений можно задать на уровне столбцов. Они указываются после <code>CONSTRAINT</code> перед атрибутами:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="p">(</span>
    <span class="n">product_no</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">NUMERIC</span> <span class="k">CONSTRAINT</span> <span class="n">positive_price</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">price</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>То есть, чтобы создать именованное ограничение, напишите ключевое слово <code>CONSTRAINT</code>, а за ним идентификатор и собственно определение ограничения.</p>
</div>
<div class="paragraph">
<p>Ограничение-проверка может также ссылаться на несколько столбцов. Например, если необходимо хранить обычную цену и цену со скидкой, так можете гарантировать, что цена со скидкой будет всегда меньше обычной.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">table_name</span> <span class="p">(</span>
    <span class="n">product_no</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">NUMERIC</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">price</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">discounted_price</span> <span class="nb">NUMERIC</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">discounted_price</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span>
    <span class="k">CHECK</span> <span class="p">(</span><span class="n">price</span> <span class="o">&gt;</span> <span class="n">discounted_price</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Этот пример можно переписать иначе:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">table_name</span> <span class="p">(</span>
    <span class="n">product_no</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">NUMERIC</span><span class="p">,</span>
    <span class="k">CHECK</span> <span class="p">(</span><span class="n">price</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">discounted_price</span> <span class="nb">NUMERIC</span><span class="p">,</span>
    <span class="k">CHECK</span> <span class="p">(</span><span class="n">discounted_price</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span>
    <span class="k">CHECK</span> <span class="p">(</span><span class="n">price</span> <span class="o">&gt;</span> <span class="n">discounted_price</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>или так:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">table_name</span> <span class="p">(</span>
    <span class="n">product_no</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">NUMERIC</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">price</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">discounted_price</span> <span class="nb">NUMERIC</span><span class="p">,</span>
    <span class="k">CHECK</span> <span class="p">(</span><span class="n">discounted_price</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">AND</span> <span class="n">price</span> <span class="o">&gt;</span> <span class="n">discounted_price</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ограничениям таблицы можно присваивать имена так же, как и ограничениям столбцов:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">table_name</span> <span class="p">(</span>
    <span class="n">product_no</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">NUMERIC</span><span class="p">,</span>
    <span class="k">CHECK</span> <span class="p">(</span><span class="n">price</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">discounted_price</span> <span class="nb">NUMERIC</span><span class="p">,</span>
    <span class="k">CHECK</span> <span class="p">(</span><span class="n">discounted_price</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span>
    <span class="k">CONSTRAINT</span> <span class="n">valid_discount</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">price</span> <span class="o">&gt;</span> <span class="n">discounted_price</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Следует заметить, что ограничение-проверка удовлетворяется, если выражение принимает значение <code>true</code> или <code>NULL</code>. Так как результатом многих выражений с операндами <code>NULL</code> будет значение <code>NULL</code>, такие ограничения не будут препятствовать записи <code>NULL</code> в связанные столбцы. Чтобы гарантировать, что столбец не содержит значения <code>NULL</code>, можно использовать ограничение <code>NOT NULL</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ограничение_not_null_2">Ограничение <code>NOT NULL</code></h5>
<div class="paragraph">
<p>Ограничение <code>NOT NULL</code> просто указывает, что столбцу нельзя присваивать значение <code>NULL</code>.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="p">(</span>
    <span class="n">product_no</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">NUMERIC</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ограничение <code>NOT NULL</code> всегда записывается как ограничение столбца и функционально эквивалентно ограничению <code>CHECK (имя_столбца IS NOT NULL)</code>, но в <strong>Postgres Pro</strong> явное ограничение <code>NOT NULL</code> работает более эффективно. Хотя у такой записи есть недостаток — назначить имя таким ограничениям нельзя.</p>
</div>
<div class="paragraph">
<p>Для столбца можно определить больше одного ограничения. Для этого их нужно просто указать одно за другим:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="p">(</span>
    <span class="n">product_no</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">NUMERIC</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">price</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ограничения_уникальности">Ограничения уникальности</h5>
<div class="paragraph">
<p>Ограничения уникальности гарантируют, что данные в определённом столбце или группе столбцов уникальны среди всех строк таблицы. Ограничение записывается так:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="p">(</span>
    <span class="n">product_no</span> <span class="nb">INTEGER</span> <span class="k">UNIQUE</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">NUMERIC</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>или:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="p">(</span>
    <span class="n">product_no</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">NUMERIC</span><span class="p">,</span>
    <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">product_no</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы определить ограничение уникальности для группы столбцов, запишите его в виде ограничения таблицы, перечислив имена столбцов через запятую:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">example</span> <span class="p">(</span>
    <span class="n">a</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">b</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="k">c</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="k">c</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Такое ограничение указывает, что сочетание значений перечисленных столбцов должно быть уникально во всей таблице, тогда как значения каждого столбца по отдельности не должны быть (и обычно не будут) уникальными.</p>
</div>
<div class="paragraph">
<p>Можно назначить уникальному ограничению имя обычным образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="p">(</span>
    <span class="n">product_no</span> <span class="nb">INTEGER</span> <span class="k">CONSTRAINT</span> <span class="n">must_be_different</span> <span class="k">UNIQUE</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">NUMERIC</span>
<span class="p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_первичный_ключ_primary_key">Первичный ключ (<code>PRIMARY KEY</code>)</h5>
<div class="paragraph">
<p>Ограничение первичного ключа означает, что образующий его столбец или группа столбцов может быть уникальным идентификатором строк в таблице. Для этого требуется, чтобы значения были одновременно уникальными и отличными от <code>NULL</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="p">(</span>
    <span class="n">product_no</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">NUMERIC</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Первичные ключи могут включать несколько столбцов; синтаксис похож на запись ограничений уникальности:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">example</span> <span class="p">(</span>
    <span class="n">a</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="n">b</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="k">c</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="k">c</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>При добавлении первичного ключа автоматически создаётся уникальный индекс-B-дерево для столбца или группы столбцов, перечисленных в первичном ключе, и данные столбцы помечаются как <code>NOT NULL</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ограничение_внешнего_ключа_references">Ограничение внешнего ключа (<code>REFERENCES</code>)</h5>
<div class="paragraph">
<p>Ограничение внешнего ключа указывает, что значения столбца (или группы столбцов) должны соответствовать значениям в некоторой строке другой таблицы. Это называется ссылочной целостностью двух связанных таблиц.</p>
</div>
<div class="paragraph">
<p>Пусть у вас уже есть таблица продуктов:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="p">(</span>
    <span class="n">product_no</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">NUMERIC</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Предположим, что есть таблица с заказами этих продуктов. Чтобы в таблице заказов содержались только заказы действительно существующих продуктов, определим в ней ограничение внешнего ключа, ссылающееся на таблицу продуктов:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="p">(</span>
    <span class="n">order_id</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">product_no</span> <span class="nb">INTEGER</span> <span class="k">REFERENCES</span> <span class="n">products</span> <span class="p">(</span><span class="n">product_no</span><span class="p">),</span>
    <span class="n">quantity</span> <span class="nb">INTEGER</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>С таким ограничением создать заказ отсутствующим в таблице <code>products</code> (и не равным <code>NULL</code>), будет невозможно.</p>
</div>
<div class="paragraph">
<p>В такой схеме таблицу <code>orders</code> называют подчинённой таблицей, а <code>products</code> — главной. Соответственно, столбцы называют так же <code>подчинённым</code> и <code>главным</code> (или ссылающимся и целевым).</p>
</div>
<div class="paragraph">
<p>Предыдущую команду можно сократить так:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">orders</span> <span class="p">(</span>
    <span class="n">order_id</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">product_no</span> <span class="nb">INTEGER</span> <span class="k">REFERENCES</span> <span class="n">products</span><span class="p">,</span>
    <span class="n">quantity</span> <span class="nb">INTEGER</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Если опустить список столбцов, внешний ключ будет неявно связан с первичным ключом главной таблицы.</p>
</div>
<div class="paragraph">
<p>Внешний ключ также может ссылаться на группу столбцов. В этом случае его нужно записать в виде обычного ограничения таблицы.</p>
</div>
<div class="paragraph">
<p><strong>Например</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">t1</span> <span class="p">(</span>
  <span class="n">a</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="n">b</span> <span class="nb">INTEGER</span><span class="p">,</span>
  <span class="k">c</span> <span class="nb">INTEGER</span><span class="p">,</span>
  <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="k">c</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">other_table</span> <span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
<span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Естественно, число и типы столбцов в ограничении должны соответствовать числу и типам целевых столбцов.</p>
</div>
<div class="sect5">
<h6 id="_добавление_ограничения_alter_table">Добавление ограничения (<code>ALTER TABLE</code>)</h6>
<div class="paragraph">
<p>Для добавления ограничения используется синтаксис ограничения таблицы. <strong>Например:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="k">ADD</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">name</span> <span class="o">&lt;&gt;</span> <span class="s1">''</span><span class="p">);</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">some_name</span> <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">product_no</span><span class="p">);</span>

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="k">ADD</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">product_group_id</span><span class="p">)</span>
<span class="k">REFERENCES</span> <span class="n">product_groups</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Чтобы добавить ограничение <code>NOT NULL</code>, которое нельзя записать в виде ограничения таблицы,  используется такой синтаксис:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">product_no</span> <span class="k">SET</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ограничение проходит проверку автоматически и будет добавлено, только если ему  удовлетворяют данные таблицы.</p>
</div>
</div>
<div class="sect5">
<h6 id="_удаление_ограничения_drop_constraint">Удаление ограничения (<code>DROP CONSTRAINT</code>)</h6>
<div class="paragraph">
<p>Для удаления ограничения необходимо знать его имя. Если ранее ограничению не присваивали имя, это  неявно сделала система, и необходимо выяснить его. Здесь может быть полезна команда <code>psql \d имя_таблицы</code> (или другие программы, показывающие подробную информацию о таблицах). Зная
имя, можно использовать команду:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="k">DROP</span> <span class="k">CONSTRAINT</span> <span class="n">some_name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Как и при удалении столбца необходимо удалить ограничение с зависимыми объектами,  добавьте указание <code>CASCADE</code>. Примером такой зависимости может быть ограничение внешнего  ключа, связанное со столбцами ограничения первичного ключа. Так можно удалить ограничения любых типов, кроме <code>NOT NULL</code>.</p>
</div>
<div class="paragraph">
<p>Чтобы удалить ограничение <code>NOT NULL</code>, используйте команду:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">product_no</span> <span class="k">DROP</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_права_доступа">6.7.10. Права доступа</h4>
<div class="paragraph">
<p>Когда в базе данных создаётся объект, ему назначается <strong>владелец</strong>. Владельцем обычно становится <strong>роль</strong>, с которой был выполнен оператор создания. Для большинства типов объектов в исходном состоянии только <strong>владелец</strong> (или <strong>суперпользователь</strong>) может делать с объектом всё что угодно. Чтобы разрешить использовать его другим ролям, нужно дать им <strong>права</strong>.</p>
</div>
<div class="sect4">
<h5 id="_добавление_нового_пользователя">Добавление нового пользователя</h5>
<div class="paragraph">
<p>Если в базе данных не существует пользователя, его можно создать следующим образом:</p>
</div>
<div class="listingblock">
<div class="title">Создание пользователя</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">USER</span> <span class="k">user</span><span class="o">-</span><span class="n">name</span> <span class="k">WITH</span> <span class="n">PASSWORD</span> <span class="s1">'password'</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>где в таблице</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>user-name</code> - логин пользователя базы данных.</p>
</li>
<li>
<p><code>password</code> - пароль нового пользователя.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>На этом этапе новый пользователь не имеет никаких разрешений на работу с базами данных. Он не может войти в систему, поэтому нужно предоставить ему неограниченные права доступа, выполнить это можно через следующий запрос.</p>
</div>
</div>
<div class="sect4">
<h5 id="_присвоение_прав_доступа_grant">Присвоение прав доступа (<code>GRANT</code>)</h5>
<div class="listingblock">
<div class="title">Предоставление пользователю неограниченные права доступа</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">PRIVILEGES</span> <span class="k">ON</span> <span class="k">table_name</span> <span class="k">TO</span> <span class="k">user</span><span class="o">-</span><span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Теперь пользователь получил новые права и может работать с базой данных.</p>
</div>
</div>
<div class="sect4">
<h5 id="_настройка_прав_доступа_для_пользователей">Настройка прав доступа для пользователей</h5>
<div class="paragraph">
<p>Предоставить другой уровень доступа к базам данных для пользователя возможно через следующую команду:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">GRANT</span> <span class="p">[</span><span class="err">тип</span> <span class="err">прав</span><span class="p">]</span> <span class="k">ON</span> <span class="p">[</span><span class="err">имя</span> <span class="err">базы</span> <span class="err">данных</span><span class="p">].[</span><span class="err">имя</span> <span class="err">таблицы</span><span class="p">]</span> <span class="k">TO</span> <span class="k">user</span><span class="o">-</span><span class="n">name</span> <span class="p">[</span> <span class="k">WITH</span> <span class="k">GRANT</span> <span class="k">OPTION</span> <span class="p">];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Если указано <code>WITH GRANT OPTION</code>, получатель права, в свою очередь, может давать его другим. Без  этого указания распоряжаться своим правом он не сможет. Группе <code>PUBLIC</code> право передачи права  дать нельзя.</p>
</div>
<div class="paragraph">
<p>В <strong>PostgreSQL</strong> права доступа бывают несколько типов:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ALL PRIVILEGES</code> – даёт пользователю полный доступ к заданной базе данных (если база данных не указана, то ко всем);</p>
</li>
<li>
<p><code>CREATE</code> – позволяет пользователю создавать базы данных/таблицы;</p>
</li>
<li>
<p><code>SELECT</code> – позволяет пользователю делать выборку данных;</p>
</li>
<li>
<p><code>INSERT</code> – позволяет пользователю добавлять новые записи в таблицы;</p>
</li>
<li>
<p><code>UPDATE</code> – позволяет пользователю изменять существующие записи в таблицах;</p>
</li>
<li>
<p><code>DELETE</code> – позволяет пользователю удалять записи из таблиц;</p>
</li>
<li>
<p><code>DROP</code> – позволяет пользователю удалять записи в базе данных/таблицах;</p>
</li>
<li>
<p><code>TRIGGER</code> - создание триггеров;</p>
</li>
<li>
<p><code>TRUNCATE</code> - очистка таблицы;</p>
</li>
<li>
<p><code>USAGE</code> - право на использование последовательностей и использовать объекты в конкретной схеме;</p>
</li>
<li>
<p><code>REFERENCES</code> - право ссылаться на таблицу;</p>
</li>
<li>
<p><code>CONNECT</code> - право на подключение к базе данных</p>
</li>
<li>
<p><code>TEMPORARY</code> - разрешает создавать в базе данных временные таблицы;</p>
</li>
<li>
<p><code>EXECUTE</code> - право на использование функции.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Право удалять объект или изменять его определение произвольным образом не считается назначаемым; оно неотъемлемо связано с владельцем, так что отозвать это право или дать его кому-то другому нельзя</strong></p>
</div>
<div class="paragraph">
<p>Если необходимо назначить несколько видов прав доступа, можно разделить их запятыми, как в команде:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">GRANT</span> <span class="k">UPDATE</span><span class="p">,</span> <span class="k">DELETE</span> <span class="k">ON</span> <span class="k">table_name</span> <span class="k">TO</span> <span class="k">user</span><span class="o">-</span><span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Если необходимо забрать у пользователя права доступа:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">REVOKE</span> <span class="p">[</span><span class="err">тип</span> <span class="err">прав</span><span class="p">]</span> <span class="k">ON</span> <span class="p">[</span><span class="err">имя</span> <span class="err">базы</span> <span class="err">данных</span><span class="p">].[</span><span class="err">имя</span> <span class="err">таблицы</span><span class="p">]</span> <span class="k">FROM</span> <span class="k">user</span><span class="o">-</span><span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Если необходимо отменить все привилегии у пользователя, введите команду:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">REVOKE</span> <span class="k">ALL</span> <span class="k">PRIVILEGES</span> <span class="k">ON</span> <span class="k">table_name</span> <span class="k">FROM</span> <span class="k">user</span><span class="o">-</span><span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_удаление_пользователей">Удаление пользователей</h5>
<div class="paragraph">
<p>Если на роль есть ссылки в какой-либо базе данных в кластере, возникнет ошибка и роль не будет удалена. Прежде чем удалять роль, необходимо удалить все принадлежащие ей объекты, а также лишить её данных ей прав для других объектов.</p>
</div>
<div class="paragraph">
<p>Удалить пользователя можно следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">ROLE</span> <span class="k">user</span><span class="o">-</span><span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>или</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">DROP</span> <span class="k">USER</span> <span class="k">user</span><span class="o">-</span><span class="n">name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>DROP USER</code> — просто альтернативное написание команды <code>DROP ROLE</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_изменение_роли_в_базе_alter_role">Изменение роли в базе (<code>ALTER ROLE</code>)</h5>
<div class="paragraph">
<p>Изменение пароля пользователя:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">ROLE</span> <span class="n">user_name</span> <span class="k">WITH</span> <span class="n">PASSWORD</span> <span class="s1">'hu8jmn3'</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Удаление пароля пользователя:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">ROLE</span> <span class="n">user_name</span> <span class="k">WITH</span> <span class="n">PASSWORD</span> <span class="k">NULL</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Переименовать пользователя:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">ALTER</span> <span class="k">ROLE</span> <span class="n">user1</span> <span class="k">RENAME</span> <span class="k">TO</span> <span class="n">user2</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_виды_ролей">Виды ролей</h5>
<div class="sect5">
<h6 id="_суперпользователи">Суперпользователи</h6>
<div class="paragraph">
<p><strong>Суперпользователи</strong> –  имеют полный доступ ко всем объектам (проверки не выполняются).</p>
</div>
</div>
<div class="sect5">
<h6 id="_владельцы">Владельцы</h6>
<div class="paragraph">
<p><strong>Владельцы</strong> – владельцем становиться тот, кто создал объект. Но право владения можно передать. Владелец имеет все привилегии на принадлежащий ему объект. Также создатель объекта обладает правом удалять его, и это право у него нельзя отнять.</p>
</div>
</div>
<div class="sect5">
<h6 id="_псевдороль_public">Псевдороль public</h6>
<div class="paragraph">
<p>Псевдороль <code>public</code> не видна, но про неё следует знать. Это групповая роль, в которую включены все остальные  роли. Это означает, что все роли по умолчанию будут иметь привилегии наследуемые от <code>public</code>. Поэтому иногда у <code>public</code> отбирают некоторые привилегии, чтобы отнять их у всех пользователей.</p>
</div>
<div class="paragraph">
<p>Роль <code>public</code> по умолчанию имеет следующие привилегии для всех баз данных:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CONNECT</code> – это означает что любая созданная роль сможет подключаться к базам данных;</p>
</li>
<li>
<p><code>TEMPORARY</code> – любая созданная роль сможет создавать временные объекты во всех база данных и объекты эти могут быть любого размера;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>для схемы <code>public</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CREATE</code> (создание объектов) – любая роль может создавать объекты в этой схеме;</p>
</li>
<li>
<p><code>USAGE</code> (доступ к объектам) – любая роль может использовать объекты в этой схеме;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>для всех функций:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>EXECUTE</code> (выполнение) – любая роль может выполнять любую функцию. Если ещё нужны права <code>USAGE</code> на ту схему, в которой функция находится, и права к объектам, к которым обращается функция. Это сделано для удобства, но снижает безопасность сервера баз данных.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_analytical_functions">6.8. Analytical functions</h3>
<div class="paragraph">
<p>Аналитические функции вычисляют статистическое значение на основе группы строк.</p>
</div>
<div class="paragraph">
<p><strong>SQL Server</strong> поддерживает указанные ниже аналитические функции:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>RANK()</code></p>
</li>
<li>
<p><code>CUME_DIST()</code></p>
</li>
<li>
<p><code>FIRST_VALUE()</code></p>
</li>
<li>
<p><code>LAG()</code></p>
</li>
<li>
<p><code>LAST_VALUE()</code></p>
</li>
<li>
<p><code>LEAD()</code></p>
</li>
<li>
<p><code>PERCENT_RANK()</code></p>
</li>
<li>
<p><code>PERCENTILE_CONT()</code></p>
</li>
<li>
<p><code>PERCENTILE_DISC()</code></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_функции_rank_cume_dist_and_percent_rank">6.8.1. Функции <code>RANK()</code>, <code>CUME_DIST()</code> and <code>PERCENT_RANK()</code></h4>
<div class="ulist">
<ul>
<li>
<p><code>PERCENT_RANK</code> - возвращает процент значений, меньших чем текущая оценка.</p>
</li>
<li>
<p><code>CUME_DIST</code> - возвращает фактическое положение оценки.</p>
</li>
<li>
<p><code>RANK</code> - назначает одинаковое числовое значение строкам, претендующим на один ранг (например, <code>1</code>, <code>2</code>, <code>2</code>, <code>4</code>, <code>5</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Синтаксис функций:</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис <code>RANK()</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="n">RANK</span><span class="p">()</span> <span class="n">OVER</span> <span class="p">(</span> <span class="p">[</span> <span class="n">partition_by_clause</span> <span class="p">]</span> <span class="n">order_by_clause</span> <span class="p">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Синтаксис <code>PERCENT_RANK()</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="n">PERCENT_RANK</span><span class="p">()</span> <span class="n">OVER</span> <span class="p">(</span>
 <span class="p">[</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">partition_expression</span><span class="p">,</span> <span class="p">...</span> <span class="p">]</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">sort_expression</span> <span class="p">[</span><span class="k">ASC</span> <span class="o">|</span> <span class="k">DESC</span><span class="p">],</span> <span class="p">...)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Синтаксис <code>PERCENT_RANK()</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="n">CUME_DIST</span><span class="p">()</span> <span class="n">OVER</span> <span class="p">(</span>
<span class="p">[</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">partition_expression</span><span class="p">,</span> <span class="p">...</span> <span class="p">]</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">sort_expression</span> <span class="p">[</span><span class="k">ASC</span> <span class="o">|</span> <span class="k">DESC</span><span class="p">],</span> <span class="p">...)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>где <code>PARTITION BY</code> распределяет строки по нескольким разделам, к которым применяется функции.</p>
</div>
<div class="paragraph">
<p>Допустим у нас есть таблица содержащая месяцы в отсортированном порядке по месяцу и значение температуры по Фаренгейту и по Цельсию.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">MNo</th>
<th class="tableblock halign-left valign-top">MName</th>
<th class="tableblock halign-left valign-top">AvgHighTempF</th>
<th class="tableblock halign-left valign-top">AvgHighTempC</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.44</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Feb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">45</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mar</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">55</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12.78</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">67</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">19.44</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">May</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">77</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25.00</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jun</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">85</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">29.44</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jul</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">89</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">31.67</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">88</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">31.11</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sep</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">81</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">27.22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oct</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">69</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20.56</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nov</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">56</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13.33</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">43</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.11</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Выполним запрос:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">MName</span><span class="p">,</span> <span class="n">AvgHighTempF</span><span class="p">,</span> <span class="n">AvgHighTempC</span><span class="p">,</span>
    <span class="n">RANK</span><span class="p">()</span> <span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">AvgHighTempf</span><span class="p">)</span> <span class="k">AS</span> <span class="n">Rnk</span><span class="p">,</span>
    <span class="n">PERCENT_RANK</span><span class="p">()</span> <span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">AvgHighTempF</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="k">AS</span> <span class="n">PR</span><span class="p">,</span>
    <span class="n">CUME_DIST</span><span class="p">()</span> <span class="n">OVER</span><span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">AvgHighTempF</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="k">AS</span> <span class="n">CD</span>
<span class="k">FROM</span> <span class="n">MonthlyTempsStl</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Получим следующие значения:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/sql/analytical-function/select-result-set.png" alt="select result set"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Январь является самым холодным месяцем.</p>
</li>
<li>
<p>Нет месяца, холоднее чем январь, поэтому его температура имеет <code>PERCENT_RANK = 0</code>. <code>CUME_DIST</code> для нее равен <code>8.33%</code> (значения умножались на <code>100</code>, чтобы вернуть проценты), поскольку температура составляет <code>8,33%</code> (<code>1/12</code>) в списке.</p>
</li>
<li>
<p>Июль самый жаркий месяц и <code>PERCENT_RANK</code>, и <code>CUME_DIST</code> возвращают <code>100</code>, поскольку его температура жарче, чем во все другие месяцы, и находится на вершине списка.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Когда используются эти функции, всегда возвращаются <code>1</code> или <code>100%</code> для самого высокого элемента списка.</p>
</div>
<div class="paragraph">
<p><code>RANK() OVER</code> в свою очередь возвращает ранг каждой строки в секции результирующего набора.
Ранг строки вычисляется как единица плюс количество рангов, находящихся до этой строки.</p>
</div>
<div class="paragraph">
<p>С принципом работы <strong>необязательного</strong> атрибута <code>PARTITION BY</code> можно ознакомиться по следующему запросу:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">Name</span><span class="p">,</span> <span class="n">Make</span><span class="p">,</span> <span class="n">Model</span><span class="p">,</span> <span class="n">Price</span><span class="p">,</span> <span class="k">Type</span><span class="p">,</span>
<span class="n">COME_DIST</span><span class="p">()</span> <span class="n">over</span> <span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="k">TYPE</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">price</span><span class="p">)</span> <span class="k">as</span> <span class="n">CUME_DIST</span>
<span class="k">FROM</span> <span class="n">Bikes</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Предложение <code>PARTITION BY</code> распределяет строки по нескольким разделам, к которым применяется функция <code>CUME_DIST()</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/sql/analytical-function/partition-by.png" alt="partition by"></span></p>
</div>
<div class="paragraph">
<p>Каждый раздел(группа) рассматривается функцией <code>CUME_DIST</code> отдельно.</p>
</div>
</div>
<div class="sect3">
<h4 id="_функции_first_value_и_last_value">6.8.2. Функции <code>FIRST_VALUE()</code> и <code>LAST_VALUE()</code></h4>
<div class="ulist">
<ul>
<li>
<p><code>FIRST_VALUE()</code> возвращает первое значение в упорядоченном наборе значений из аналитического окна.</p>
</li>
<li>
<p><code>LAST_VALUE()</code> возвращает последнее значение в упорядоченном наборе значений из аналитического окна.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="n">FIRST_VALUE</span> <span class="p">(</span><span class="n">expression</span> <span class="p">[</span><span class="n">RESPECT</span> <span class="n">NULLS</span> <span class="o">|</span> <span class="k">IGNORE</span> <span class="n">NULLS</span><span class="p">])</span>
<span class="n">OVER</span> <span class="p">([</span><span class="n">query_partition_clause</span><span class="p">]</span> <span class="p">[</span><span class="n">order_by_clause</span> <span class="p">[</span><span class="n">windowing_clause</span><span class="p">]])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>где</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>expression</code> - столбец или выражение, для которого необходимо вернуть первое значение.</p>
</li>
<li>
<p><code>RESPECT NULLS</code> | <code>IGNORE NULLS</code> - необязательный параметр.
Он определяет, включены ли значения <code>NULL</code> или игнорируются в аналитическом окне. Если этот параметр опущен, значением по умолчанию является <code>RESPECT NULLS</code>, который включает значения <code>NULL</code>.</p>
</li>
<li>
<p><code>windowing_clause</code> - необязательный параметр.
Он определяет строки в аналитическом окне для оценки используя сортировку.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Варианты <code>windowing_clause</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>windowing_clause</code></th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RANGE BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Последняя строка в окне изменяется с изменением текущей строки (по умолчанию)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RANGE BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Первая строка в окне изменяется с изменением текущей строки</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Все строки включены в окно независимо от текущей строки</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Допустим имеется таблица:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/sql/analytical-function/salary-table.png" alt="salary table"></span></p>
</div>
<div class="paragraph">
<p>Выполним следующий запрос:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">FIRST_VALUE</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span>
    <span class="n">OVER</span> <span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">salary</span> <span class="k">DESC</span>
       <span class="n">RANGE</span> <span class="k">BETWEEN</span> <span class="n">UNBOUNDED</span> <span class="n">PRECEDING</span> <span class="k">AND</span> <span class="n">UNBOUNDED</span> <span class="n">FOLLOWING</span><span class="p">)</span>
       <span class="k">AS</span> <span class="n">HIGHEST</span>
<span class="k">FROM</span> <span class="n">salaryTable</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Отсортировав таблицу по полю <code>salary</code> получим первое наиболее значение <code>salary</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">HIGHEST</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">department_id</span><span class="p">,</span> <span class="n">FIRST_VALUE</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span>
    <span class="n">OVER</span> <span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">department_id</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">salary</span> <span class="k">DESC</span>
       <span class="n">RANGE</span> <span class="k">BETWEEN</span> <span class="n">UNBOUNDED</span> <span class="n">PRECEDING</span> <span class="k">AND</span> <span class="n">UNBOUNDED</span> <span class="n">FOLLOWING</span><span class="p">)</span>
       <span class="k">AS</span> <span class="n">HIGHEST</span>
<span class="k">FROM</span> <span class="n">salaryTable</span>
<span class="k">WHERE</span> <span class="n">department_id</span> <span class="k">in</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">department_id</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Выведем номер департамента и первое значение <code>salary</code>. Для этого разобьем таблицу на группы <code>department_id</code>  и отсортируем по полю <code>salary</code>. В выборке будут участвовать департаменты с номерами <code>10</code> и <code>20</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">department_id</th>
<th class="tableblock halign-left valign-top">HIGHEST</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3200</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4900</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Самую минимальную зарплату можно вывести изменив сортировку по <code>ASC</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">department_id</span><span class="p">,</span> <span class="n">FIRST_VALUE</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span>
    <span class="n">OVER</span> <span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">department_id</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">salary</span> <span class="k">ASC</span>
        <span class="n">RANGE</span> <span class="k">BETWEEN</span> <span class="n">UNBOUNDED</span> <span class="n">PRECEDING</span> <span class="k">AND</span> <span class="n">UNBOUNDED</span> <span class="n">FOLLOWING</span><span class="p">)</span>
        <span class="k">AS</span> <span class="n">LOWEST</span>
<span class="k">FROM</span> <span class="n">salaryTable</span>
<span class="k">WHERE</span> <span class="n">department_id</span> <span class="k">in</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">department_id</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Или воспользоваться функцией <code>LAST_VALUE()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">department_id</span><span class="p">,</span> <span class="n">LAST_VALUE</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span>
 <span class="n">OVER</span> <span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">department_id</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">salary</span> <span class="k">DESC</span>
       <span class="n">RANGE</span> <span class="k">BETWEEN</span> <span class="n">UNBOUNDED</span> <span class="n">PRECEDING</span> <span class="k">AND</span> <span class="n">UNBOUNDED</span> <span class="n">FOLLOWING</span><span class="p">)</span>
       <span class="k">AS</span> <span class="n">HIGHEST</span>
<span class="k">FROM</span> <span class="n">salaryTable</span>
<span class="k">WHERE</span> <span class="n">department_id</span> <span class="k">in</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">department_id</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Результат выполнения функций будет один:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">department_id</th>
<th class="tableblock halign-left valign-top">HIGHEST</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2950</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_функции_lag_и_lead">6.8.3. Функции <code>LAG()</code> и <code>LEAD()</code></h4>
<div class="paragraph">
<p>Функции <code>LAG</code> и <code>LEAD</code> позволяют возвращать выражение значения из строки в секции окна, которая находится на заданном смещении перед (<code>LAG</code> или <code>LEAD</code>).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/sql/analytical-function/sales-table.png" alt="sales table"></span></p>
</div>
<div class="paragraph">
<p>Выполним запрос, сдвинем на одну позицию с атрибутом <code>Selec_Amount</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">Sales_Customer_Id</span><span class="p">,</span> <span class="n">Sales_Date</span><span class="p">,</span> <span class="n">Sales_Amount</span><span class="p">,</span>
    <span class="n">LAG</span><span class="p">(</span><span class="n">Sales_Amount</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">Sales_Customer_Id</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Sales_Date</span><span class="p">)</span> <span class="k">AS</span> <span class="n">PrevValue</span>
<span class="k">FROM</span> <span class="n">dbo</span><span class="p">.</span><span class="n">Sales</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Благодаря такой возможности, можно увидеть тенденцию стоимости продаж между двумя датами:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/sql/analytical-function/sales-table-2.png" alt="sales table 2"></span></p>
</div>
<div class="paragraph">
<p>Благодаря функции <code>LEAD</code> сдвинем атрибут <code>Sales_Amount</code> вверх на одну позицию:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">Sales_Customer_Id</span><span class="p">,</span> <span class="n">Sales_Date</span><span class="p">,</span>
    <span class="n">LAG</span><span class="p">(</span><span class="n">Sales_Amount</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">Sales_Customer_Id</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Sales_Date</span><span class="p">)</span> <span class="k">AS</span> <span class="n">PrevValue</span><span class="p">,</span>
    <span class="n">Sales_Amount</span><span class="p">,</span>
    <span class="n">LEAD</span><span class="p">(</span><span class="n">Sales_Amount</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">Sales_Customer_Id</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Sales_Date</span><span class="p">)</span> <span class="k">AS</span> <span class="n">NextValue</span>
<span class="k">FROM</span> <span class="n">dbo</span><span class="p">.</span><span class="n">Sales</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Результат:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/sql/analytical-function/sales-table-3.png" alt="sales table 3"></span></p>
</div>
<div class="paragraph">
<p>В функции можно указать шаг смещения, например на две позиции:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">Sales_Customer_Id</span><span class="p">,</span> <span class="n">Sales_Date</span><span class="p">,</span>
    <span class="n">LAG</span><span class="p">(</span><span class="n">Sales_Amount</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">Sales_Customer_Id</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Sales_Date</span><span class="p">)</span> <span class="k">AS</span> <span class="n">PrevValue</span><span class="p">,</span>
    <span class="n">Sales_Amount</span><span class="p">,</span>
    <span class="n">LEAD</span><span class="p">(</span><span class="n">Sales_Amount</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">Sales_Customer_Id</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Sales_Date</span><span class="p">)</span> <span class="k">AS</span> <span class="n">NextValue</span>
<span class="k">FROM</span> <span class="n">dbo</span><span class="p">.</span><span class="n">Sales</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Результат:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/sql/analytical-function/sales-table-4.png" alt="sales table 4"></span></p>
</div>
<div class="paragraph">
<p>В функции можно указать значения по умолчанию, для избежания значений <code>null</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">Sales_Customer_Id</span><span class="p">,</span> <span class="n">Sales_Date</span><span class="p">,</span>
    <span class="n">LAG</span><span class="p">(</span><span class="n">Sales_Amount</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">Sales_Customer_Id</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Sales_Date</span><span class="p">)</span> <span class="k">AS</span> <span class="n">PrevValue</span><span class="p">,</span>
    <span class="n">Sales_Amount</span><span class="p">,</span>
    <span class="n">LEAD</span><span class="p">(</span><span class="n">Sales_Amount</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span><span class="n">PARTITION</span> <span class="k">BY</span> <span class="n">Sales_Customer_Id</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Sales_Date</span><span class="p">)</span> <span class="k">AS</span> <span class="n">NextValue</span>
<span class="k">FROM</span> <span class="n">dbo</span><span class="p">.</span><span class="n">Sales</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Результат:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/sql/analytical-function/sales-table-5.png" alt="sales table 5"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_функция_percentile_cont">6.8.4. Функция <code>PERCENTILE_CONT()</code></h4>
<div class="paragraph">
<p><code>PERCENTILE_CONT()</code> — вычисляет процентиль на основе постоянного распределения значения столбца. В качестве параметра принимает процентиль, который необходимо вычислить.</p>
</div>
<div class="paragraph">
<p>Синтаксис:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="n">PERCENTILE_CONT</span> <span class="p">(</span> <span class="n">numeric_literal</span> <span class="p">)</span>
<span class="n">WITHIN</span> <span class="k">GROUP</span> <span class="p">(</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">order_by_expression</span> <span class="p">[</span> <span class="k">ASC</span> <span class="o">|</span> <span class="k">DESC</span> <span class="p">]</span> <span class="p">)</span>
<span class="n">OVER</span> <span class="p">(</span> <span class="p">[</span> <span class="o">&lt;</span><span class="n">partition_by_clause</span><span class="o">&gt;</span> <span class="p">]</span> <span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>где</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>numeric_literal</code> - процентиль, который необходимо вычислить. Значение должно находиться в диапазоне от <code>0.0</code> до <code>1,0</code>.</p>
</li>
<li>
<p><code>WITHIN GROUP</code> ( <code>ORDER BY order_by_expression</code> [ <code>ASC</code> | <code>DESC</code> ] ) - указывает список числовых значений, который следует отсортировать и по которому будет вычисляться процентиль. Разрешен только один аргумент <code>order_by_expression</code>. Результатом вычисления выражения должен быть точный или приблизительный числовой тип. Другие типы данных недопустимы.</p>
</li>
<li>
<p><code>OVER</code> ( <code>&lt;partition_by_clause&gt;</code> ) - делит результирующий набор, полученный с помощью предложения <code>FROM</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Допустим есть таблица:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
<th class="tableblock halign-left valign-top">c</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NULL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NULL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Вычислим значение процентиля по полю <code>a</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">PERCENTILE_CONT</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">WITHIN</span> <span class="k">GROUP</span> <span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">a</span><span class="p">)</span>
<span class="k">FROM</span> <span class="k">sets</span><span class="p">;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY a)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.500</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Вычислим значение процентиля по полю <code>a</code> разбив на группы по полю <code>c</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">c</span><span class="p">,</span> <span class="n">PERCENTILE_CONT</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">WITHIN</span> <span class="k">GROUP</span> <span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">a</span><span class="p">)</span> <span class="k">AS</span> <span class="n">PERCENTILE</span>
<span class="k">FROM</span> <span class="k">sets</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">c</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="k">c</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Результат:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">c</th>
<th class="tableblock halign-left valign-top">PERCENTILE</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.000</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Вычислим значение процентиля по полю <code>a</code> используя параметр <code>PERCENTILE_CONT</code>(<code>0.25</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">PERCENTILE_CONT</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">25</span><span class="p">)</span>
    <span class="n">WITHIN</span> <span class="k">GROUP</span> <span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">a</span><span class="p">)</span> <span class="k">AS</span> <span class="n">PERCENTILE</span>
<span class="k">FROM</span> <span class="k">sets</span><span class="p">;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PERCENTILE</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.00</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Изменив параметр <code>ORDER BY</code> на <code>DESC</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">PERCENTILE_CONT</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">25</span><span class="p">)</span>
    <span class="n">WITHIN</span> <span class="k">GROUP</span> <span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">a</span> <span class="k">DESC</span><span class="p">)</span> <span class="k">AS</span> <span class="n">PERCENTILE</span>
<span class="k">FROM</span> <span class="k">sets</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Получим следующий результат:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PERCENTILE</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.750</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_функция_percentile_disc">6.8.5. Функция <code>PERCENTILE_DISC()</code></h4>
<div class="paragraph">
<p><code>PERCENTILE_DISC()</code> — вычисляет определенный процентиль для отсортированных значений в наборе данных. В качестве параметра принимает процентиль, который необходимо вычислить.</p>
</div>
<div class="paragraph">
<p>Синтаксис:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="n">PERCENTILE_DISC</span> <span class="p">(</span> <span class="n">numeric_literal</span> <span class="p">)</span> <span class="n">WITHIN</span> <span class="k">GROUP</span> <span class="p">(</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">order_by_expression</span> <span class="p">[</span> <span class="k">ASC</span> <span class="o">|</span> <span class="k">DESC</span> <span class="p">]</span> <span class="p">)</span>
<span class="n">OVER</span> <span class="p">(</span> <span class="p">[</span> <span class="o">&lt;</span><span class="n">partition_by_clause</span><span class="o">&gt;</span> <span class="p">]</span> <span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>где</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>literal</code> - процентиль, который необходимо вычислить. Значение должно находиться в диапазоне от <code>0.0</code> до <code>1,0</code>.</p>
</li>
<li>
<p><code>WITHIN GROUP ( ORDER BY order_by_expression [ ASC | DESC)</code> - указывает список значений, который следует отсортировать и по которому будет вычисляться процентиль. Разрешен только один аргумент <code>order_by_expression</code>. По умолчанию задан порядок сортировки по возрастанию. Список значений может быть любого из типов данных, которые допустимы для операции сортировки.</p>
</li>
<li>
<p><code>OVER ( &lt;partition_by_clause&gt;)</code> - разделяет результирующий набор предложения <code>FROM</code> на секции, к которым применяется функция вычисления процентиля.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Создадим таблицу со следующими значениями:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">a</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100000</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Выполним запросы:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">PERCENTILE_DISC</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">80</span><span class="p">)</span>
    <span class="n">WITHIN</span> <span class="k">GROUP</span> <span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">a</span> <span class="k">DESC</span><span class="p">)</span> <span class="k">AS</span> <span class="n">PERCENTILE</span>
<span class="k">FROM</span> <span class="k">table_name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Результат:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PERCENTILE</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="n">PERCENTILE_DISC</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">10</span><span class="p">)</span>
<span class="n">WITHIN</span> <span class="k">GROUP</span> <span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">a</span> <span class="k">DESC</span><span class="p">)</span> <span class="k">AS</span> <span class="n">PERCENTILE</span>
<span class="k">FROM</span> <span class="k">table_name</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Результат:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">PERCENTILE</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100000</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Или для таблицы</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">a</th>
<th class="tableblock halign-left valign-top">b</th>
<th class="tableblock halign-left valign-top">c</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NULL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NULL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Используем запрос:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="k">c</span><span class="p">,</span> <span class="n">PERCENTILE_DISC</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">WITHIN</span> <span class="k">GROUP</span> <span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">a</span><span class="p">)</span> <span class="k">AS</span> <span class="n">PERCENTILE</span>
<span class="k">FROM</span> <span class="k">sets</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="k">c</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="k">c</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Результат:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">c</th>
<th class="tableblock halign-left valign-top">PERCENTILE</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_рекурсия_recursive">6.8.6. Рекурсия (<code>RECURSIVE</code>)</h4>
<div class="paragraph">
<p>Рекурсивная функция позволяет многократно выполнятся, чтобы возвращать подмножество данных до тех пор, пока не получится конечный результирующий набор.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="no">WITH</span> <span class="o">[</span><span class="no">RECURSIVE</span><span class="o">]</span>
    <span class="nf">table_name</span><span class="o">(</span><span class="n">parameters</span><span class="o">)</span> <span class="no">AS</span> <span class="o">(</span><span class="n">select</span><span class="o">-</span><span class="n">stmt</span><span class="o">)</span>
<span class="no">UNION</span> <span class="o">[</span><span class="no">ALL</span><span class="o">]</span>
    <span class="nc">Recursive</span><span class="o">-</span><span class="n">select</span>
    <span class="nc">Cte</span><span class="o">-</span><span class="n">select</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>параметры:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>table_name</code>(<code>parameters</code>) – таблица, данные в которой хранятся для использования в рекурсии, таблица не создаётся, она хранится в памяти компьютера и удаляется после завершения работы рекурсии. Ее не нужно создавать отдельно.</p>
</li>
<li>
<p><code>select-stmt</code> – выполняется один раз. Позволяет задать начальные значения полям таблицы до начала работы рекурсии.</p>
</li>
<li>
<p><code>UNION</code> [<code>ALL</code>] – позволяется соединить результаты запроса рекурсивной функции.</p>
</li>
<li>
<p><code>Recursive-select</code> – повторяющаяся часть. Будет выполняться пока условие не удовлетворено.</p>
</li>
<li>
<p><code>Cte-select</code> – значения полей, которые выведутся на экран.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Разберем принцип работы рекурсии на простом примере:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="no">WITH</span> <span class="no">RECURSIVE</span>
  <span class="nf">table1</span><span class="o">(</span><span class="n">col1</span><span class="o">)</span> <span class="no">AS</span> <span class="o">(</span>
      <span class="no">SELECT</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
    <span class="no">UNION</span> <span class="no">ALL</span>
    <span class="no">SELECT</span> <span class="n">col1</span><span class="o">+</span><span class="mi">1</span> <span class="no">FROM</span> <span class="n">table1</span>
    <span class="no">WHERE</span> <span class="n">col1</span><span class="o">&lt;</span><span class="mi">1000</span><span class="o">)</span>

<span class="no">SELECT</span> <span class="n">col1</span> <span class="no">FROM</span> <span class="n">table1</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>В таком запросе происходит создание таблицы <code>table1</code> с полем <code>col1</code>, после указания <code>AS</code> присваивается значение <code>сol1 = 1</code>. Этот блок в рекурсивной функции будет выполнен только один раз.</p>
</div>
<div class="paragraph">
<p>Важно понять, что не нужно создавать <code>table1</code> до создания рекурсии, она будет создана автоматически и не сохранится после завершения работы рекурсивной функции.</p>
</div>
<div class="paragraph">
<p>После указания <code>UNION ALL</code> описывается логика работы рекурсии - прибавление к значению <code>col1</code> единицы, до тех пор, пока функция не достигнет значения  <code>col1 = 1000</code>.</p>
</div>
<div class="paragraph">
<p>После отработки каждого цикла рекурсии, произойдет вывод значения <code>SELECT col1 FROM table1</code> на экран.</p>
</div>
<div class="paragraph">
<p>Таким образом получим следующую таблицу:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">998</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">999</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Другой пример, создадим таблицу содержащую имя сотрудника и его начальника:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="no">CREATE</span> <span class="no">TABLE</span> <span class="nf">org</span><span class="o">(</span>
  <span class="n">name</span> <span class="nf">varchar</span><span class="o">(</span><span class="mi">100</span><span class="o">)</span> <span class="no">PRIMARY</span> <span class="no">KEY</span><span class="o">,</span>
  <span class="n">boss</span> <span class="nf">varchar</span><span class="o">(</span><span class="mi">100</span><span class="o">)</span> <span class="no">REFERENCES</span> <span class="nf">org</span><span class="o">(</span><span class="n">name</span><span class="o">)</span>
<span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Внесем следующие имена:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="no">INSERT</span> <span class="no">INTO</span> <span class="n">org</span> <span class="nf">VALUES</span><span class="o">(</span><span class="err">'</span><span class="nc">Alice</span><span class="err">'</span><span class="o">,</span><span class="no">NULL</span><span class="o">);</span>
<span class="no">INSERT</span> <span class="no">INTO</span> <span class="n">org</span> <span class="nf">VALUES</span><span class="o">(</span><span class="err">'</span><span class="nc">Bob</span><span class="sc">','</span><span class="nc">Alice</span><span class="err">'</span><span class="o">);</span>
<span class="no">INSERT</span> <span class="no">INTO</span> <span class="n">org</span> <span class="nf">VALUES</span><span class="o">(</span><span class="err">'</span><span class="nc">Cindy</span><span class="sc">','</span><span class="nc">Alice</span><span class="err">'</span><span class="o">);</span>
<span class="no">INSERT</span> <span class="no">INTO</span> <span class="n">org</span> <span class="nf">VALUES</span><span class="o">(</span><span class="err">'</span><span class="nc">Dave</span><span class="sc">','</span><span class="nc">Bob</span><span class="err">'</span><span class="o">);</span>
<span class="no">INSERT</span> <span class="no">INTO</span> <span class="n">org</span> <span class="nf">VALUES</span><span class="o">(</span><span class="err">'</span><span class="nc">Emma</span><span class="sc">','</span><span class="nc">Bob</span><span class="err">'</span><span class="o">);</span>
<span class="no">INSERT</span> <span class="no">INTO</span> <span class="n">org</span> <span class="nf">VALUES</span><span class="o">(</span><span class="err">'</span><span class="nc">Fred</span><span class="sc">','</span><span class="nc">Cindy</span><span class="err">'</span><span class="o">);</span>
<span class="no">INSERT</span> <span class="no">INTO</span> <span class="n">org</span> <span class="nf">VALUES</span><span class="o">(</span><span class="err">'</span><span class="nc">Gail</span><span class="sc">','</span><span class="nc">Cindy</span><span class="err">'</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Первый параметр - имя сотрудника, второй - ссылка на имя начальника. Например у Алисы нет начальник – значение <code>NULL</code>. Подчиненные <strong>Алисы</strong> – <strong>Bob</strong>, <strong>Cindy</strong> и т.д.</p>
</div>
<div class="paragraph">
<p>Можно вывести одним рекурсивным запросом таблицу, содержащую иерархию сотрудников в компании. Используем следующий запрос:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="no">WITH</span> <span class="no">RECURSIVE</span>
  <span class="nf">under_alice</span><span class="o">(</span><span class="n">name</span><span class="o">,</span><span class="n">level</span><span class="o">)</span> <span class="no">AS</span> <span class="o">(</span>
    <span class="no">VALUES</span><span class="o">(</span><span class="err">'</span><span class="nc">Alice</span><span class="err">'</span><span class="o">,</span><span class="mi">0</span><span class="o">)</span>

    <span class="no">UNION</span> <span class="no">ALL</span>

    <span class="no">SELECT</span> <span class="n">org</span><span class="o">.</span><span class="na">name</span><span class="o">,</span> <span class="n">under_alice</span><span class="o">.</span><span class="na">level</span><span class="o">+</span><span class="mi">1</span>
      <span class="no">FROM</span> <span class="n">org</span> <span class="no">JOIN</span> <span class="n">under_alice</span> <span class="no">ON</span> <span class="n">org</span><span class="o">.</span><span class="na">boss</span><span class="o">=</span><span class="n">under_alice</span><span class="o">.</span><span class="na">name</span>
  <span class="o">)</span>

<span class="no">SELECT</span> <span class="n">level</span><span class="o">,</span> <span class="n">name</span> <span class="no">FROM</span> <span class="n">under_alice</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Вывод на экран:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>level</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alice</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bob</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cindy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dave</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emma</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fred</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gail</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Последовательность работы такого запроса:</p>
</div>
<div class="paragraph">
<p>1) Создание и инициализация таблицы <code>under_alice</code>(<code>name,level</code>) с значениями <code>Alice</code>,<code>0</code>.</p>
</div>
<div class="paragraph">
<p>2) Соединение инициализирующего блока с рекурсивным благодаря <code>UNION</code>, благодаря чему выведется первая строка.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>level</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alice</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>3) Выполнение рекурсивного блока:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="no">SELECT</span> <span class="n">org</span><span class="o">.</span><span class="na">name</span><span class="o">,</span> <span class="n">under_alice</span><span class="o">.</span><span class="na">level</span><span class="o">+</span><span class="mi">1</span>
    <span class="no">FROM</span> <span class="n">org</span> <span class="no">JOIN</span> <span class="n">under_alice</span> <span class="no">ON</span> <span class="n">org</span><span class="o">.</span><span class="na">boss</span><span class="o">=</span><span class="n">under_alice</span><span class="o">.</span><span class="na">name</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>В результате которого в таблицу <code>under_alice()</code> попадут <code>Bob</code> и <code>Cindy</code>, поскольку они являются подчиненными Алисы. Значение <code>level = level(0) + 1 = 1</code>;</p>
</div>
<div class="paragraph">
<p>4) Соединение инициализирующего блока с рекурсивным благодаря <code>UNION</code>, благодаря чему выведется вторая и третья строка.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>level</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bob</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cindy</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>5) Выполнение рекурсивного запроса, благодаря чему выведутся на экран имена <code>Dave</code>, <code>Emma</code>, <code>Fred</code>, <code>Fail</code> с <code>level = 2</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_common">7. Common</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_github_keys">7.1. GitHub keys</h3>
<div class="sect3">
<h4 id="_ssh_key">7.1.1. SSH key</h4>
<div class="paragraph">
<p>С помощью протокола <strong>SSH</strong> можно подключаться и проходить проверку подлинности на удаленных серверах и службах. С помощью ключей <strong>SSH</strong> вы можете подключаться к <strong>GitHub</strong> без предоставления своего имени пользователя и личного маркера доступа при каждом посещении.</p>
</div>
<div class="paragraph">
<p>Для того чтобы использовать подключение с помощью протокола <strong>SSH</strong> необходимо сгенерировать <strong>SSH-KEY</strong>. В данном примере генерация происходит через <strong>GIT GUI</strong>.</p>
</div>
<div class="paragraph">
<p>Для генерации заходим <em>Git GUI Here</em>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/github-keys/ssh-generate1.png" alt="ssh generate1"></span></p>
</div>
<div class="paragraph">
<p>В появившемся окне выбираем вкладку <em>Help</em> - <em>Show SSH Key</em></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/github-keys/ssh-generate2.png" alt="ssh generate2"></span></p>
</div>
<div class="paragraph">
<p>Если, ключ не обнаружен, то производим генерацию ключа <em>Generate Key</em></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/github-keys/ssh-generate3.png" alt="ssh generate3"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/github-keys/ssh-generate4.png" alt="ssh generate4"></span></p>
</div>
<div class="paragraph">
<p>После того как ключ был сгенерирован или уже имелся, его нужно скопировать для установки в профиле. Для этого в настройки вашего профиля (<em>setting</em>).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/github-keys/ssh-install-git1.png" alt="ssh install git1"></span></p>
</div>
<div class="paragraph">
<p>Далее ищем вкладку <em>SSH and GPG keys</em></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/github-keys/ssh-install-git2.png" alt="ssh install git2"></span></p>
</div>
<div class="paragraph">
<p>Нажимаем <em>New SSH key</em></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/github-keys/ssh-install-git3.png" alt="ssh install git3"></span></p>
</div>
<div class="paragraph">
<p>Вставляем имеющийся ключ и добавляем <em>Add SSH key</em></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/github-keys/ssh-install-git4.png" alt="ssh install git4"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_gpg_key">7.1.2. GPG key</h4>
<div class="paragraph">
<p>С помощью <strong>GPG</strong> или <strong>S/MIME</strong> можно подписывать теги и коммиты. Эти теги или коммиты помечаются как проверенные на <strong>GitHub</strong>, чтобы другие люди могли быть уверены, что изменения происходят из надежного источника.</p>
</div>
<div class="paragraph">
<p>Сначала необходимо скачать и становить <a href="https://www.gnupg.org/download/"><strong>Gpg4win</strong></a></p>
</div>
<div class="paragraph">
<p>Затем заходим в Git Bush и вводим команду:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell script">gpg --full-generate-key</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/github-keys/gpg-generate1.png" alt="gpg generate1"></span></p>
</div>
<div class="paragraph">
<p>Затем выбирая нужные настройки нажимаем <em>Enter</em> до тех пор, пока не попросит подтвердить корректность данных и если все верно подтверждаем набрав <code>Y</code></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/github-keys/gpg-generate2.png" alt="gpg generate2"></span></p>
</div>
<div class="paragraph">
<p>Далее вводим свои данные: имя, email.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/github-keys/gpg-generate3.png" alt="gpg generate3"></span></p>
</div>
<div class="paragraph">
<p>Если все верно - подтверждаем введенные данные набрав`О`.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/github-keys/gpg-generate4.png" alt="gpg generate4"></span></p>
</div>
<div class="paragraph">
<p>Вводим пароль(секретное поле) и затем его подтверждаем</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/github-keys/gpg-generate5.png" alt="gpg generate5"></span></p>
</div>
<div class="paragraph">
<p>После этого наши GPG ключи сгенерированы.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/github-keys/gpg-generate6.png" alt="gpg generate6"></span></p>
</div>
<div class="paragraph">
<p>Чтобы посмотреть открытый и закрытый ключи необходимо ввести следующую команду:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell script">gpg --list-secret-keys --keyid-format=long
/Users/hubot/.gnupg/secring.gpg
------------------------------------
sec   4096R/3AA5C34371567BD2 2016-03-10 [expires: 2017-03-10]
uid                          Hubot
ssb   4096R/42B317FD4BA89E7A 2016-03-10</code></pre>
</div>
</div>
<div class="paragraph">
<p>Далее введя команду <strong>gpg --armor --export &#8230;&#8203;</strong>, и подставив место &#8230;&#8203; свое значение получим</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell script">gpg --armor --export 3AA5C34371567BD2</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/github-keys/gpg-install-git1.png" alt="gpg install git1"></span></p>
</div>
<div class="paragraph">
<p>После этого выделяем и копируем от <code>-----BEGIN PGP PUBLIC KEY BLOCK-----</code> до <code>-----END PGP PUBLIC KEY BLOCK-----</code></p>
</div>
<div class="paragraph">
<p>Далее, как и при добавлении <strong>SSH</strong> ключей заходим в свой профиль - <em>setting</em> - <em>SSH and GPG keys</em> и выбираем уже <em>New GPG key</em></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/github-keys/gpg-install-git2.png" alt="gpg install git2"></span></p>
</div>
<div class="paragraph">
<p>И в появившемся окне вставляем скопированный ключ и добавляем его.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/github-keys/gpg-install-git3.png" alt="gpg install git3"></span></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_тестирование">7.2. Тестирование</h3>
<div class="paragraph">
<p><strong>Тестирование</strong> (<strong>testing</strong>) <strong>программного обеспечения</strong> (<strong>ПО</strong>) – это процесс исследования ПО с целью выявления ошибок и определения соответствия между реальным и ожидаемым поведением ПО, осуществляемый на основе набора тестов, выбранных определённым образом. В более широком смысле, <strong>тестирование ПО</strong> – это техника контроля качества программного продукта, включающая в себя проектирование тестов, выполнение тестирования и анализ полученных результатов.</p>
</div>
<div class="paragraph">
<p>Очень часто современные программные продукты разрабатываются в сжатые сроки и при ограниченных бюджетах проектов. Программирование сегодня перешло из разряда искусства в разряд ремесел для многих миллионов специалистов. Но, к сожалению, в такой спешке разработчики зачастую игнорируют необходимость обеспечения защищённости своих продуктов, подвергая тем самым пользователей неоправданному риску. <strong>Контроль качества</strong> (<strong>тестирование</strong>) считается важным в <strong>процессе разработки ПО</strong>, потому что обеспечивает безопасность, надёжность, удобство создаваемого продукта. В настоящее время существует великое множество подходов и методик к решению задачи тестирования ПО, но эффективное тестирование сложных программных систем — процесс творческий, не сводящийся к следованию строгим и чётким правилам.</p>
</div>
<div class="sect3">
<h4 id="_классификация_видов_тестирования">7.2.1. Классификация видов тестирования</h4>
<div class="paragraph">
<p>Существует несколько признаков, по которым принято производить классификацию видов тестирования. Все <strong>виды тестирования</strong> программного обеспечения можно условно классифицировать по следующему виду:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>По степени автоматизации</p>
</li>
<li>
<p>По уровню доступа</p>
</li>
<li>
<p>В зависимости от преследуемых целей</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/testing/testing-diagram.png" alt="testing diagram"></span></p>
</div>
<div class="sect4">
<h5 id="_по_степени_автоматизации">По степени автоматизации</h5>
<div class="ulist">
<ul>
<li>
<p>Ручное тестирование;</p>
</li>
<li>
<p>Автоматизированное тестирование.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Ручное тестирование</strong> (<strong>manual testing</strong>) – тестирование при котором не используются программные средства для выполнения тестов и проверки результатов выполнения.</p>
</div>
<div class="paragraph">
<p><strong>Автоматизированное тестирование</strong> (<strong>automated testing</strong>) – тестирование, при котором используются программные средства для выполнения тестов и проверки результатов выполнения. <strong>Автоматизированное тестирование</strong>, несомненно, приносит пользу и экономит время и ресурсы компании.</p>
</div>
<div class="paragraph">
<p>В процессе разработки часто бывает так, что новая версия с исправленными ошибками выпускается каждый день, а иногда, и несколько раз в день. <strong>Smoke testing</strong> прежде всего должно быть <strong>автоматизировано</strong>, потому что сразу после сборки новой версии программы нам необходимо в кратчайшие сроки убедиться в том, что программа запускается. Автоматический тест справится с подобной задачей за считанные секунды, и сборку можно будет считать успешной. Если же этим будет заниматься человек, то времени на проверку будет уходить гораздо больше. Таким образом, автоматизация <strong>smoke testing</strong> – это неплохая экономия времени отдела тестирования.</p>
</div>
<div class="paragraph">
<p>Для <strong>автоматизации тестирования</strong> существует большое количество приложений. Наиболее популярные из них:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Selenium</p>
</li>
<li>
<p>TestComplete</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Автоматизация</strong> в целом не только экономит время на разработку, но и увеличивает надежность и безопасность создаваемых продуктов. Очевидны также преимущества для тестировщиков:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>надёжность проверки продукта возрастает</p>
</li>
<li>
<p>время на тестирование сокращается</p>
</li>
<li>
<p>работа тестирующего становится менее стрессовой</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Конечно, автоматические тесты никогда не смогут заменить человека, но могут облегчить работу инженера-тестировщика ПО.</p>
</div>
</div>
<div class="sect4">
<h5 id="_по_уровню_доступа">По уровню доступа</h5>
<div class="ulist">
<ul>
<li>
<p>Тестирование чёрного ящика;</p>
</li>
<li>
<p>Тестирование белого ящика.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_тестирование_чёрного_ящика">Тестирование чёрного ящика</h6>
<div class="paragraph">
<p><strong>Тестирование чёрного ящика</strong> (<strong>black box</strong>) - тестирование ПО, при котором тестировщик имеет доступ к ПО только через интерфейсы заказчика, либо через внешние интерфейсы, позволяющие другому компьютеру или процессу подключиться к системе для тестирования. Этот подход до сих пор является самым распространенным в повседневной практике, но у него есть целый ряд недостатков. Например, некоторые ошибки возникают достаточно редко и потому их трудно найти и воспроизвести.</p>
</div>
</div>
<div class="sect5">
<h6 id="_тестирование_белого_ящика">Тестирование белого ящика</h6>
<div class="paragraph">
<p><strong>Тестирование белого ящика</strong> (<strong>white box</strong>) - тестирование ПО, при котором тестировщик имеет доступ к исходному коду программы и может писать код, связанный с библиотеками тестируемого ПО. К тестированию белого ящика относят методики:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>чтение программ</p>
</li>
<li>
<p>формальный просмотр программ</p>
</li>
<li>
<p>инспекция</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Этот метод позволяет заглянуть внутрь <strong>"чёрного ящика"</strong> и сосредоточиться на внутренней информации, которая и определяет поведение программы. Основной трудностью является сложность отслеживания вычислений времени выполнения. При тестировании программы происходит проверка логики программы. Полным тестированием в этом случае будет такое, которое приведет к перебору всех возможных путей. Даже для средних по сложности программ число таких путей может достигать десятки тысяч.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_в_зависимости_от_преследуемых_целей">В зависимости от преследуемых целей</h5>
<div class="paragraph">
<p>Все <strong>виды тестирования</strong> программного обеспечения, в зависимости от преследуемых целей, можно условно разделить на следующие группы:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Функциональные</strong></p>
</li>
<li>
<p><strong>Нефункциональные</strong></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_функциональные_виды_тестирования">Функциональные виды тестирования</h6>
<div class="paragraph">
<p><strong>Функциональные тесты</strong> базируются на функциях и особенностях, а также взаимодействии с другими системами, и могут быть представлены на всех уровнях тестирования:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>компонентном</strong> или <strong>модульном</strong> (<strong>Component</strong>/<strong>Unit testing</strong>)</p>
</li>
<li>
<p><strong>интеграционном</strong> (<strong>Integration testing</strong>),</p>
</li>
<li>
<p><strong>системном</strong> (<strong>System testing</strong>)</p>
</li>
<li>
<p><strong>приемочном</strong> (<strong>Acceptance testing</strong>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Функциональные виды тестирования рассматривают внешнее поведение системы. После проведения необходимых изменений, таких как исправление бага/дефекта, программное обеспечение должно быть протестировано повторно для подтверждения того факта, что проблема была действительно решена. Ниже перечислены виды функционального тестирования, которые необходимо проводить после установки программного обеспечения, для подтверждения работоспособности приложения или правильности осуществленного исправления дефекта:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Функциональное тестирование</strong> (<strong>Functional testing</strong>)</p>
</li>
<li>
<p><strong>Тестирование взаимодействия</strong> (<strong>Interoperability Testing</strong>)</p>
</li>
<li>
<p><strong>Дымовое тестирование</strong> <strong>(Smoke Testing</strong>)</p>
</li>
<li>
<p><strong>Регрессионное тестирование</strong> (<strong>Regression Testing</strong>)</p>
</li>
<li>
<p><strong>Тестирование сборки</strong> (<strong>Build Verification Test</strong>)</p>
</li>
<li>
<p><strong>Санитарное тестирование или проверка согласованности/исправности</strong> (<strong>Sanity Testing</strong>)</p>
</li>
<li>
<p><strong>Альфа-тестирование</strong></p>
</li>
<li>
<p><strong>Бета-тестирование</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Функциональное тестирование</strong> (<strong>functional testing</strong>) – тестирование ПО, направленное на проверку реализуемости функциональных требований.
При функциональном тестировании проверяется способность ПО правильно решать задачи, необходимые пользователям.</p>
</div>
<div class="paragraph">
<p><strong>Альфа-тестирование</strong> – это процесс имитации реальной работы разработчиков с программным продуктом, или реальная работа потенциальных пользователей с системой.</p>
</div>
<div class="paragraph">
<p><strong>Бета-тестирование</strong> – это распространение версий с ограничениями для некоторой группы лиц, с целью проверки содержания допустимо минимального количества ошибок в программном продукте.</p>
</div>
<div class="paragraph">
<p><strong>Регрессионное тестирование</strong> (<strong>regression testing</strong>) – тестирование ПО, при котором проводится проверка ранее найденных ошибок, а также проверка основной функциональности.</p>
</div>
<div class="paragraph">
<p>Проводится, как правило, на каждой новой версии программного продукта. <strong>Регрессивное тестирование является наиболее важной фазой тестирования</strong> непосредственно перед окончанием работ над продуктом, так как непосредственно перед релизом продукта крайне необходимо проверить не только основную функциональность, но и то, что ни одна из ранее найденных ошибок не повторяется в финальной версии. Являясь неотъемлемой частью функционального тестирования, регрессионное тестирование позволяет гарантировать, что изменения, связанные с устранением дефектов, не оказали негативного воздействия на остальные функциональные области приложения.</p>
</div>
<div class="paragraph">
<p><strong>Дымовое тестирование</strong> (<strong>smoke testing</strong>) - тестирование ПО, при котором выполняется набор тестов, после чего можно сказать, что программный продукт запускается.</p>
</div>
<div class="paragraph">
<p>Если ошибок при запуске не происходит, то дымовой тест считается пройденным. Если программа не прошла дымовой тест, то её отправляют на доработку. Дело в том, что разработчики пишут отдельные компоненты одного приложения, но когда эти компоненты объединяют, нередко получается так, что совместно они работать не могут, следовательно, нет смысла тестировать продукт в целом.</p>
</div>
</div>
<div class="sect5">
<h6 id="_нефункциональные_виды_тестирования">Нефункциональные виды тестирования</h6>
<div class="paragraph">
<p>Нефункциональное тестирование описывает тесты, необходимые для определения характеристик программного обеспечения, которые могут быть измерены различными величинами. В целом, это тестирование того, "Как система работает". Далее перечислены основные <strong>виды нефункциональных тестов</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Тестирование производительности</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>нагрузочное тестирование</strong> (<strong>Performance and Load Testing</strong>)</p>
</li>
<li>
<p><strong>стрессовое тестирование</strong> (<strong>Stress Testing</strong>)</p>
</li>
<li>
<p><strong>тестирование стабильности или надежности</strong> (<strong>Stability/Reliability Testing</strong>)</p>
</li>
<li>
<p><strong>объемное тестирование</strong> (<strong>Volume Testing</strong>)</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Тестирование установки</strong> (<strong>Installation testing</strong>)</p>
</li>
<li>
<p><strong>Тестирование удобства пользования</strong> (<strong>Usability Testing</strong>)</p>
</li>
<li>
<p><strong>Тестирование на отказ и восстановление</strong> (<strong>Failover and Recovery Testing</strong>)</p>
</li>
<li>
<p><strong>Конфигурационное тестирование</strong> (<strong>Configuration Testing</strong>)</p>
</li>
<li>
<p><strong>Тестирование безопасности</strong> (<strong>Security and Access Control Testing</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Тестирование производительности</strong> (<strong>performance testing</strong>) – тестирование ПО, позволяющее осуществлять оценку быстродействия программного продукта при определённой нагрузке. Тест производительности выполняется до и после проведения оптимизации с целью выявить изменения в производительности. Если оптимизация не удается, и производительность снижается, то программист может отказаться от неудачной оптимизации. В случае повышения производительности величину этого повышения можно сравнить с ожидаемыми результатами, чтобы убедиться в успешности оптимизации. Задачей теста производительности является выявление фактов повышения и понижения производительности, чтобы можно было избежать неудачных модернизаций.</p>
</div>
<div class="paragraph">
<p><strong>Нагрузочное тестирование</strong> (<strong>load testing</strong>) – тестирование ПО, позволяющее осуществлять оценку быстродействия программного продукта при плановых, повышенных и пиковых нагрузках. Осуществление нагрузочного тестирования перед вводом системы в промышленную эксплуатацию позволяет избегать неожиданных потерь в производительности через полгода - год, когда система будет заполнена данными.</p>
</div>
<div class="paragraph">
<p><strong>Стресс-тестирование</strong> (<strong>stress testing</strong>) – тестирование ПО, которое оценивает надёжность и устойчивость системы в условиях превышения пределов нормального функционирования. Это проверка программы в таких стрессовых ситуациях как наличие большого объёма входных параметров, нехватка дискового пространства или маломощный процессор. <strong>Стресс тестирование</strong> предназначено для проверки настроенного решения и серверной группы на одновременное обслуживание большого количества пользователей. При таком тестировании проверяется не только серверная группа, но и влияние, оказываемое настройками на производительность системы в целом и ее отказоустойчивость. Для проведения такого тестирования необходимо иметь набор компьютеров, эмулирующих работу групп пользователей.</p>
</div>
<div class="paragraph">
<p><strong>Тестирование стабильности</strong> (<strong>stability/endurance/soak testing</strong>) – тестирование ПО, при котором проверяется работоспособность ПО при длительном тестировании со среднем уровнем нагрузки.</p>
</div>
<div class="paragraph">
<p><strong>Тестирование безопасности (security testing)</strong> – тестирование ПО, которое проверяет фактическую реакцию защитных механизмов, встроенных в систему на проникновение злоумышленников.</p>
</div>
<div class="paragraph">
<p><strong>Тестирование совместимости</strong> (<strong>compatibility testing</strong>) - тестирование ПО, которое проверяет работоспособность ПО в определенном окружении.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_уровни_тестирования">7.2.2. Уровни тестирования</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Модульное тестирование;</p>
</li>
<li>
<p>Интеграционное тестирование;</p>
</li>
<li>
<p>Системное тестирование;</p>
</li>
<li>
<p>Приемочное тестирование.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_пирамида_тестирования">Пирамида тестирования</h5>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/testing/test-pyramid.jpeg" alt="test pyramid"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/testing/test-hierarchy.png" alt="test hierarchy"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="_модульное_тестирование">Модульное тестирование</h5>
<div class="paragraph">
<p><strong>Модульное тестирование</strong> – это процесс исследования ПО, при котором тестируется минимально возможный компонент, например, отдельный класс или функция.
Часто модульное тестирование осуществляется разработчиками ПО.</p>
</div>
</div>
<div class="sect4">
<h5 id="_интеграционное_тестирование">Интеграционное тестирование</h5>
<div class="paragraph">
<p><strong>Интеграционное тестирование</strong> – это процесс исследования ПО, при котором тестируется интерфейсы между компонентами или подсистемами.</p>
</div>
</div>
<div class="sect4">
<h5 id="_системное_тестирование">Системное тестирование</h5>
<div class="paragraph">
<p><strong>Системное тестирование</strong> – это процесс исследования ПО, при котором тестируется интегрированная система на её соответствие требованиям заказчика. <strong>Альфа</strong> и <strong>Бета</strong> тестирование относятся к подкатегориям системного тестирования.</p>
</div>
</div>
<div class="sect4">
<h5 id="_приемочное_тестирование_acceptance_testing">Приемочное тестирование (Acceptance Testing)</h5>
<div class="paragraph">
<p><strong>Приемочное тестирование</strong> - формальный процесс тестирования, который проверяет соответствие системы требованиям и проводится с целью:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>определения удовлетворяет ли система приемочным критериям;</p>
</li>
<li>
<p>вынесения решения заказчиком или другим уполномоченным лицом принимается приложение или нет.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Приемочное тестирование</strong> выполняется на основании набора типичных тестовых случаев и сценариев, разработанных на основании требований к данному приложению. Решение о проведении приемочного тестирования принимается, когда:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>продукт достиг необходимого уровня качества;</p>
</li>
<li>
<p>заказчик ознакомлен с <strong>Планом Приемочных Работ</strong> (<strong>Product Acceptance Plan</strong>) или иным документом, где описан набор действий, связанных с проведением приемочного тестирования, дата проведения, ответственные и т.д.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Фаза приемочного тестирования</strong> длится до тех пор, пока заказчик не выносит решение об отправлении приложения на доработку или выдаче приложения.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_динамический_и_статический_анализ_кода">7.2.3. Динамический и статический анализ кода</h4>
<div class="paragraph">
<p>По мере продвижения проекта стоимость устранения дефектов ПО может экспоненциально возрастать. Инструменты <strong>статического</strong> и <strong>динамического</strong> анализа помогают предотвратить эти затраты благодаря обнаружению программных ошибок на ранних этапах жизненного цикла ПО.</p>
</div>
<div class="paragraph">
<p><strong>Динамический анализ кода</strong> (<strong>runtime analysis</strong>) – способ анализа программы непосредственно при ее выполнении. При динамическом анализе проблемы в исходном коде находятся по мере их возникновения. Процесс анализа можно разбить на несколько этапов:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>подготовка исходных данных</p>
</li>
<li>
<p>проведение тестового запуска программы</p>
</li>
<li>
<p>сбор необходимых параметров</p>
</li>
<li>
<p>анализ полученных данных</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Статический анализ кода</strong> (<strong>static analysis</strong>) - анализ программы, производимый без реального выполнения исследуемых программ. Статический анализ кода позволяет обнаружить дефекты в исходном коде до того, как код будет готов для запуска.</p>
</div>
<div class="paragraph">
<p>На практике разработчики могут использовать как статический, так и динамический анализ для ускорения процессов разработки и тестирования, а также для повышения качества исходного продукта.</p>
</div>
</div>
<div class="sect3">
<h4 id="_links_5">7.2.4. Links</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.protesting.ru/testing/testtypes.html">Виды тестирования программного обеспечения</a></p>
</li>
<li>
<p><a href="https://ru.wikipedia.org/wiki/%D0%9C%D0%BE%D0%B4%D1%83%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5_%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">Википедия. Модульное тестирование.</a></p>
</li>
<li>
<p><a href="http://www.protesting.ru/testing/levels/component.html">Компонентное или модульное тестирование.</a></p>
</li>
<li>
<p><a href="https://www.bluej.org/tutorial/testing-tutorial.pdf">Unit Testing in BlueJ.</a></p>
</li>
<li>
<p><a href="https://msdn.microsoft.com/ru-ru/library/windows/apps/jj159318.aspx">Модульное тестирование кода Visual C# в приложениях для Магазина Windows.</a></p>
</li>
<li>
<p><a href="http://rsdn.org/article/testing/UnitTesting.xml">Модульное тестирование: 2+2 = 4?</a></p>
</li>
<li>
<p><a href="https://ru.wikipedia.org/wiki/%D0%98%D0%BD%D1%82%D0%B5%D0%B3%D1%80%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D0%BE%D0%B5_%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">Википедия. Интеграционное тестирование.</a></p>
</li>
<li>
<p><a href="http://www.protesting.ru/testing/levels/system.html">Системное тестирование.</a></p>
</li>
<li>
<p><a href="http://www.softwaretestingclass.com/system-testing-what-why-how/">System Testing: What? Why? &amp; How?</a></p>
</li>
<li>
<p><a href="https://ru.wikipedia.org/wiki/%D0%A4%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5_%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">Википедия. Функциональное тестирование.</a></p>
</li>
<li>
<p><a href="https://symfony.com/legacy/doc/jobeet/1_4/ru/09?orm=doctrine">День 9: Функциональное тестирование.</a></p>
</li>
<li>
<p><a href="http://www.protesting.ru/testing/types/functional.html">Функциональное тестирование.</a></p>
</li>
<li>
<p>StackOverflow. <a href="https://stackoverflow.com/questions/2741832/unit-tests-vs-functional-tests">Unit tests vs Functional Testing.</a></p>
</li>
<li>
<p><a href="">Unit, Integration, and Functional Testing</a></p>
</li>
<li>
<p><a href="https://ru.wikipedia.org/wiki/%D0%A2%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%BE%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D0%B8">Википедия. Тестирование производительности.</a></p>
</li>
<li>
<p><a href="http://www.protesting.ru/testing/types/loadtesttypes.html">Нагрузочное тестирование.</a></p>
</li>
<li>
<p><a href="http://www.protesting.ru/automation/performance.html">Автоматизация нагрузочного тестирования.</a></p>
</li>
<li>
<p><a href="https://ru.wikipedia.org/wiki/%D0%9D%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BE%D1%87%D0%BD%D0%BE%D0%B5_%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">Википедия. Нагрузочное тестирование.</a></p>
</li>
<li>
<p><a href="http://www.protesting.ru/testing/types/loadtesttypes.html">Нагрузочное тестирование.</a></p>
</li>
<li>
<p><a href="https://ru.wikipedia.org/wiki/%D0%A1%D1%82%D1%80%D0%B5%D1%81%D1%81-%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%BD%D0%BE%D0%B3%D0%BE_%D0%BE%D0%B1%D0%B5%D1%81%D0%BF%D0%B5%D1%87%D0%B5%D0%BD%D0%B8%D1%8F">Википедия. Стресс-тестирование программного обеспечения.</a></p>
</li>
<li>
<p><a href="https://devblogs.microsoft.com/cppblog/vc-ide-design-time-stress-testing/">VC++ IDE / Design Time Stress Testing</a></p>
</li>
<li>
<p><a href="https://ru.wikipedia.org/wiki/%D0%A2%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%81%D1%82%D0%B0%D0%B1%D0%B8%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D0%B8">Википедия. Тестирование стабильности.</a></p>
</li>
<li>
<p><a href="https://ru.wikipedia.org/wiki/%D0%A2%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D0%B8">Википедия. Тестирование безопасности.</a></p>
</li>
<li>
<p><a href="https://ru.wikipedia.org/wiki/%D0%A2%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE_%D1%81%D1%82%D1%80%D0%B0%D1%82%D0%B5%D0%B3%D0%B8%D0%B8_%D1%87%D1%91%D1%80%D0%BD%D0%BE%D0%B3%D0%BE_%D1%8F%D1%89%D0%B8%D0%BA%D0%B0">Википедия. Тестирование по стратегии чёрного ящика.</a></p>
</li>
<li>
<p><a href="https://ru.wikipedia.org/wiki/%D0%A2%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE_%D1%81%D1%82%D1%80%D0%B0%D1%82%D0%B5%D0%B3%D0%B8%D0%B8_%D0%B1%D0%B5%D0%BB%D0%BE%D0%B3%D0%BE_%D1%8F%D1%89%D0%B8%D0%BA%D0%B0">Википедия. Стратегия тестирования по принципу "Белого ящика".</a></p>
</li>
<li>
<p><a href="https://dic.academic.ru/dic.nsf/ruwiki/392944">Альфа тестирование.</a></p>
</li>
<li>
<p><a href="https://ru.wikipedia.org/wiki/%D0%91%D0%B5%D1%82%D0%B0-%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">Википедия. Бета-тестирование.</a></p>
</li>
<li>
<p><a href="https://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D0%B3%D1%80%D0%B5%D1%81%D1%81%D0%B8%D0%BE%D0%BD%D0%BD%D0%BE%D0%B5_%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">Википедия. Регрессивное тестирование.</a></p>
</li>
<li>
<p><a href="http://www.protesting.ru/testing/types/regression.html">Регрессивное тестирование.</a></p>
</li>
<li>
<p><a href="https://ru.wikipedia.org/wiki/Smoke_test">Википедия. Smoke test.</a></p>
</li>
<li>
<p><a href="http://www.protesting.ru/testing/types/smoke.html">Дымовое тестирование.</a></p>
</li>
<li>
<p><a href="https://tpl-it.wikispaces.com/%d0%a0%d1%83%d1%87%d0%bd%d0%be%d0%b5+%d1%82%d0%b5%d1%81%d1%82%d0%b8%d1%80%d0%be%d0%b2%d0%b0%d0%bd%d0%b8%d0%b5+(manual+testing)">Ручное тестирование.</a></p>
</li>
<li>
<p><a href="https://habr.com/ru/post/145974/">Тестирование: Ручное или Автоматизированное?</a></p>
</li>
<li>
<p><a href="">Автоматизированное тестирование.</a></p>
</li>
<li>
<p><a href="https://habr.com/ru/post/145974/">Тестирование: Ручное или Автоматизированное?</a></p>
</li>
<li>
<p><a href="https://pvs-studio.com/ru/blog/terms/0070/">Динамический анализ кода.</a></p>
</li>
<li>
<p><a href="https://ru.wikipedia.org/wiki/%D0%94%D0%B8%D0%BD%D0%B0%D0%BC%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7_%D0%BA%D0%BE%D0%B4%D0%B0">Википедия. Динамический анализ кода.</a></p>
</li>
<li>
<p><a href="https://ru.wikipedia.org/wiki/%D0%A1%D1%82%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7_%D0%BA%D0%BE%D0%B4%D0%B0">Википедия. Статический анализ кода.</a></p>
</li>
<li>
<p><a href="https://pvs-studio.com/ru/blog/terms/0046/">Статический анализ кода.</a></p>
</li>
<li>
<p><a href="https://pvs-studio.com/ru/blog/posts/a0087/">Джон Кармак о статическом анализе кода.</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_web_services">7.3. Web services</h3>
<div class="paragraph">
<p>В каждой отрасли бизнеса, каждой компании, как правило, используется огромное количество ПО, которым нужно взаимодействовать между собой. За десятилетия существования <strong>Web</strong> как отрасли сформировались следующие практики межсетевого взаимодействия:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Обмен файлами по <strong>FTP</strong>.</p>
</li>
<li>
<p>Неструктурированные <strong>HTTP</strong>-запросы, договорённости между разработчиками.</p>
</li>
<li>
<p><strong>Web services</strong>.</p>
</li>
<li>
<p><strong>Sockets</strong>, порты, бинарные объекты.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Web services</strong> (<strong>веб сервисы</strong>, <strong>веб службы</strong>) - это технология, позволяющая системам обмениваться данными друг с другом через сетевое подключение. Обычно веб-сервисы работают поверх протокола <strong>HTTP</strong> или протокола более высокого уровня. <strong>Web service</strong> — просто адрес, ссылка, обращение к которому позволяет получить данные или выполнить действие.</p>
</div>
<div class="paragraph">
<p>Другими словами <strong>web service</strong> это код, доступный по протоколу (например <strong>HTTP</strong>) и возвращающий информацию в каком-то формате (например <strong>XML</strong>, <strong>JSON</strong>) конкретному приложению.</p>
</div>
<div class="paragraph">
<p><strong>Web service</strong> можно использовать для одного приложения на компьютере или предоставить к нему доступ через <strong>Интернет</strong> любому числу приложений. Поскольку доступ к <strong>web service</strong> выполняется через стандартный интерфейс, с нем могут работать различные системы, образуя единую вычислительную сеть.</p>
</div>
<div class="paragraph">
<p>В <strong>web services</strong> всегда есть клиент и сервер. Сервер – это и есть наш <strong>web service</strong> и иногда его называют <strong>endpoint</strong> (типа как, конечная точка, куда доходят сообщения от клиента).</p>
</div>
<div class="paragraph">
<p>Самые известные способы реализации веб-сервисов:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>XML-RPC</strong> (<strong>XML Remote Procedure Call</strong>) — протокол удаленного вызова процедур с использованием <strong>XML</strong>. Прародитель <strong>SOAP</strong>. Предельно прост в реализации.</p>
</li>
<li>
<p><strong>SOAP</strong> (<strong>Simple Object Access Protocol</strong>) — стандартный протокол по версии <strong>W3C</strong>. Четко структурирован и задокументирован.</p>
</li>
<li>
<p><strong>JSON-RPC</strong> (<strong>JSON Remote Procedure Call</strong>) — более современный аналог <strong>XML-RPC</strong>. Основное отличие — данные передаются в формате <strong>JSON</strong>.</p>
</li>
<li>
<p><strong>REST</strong> (<strong>Representational State Transfer</strong>) — архитектурный стиль взаимодействия компьютерных систем в сети основанный на методах протокола <strong>HTTP</strong>.</p>
</li>
<li>
<p>Специализированные протоколы для конкретного вида задач, такие как <strong>GraphQL</strong>.</p>
</li>
<li>
<p>Менее распространенный, но более эффективный <strong>gRPC</strong>, передающий данные в бинарном виде и использующий <strong>HTTP/2</strong> в качестве транспорта.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Главное отличие web service</strong> от других способов передачи данных: <strong>стандартизированность</strong>. Приняв решение использовать веб-сервисы, можно сразу переходить к структуре данных и доступным функциям. Например, В <strong>SOAP</strong> (как более строгом протоколе), уже решён вопрос уведомления об ошибках.</p>
</div>
<div class="sect3">
<h4 id="_soap_web_services">7.3.1. SOAP web-services</h4>
<div class="paragraph">
<p><strong>SOAP</strong> <strong>web-services</strong> ("<strong>Big web-service</strong>", классический <strong>web-service</strong>) - это протокол, предназначенный для обмена структурированной информацией в децентрализованной распределенной среде. Первоначально <strong>SOAP</strong> расшифровывался как <strong>Simple Object Access Protocol</strong> и предназначался в основном для реализации удалённого вызова процедур (<strong>RPC</strong>). Сейчас протокол используется для обмена произвольными сообщениями в формате <strong>XML</strong>, а не только для вызова процедур.</p>
</div>
<div class="paragraph">
<p><strong>SOAP</strong> использует технологии <strong>XML</strong> для определения расширяемой инфраструктуры обмена сообщениями, обеспечивающей конструкцию сообщения, которой можно обмениваться по множеству базовых протоколов. Платформа была разработана так, чтобы быть независимой от какого-либо языка программирования и другой специфической семантики реализации.</p>
</div>
<div class="paragraph">
<p>Протокол <strong>SOAP</strong> не различает вызов процедуры и ответ на него, а просто определяет формат послания (<strong>message</strong>) в виде документа <strong>XML</strong>. Послание может содержать вызов процедуры, ответ на него, запрос на выполнение каких-то других действий или просто текст. Спецификацию <strong>SOAP</strong> не интересует содержимое послания, она задает только его оформление.</p>
</div>
<div class="paragraph">
<p>Две основные цели разработки <strong>SOAP</strong> - это простота и расширяемость. <strong>SOAP</strong> пытается достичь этих целей, исключая из инфраструктуры обмена сообщениями функции, которые часто встречаются в распределенных системах. Такие функции включают, помимо прочего, «надежность», «безопасность», «корреляцию», «маршрутизацию» и «шаблоны обмена сообщениями» (<strong>MEP</strong>). Хотя ожидается, что будут определены многие функции, эта спецификация предоставляет подробные сведения только для двух <strong>MEP</strong>. Остальные функции оставлены для определения как расширения другими спецификациями.</p>
</div>
<div class="paragraph">
<p>Как было сказано выше, <strong>SOAP</strong> является протоколом и имеет спецификацию. В качестве транспортного протокола может использовать <strong>HTTP</strong>, <strong>SMTP</strong>, <strong>FTP</strong>, <strong>JMS</strong>. Все детали сообщений (в обе стороны – от клиента к серверу и обратно) передаются в стандартизованном <strong>XML</strong>-документе. <strong>SOAP</strong> чаще всего применяется поверх <strong>HTTP</strong>(<strong>S</strong>).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/web-services/soap-architecture.png" alt="soap architecture"></span></p>
</div>
<div class="paragraph">
<p><strong>SOAP</strong> – это базовая однонаправленная модель соединения, обеспечивающая согласованную передачу сообщения от отправителя к получателю, потенциально допускающая наличие посредников, которые могут обрабатывать часть сообщения или добавлять к нему дополнительные элементы. Спецификация <strong>SOAP</strong> содержит соглашения по преобразованию однонаправленного обмена сообщениями в соответствии с принципом «запрос/ответ», а также определяет как осуществлять передачу всего <strong>XML</strong>-документа.</p>
</div>
<div class="paragraph">
<p>Нужно отметить, что определение <strong>SOAP</strong> <strong>web-services</strong> состоит из набора протоколов (спецификаций):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Протокол <strong>SOAP</strong> необходим для реализации возможностей обратного вызова</p>
</li>
<li>
<p>Протокол <strong>WSDL</strong> (<strong>Web-Service Description Language</strong>) язык определения <strong>web-services</strong> или язык описания внешних интерфейсов web-службы на базе <strong>XML</strong></p>
</li>
<li>
<p>Протокол <strong>UDDI</strong> (<strong>необязательный</strong>) (<strong>Universal Description, Discovery, Interoperability</strong>) универсальное описание или каталог веб-служб и сведений предоставляющих <strong>WSDL</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/web-services/web-service-soap.png" alt="web service soap"></span></p>
</div>
<div class="sect4">
<h5 id="_soap_message">SOAP message</h5>
<div class="paragraph">
<p>Любое сообщение в протоколе <strong>SOAP</strong> — это <strong>XML</strong> документ.</p>
</div>
<div class="paragraph">
<p>Данный документ состоит из следующих элементов (тегов):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>SOAP Envelope</strong> — конверт (корневой обязательный элемент), который определяет сообщение и пространство имен, использованное в документе.</p>
</li>
<li>
<p><strong>SOAP Header</strong> — заголовок, необязательный элемент, содержит атрибуты сообщения, например: информация о безопасности или о сетевой маршрутизации.</p>
</li>
<li>
<p><strong>SOAP Body</strong> — основной элемент, содержит сообщение, которым обмениваются приложения.</p>
</li>
<li>
<p><strong>Fault</strong> — необязательный элемент, предоставляет информацию об ошибках, которые произошли при обработке сообщений.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/web-services/soap-message.png" alt="soap message"></span></p>
</div>
<div class="paragraph">
<p>Конверт является самым «верхним» элементом <strong>SOAP</strong> сообщения. Описывается с помощью элемента <code>Envelope</code> с обязательным пространством имен <code><a href="http://www.w3.org/2003/05/soap-envelope" class="bare">http://www.w3.org/2003/05/soap-envelope</a></code> для версии 1.2 и <code><a href="http://schemas.xmlsoap.org/soap/" class="bare">http://schemas.xmlsoap.org/soap/</a></code> для версии 1.1. У элемента <code>Envelope</code> могут быть атрибуты <code>xmlns</code>, определяющие пространства имен, и другие атрибуты, снабженные префиксами.</p>
</div>
<div class="paragraph">
<p>Заголовок <strong>SOAP</strong> является не обязательный. Заголовок кроме атрибутов <code>xmlns</code> может содержать 0 или более стандартных атрибутов:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>encodingStyle</code></p>
</li>
<li>
<p><code>actor</code> (или role для версии 1.2)</p>
</li>
<li>
<p><code>mustUnderstand</code></p>
</li>
<li>
<p><code>relay</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Элемент <code>Body</code> обязательно записывается сразу за элементом <code>Header</code>, если он есть в сообщении, или первым в <strong>SOAP</strong>-сообщении, если заголовок отсутствует. В элемент <code>Body</code> можно вложить произвольные элементы, спецификация никак не определяет их структуру. Определен только один стандартный элемент, который может быть в теле сообщения - <code>Fault</code>, содержащий сообщение об ошибке.</p>
</div>
<div class="paragraph">
<p>Если <strong>SOAP</strong>-сервер, обрабатывая поступившее <strong>SOAP</strong>-сообщение, обнаружит ошибку, то он прекратит обработку и отправит клиенту <strong>SOAP</strong>-сообщение, содержащее один элемент <code>Fault</code> с сообщением об ошибке.</p>
</div>
<div class="paragraph">
<p>Пример запроса на сервер:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;soap:Envelope</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns:xsd=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span> <span class="na">xmlns:soap=</span><span class="s">"http://schemas.xmlsoap.org/soap/envelope/"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;soap:Body&gt;</span>
     <span class="nt">&lt;getProductDetails</span> <span class="na">xmlns=</span><span class="s">"www.example.com"</span><span class="nt">&gt;</span>
       <span class="nt">&lt;productID&gt;</span>12345<span class="nt">&lt;/productID&gt;</span>
     <span class="nt">&lt;/getProductDetails&gt;</span>
   <span class="nt">&lt;/soap:Body&gt;</span>
<span class="nt">&lt;/soap:Envelope&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Пример ответа:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;soap:Envelope</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns:xsd=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span> <span class="na">xmlns:soap=</span><span class="s">"http://schemas.xmlsoap.org/soap/envelope/"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;soap:Body&gt;</span>
     <span class="nt">&lt;getProductDetailsResponse</span> <span class="na">xmlns=</span><span class="s">"www.example.com"</span><span class="nt">&gt;</span>
       <span class="nt">&lt;getProductDetailsResult&gt;</span>
         <span class="nt">&lt;productID&gt;</span>12345<span class="nt">&lt;/productID&gt;</span>
         <span class="nt">&lt;productName&gt;</span>Стакан граненый<span class="nt">&lt;/productName&gt;</span>
         <span class="nt">&lt;description&gt;</span>Стакан граненый. 250 мл.<span class="nt">&lt;/description&gt;</span>
         <span class="nt">&lt;price&gt;</span>9.95<span class="nt">&lt;/price&gt;</span>
         <span class="nt">&lt;currency&gt;</span>
             <span class="nt">&lt;code&gt;</span>840<span class="nt">&lt;/code&gt;</span>
             <span class="nt">&lt;alpha3&gt;</span>USD<span class="nt">&lt;/alpha3&gt;</span>
             <span class="nt">&lt;sign&gt;</span>$<span class="nt">&lt;/sign&gt;</span>
             <span class="nt">&lt;name&gt;</span>US dollar<span class="nt">&lt;/name&gt;</span>
             <span class="nt">&lt;accuracy&gt;</span>2<span class="nt">&lt;/accuracy&gt;</span>
         <span class="nt">&lt;/currency&gt;</span>
         <span class="nt">&lt;inStock&gt;</span>true<span class="nt">&lt;/inStock&gt;</span>
       <span class="nt">&lt;/getProductDetailsResult&gt;</span>
     <span class="nt">&lt;/getProductDetailsResponse&gt;</span>
   <span class="nt">&lt;/soap:Body&gt;</span>
<span class="nt">&lt;/soap:Envelope&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_wsdl">WSDL</h5>
<div class="paragraph">
<p><strong>WSDL</strong> (<strong>Web Services Description Language</strong>) — язык описания веб-сервисов и доступа к ним, основанный на языке <strong>XML</strong>.</p>
</div>
<div class="paragraph">
<p>Другими словами, определения <strong>WSDL</strong> описывают, как получить доступ к веб-службе и какие операции она будет выполнять.</p>
</div>
<div class="paragraph">
<p>Каждый документ <strong>WSDL 1.1</strong> можно разбить на следующие логические части:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Определение типов данных (<strong>types</strong>) — определение вида отправляемых и получаемых сервисом <strong>XML</strong>-сообщений</p>
</li>
<li>
<p>Элементы данных (<strong>message</strong>) — сообщения, используемые web-сервисом</p>
</li>
<li>
<p>Абстрактные операции (<strong>portType</strong>) — список операций, которые могут быть выполнены с сообщениями</p>
</li>
<li>
<p>Связывание сервисов (<strong>binding</strong>) — способ, которым сообщение будет доставлено</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../assets/img/common/web-services/wsdl-file.png" alt="wsdl file"></span></p>
</div>
<div class="paragraph">
<p>Документ WSDL содержит следующие элементы:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Определение</strong> — это корневой элемент всех документов <strong>WSDL</strong>. Он определяет имя веб-службы, объявляет несколько пространств имен, используемых в оставшейся части документа, и содержит все элементы службы, описанные здесь.</p>
</li>
<li>
<p><strong>Типы данных</strong> — типы данных, которые будут использоваться в сообщениях, представлены в форме схем <strong>XML</strong>.</p>
</li>
<li>
<p><strong>Сообщение — это абстрактное определение данных в форме сообщения, представленного либо в виде всего документа, либо в качестве аргументов, которые</strong> должны быть сопоставлены с вызовом метода.</p>
</li>
<li>
<p><strong>Операция</strong> — это абстрактное определение операции для сообщения, например, присвоение имени методу, очереди сообщений или бизнес-процессу, которое примет и обработает сообщение.</p>
</li>
<li>
<p><strong>Тип порта</strong> — это абстрактный набор операций, сопоставленный с одной или несколькими конечными точками, определяющий набор операций для привязки; коллекция операций, как она абстрактна, может быть сопоставлена с несколькими транспортными средствами через различные привязки.</p>
</li>
<li>
<p><strong>Связывание</strong> — это конкретный протокол и форматы данных для операций и сообщений, определенных для определенного типа порта.</p>
</li>
<li>
<p><strong>Порт</strong> — это сочетание привязки и сетевого адреса, обеспечивающее целевой адрес службы связи.</p>
</li>
<li>
<p><strong>Сервис</strong> — это набор связанных конечных точек, охватывающий определения сервиса в файле; службы сопоставляют привязку с портом и включают любые определения расширяемости.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>В дополнение к этим основным элементам спецификация <strong>WSDL</strong> также определяет следующие служебные элементы:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Документация</strong> — Этот элемент используется для предоставления удобочитаемой документации и может быть включен в любой другой элемент <strong>WSDL</strong>.</p>
</li>
<li>
<p><strong>Импорт</strong> — этот элемент используется для импорта других документов WSDL или схем XML.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Файл <strong>WSDL</strong> выглядит следующим образом:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;definitions</span> <span class="na">name =</span> <span class="s">"HelloService"</span>
   <span class="na">targetNamespace =</span> <span class="s">"http://www.examples.com/wsdl/HelloService.wsdl"</span>
   <span class="na">xmlns =</span> <span class="s">"http://schemas.xmlsoap.org/wsdl/"</span>
   <span class="na">xmlns:soap =</span> <span class="s">"http://schemas.xmlsoap.org/wsdl/soap/"</span>
   <span class="na">xmlns:tns =</span> <span class="s">"http://www.examples.com/wsdl/HelloService.wsdl"</span>
   <span class="na">xmlns:xsd =</span> <span class="s">"http://www.w3.org/2001/XMLSchema"</span><span class="nt">&gt;</span>

   <span class="nt">&lt;message</span> <span class="na">name =</span> <span class="s">"SayHelloRequest"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;part</span> <span class="na">name =</span> <span class="s">"firstName"</span> <span class="na">type =</span> <span class="s">"xsd:string"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;/message&gt;</span>

   <span class="nt">&lt;message</span> <span class="na">name =</span> <span class="s">"SayHelloResponse"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;part</span> <span class="na">name =</span> <span class="s">"greeting"</span> <span class="na">type =</span> <span class="s">"xsd:string"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;/message&gt;</span>

   <span class="nt">&lt;portType</span> <span class="na">name =</span> <span class="s">"Hello_PortType"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;operation</span> <span class="na">name =</span> <span class="s">"sayHello"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;input</span> <span class="na">message =</span> <span class="s">"tns:SayHelloRequest"</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;output</span> <span class="na">message =</span> <span class="s">"tns:SayHelloResponse"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/operation&gt;</span>
   <span class="nt">&lt;/portType&gt;</span>

   <span class="nt">&lt;binding</span> <span class="na">name =</span> <span class="s">"Hello_Binding"</span> <span class="na">type =</span> <span class="s">"tns:Hello_PortType"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;soap:binding</span> <span class="na">style =</span> <span class="s">"rpc"</span>
         <span class="na">transport =</span> <span class="s">"http://schemas.xmlsoap.org/soap/http"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;operation</span> <span class="na">name =</span> <span class="s">"sayHello"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;soap:operation</span> <span class="na">soapAction =</span> <span class="s">"sayHello"</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;input&gt;</span>
            <span class="nt">&lt;soap:body</span>
               <span class="na">encodingStyle =</span> <span class="s">"http://schemas.xmlsoap.org/soap/encoding/"</span>
               <span class="na">namespace =</span> <span class="s">"urn:examples:helloservice"</span>
               <span class="na">use =</span> <span class="s">"encoded"</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/input&gt;</span>

         <span class="nt">&lt;output&gt;</span>
            <span class="nt">&lt;soap:body</span>
               <span class="na">encodingStyle =</span> <span class="s">"http://schemas.xmlsoap.org/soap/encoding/"</span>
               <span class="na">namespace =</span> <span class="s">"urn:examples:helloservice"</span>
               <span class="na">use =</span> <span class="s">"encoded"</span><span class="nt">/&gt;</span>
         <span class="nt">&lt;/output&gt;</span>
      <span class="nt">&lt;/operation&gt;</span>
   <span class="nt">&lt;/binding&gt;</span>

   <span class="nt">&lt;service</span> <span class="na">name =</span> <span class="s">"Hello_Service"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;documentation&gt;</span>WSDL File for HelloService<span class="nt">&lt;/documentation&gt;</span>
      <span class="nt">&lt;port</span> <span class="na">binding =</span> <span class="s">"tns:Hello_Binding"</span> <span class="na">name =</span> <span class="s">"Hello_Port"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;soap:address</span>
            <span class="na">location =</span> <span class="s">"http://www.examples.com/SayHello/"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/port&gt;</span>
   <span class="nt">&lt;/service&gt;</span>
<span class="nt">&lt;/definitions&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Definitions</strong> - <code>HelloService</code></p>
</li>
<li>
<p><strong>Type</strong> - использование встроенных типов данных, которые определены в <strong>XMLSchema</strong>.</p>
</li>
<li>
<p><strong>Message</strong></p>
<div class="ulist">
<ul>
<li>
<p><code>sayHelloRequest</code> - параметр firstName</p>
</li>
<li>
<p><code>sayHelloresponse</code> - возвращаемое значение приветствия</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Port Type</strong> - операция <code>sayHello</code>, состоящая из службы запроса и ответа.</p>
</li>
<li>
<p><strong>Binding</strong>  - Направление использования транспортного протокола <strong>SOAP</strong> <strong>HTTP</strong>.</p>
</li>
<li>
<p><strong>Service</strong>  - Сервис доступен по адресу <code><a href="http://www.examples.com/SayHello/" class="bare">http://www.examples.com/SayHello/</a></code>.</p>
</li>
<li>
<p><strong>Port</strong>  - связывает привязку с <strong>URI</strong> <code><a href="http://www.examples.com/SayHello/" class="bare">http://www.examples.com/SayHello/</a></code>, по которому можно получить доступ к работающей службе.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_преимущества">Преимущества</h5>
<div class="paragraph">
<p>Преимущества:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Работа с методами</p>
</li>
<li>
<p>Наличие строгой спецификации</p>
</li>
<li>
<p>Большое количества спецификаций</p>
</li>
<li>
<p>Поддержка транзакций, уровней безопасности и пр.</p>
</li>
<li>
<p>Различные транспортные уровни (<strong>HTTP</strong>, <strong>SMTP</strong>, <strong>FTP</strong>, <strong>JMS</strong>)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_недостатки">Недостатки</h5>
<div class="paragraph">
<p>Недостатки:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Сложность реализации (по сравнению с <strong>REST</strong>);</p>
</li>
<li>
<p>Работа только через <strong>XML</strong></p>
</li>
<li>
<p>Сложность/ресурсоемкость парсинга XML-данных</p>
</li>
<li>
<p>При изменениях необходимо обновлять <strong>WSDL</strong>, и, следовательно, вносить изменения на клиенте</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_restful">7.3.2. RESTful</h4>
<div class="paragraph">
<p><strong>REST</strong> (<strong>Representational State Transfer</strong>) — на самом деле архитектурный стиль, а не протокол. Фактически, он основывается на соглашениях. Сервис построенный в стиле REST называется REST-сервисом. Веб-сервис, построенный с учетом всех требований и ограничений архитектурного стиля, можно назвать <strong>RESTful</strong> веб-сервисом.</p>
</div>
<div class="paragraph">
<p><strong>REST</strong> не зависит от какого-либо протокола, но почти каждый <strong>RESTful</strong> сервис использует <strong>HTTP</strong> как основной протокол.</p>
</div>
<div class="paragraph">
<p>Существует шесть обязательных ограничений для построения распределённых <strong>REST</strong>-приложений:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Модель клиент-сервер</p>
</li>
<li>
<p>Отсутствие состояния</p>
</li>
<li>
<p>Кэширование</p>
</li>
<li>
<p>Единообразие интерфейса</p>
</li>
<li>
<p>Слои</p>
</li>
<li>
<p>Код по требованию (необязательное ограничение)</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_модель_клиент_сервер">Модель клиент-сервер</h5>
<div class="paragraph">
<p>Первым ограничением, применимым к гибридной модели, является приведение архитектуры к модели клиент-сервер. Разграничение потребностей является принципом, лежащим в основе данного накладываемого ограничения. Отделение потребности интерфейса клиента от потребностей сервера, хранящего данные, повышает переносимость кода клиентского интерфейса на другие платформы, а упрощение серверной части улучшает масштабируемость. Наибольшее же влияние на всемирную паутину, пожалуй, имеет само разграничение, которое позволяет отдельным частям развиваться независимо друг от друга, поддерживая потребности в развитии интернета со стороны различных организаций.</p>
</div>
</div>
<div class="sect4">
<h5 id="_отсутствие_состояния">Отсутствие состояния</h5>
<div class="paragraph">
<p>Протокол взаимодействия между клиентом и сервером требует соблюдения следующего условия: в период между запросами клиента никакая информация о состоянии клиента на сервере не хранится (Stateless protocol или «протокол без сохранения состояния»). Все запросы от клиента должны быть составлены так, чтобы сервер получил всю необходимую информацию для выполнения запроса. Состояние сессии при этом сохраняется на стороне клиента. Информация о состоянии сессии может быть передана сервером какому-либо другому сервису (например, в службу базы данных) для поддержания устойчивого состояния, например, на период установления аутентификации. Клиент инициирует отправку запросов, когда он готов (возникает необходимость) перейти в новое состояние.</p>
</div>
<div class="paragraph">
<p>Во время обработки клиентских запросов считается, что клиент находится в переходном состоянии. Каждое отдельное состояние приложения представлено связями, которые могут быть задействованы при следующем обращении клиента.</p>
</div>
</div>
<div class="sect4">
<h5 id="_кэширование">Кэширование</h5>
<div class="paragraph">
<p>Как и во Всемирной паутине, клиенты, а также промежуточные узлы, могут выполнять кэширование ответов сервера. Ответы сервера, в свою очередь, должны иметь явное или неявное обозначение как кэшируемые или некэшируемые с целью предотвращения получения клиентами устаревших или неверных данных в ответ на последующие запросы. Правильное использование кэширования способно частично или полностью устранить некоторые клиент-серверные взаимодействия, ещё больше повышая производительность и масштабируемость системы.</p>
</div>
</div>
<div class="sect4">
<h5 id="_единообразие_интерфейса">Единообразие интерфейса</h5>
<div class="paragraph">
<p>К фундаментальным требованиям <strong>REST</strong> архитектуры относится и унифицированный, единообразный интерфейс. Клиент должен всегда понимать, в каком формате и на какие адреса ему нужно слать запрос, а сервер, в свою очередь, также должен понимать, в каком формате ему следует отвечать на запросы клиента. Этот единый формат клиент-серверного взаимодействия, который описывает, что, куда, в каком виде и как отсылать и является унифицированным интерфейсом.</p>
</div>
<div class="paragraph">
<p>Наличие унифицированного интерфейса является фундаментальным требованием дизайна <strong>REST</strong>-сервисов. Унифицированные интерфейсы позволяют каждому из сервисов развиваться независимо.</p>
</div>
<div class="paragraph">
<p>К унифицированным интерфейсам предъявляются следующие четыре ограничительных условия:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Идентификация ресурсов</strong>. Все ресурсы идентифицируются в запросах, например, с использованием <strong>URI</strong> в интернет-системах. Ресурсы концептуально отделены от представлений, которые возвращаются клиентам. Например, сервер может отсылать данные из базы данных в виде <strong>HTML</strong>, <strong>XML</strong> или <strong>JSON</strong>, ни один из которых не является типом хранения внутри сервера.</p>
</li>
<li>
<p><strong>Манипуляция ресурсами через представление</strong>. Если клиент хранит представление ресурса, включая метаданные — он обладает достаточной информацией для модификации или удаления ресурса.</p>
</li>
<li>
<p><strong>«Самоописываемые» сообщения</strong>. Каждое сообщение содержит достаточно информации, чтобы понять, каким образом его обрабатывать. К примеру, обработчик сообщения (<strong>parser</strong>), необходимый для извлечения данных, может быть указан в списке <strong>MIME</strong>-типов.</p>
</li>
<li>
<p><strong>Гипермедиа как средство изменения состояния приложения</strong> (<strong>HATEOAS</strong>). Клиенты изменяют состояние системы только через действия, которые динамически определены в гипермедиа на сервере (к примеру, гиперссылки в гипертексте). Исключая простые точки входа в приложение, клиент не может предположить, что доступна какая-то операция над каким-то ресурсом, если не получил информацию об этом в предыдущих запросах к серверу. Не существует универсального формата для предоставления ссылок между ресурсами, <strong>Web Linking</strong> (<strong>RFC 5988</strong> &#8594; <strong>RFC 8288</strong>) и J<strong>SON Hypermedia API Language</strong> являются двумя популярными форматами предоставления ссылок в <strong>REST HYPERMEDIA</strong> сервисах.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_слои">Слои</h5>
<div class="paragraph">
<p>Клиент обычно не способен точно определить, взаимодействует он напрямую с сервером или же с промежуточным узлом, в связи с иерархической структурой сетей (подразумевая, что такая структура образует слои). Применение промежуточных серверов способно повысить масштабируемость за счёт балансировки нагрузки и распределённого кэширования. Промежуточные узлы также могут подчиняться политике безопасности с целью обеспечения конфиденциальности информации</p>
</div>
</div>
<div class="sect4">
<h5 id="_код_по_требованию_необязательное_ограничение">Код по требованию (необязательное ограничение)</h5>
<div class="paragraph">
<p><strong>REST</strong> может позволить расширить функциональность клиента за счёт загрузки кода с сервера в виде апплетов или сценариев. Филдинг утверждает, что дополнительное ограничение позволяет проектировать архитектуру, поддерживающую желаемую функциональность в общем случае, но, возможно, за исключением некоторых контекстов.</p>
</div>
</div>
<div class="sect4">
<h5 id="_преимущества_2">Преимущества</h5>
<div class="paragraph">
<p>Преимущества:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Легко разрабатывать</p>
</li>
<li>
<p>Производительность (за счёт использования кэша);</p>
</li>
<li>
<p>Может возвращать ответ в разных видах (<strong>HTML</strong>, <strong>XML</strong>, <strong>JSON</strong>, строка и т.д.)</p>
</li>
<li>
<p>Легко вносить изменения без изменения клиента</p>
</li>
<li>
<p>Надёжность (за счёт отсутствия необходимости сохранять информацию о состоянии клиента, которая может быть утеряна);</p>
</li>
<li>
<p>Масштабируемость;</p>
</li>
<li>
<p>Простота интерфейсов;</p>
</li>
<li>
<p>Портативность компонентов;</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_недостатки_2">Недостатки</h5>
<div class="paragraph">
<p>Недостатки:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Не сохраняет состояния (<strong>HTTP</strong> не сохраняет состояние)</p>
</li>
<li>
<p>Важный недостаток <strong>REST API</strong> — слабая устойчивость к взлому.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_отличия_rest_от_soap">7.3.3. Отличия <code>REST</code> от <code>SOAP</code></h4>
<div class="paragraph">
<p><strong>REST</strong> и <strong>SOAP</strong> на самом деле не сопоставимы. <strong>REST</strong> — это архитектурный стиль. <strong>SOAP</strong> — это протокол отправки сообщения. Давайте сравним популярные реализации стилей <strong>REST</strong> и <strong>SOAP</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>SOAP</strong> это протокол, <strong>REST</strong> – это архитектурный стиль, <strong>SOAP</strong> имеет веб-сервис <strong>WSDL</strong> с прописанными методами, которые можно удаленно вызывать.</p>
</li>
<li>
<p><strong>REST</strong> использует <strong>JSON</strong> и <strong>XML</strong>, <strong>SOAP</strong> только <strong>XML</strong>.</p>
</li>
<li>
<p><strong>REST</strong> работает только по <strong>HTTP/HTTPS</strong>, <strong>SOAP</strong> с любым протоколом прикладного уровня: <strong>SMPT</strong>, <strong>FTP</strong>, <strong>HTTP</strong>, <strong>HTTPS</strong>, <strong>POP3</strong></p>
</li>
<li>
<p><strong>REST</strong> более простой, гибкий и быстрый, <strong>SOAP</strong> типизированный, но в некоторых случаях лучше визуализируется за счет применения им синтаксиса похожего на <strong>HTML</strong> разметку.</p>
</li>
<li>
<p><strong>RESTFful</strong> веб-сервисы, как правило, гораздо проще реализовать, чем веб-сервисы на основе <strong>SOAP</strong>.</p>
</li>
<li>
<p>В <strong>REST</strong> легко изменять функционал без изменения клиента, в то время в <strong>SOAP</strong> после изменений необходимо изменять WSDL и, следовательно, вносить изменения на клиенте.</p>
</li>
<li>
<p><strong>REST</strong> может работать с ресурсами. Каждый <strong>URL</strong> это представление какого-либо ресурса. <strong>SOAP</strong> работает с операциями, которые реализуют какую-то бизнес-логику с помощью нескольких интерфейсов.</p>
</li>
<li>
<p><strong>SOAP</strong> на основе чтения не может быть помещена в кэш, а <strong>REST</strong> в этом случае может быть закэширован.</p>
</li>
<li>
<p><strong>SOAP</strong> поддерживает <strong>TLS</strong> и <strong>WS-security</strong>, в то время как <strong>REST</strong> - только <strong>TLS</strong>.</p>
</li>
<li>
<p><strong>SOAP</strong> поддерживает <strong>ACID</strong> (<strong>Atomicity</strong>, <strong>Consistency</strong>, <strong>Isolation</strong>, <strong>Durability</strong>). <strong>REST</strong> поддерживает транзакции, но не один из <strong>ACID</strong> не совместим с двух фазовым коммитом.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_links_6">7.3.4. Links</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://habr.com/ru/post/46374/">Веб-сервисы в теории и на практике для начинающих</a></p>
</li>
<li>
<p><a href="https://javarush.ru/groups/posts/1168-veb-servisih-shag-1-chto-takoe-veb-servis-i-kak-s-nim-rabotatjh">Веб-сервисы. Шаг 1. Что такое веб-сервис и как с ним работать?</a></p>
</li>
<li>
<p><a href="https://ru.wikipedia.org/wiki/SOAP">Wikipedia: SOAP</a></p>
</li>
<li>
<p><a href="http://khpi-iip.mipk.kharkiv.edu/library/sotii/lectures/Lecture5.pdf">Стандарт SOAP – протокол взаимодействия сервисов</a></p>
</li>
<li>
<p><a href="https://www.tutorialspoint.com/wsdl/wsdl_example.htm">WSDL - Example</a></p>
</li>
<li>
<p><a href="https://coderlessons.com/tutorials/xml-tekhnologii/uznaite-wsdl/wsdl-kratkoe-rukovodstvo">WSDL — Краткое руководство</a></p>
</li>
<li>
<p><a href="http://java-online.ru/web-service.xhtml">Описание WEB-сервисов, XML-RPC</a></p>
</li>
<li>
<p><a href="https://glebradchenko.susu.ru/courses/bachelor/odp/2013/SUSU_Distr_09_SOAP_01.pdf">Распределенные вычислительные системы</a></p>
</li>
<li>
<p><a href="http://art-in-stamps.ru/development/restful-web-services.shtml">Веб-сервисы RESTful</a></p>
</li>
<li>
<p><a href="https://habr.com/ru/post/483202/">Введение в REST API — RESTful веб-сервисы</a></p>
</li>
<li>
<p><a href="https://javarush.ru/groups/posts/2486-obzor-rest-chastjh-1-chto-takoe-rest">Обзор REST. Часть 1: что такое REST</a></p>
</li>
<li>
<p><a href="https://www.intervolga.ru/blog/projects/relsy-veb-integratsii-rest-i-soap/">Рельсы веб-интеграции. REST и SOAP</a></p>
</li>
<li>
<p><a href="http://citforum.ru/internet/webservice/soap_rest/">SOAP и REST, вместе или порознь?</a></p>
</li>
<li>
<p><a href="https://qastart.by/class-2/23-rest-soap">REST / SOAP</a></p>
</li>
<li>
<p><a href="https://habr.com/ru/post/483204/">Различия REST и SOAP</a></p>
</li>
<li>
<p><a href="https://jsehelper.blogspot.com/2016/04/web-services.html">Ответы на вопросы на собеседование Web services</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=P2wA_JehjK8&amp;ab_channel=SergeyNemchinskiy">YouTube: Rest web-services vs SOAP Services</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=oetMZo2PEFc&amp;t=794s&amp;ab_channel=javabegin">YouTube: Введение в веб сервисы</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=2YWfJHDNQy0&amp;t=40s&amp;ab_channel=okiseleva">YouTube: Введение в SOAP и REST: что это и с чем едят</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-12-17 03:24:35 UTC
</div>
</div>
</body>
</html>