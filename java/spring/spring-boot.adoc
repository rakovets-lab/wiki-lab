= Spring Boot
:imagesdir: ../../assets/img/java/spring/boot

== Введение в Spring Boot

*Spring Boot* — самый популярный фреймворк на основе Java, построенный на базе функций *Spring Framework*. Он используется для создания простых и понятных в понимании standalone (автономных) и web-based (веб) приложений.

=== Что такое Spring Boot?

*Spring Boot* — это проект с открытым исходным кодом, разработанный командой *Pivotal* (команда *Spring*). Он построен на основе *Spring Framework* и предоставляет собой *RAD* (*Rapid Application Development*/*Быстрая разработка приложений*) на основе *Spring Framework*. Он комбинирует *Spring Framework* и third-party libraries (сторонние библиотеки), которые упрощают создание приложений и уменьшения усилия по разработке. В отличие от *Spring Framework*, *Spring Boot* не требует конфигурации на основе XML или аннотаций, поскольку он автоматически настраивает *Spring* и сторонние библиотеки.

Целью платформы *Spring Boot* является полное удаление конфигураций на основе XML и сокращение времени разработки и интеграционного тестирования.

Цели *Spring Boot* перечислены ниже:

* Предложить полный *Opinionated Development Approach*.
* Обеспечить большую часть функционала неявно или по умолчанию.
* Избегать написания множества строк кода.

=== Необходимость использования Spring Boot

Некоторые из основных факторов использования среды Spring Boot перечислены ниже:

* Он обеспечивает гибкость и простоту при разработке приложений на основе Java.
* Он позволяет создавать менее трудоемкие приложения, так как большинство вещей управляются им по умолчанию.
* Он не требует какой-либо конфигурации на основе XML или Java, поскольку он автоматически настраивает Spring и сторонние библиотеки.
* Он также обеспечивает мощную batch (пакетную) обработку и гибкие транзакции базы данных.

=== Компоненты Spring Boot

image::components.png[]

As we have discussed, the Spring Boot framework is an upgraded project of the Spring framework with some additional features and components. There are four major components of Spring Boot that are listed below:

*Spring Boot* — это обновленный проект среды Spring с некоторыми дополнительными функциями и компонентами. Ниже перечислены четыре основных компонента *Spring Boot*:

* *Spring Boot Starters*
* *Spring Boot AutoConfiguration*
* *Spring Boot CLI*
* *Spring Boot Actuator*

Наряду с перечисленными выше основными компонентами в *Spring Boot* доступны еще два дополнительных компонента:

* *Spring Initializr*
* *Spring Boot IDEs*

==== Spring Boot Starters

*Spring Boot Starters* — один из основных компонентов среды *Spring Boot*. Он связывает более одной зависимости в группе. Это также уменьшает количество зависимостей, добавляемых вручную, путем объединения нескольких зависимостей в одну. Таким образом, он добавляет стартер вместо указания множества зависимостей.

Например, когда создается приложение *Spring MVC*, требуется множество зависимостей, таких как:

* *Spring Core*
* *Spring Web MVC*
* *Spring Web*

Наряду с приведенными выше зависимостями необходимы еще некоторые зависимости. Ручное добавление зависимостей загромождает код. Spring Boot предложил решение этой проблемы.

Spring Boot упрощает задачу, поскольку добавляет только *root dependency* (корневую зависимость) или *starter dependency* (начальную зависимость). Когда добавляется starter зависимость в приложение, *Spring Boot* автоматически добавляет в приложение все необходимые зависимости.

==== Spring Boot AutoConfiguration

*Spring Boot AutoConfiguration* также является важным компонентом *Spring Boot*. Когда создается любое приложение Spring, нам требуется много кода конфигурации, например конфигурации на основе XML, Java или аннотаций. В большинстве приложений это создает много путаницы и к трате большого количества времени на это.


Поэтому для решения проблемы возник *Spring Boot AutoConfiguration*. Он отвечает за сокращение конфигурации Spring. При создании *Spring Boot* приложения  нет необходимости определять какую-либо конфигурацию (на основе XML) и сократить использование конфигурации на основе аннотаций. Использование *Spring Boot AutoConfiguration* делает разработку приложений простой и быстрой, поскольку ее настройка не отнимает много времени.

Например, если использовать стартер `spring-boot-starter-web` в приложении, *Spring Boot* автоматически настраивает все bean-компоненты или классы необходимые для web-приложения.

==== Spring Boot CLI

*Spring Boot CLI* (*Command Line Interface*) — это интерфейс командной строки для приложений на основе *Spring Boot*. Он позволяет запустить приложение Spring Boot с помощью CLI. Он также используется для тестирования приложений Spring Boot из командной строки. Используя интерфейс командной строки Spring Boot, также можно выполнять Groovy код, который имеет аналогичный синтаксис, подобный Java.

При запуске некоторых приложений *Spring Boot* через *CLI* он под капотом использует компоненты *Spring Boot Starter* и *Spring Boot AutoConfiguration* для решения всех зависимостей и запуску приложения.

==== Spring Boot Actuator

*Spring Boot Actuator* также является важным компонентом *Spring Boot*. Он также разрабатывается как подпроект (инструмент) Spring Boot. Он предоставляет множество функций для среды Spring Boot, но в основном отвечает за две его основные функции:

* Он предоставляет (HTTP) EndPoints для управления (HTTP) для приложения на Spring Boot.
* Он позволяет управлять работающим приложениям с помощью этих HTTP EndPoints.

*Spring Boot Actuator* автоматически предоставляет имя хоста как `localhost` и номер порта как `8080` всякий раз, когда развертывается приложение Spring Boot с помощью интерфейса командной строки Spring Boot. Здесь обычно используются HTTP-методы GET или POST для взаимодействия с HTTP EndPoints по средствам *Spring Boot Actuator*.

Spring Boot Actuator в основном используется для доступа к внутренней информации приложения, такой как metrics (метрики), dump (дамп), health (работоспособность) и т.д.

==== Spring Initializr

*Spring Initializr* — это веб-интерфейс для создания, настройки и создания приложений на базе Spring. Другими словами, это инструмент, который используется для быстрого создания проекта на основе JVM. Он может создавать проекты на различных языках, таких как Java, Kotlin и Groovy. Он также предоставляет скрипт (*Maven* или *Gradle*) для создания приложений.

==== Spring Boot IDEs

*Spring Boot* поддерживает множество *IDE*, таких, как *Eclipse*, *IntelliJ IDEA*, *Spring Tool Suite* (*STS*) и т.д., которые используются для создания приложений.

=== Преимущества Spring Boot

Основное преимущество Spring Boot заключается в том, что он состоит из фреймворка Spring и Embedded HTTP server. Но конфигурации на основе XML и аннотаций почти нет.

image::advantages.png[]

Другие преимущества среды Spring Boot приведены ниже:

* С ним легко разрабатывать приложения на основе Spring с помощью Groovy и Java.
* Он повышает производительность и сокращает время разработки, поскольку большинство вещей управляются по умолчанию.
* Он сводит к минимуму написание типичного длинного кода, такого как конфигурация на основе XML и аннотаций.
* Он делает простой и плавной интеграцию Spring Boot с другими экосистемами, такими как Spring Security, Spring Data, Spring JDBC и ORM.
* Он также предоставляет встроенные HTTP-серверы, такие, как *Apache Tomcat*, *Apache Jetty*, сервер приложений *Undertow* и многие другие, для развертывания и тестирования приложений на основе Spring.
* Он также предлагает несколько плагинов для простой разработки и тестирования приложений Spring Boot с использованием инструментов сборки, таких как Maven.

=== Ограничения Spring Boot

Некоторые из ограничений Spring Boot перечислены ниже:

* Он содержит некоторые дополнительные зависимости, которые могут быть бесполезны для конкретного приложения, поскольку используется *Spring Boot Starters* (root dependencies).
* Ненужные зависимости, используемые в приложениях, приводят к огромному размеру приложения.
* Преобразование приложений на *Spring Framework* в приложения на *Spring Boot* занимает немного времени.

== Spring Boot Features

*Spring Boot* построена на основе *Spring Framework*. Фактически он является улучшенной версией проекта *Spring*, поэтому он способен делать то, что не может сделать *Spring Framework*.

Ключевые особенности среды *Spring Boot* перечислены ниже:

.Features of Spring Boot
image:features.png[]

* SpringApplication
* Lazy Initialization
* Admin Features
* Security
* Logging
* Caching
* Kotlin Support
* Validation
* JSON
* Testing
* Task Execution and Scheduling

=== SpringApplication

Класс `SpringApplication` в основном используется для начальной загрузки и запуска приложения Spring с использованием `main()` метода. В некоторых случаях можно использовать статический метод `SpringApplication.run()`.

[source,java]
----
public class MyFirstSpringApp {
    public static void main(String[] args) {
           SpringApplication.run(MyFirstSpringApp.class, args);
    }
}
----

По умолчанию в logs отображаются информация о запуске Spring приложения. Эти logs о запуске можно отключить, установив для `spring.main.log-startup-info` значение `false` в `application.properties`.

=== Lazy Initialization

В Spring Boot `SpringApplication` помогает lazy (отложенной/ленивой) инициализации Spring приложений. После включения lazy (отложенной/ленивой) инициализации bean-компоненты создаются по мере необходимости, а не во время запуска приложения, что приводит к более быстрому старту приложения. При включении lazy (отложенной/ленивой) инициализации в веб-приложении некоторые веб-компоненты не инициализируются до тех пор, пока не будет получен HTTP-запрос.

Включить lazy (отложенной/ленивой) инициализацию тремя способами:

1. С помощью метода `lazyInitialization()` класса `SpringApplicationBuilder`.
2. С помощью метода `setLazyInitialization()` класса `SpringApplication`.
3. С помощью свойства `spring.main.lazy-initialization=true`.

=== Admin Features

В Spring Boot можно включить функции, связанные с администрированием, указав свойство `spring.application.admin.enabled=true`. Это позволит использовать задействовать интерфейс `SpringApplicationAdminMXBean` на платформе `MBeanServer` . Он используется для реализации wrapper services (служб-оболочек), а также для администрирования Spring Boot приложений.

=== Security

*Spring Boot* приложения — это приложения на основе Spring. Поэтому Spring Boot приложения очень безопасны и основаны на стратегиях безопасности Spring. Аннотация `@EnableGlobalMethodSecurity` используется для добавления безопасности на уровне метода в веб-приложение.

=== Logging

*Spring Boot* использует *Commons-logging* для всех внутренних logs, который представляет собой Java-based programming model service для logging и других наборов инструментов. Некоторые конфигурации по умолчанию также предоставляются для *Log4J2*, *Logback* и *Java Util Logging*.

=== Caching

*Кэширование* поддерживается Spring Boot. Кэширование также применяется и к методам приложений, что приводит к уменьшению количества выполнений на основе информации, доступной в кеше. Spring Boot автоматически настраивает кэш, а поддержка кэширования включается с помощью аннотации `@EnableCaching`.

=== Kotlin Support

*Kotlin* — это язык программирования, используемый для Android, серверной, мобильной кроссплатформенной и веб-разработки. Он предназначен для JVM и других платформ, которые позволяют писать короткий и простой код, обеспечивая при этом взаимодействие с другими существующими библиотеками Java.

=== Validation

Validation (валидация) автоматически поддерживается Spring Boot. Spring Boot позволяет аннотировать методы bean-компонента ограничением `javax.validation` для их полей и возвращаемых значений. Целевые классы аннотируются аннотацией `@Validated` и просматриваются validator (валидатором) при validation (валидации).

=== JSON

Spring Boot предлагает интеграцию с тремя основными библиотеками для JSON mapping:

* *Jackson* +
*Jackson* — это библиотека JSON по умолчанию и наиболее предпочтительная. Входит в стартер `spring-boot-starter-json`. Конфигурация *Jackson* предоставляется по умолчанию. Компонент `ObjectMapper` настраивается автоматически, когда *Jackson* находится в classpath. Он также предлагает несколько свойств конфигурации для настройки конфигурации `ObjectMapper`.

* *Gson* +
Конфигурация *Gson* предоставляется по умолчанию. Поэтому он автоматически настраивается, когда *Gson* находится в classpath. Существует несколько свойств конфигурации `spring.gson.*` для изменения конфигураций. Так же для управления конфигурациями используется компонент `GsonBuilderCustomizer`.

* *JSON-B* +
Автоматическая настройка для *JSON-B* также предоставляется по умолчанию. Компонент *JSON-B* настраивается автоматически, когда API для JSON-B и его реализация находятся в classpath.

=== Testing

*Spring Boot* предоставляет множество утилит и аннотаций, помогающих тестировать приложения. Есть два модуля, которые обеспечивают поддержку тестирования:

** `spring-boot-test` - содержит все основные элементы,
** `spring-boot-test-autoconfigure` - поддерживает автоматическую настройку для тестов.

=== Task Execution and Scheduling

Если компонент `Executor` отсутствует в контексте, Spring Boot автоматически настраивает `ThreadPoolTaskExecutor`. В зависимости от цели можно изменить bean-компонент `Executor` на `ThreadPoolTaskExecutor` или определить как `ThreadPoolTaskExecutor`, так и `AsyncConfiguration`.

==  Spring Boot Architecture

*Spring Boot* — это расширенная версия или проект *Spring Framework*. Наряду с *Spring Framework* он также состоит из third-party libraries (сторонних библиотек) и Embedded HTTP servers. Он легко создает готовые к работе, менее трудоемкие и автономные приложения на основе *Spring Framework*.

Цель *Spring Boot* — полностью отказаться от использования конфигурации на основе XML и аннотаций в приложениях. Используя *Spring Boot*, можно создать приложение с минимальными усилиями (меньше времени и усилий). По умолчанию он предлагает большинство вещей, необходимых для разработки.

*Spring Boot* следует многоуровневой архитектуре и состоит из четырех слоев, как показано ниже.

* *Presentation Layer*
* *Business Layer*
* *Persistence Layer*
* *Database Layer*

.Spring Boot Architecture
image::architecture-1.png[]

На приведенной выше диаграмме показано, что каждый уровень архитектуры напрямую взаимодействует с уровнем, расположенным чуть выше или ниже него, благодаря workflow (рабочему процессу). Это означает, что каждый уровень зависит только от соседнего с ним уровня, поэтому, если изменяется API (не реализация этого API) одного уровня, то просто нужно обновить смежные с ним слои.

Краткое описание слоев приведено ниже.

* *Presentation layer* +
Это front layer или верхний слой архитектуры, так как он состоит из views (представлений). Он используется для преобразования полей JSON в объекты и наоборот, а также обрабатывает аутентификацию и HTTP запросы. После завершения аутентификации он передает ее на business layer (бизнес-уровень) для дальнейшей обработки.

* *Business Layer* +
Обрабатывает всю бизнес-логику, а также выполняет validation и authorization, поскольку является частью бизнес-логики. Например, только администраторы могут изменять учетную запись пользователя.

* *Persistence Layer*+
Содержит всю логику хранилища, например, запросы к базе данных приложения. Он также переводит бизнес-объекты из/в записи в базе данных.

* *Database Layer*+
Уровень базы данных состоит из базы данных, такой как *MariaDB*, *PostgreSQL*, *MongoDB* и т.д. Он может содержать несколько баз данных. Все операции, связанные с базой данных, такие как CRUD (создание, чтение/извлечение, обновление и удаление), выполняются на этом уровне.

Реализация вышеописанной многоуровневой архитектуры выполняется таким образом:

HTTP-запросы или веб-запросы обрабатываются Controllers на presentation layer, services контролируют business logic, а repositories обрабатывают persistence (логику хранения). Controller может использовать несколько services, service может использовать несколько repositories, а репозиторий может использовать несколько баз данных.

=== Spring Boot Workflow

Архитектура Spring Boot основана на *Spring Framework*. Таким образом, он в основном использует все функции и модули Spring-подобных *Spring MVC*, *Spring Core* и т.д., за исключением того, что нет необходимости в классах *DAO* и *DAOImpl*.

На следующей диаграмме показан workflow Spring Boot.

.Spring Boot Architecture
image::architecture-2.png[]

* Клиент делает HTTP-запрос (GET или POST).
* Запрос пересылается Controller, который сопоставляет запрос и обрабатывает его. При необходимости он также вызывает логику Service.
* Бизнес-логика выполняется на уровне Service, а логика выполняется с данными из базы данных, которые сопоставляются с Model или Entity class по средствам JPA.
* Страница JSP возвращается в качестве ответа клиенту, если не произошло ошибки.
